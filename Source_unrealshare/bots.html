<html>
<head>
	<title>Unreal Tournament UnrealScript - Source: UnrealShare.Bots</title>
	<meta name="Generator" value="UnCodeX 202">
	<link rel="stylesheet" href="..\DocStyle2.css" type="text/css">
	<!--[if IE]>
	<link rel="stylesheet" href="..\DocStyle2-msie.css" type="text/css">
	<![endif]-->
</head>
<body>

<div class="header">
<table class="header">
<tr class="header">
	<td class="header"><a href="..\overview.html">Overview</a></td>
	<td class="header"><a href="..\unrealshare\unrealshare-overview.html">Package</a></td>
	<td class="header"><a href="..\unrealshare\bots.html">Class</a></td>
	<td class="header_hilight">Source</td>
	<td class="header"><a class="header" href="..\classtree.html#Bots">Class tree</a></td>
	<td class="header"><a class="header" href="..\glossary_A.html">Glossary</a></a>
	<td class="logo" rowspan="2">UnrealScript<br />Documentation</td>
</tr>
<tr>
	<td class="subheader" colspan="3"><a href="botinfo.html">previous class</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="boulder.html">next class</a></td>
	<td class="subheader" colspan="2"><a href="..\index.html" target="_top">frames</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="" target="_top">no frames</a></td>
</tr>
</table>
</div>
<div class="spacer"></div>

<h1><a href="..\unrealshare\unrealshare-overview.html">UnrealShare</a>.<a href="..\unrealshare\bots.html">Bots</a></h1>
<br />
<div class="source"><table class="source"><tr><td class="source_lineno"><font class="source_lineno">00001<br>
00002<br>
00003<br>
00004<br>
00005<br>
00006<br>
00007<br>
00008<br>
00009<br>
00010<br>
00011<br>
00012<br>
00013<br>
00014<br>
00015<br>
00016<br>
00017<br>
00018<br>
00019<br>
00020<br>
00021<br>
00022<br>
00023<br>
00024<br>
00025<br>
00026<br>
00027<br>
00028<br>
00029<br>
00030<br>
00031<br>
00032<br>
00033<br>
00034<br>
00035<br>
00036<br>
00037<br>
00038<br>
00039<br>
00040<br>
00041<br>
00042<br>
00043<br>
00044<br>
00045<br>
00046<br>
00047<br>
00048<br>
00049<br>
00050<br>
00051<br>
00052<br>
00053<br>
00054<br>
00055<br>
00056<br>
00057<br>
00058<br>
00059<br>
00060<br>
00061<br>
00062<br>
00063<br>
00064<br>
00065<br>
00066<br>
00067<br>
00068<br>
00069<br>
00070<br>
00071<br>
00072<br>
00073<br>
00074<br>
00075<br>
00076<br>
00077<br>
00078<br>
00079<br>
00080<br>
00081<br>
00082<br>
00083<br>
00084<br>
00085<br>
00086<br>
00087<br>
00088<br>
00089<br>
00090<br>
00091<br>
00092<br>
00093<br>
00094<br>
00095<br>
00096<br>
00097<br>
00098<br>
00099<br>
00100<br>
00101<br>
00102<br>
00103<br>
00104<br>
00105<br>
00106<br>
00107<br>
00108<br>
00109<br>
00110<br>
00111<br>
00112<br>
00113<br>
00114<br>
00115<br>
00116<br>
00117<br>
00118<br>
00119<br>
00120<br>
00121<br>
00122<br>
00123<br>
00124<br>
00125<br>
00126<br>
00127<br>
00128<br>
00129<br>
00130<br>
00131<br>
00132<br>
00133<br>
00134<br>
00135<br>
00136<br>
00137<br>
00138<br>
00139<br>
00140<br>
00141<br>
00142<br>
00143<br>
00144<br>
00145<br>
00146<br>
00147<br>
00148<br>
00149<br>
00150<br>
00151<br>
00152<br>
00153<br>
00154<br>
00155<br>
00156<br>
00157<br>
00158<br>
00159<br>
00160<br>
00161<br>
00162<br>
00163<br>
00164<br>
00165<br>
00166<br>
00167<br>
00168<br>
00169<br>
00170<br>
00171<br>
00172<br>
00173<br>
00174<br>
00175<br>
00176<br>
00177<br>
00178<br>
00179<br>
00180<br>
00181<br>
00182<br>
00183<br>
00184<br>
00185<br>
00186<br>
00187<br>
00188<br>
00189<br>
00190<br>
00191<br>
00192<br>
00193<br>
00194<br>
00195<br>
00196<br>
00197<br>
00198<br>
00199<br>
00200<br>
00201<br>
00202<br>
00203<br>
00204<br>
00205<br>
00206<br>
00207<br>
00208<br>
00209<br>
00210<br>
00211<br>
00212<br>
00213<br>
00214<br>
00215<br>
00216<br>
00217<br>
00218<br>
00219<br>
00220<br>
00221<br>
00222<br>
00223<br>
00224<br>
00225<br>
00226<br>
00227<br>
00228<br>
00229<br>
00230<br>
00231<br>
00232<br>
00233<br>
00234<br>
00235<br>
00236<br>
00237<br>
00238<br>
00239<br>
00240<br>
00241<br>
00242<br>
00243<br>
00244<br>
00245<br>
00246<br>
00247<br>
00248<br>
00249<br>
00250<br>
00251<br>
00252<br>
00253<br>
00254<br>
00255<br>
00256<br>
00257<br>
00258<br>
00259<br>
00260<br>
00261<br>
00262<br>
00263<br>
00264<br>
00265<br>
00266<br>
00267<br>
00268<br>
00269<br>
00270<br>
00271<br>
00272<br>
00273<br>
00274<br>
00275<br>
00276<br>
00277<br>
00278<br>
00279<br>
00280<br>
00281<br>
00282<br>
00283<br>
00284<br>
00285<br>
00286<br>
00287<br>
00288<br>
00289<br>
00290<br>
00291<br>
00292<br>
00293<br>
00294<br>
00295<br>
00296<br>
00297<br>
00298<br>
00299<br>
00300<br>
00301<br>
00302<br>
00303<br>
00304<br>
00305<br>
00306<br>
00307<br>
00308<br>
00309<br>
00310<br>
00311<br>
00312<br>
00313<br>
00314<br>
00315<br>
00316<br>
00317<br>
00318<br>
00319<br>
00320<br>
00321<br>
00322<br>
00323<br>
00324<br>
00325<br>
00326<br>
00327<br>
00328<br>
00329<br>
00330<br>
00331<br>
00332<br>
00333<br>
00334<br>
00335<br>
00336<br>
00337<br>
00338<br>
00339<br>
00340<br>
00341<br>
00342<br>
00343<br>
00344<br>
00345<br>
00346<br>
00347<br>
00348<br>
00349<br>
00350<br>
00351<br>
00352<br>
00353<br>
00354<br>
00355<br>
00356<br>
00357<br>
00358<br>
00359<br>
00360<br>
00361<br>
00362<br>
00363<br>
00364<br>
00365<br>
00366<br>
00367<br>
00368<br>
00369<br>
00370<br>
00371<br>
00372<br>
00373<br>
00374<br>
00375<br>
00376<br>
00377<br>
00378<br>
00379<br>
00380<br>
00381<br>
00382<br>
00383<br>
00384<br>
00385<br>
00386<br>
00387<br>
00388<br>
00389<br>
00390<br>
00391<br>
00392<br>
00393<br>
00394<br>
00395<br>
00396<br>
00397<br>
00398<br>
00399<br>
00400<br>
00401<br>
00402<br>
00403<br>
00404<br>
00405<br>
00406<br>
00407<br>
00408<br>
00409<br>
00410<br>
00411<br>
00412<br>
00413<br>
00414<br>
00415<br>
00416<br>
00417<br>
00418<br>
00419<br>
00420<br>
00421<br>
00422<br>
00423<br>
00424<br>
00425<br>
00426<br>
00427<br>
00428<br>
00429<br>
00430<br>
00431<br>
00432<br>
00433<br>
00434<br>
00435<br>
00436<br>
00437<br>
00438<br>
00439<br>
00440<br>
00441<br>
00442<br>
00443<br>
00444<br>
00445<br>
00446<br>
00447<br>
00448<br>
00449<br>
00450<br>
00451<br>
00452<br>
00453<br>
00454<br>
00455<br>
00456<br>
00457<br>
00458<br>
00459<br>
00460<br>
00461<br>
00462<br>
00463<br>
00464<br>
00465<br>
00466<br>
00467<br>
00468<br>
00469<br>
00470<br>
00471<br>
00472<br>
00473<br>
00474<br>
00475<br>
00476<br>
00477<br>
00478<br>
00479<br>
00480<br>
00481<br>
00482<br>
00483<br>
00484<br>
00485<br>
00486<br>
00487<br>
00488<br>
00489<br>
00490<br>
00491<br>
00492<br>
00493<br>
00494<br>
00495<br>
00496<br>
00497<br>
00498<br>
00499<br>
00500<br>
00501<br>
00502<br>
00503<br>
00504<br>
00505<br>
00506<br>
00507<br>
00508<br>
00509<br>
00510<br>
00511<br>
00512<br>
00513<br>
00514<br>
00515<br>
00516<br>
00517<br>
00518<br>
00519<br>
00520<br>
00521<br>
00522<br>
00523<br>
00524<br>
00525<br>
00526<br>
00527<br>
00528<br>
00529<br>
00530<br>
00531<br>
00532<br>
00533<br>
00534<br>
00535<br>
00536<br>
00537<br>
00538<br>
00539<br>
00540<br>
00541<br>
00542<br>
00543<br>
00544<br>
00545<br>
00546<br>
00547<br>
00548<br>
00549<br>
00550<br>
00551<br>
00552<br>
00553<br>
00554<br>
00555<br>
00556<br>
00557<br>
00558<br>
00559<br>
00560<br>
00561<br>
00562<br>
00563<br>
00564<br>
00565<br>
00566<br>
00567<br>
00568<br>
00569<br>
00570<br>
00571<br>
00572<br>
00573<br>
00574<br>
00575<br>
00576<br>
00577<br>
00578<br>
00579<br>
00580<br>
00581<br>
00582<br>
00583<br>
00584<br>
00585<br>
00586<br>
00587<br>
00588<br>
00589<br>
00590<br>
00591<br>
00592<br>
00593<br>
00594<br>
00595<br>
00596<br>
00597<br>
00598<br>
00599<br>
00600<br>
00601<br>
00602<br>
00603<br>
00604<br>
00605<br>
00606<br>
00607<br>
00608<br>
00609<br>
00610<br>
00611<br>
00612<br>
00613<br>
00614<br>
00615<br>
00616<br>
00617<br>
00618<br>
00619<br>
00620<br>
00621<br>
00622<br>
00623<br>
00624<br>
00625<br>
00626<br>
00627<br>
00628<br>
00629<br>
00630<br>
00631<br>
00632<br>
00633<br>
00634<br>
00635<br>
00636<br>
00637<br>
00638<br>
00639<br>
00640<br>
00641<br>
00642<br>
00643<br>
00644<br>
00645<br>
00646<br>
00647<br>
00648<br>
00649<br>
00650<br>
00651<br>
00652<br>
00653<br>
00654<br>
00655<br>
00656<br>
00657<br>
00658<br>
00659<br>
00660<br>
00661<br>
00662<br>
00663<br>
00664<br>
00665<br>
00666<br>
00667<br>
00668<br>
00669<br>
00670<br>
00671<br>
00672<br>
00673<br>
00674<br>
00675<br>
00676<br>
00677<br>
00678<br>
00679<br>
00680<br>
00681<br>
00682<br>
00683<br>
00684<br>
00685<br>
00686<br>
00687<br>
00688<br>
00689<br>
00690<br>
00691<br>
00692<br>
00693<br>
00694<br>
00695<br>
00696<br>
00697<br>
00698<br>
00699<br>
00700<br>
00701<br>
00702<br>
00703<br>
00704<br>
00705<br>
00706<br>
00707<br>
00708<br>
00709<br>
00710<br>
00711<br>
00712<br>
00713<br>
00714<br>
00715<br>
00716<br>
00717<br>
00718<br>
00719<br>
00720<br>
00721<br>
00722<br>
00723<br>
00724<br>
00725<br>
00726<br>
00727<br>
00728<br>
00729<br>
00730<br>
00731<br>
00732<br>
00733<br>
00734<br>
00735<br>
00736<br>
00737<br>
00738<br>
00739<br>
00740<br>
00741<br>
00742<br>
00743<br>
00744<br>
00745<br>
00746<br>
00747<br>
00748<br>
00749<br>
00750<br>
00751<br>
00752<br>
00753<br>
00754<br>
00755<br>
00756<br>
00757<br>
00758<br>
00759<br>
00760<br>
00761<br>
00762<br>
00763<br>
00764<br>
00765<br>
00766<br>
00767<br>
00768<br>
00769<br>
00770<br>
00771<br>
00772<br>
00773<br>
00774<br>
00775<br>
00776<br>
00777<br>
00778<br>
00779<br>
00780<br>
00781<br>
00782<br>
00783<br>
00784<br>
00785<br>
00786<br>
00787<br>
00788<br>
00789<br>
00790<br>
00791<br>
00792<br>
00793<br>
00794<br>
00795<br>
00796<br>
00797<br>
00798<br>
00799<br>
00800<br>
00801<br>
00802<br>
00803<br>
00804<br>
00805<br>
00806<br>
00807<br>
00808<br>
00809<br>
00810<br>
00811<br>
00812<br>
00813<br>
00814<br>
00815<br>
00816<br>
00817<br>
00818<br>
00819<br>
00820<br>
00821<br>
00822<br>
00823<br>
00824<br>
00825<br>
00826<br>
00827<br>
00828<br>
00829<br>
00830<br>
00831<br>
00832<br>
00833<br>
00834<br>
00835<br>
00836<br>
00837<br>
00838<br>
00839<br>
00840<br>
00841<br>
00842<br>
00843<br>
00844<br>
00845<br>
00846<br>
00847<br>
00848<br>
00849<br>
00850<br>
00851<br>
00852<br>
00853<br>
00854<br>
00855<br>
00856<br>
00857<br>
00858<br>
00859<br>
00860<br>
00861<br>
00862<br>
00863<br>
00864<br>
00865<br>
00866<br>
00867<br>
00868<br>
00869<br>
00870<br>
00871<br>
00872<br>
00873<br>
00874<br>
00875<br>
00876<br>
00877<br>
00878<br>
00879<br>
00880<br>
00881<br>
00882<br>
00883<br>
00884<br>
00885<br>
00886<br>
00887<br>
00888<br>
00889<br>
00890<br>
00891<br>
00892<br>
00893<br>
00894<br>
00895<br>
00896<br>
00897<br>
00898<br>
00899<br>
00900<br>
00901<br>
00902<br>
00903<br>
00904<br>
00905<br>
00906<br>
00907<br>
00908<br>
00909<br>
00910<br>
00911<br>
00912<br>
00913<br>
00914<br>
00915<br>
00916<br>
00917<br>
00918<br>
00919<br>
00920<br>
00921<br>
00922<br>
00923<br>
00924<br>
00925<br>
00926<br>
00927<br>
00928<br>
00929<br>
00930<br>
00931<br>
00932<br>
00933<br>
00934<br>
00935<br>
00936<br>
00937<br>
00938<br>
00939<br>
00940<br>
00941<br>
00942<br>
00943<br>
00944<br>
00945<br>
00946<br>
00947<br>
00948<br>
00949<br>
00950<br>
00951<br>
00952<br>
00953<br>
00954<br>
00955<br>
00956<br>
00957<br>
00958<br>
00959<br>
00960<br>
00961<br>
00962<br>
00963<br>
00964<br>
00965<br>
00966<br>
00967<br>
00968<br>
00969<br>
00970<br>
00971<br>
00972<br>
00973<br>
00974<br>
00975<br>
00976<br>
00977<br>
00978<br>
00979<br>
00980<br>
00981<br>
00982<br>
00983<br>
00984<br>
00985<br>
00986<br>
00987<br>
00988<br>
00989<br>
00990<br>
00991<br>
00992<br>
00993<br>
00994<br>
00995<br>
00996<br>
00997<br>
00998<br>
00999<br>
01000<br>
01001<br>
01002<br>
01003<br>
01004<br>
01005<br>
01006<br>
01007<br>
01008<br>
01009<br>
01010<br>
01011<br>
01012<br>
01013<br>
01014<br>
01015<br>
01016<br>
01017<br>
01018<br>
01019<br>
01020<br>
01021<br>
01022<br>
01023<br>
01024<br>
01025<br>
01026<br>
01027<br>
01028<br>
01029<br>
01030<br>
01031<br>
01032<br>
01033<br>
01034<br>
01035<br>
01036<br>
01037<br>
01038<br>
01039<br>
01040<br>
01041<br>
01042<br>
01043<br>
01044<br>
01045<br>
01046<br>
01047<br>
01048<br>
01049<br>
01050<br>
01051<br>
01052<br>
01053<br>
01054<br>
01055<br>
01056<br>
01057<br>
01058<br>
01059<br>
01060<br>
01061<br>
01062<br>
01063<br>
01064<br>
01065<br>
01066<br>
01067<br>
01068<br>
01069<br>
01070<br>
01071<br>
01072<br>
01073<br>
01074<br>
01075<br>
01076<br>
01077<br>
01078<br>
01079<br>
01080<br>
01081<br>
01082<br>
01083<br>
01084<br>
01085<br>
01086<br>
01087<br>
01088<br>
01089<br>
01090<br>
01091<br>
01092<br>
01093<br>
01094<br>
01095<br>
01096<br>
01097<br>
01098<br>
01099<br>
01100<br>
01101<br>
01102<br>
01103<br>
01104<br>
01105<br>
01106<br>
01107<br>
01108<br>
01109<br>
01110<br>
01111<br>
01112<br>
01113<br>
01114<br>
01115<br>
01116<br>
01117<br>
01118<br>
01119<br>
01120<br>
01121<br>
01122<br>
01123<br>
01124<br>
01125<br>
01126<br>
01127<br>
01128<br>
01129<br>
01130<br>
01131<br>
01132<br>
01133<br>
01134<br>
01135<br>
01136<br>
01137<br>
01138<br>
01139<br>
01140<br>
01141<br>
01142<br>
01143<br>
01144<br>
01145<br>
01146<br>
01147<br>
01148<br>
01149<br>
01150<br>
01151<br>
01152<br>
01153<br>
01154<br>
01155<br>
01156<br>
01157<br>
01158<br>
01159<br>
01160<br>
01161<br>
01162<br>
01163<br>
01164<br>
01165<br>
01166<br>
01167<br>
01168<br>
01169<br>
01170<br>
01171<br>
01172<br>
01173<br>
01174<br>
01175<br>
01176<br>
01177<br>
01178<br>
01179<br>
01180<br>
01181<br>
01182<br>
01183<br>
01184<br>
01185<br>
01186<br>
01187<br>
01188<br>
01189<br>
01190<br>
01191<br>
01192<br>
01193<br>
01194<br>
01195<br>
01196<br>
01197<br>
01198<br>
01199<br>
01200<br>
01201<br>
01202<br>
01203<br>
01204<br>
01205<br>
01206<br>
01207<br>
01208<br>
01209<br>
01210<br>
01211<br>
01212<br>
01213<br>
01214<br>
01215<br>
01216<br>
01217<br>
01218<br>
01219<br>
01220<br>
01221<br>
01222<br>
01223<br>
01224<br>
01225<br>
01226<br>
01227<br>
01228<br>
01229<br>
01230<br>
01231<br>
01232<br>
01233<br>
01234<br>
01235<br>
01236<br>
01237<br>
01238<br>
01239<br>
01240<br>
01241<br>
01242<br>
01243<br>
01244<br>
01245<br>
01246<br>
01247<br>
01248<br>
01249<br>
01250<br>
01251<br>
01252<br>
01253<br>
01254<br>
01255<br>
01256<br>
01257<br>
01258<br>
01259<br>
01260<br>
01261<br>
01262<br>
01263<br>
01264<br>
01265<br>
01266<br>
01267<br>
01268<br>
01269<br>
01270<br>
01271<br>
01272<br>
01273<br>
01274<br>
01275<br>
01276<br>
01277<br>
01278<br>
01279<br>
01280<br>
01281<br>
01282<br>
01283<br>
01284<br>
01285<br>
01286<br>
01287<br>
01288<br>
01289<br>
01290<br>
01291<br>
01292<br>
01293<br>
01294<br>
01295<br>
01296<br>
01297<br>
01298<br>
01299<br>
01300<br>
01301<br>
01302<br>
01303<br>
01304<br>
01305<br>
01306<br>
01307<br>
01308<br>
01309<br>
01310<br>
01311<br>
01312<br>
01313<br>
01314<br>
01315<br>
01316<br>
01317<br>
01318<br>
01319<br>
01320<br>
01321<br>
01322<br>
01323<br>
01324<br>
01325<br>
01326<br>
01327<br>
01328<br>
01329<br>
01330<br>
01331<br>
01332<br>
01333<br>
01334<br>
01335<br>
01336<br>
01337<br>
01338<br>
01339<br>
01340<br>
01341<br>
01342<br>
01343<br>
01344<br>
01345<br>
01346<br>
01347<br>
01348<br>
01349<br>
01350<br>
01351<br>
01352<br>
01353<br>
01354<br>
01355<br>
01356<br>
01357<br>
01358<br>
01359<br>
01360<br>
01361<br>
01362<br>
01363<br>
01364<br>
01365<br>
01366<br>
01367<br>
01368<br>
01369<br>
01370<br>
01371<br>
01372<br>
01373<br>
01374<br>
01375<br>
01376<br>
01377<br>
01378<br>
01379<br>
01380<br>
01381<br>
01382<br>
01383<br>
01384<br>
01385<br>
01386<br>
01387<br>
01388<br>
01389<br>
01390<br>
01391<br>
01392<br>
01393<br>
01394<br>
01395<br>
01396<br>
01397<br>
01398<br>
01399<br>
01400<br>
01401<br>
01402<br>
01403<br>
01404<br>
01405<br>
01406<br>
01407<br>
01408<br>
01409<br>
01410<br>
01411<br>
01412<br>
01413<br>
01414<br>
01415<br>
01416<br>
01417<br>
01418<br>
01419<br>
01420<br>
01421<br>
01422<br>
01423<br>
01424<br>
01425<br>
01426<br>
01427<br>
01428<br>
01429<br>
01430<br>
01431<br>
01432<br>
01433<br>
01434<br>
01435<br>
01436<br>
01437<br>
01438<br>
01439<br>
01440<br>
01441<br>
01442<br>
01443<br>
01444<br>
01445<br>
01446<br>
01447<br>
01448<br>
01449<br>
01450<br>
01451<br>
01452<br>
01453<br>
01454<br>
01455<br>
01456<br>
01457<br>
01458<br>
01459<br>
01460<br>
01461<br>
01462<br>
01463<br>
01464<br>
01465<br>
01466<br>
01467<br>
01468<br>
01469<br>
01470<br>
01471<br>
01472<br>
01473<br>
01474<br>
01475<br>
01476<br>
01477<br>
01478<br>
01479<br>
01480<br>
01481<br>
01482<br>
01483<br>
01484<br>
01485<br>
01486<br>
01487<br>
01488<br>
01489<br>
01490<br>
01491<br>
01492<br>
01493<br>
01494<br>
01495<br>
01496<br>
01497<br>
01498<br>
01499<br>
01500<br>
01501<br>
01502<br>
01503<br>
01504<br>
01505<br>
01506<br>
01507<br>
01508<br>
01509<br>
01510<br>
01511<br>
01512<br>
01513<br>
01514<br>
01515<br>
01516<br>
01517<br>
01518<br>
01519<br>
01520<br>
01521<br>
01522<br>
01523<br>
01524<br>
01525<br>
01526<br>
01527<br>
01528<br>
01529<br>
01530<br>
01531<br>
01532<br>
01533<br>
01534<br>
01535<br>
01536<br>
01537<br>
01538<br>
01539<br>
01540<br>
01541<br>
01542<br>
01543<br>
01544<br>
01545<br>
01546<br>
01547<br>
01548<br>
01549<br>
01550<br>
01551<br>
01552<br>
01553<br>
01554<br>
01555<br>
01556<br>
01557<br>
01558<br>
01559<br>
01560<br>
01561<br>
01562<br>
01563<br>
01564<br>
01565<br>
01566<br>
01567<br>
01568<br>
01569<br>
01570<br>
01571<br>
01572<br>
01573<br>
01574<br>
01575<br>
01576<br>
01577<br>
01578<br>
01579<br>
01580<br>
01581<br>
01582<br>
01583<br>
01584<br>
01585<br>
01586<br>
01587<br>
01588<br>
01589<br>
01590<br>
01591<br>
01592<br>
01593<br>
01594<br>
01595<br>
01596<br>
01597<br>
01598<br>
01599<br>
01600<br>
01601<br>
01602<br>
01603<br>
01604<br>
01605<br>
01606<br>
01607<br>
01608<br>
01609<br>
01610<br>
01611<br>
01612<br>
01613<br>
01614<br>
01615<br>
01616<br>
01617<br>
01618<br>
01619<br>
01620<br>
01621<br>
01622<br>
01623<br>
01624<br>
01625<br>
01626<br>
01627<br>
01628<br>
01629<br>
01630<br>
01631<br>
01632<br>
01633<br>
01634<br>
01635<br>
01636<br>
01637<br>
01638<br>
01639<br>
01640<br>
01641<br>
01642<br>
01643<br>
01644<br>
01645<br>
01646<br>
01647<br>
01648<br>
01649<br>
01650<br>
01651<br>
01652<br>
01653<br>
01654<br>
01655<br>
01656<br>
01657<br>
01658<br>
01659<br>
01660<br>
01661<br>
01662<br>
01663<br>
01664<br>
01665<br>
01666<br>
01667<br>
01668<br>
01669<br>
01670<br>
01671<br>
01672<br>
01673<br>
01674<br>
01675<br>
01676<br>
01677<br>
01678<br>
01679<br>
01680<br>
01681<br>
01682<br>
01683<br>
01684<br>
01685<br>
01686<br>
01687<br>
01688<br>
01689<br>
01690<br>
01691<br>
01692<br>
01693<br>
01694<br>
01695<br>
01696<br>
01697<br>
01698<br>
01699<br>
01700<br>
01701<br>
01702<br>
01703<br>
01704<br>
01705<br>
01706<br>
01707<br>
01708<br>
01709<br>
01710<br>
01711<br>
01712<br>
01713<br>
01714<br>
01715<br>
01716<br>
01717<br>
01718<br>
01719<br>
01720<br>
01721<br>
01722<br>
01723<br>
01724<br>
01725<br>
01726<br>
01727<br>
01728<br>
01729<br>
01730<br>
01731<br>
01732<br>
01733<br>
01734<br>
01735<br>
01736<br>
01737<br>
01738<br>
01739<br>
01740<br>
01741<br>
01742<br>
01743<br>
01744<br>
01745<br>
01746<br>
01747<br>
01748<br>
01749<br>
01750<br>
01751<br>
01752<br>
01753<br>
01754<br>
01755<br>
01756<br>
01757<br>
01758<br>
01759<br>
01760<br>
01761<br>
01762<br>
01763<br>
01764<br>
01765<br>
01766<br>
01767<br>
01768<br>
01769<br>
01770<br>
01771<br>
01772<br>
01773<br>
01774<br>
01775<br>
01776<br>
01777<br>
01778<br>
01779<br>
01780<br>
01781<br>
01782<br>
01783<br>
01784<br>
01785<br>
01786<br>
01787<br>
01788<br>
01789<br>
01790<br>
01791<br>
01792<br>
01793<br>
01794<br>
01795<br>
01796<br>
01797<br>
01798<br>
01799<br>
01800<br>
01801<br>
01802<br>
01803<br>
01804<br>
01805<br>
01806<br>
01807<br>
01808<br>
01809<br>
01810<br>
01811<br>
01812<br>
01813<br>
01814<br>
01815<br>
01816<br>
01817<br>
01818<br>
01819<br>
01820<br>
01821<br>
01822<br>
01823<br>
01824<br>
01825<br>
01826<br>
01827<br>
01828<br>
01829<br>
01830<br>
01831<br>
01832<br>
01833<br>
01834<br>
01835<br>
01836<br>
01837<br>
01838<br>
01839<br>
01840<br>
01841<br>
01842<br>
01843<br>
01844<br>
01845<br>
01846<br>
01847<br>
01848<br>
01849<br>
01850<br>
01851<br>
01852<br>
01853<br>
01854<br>
01855<br>
01856<br>
01857<br>
01858<br>
01859<br>
01860<br>
01861<br>
01862<br>
01863<br>
01864<br>
01865<br>
01866<br>
01867<br>
01868<br>
01869<br>
01870<br>
01871<br>
01872<br>
01873<br>
01874<br>
01875<br>
01876<br>
01877<br>
01878<br>
01879<br>
01880<br>
01881<br>
01882<br>
01883<br>
01884<br>
01885<br>
01886<br>
01887<br>
01888<br>
01889<br>
01890<br>
01891<br>
01892<br>
01893<br>
01894<br>
01895<br>
01896<br>
01897<br>
01898<br>
01899<br>
01900<br>
01901<br>
01902<br>
01903<br>
01904<br>
01905<br>
01906<br>
01907<br>
01908<br>
01909<br>
01910<br>
01911<br>
01912<br>
01913<br>
01914<br>
01915<br>
01916<br>
01917<br>
01918<br>
01919<br>
01920<br>
01921<br>
01922<br>
01923<br>
01924<br>
01925<br>
01926<br>
01927<br>
01928<br>
01929<br>
01930<br>
01931<br>
01932<br>
01933<br>
01934<br>
01935<br>
01936<br>
01937<br>
01938<br>
01939<br>
01940<br>
01941<br>
01942<br>
01943<br>
01944<br>
01945<br>
01946<br>
01947<br>
01948<br>
01949<br>
01950<br>
01951<br>
01952<br>
01953<br>
01954<br>
01955<br>
01956<br>
01957<br>
01958<br>
01959<br>
01960<br>
01961<br>
01962<br>
01963<br>
01964<br>
01965<br>
01966<br>
01967<br>
01968<br>
01969<br>
01970<br>
01971<br>
01972<br>
01973<br>
01974<br>
01975<br>
01976<br>
01977<br>
01978<br>
01979<br>
01980<br>
01981<br>
01982<br>
01983<br>
01984<br>
01985<br>
01986<br>
01987<br>
01988<br>
01989<br>
01990<br>
01991<br>
01992<br>
01993<br>
01994<br>
01995<br>
01996<br>
01997<br>
01998<br>
01999<br>
02000<br>
02001<br>
02002<br>
02003<br>
02004<br>
02005<br>
02006<br>
02007<br>
02008<br>
02009<br>
02010<br>
02011<br>
02012<br>
02013<br>
02014<br>
02015<br>
02016<br>
02017<br>
02018<br>
02019<br>
02020<br>
02021<br>
02022<br>
02023<br>
02024<br>
02025<br>
02026<br>
02027<br>
02028<br>
02029<br>
02030<br>
02031<br>
02032<br>
02033<br>
02034<br>
02035<br>
02036<br>
02037<br>
02038<br>
02039<br>
02040<br>
02041<br>
02042<br>
02043<br>
02044<br>
02045<br>
02046<br>
02047<br>
02048<br>
02049<br>
02050<br>
02051<br>
02052<br>
02053<br>
02054<br>
02055<br>
02056<br>
02057<br>
02058<br>
02059<br>
02060<br>
02061<br>
02062<br>
02063<br>
02064<br>
02065<br>
02066<br>
02067<br>
02068<br>
02069<br>
02070<br>
02071<br>
02072<br>
02073<br>
02074<br>
02075<br>
02076<br>
02077<br>
02078<br>
02079<br>
02080<br>
02081<br>
02082<br>
02083<br>
02084<br>
02085<br>
02086<br>
02087<br>
02088<br>
02089<br>
02090<br>
02091<br>
02092<br>
02093<br>
02094<br>
02095<br>
02096<br>
02097<br>
02098<br>
02099<br>
02100<br>
02101<br>
02102<br>
02103<br>
02104<br>
02105<br>
02106<br>
02107<br>
02108<br>
02109<br>
02110<br>
02111<br>
02112<br>
02113<br>
02114<br>
02115<br>
02116<br>
02117<br>
02118<br>
02119<br>
02120<br>
02121<br>
02122<br>
02123<br>
02124<br>
02125<br>
02126<br>
02127<br>
02128<br>
02129<br>
02130<br>
02131<br>
02132<br>
02133<br>
02134<br>
02135<br>
02136<br>
02137<br>
02138<br>
02139<br>
02140<br>
02141<br>
02142<br>
02143<br>
02144<br>
02145<br>
02146<br>
02147<br>
02148<br>
02149<br>
02150<br>
02151<br>
02152<br>
02153<br>
02154<br>
02155<br>
02156<br>
02157<br>
02158<br>
02159<br>
02160<br>
02161<br>
02162<br>
02163<br>
02164<br>
02165<br>
02166<br>
02167<br>
02168<br>
02169<br>
02170<br>
02171<br>
02172<br>
02173<br>
02174<br>
02175<br>
02176<br>
02177<br>
02178<br>
02179<br>
02180<br>
02181<br>
02182<br>
02183<br>
02184<br>
02185<br>
02186<br>
02187<br>
02188<br>
02189<br>
02190<br>
02191<br>
02192<br>
02193<br>
02194<br>
02195<br>
02196<br>
02197<br>
02198<br>
02199<br>
02200<br>
02201<br>
02202<br>
02203<br>
02204<br>
02205<br>
02206<br>
02207<br>
02208<br>
02209<br>
02210<br>
02211<br>
02212<br>
02213<br>
02214<br>
02215<br>
02216<br>
02217<br>
02218<br>
02219<br>
02220<br>
02221<br>
02222<br>
02223<br>
02224<br>
02225<br>
02226<br>
02227<br>
02228<br>
02229<br>
02230<br>
02231<br>
02232<br>
02233<br>
02234<br>
02235<br>
02236<br>
02237<br>
02238<br>
02239<br>
02240<br>
02241<br>
02242<br>
02243<br>
02244<br>
02245<br>
02246<br>
02247<br>
02248<br>
02249<br>
02250<br>
02251<br>
02252<br>
02253<br>
02254<br>
02255<br>
02256<br>
02257<br>
02258<br>
02259<br>
02260<br>
02261<br>
02262<br>
02263<br>
02264<br>
02265<br>
02266<br>
02267<br>
02268<br>
02269<br>
02270<br>
02271<br>
02272<br>
02273<br>
02274<br>
02275<br>
02276<br>
02277<br>
02278<br>
02279<br>
02280<br>
02281<br>
02282<br>
02283<br>
02284<br>
02285<br>
02286<br>
02287<br>
02288<br>
02289<br>
02290<br>
02291<br>
02292<br>
02293<br>
02294<br>
02295<br>
02296<br>
02297<br>
02298<br>
02299<br>
02300<br>
02301<br>
02302<br>
02303<br>
02304<br>
02305<br>
02306<br>
02307<br>
02308<br>
02309<br>
02310<br>
02311<br>
02312<br>
02313<br>
02314<br>
02315<br>
02316<br>
02317<br>
02318<br>
02319<br>
02320<br>
02321<br>
02322<br>
02323<br>
02324<br>
02325<br>
02326<br>
02327<br>
02328<br>
02329<br>
02330<br>
02331<br>
02332<br>
02333<br>
02334<br>
02335<br>
02336<br>
02337<br>
02338<br>
02339<br>
02340<br>
02341<br>
02342<br>
02343<br>
02344<br>
02345<br>
02346<br>
02347<br>
02348<br>
02349<br>
02350<br>
02351<br>
02352<br>
02353<br>
02354<br>
02355<br>
02356<br>
02357<br>
02358<br>
02359<br>
02360<br>
02361<br>
02362<br>
02363<br>
02364<br>
02365<br>
02366<br>
02367<br>
02368<br>
02369<br>
02370<br>
02371<br>
02372<br>
02373<br>
02374<br>
02375<br>
02376<br>
02377<br>
02378<br>
02379<br>
02380<br>
02381<br>
02382<br>
02383<br>
02384<br>
02385<br>
02386<br>
02387<br>
02388<br>
02389<br>
02390<br>
02391<br>
02392<br>
02393<br>
02394<br>
02395<br>
02396<br>
02397<br>
02398<br>
02399<br>
02400<br>
02401<br>
02402<br>
02403<br>
02404<br>
02405<br>
02406<br>
02407<br>
02408<br>
02409<br>
02410<br>
02411<br>
02412<br>
02413<br>
02414<br>
02415<br>
02416<br>
02417<br>
02418<br>
02419<br>
02420<br>
02421<br>
02422<br>
02423<br>
02424<br>
02425<br>
02426<br>
02427<br>
02428<br>
02429<br>
02430<br>
02431<br>
02432<br>
02433<br>
02434<br>
02435<br>
02436<br>
02437<br>
02438<br>
02439<br>
02440<br>
02441<br>
02442<br>
02443<br>
02444<br>
02445<br>
02446<br>
02447<br>
02448<br>
02449<br>
02450<br>
02451<br>
02452<br>
02453<br>
02454<br>
02455<br>
02456<br>
02457<br>
02458<br>
02459<br>
02460<br>
02461<br>
02462<br>
02463<br>
02464<br>
02465<br>
02466<br>
02467<br>
02468<br>
02469<br>
02470<br>
02471<br>
02472<br>
02473<br>
02474<br>
02475<br>
02476<br>
02477<br>
02478<br>
02479<br>
02480<br>
02481<br>
02482<br>
02483<br>
02484<br>
02485<br>
02486<br>
02487<br>
02488<br>
02489<br>
02490<br>
02491<br>
02492<br>
02493<br>
02494<br>
02495<br>
02496<br>
02497<br>
02498<br>
02499<br>
02500<br>
02501<br>
02502<br>
02503<br>
02504<br>
02505<br>
02506<br>
02507<br>
02508<br>
02509<br>
02510<br>
02511<br>
02512<br>
02513<br>
02514<br>
02515<br>
02516<br>
02517<br>
02518<br>
02519<br>
02520<br>
02521<br>
02522<br>
02523<br>
02524<br>
02525<br>
02526<br>
02527<br>
02528<br>
02529<br>
02530<br>
02531<br>
02532<br>
02533<br>
02534<br>
02535<br>
02536<br>
02537<br>
02538<br>
02539<br>
02540<br>
02541<br>
02542<br>
02543<br>
02544<br>
02545<br>
02546<br>
02547<br>
02548<br>
02549<br>
02550<br>
02551<br>
02552<br>
02553<br>
02554<br>
02555<br>
02556<br>
02557<br>
02558<br>
02559<br>
02560<br>
02561<br>
02562<br>
02563<br>
02564<br>
02565<br>
02566<br>
02567<br>
02568<br>
02569<br>
02570<br>
02571<br>
02572<br>
02573<br>
02574<br>
02575<br>
02576<br>
02577<br>
02578<br>
02579<br>
02580<br>
02581<br>
02582<br>
02583<br>
02584<br>
02585<br>
02586<br>
02587<br>
02588<br>
02589<br>
02590<br>
02591<br>
02592<br>
02593<br>
02594<br>
02595<br>
02596<br>
02597<br>
02598<br>
02599<br>
02600<br>
02601<br>
02602<br>
02603<br>
02604<br>
02605<br>
02606<br>
02607<br>
02608<br>
02609<br>
02610<br>
02611<br>
02612<br>
02613<br>
02614<br>
02615<br>
02616<br>
02617<br>
02618<br>
02619<br>
02620<br>
02621<br>
02622<br>
02623<br>
02624<br>
02625<br>
02626<br>
02627<br>
02628<br>
02629<br>
02630<br>
02631<br>
02632<br>
02633<br>
02634<br>
02635<br>
02636<br>
02637<br>
02638<br>
02639<br>
02640<br>
02641<br>
02642<br>
02643<br>
02644<br>
02645<br>
02646<br>
02647<br>
02648<br>
02649<br>
02650<br>
02651<br>
02652<br>
02653<br>
02654<br>
02655<br>
02656<br>
02657<br>
02658<br>
02659<br>
02660<br>
02661<br>
02662<br>
02663<br>
02664<br>
02665<br>
02666<br>
02667<br>
02668<br>
02669<br>
02670<br>
02671<br>
02672<br>
02673<br>
02674<br>
02675<br>
02676<br>
02677<br>
02678<br>
02679<br>
02680<br>
02681<br>
02682<br>
02683<br>
02684<br>
02685<br>
02686<br>
02687<br>
02688<br>
02689<br>
02690<br>
02691<br>
02692<br>
02693<br>
02694<br>
02695<br>
02696<br>
02697<br>
02698<br>
02699<br>
02700<br>
02701<br>
02702<br>
02703<br>
02704<br>
02705<br>
02706<br>
02707<br>
02708<br>
02709<br>
02710<br>
02711<br>
02712<br>
02713<br>
02714<br>
02715<br>
02716<br>
02717<br>
02718<br>
02719<br>
02720<br>
02721<br>
02722<br>
02723<br>
02724<br>
02725<br>
02726<br>
02727<br>
02728<br>
02729<br>
02730<br>
02731<br>
02732<br>
02733<br>
02734<br>
02735<br>
02736<br>
02737<br>
02738<br>
02739<br>
02740<br>
02741<br>
02742<br>
02743<br>
02744<br>
02745<br>
02746<br>
02747<br>
02748<br>
02749<br>
02750<br>
02751<br>
02752<br>
02753<br>
02754<br>
02755<br>
02756<br>
02757<br>
02758<br>
02759<br>
02760<br>
02761<br>
02762<br>
02763<br>
02764<br>
02765<br>
02766<br>
02767<br>
02768<br>
02769<br>
02770<br>
02771<br>
02772<br>
02773<br>
02774<br>
02775<br>
02776<br>
02777<br>
02778<br>
02779<br>
02780<br>
02781<br>
02782<br>
02783<br>
02784<br>
02785<br>
02786<br>
02787<br>
02788<br>
02789<br>
02790<br>
02791<br>
02792<br>
02793<br>
02794<br>
02795<br>
02796<br>
02797<br>
02798<br>
02799<br>
02800<br>
02801<br>
02802<br>
02803<br>
02804<br>
02805<br>
02806<br>
02807<br>
02808<br>
02809<br>
02810<br>
02811<br>
02812<br>
02813<br>
02814<br>
02815<br>
02816<br>
02817<br>
02818<br>
02819<br>
02820<br>
02821<br>
02822<br>
02823<br>
02824<br>
02825<br>
02826<br>
02827<br>
02828<br>
02829<br>
02830<br>
02831<br>
02832<br>
02833<br>
02834<br>
02835<br>
02836<br>
02837<br>
02838<br>
02839<br>
02840<br>
02841<br>
02842<br>
02843<br>
02844<br>
02845<br>
02846<br>
02847<br>
02848<br>
02849<br>
02850<br>
02851<br>
02852<br>
02853<br>
02854<br>
02855<br>
02856<br>
02857<br>
02858<br>
02859<br>
02860<br>
02861<br>
02862<br>
02863<br>
02864<br>
02865<br>
02866<br>
02867<br>
02868<br>
02869<br>
02870<br>
02871<br>
02872<br>
02873<br>
02874<br>
02875<br>
02876<br>
02877<br>
02878<br>
02879<br>
02880<br>
02881<br>
02882<br>
02883<br>
02884<br>
02885<br>
02886<br>
02887<br>
02888<br>
02889<br>
02890<br>
02891<br>
02892<br>
02893<br>
02894<br>
02895<br>
02896<br>
02897<br>
02898<br>
02899<br>
02900<br>
02901<br>
02902<br>
02903<br>
02904<br>
02905<br>
02906<br>
02907<br>
02908<br>
02909<br>
02910<br>
02911<br>
02912<br>
02913<br>
02914<br>
02915<br>
02916<br>
02917<br>
02918<br>
02919<br>
02920<br>
02921<br>
02922<br>
02923<br>
02924<br>
02925<br>
02926<br>
02927<br>
02928<br>
02929<br>
02930<br>
02931<br>
02932<br>
02933<br>
02934<br>
02935<br>
02936<br>
02937<br>
02938<br>
02939<br>
02940<br>
02941<br>
02942<br>
02943<br>
02944<br>
02945<br>
02946<br>
02947<br>
02948<br>
02949<br>
02950<br>
02951<br>
02952<br>
02953<br>
02954<br>
02955<br>
02956<br>
02957<br>
02958<br>
02959<br>
02960<br>
02961<br>
02962<br>
02963<br>
02964<br>
02965<br>
02966<br>
02967<br>
02968<br>
02969<br>
02970<br>
02971<br>
02972<br>
02973<br>
02974<br>
02975<br>
02976<br>
02977<br>
02978<br>
02979<br>
02980<br>
02981<br>
02982<br>
02983<br>
02984<br>
02985<br>
02986<br>
02987<br>
02988<br>
02989<br>
02990<br>
02991<br>
02992<br>
02993<br>
02994<br>
02995<br>
02996<br>
02997<br>
02998<br>
02999<br>
03000<br>
03001<br>
03002<br>
03003<br>
03004<br>
03005<br>
03006<br>
03007<br>
03008<br>
03009<br>
03010<br>
03011<br>
03012<br>
03013<br>
03014<br>
03015<br>
03016<br>
03017<br>
03018<br>
03019<br>
03020<br>
03021<br>
03022<br>
03023<br>
03024<br>
03025<br>
03026<br>
03027<br>
03028<br>
03029<br>
03030<br>
03031<br>
03032<br>
03033<br>
03034<br>
03035<br>
03036<br>
03037<br>
03038<br>
03039<br>
03040<br>
03041<br>
03042<br>
03043<br>
03044<br>
03045<br>
03046<br>
03047<br>
03048<br>
03049<br>
03050<br>
03051<br>
03052<br>
03053<br>
03054<br>
03055<br>
03056<br>
03057<br>
03058<br>
03059<br>
03060<br>
03061<br>
03062<br>
03063<br>
03064<br>
03065<br>
03066<br>
03067<br>
03068<br>
03069<br>
03070<br>
03071<br>
03072<br>
03073<br>
03074<br>
03075<br>
03076<br>
03077<br>
03078<br>
03079<br>
03080<br>
03081<br>
03082<br>
03083<br>
03084<br>
03085<br>
03086<br>
03087<br>
03088<br>
03089<br>
03090<br>
03091<br>
03092<br>
03093<br>
03094<br>
03095<br>
03096<br>
03097<br>
03098<br>
03099<br>
03100<br>
03101<br>
03102<br>
03103<br>
03104<br>
03105<br>
03106<br>
03107<br>
03108<br>
03109<br>
03110<br>
03111<br>
03112<br>
03113<br>
03114<br>
03115<br>
03116<br>
03117<br>
03118<br>
03119<br>
03120<br>
03121<br>
03122<br>
03123<br>
03124<br>
03125<br>
03126<br>
03127<br>
03128<br>
03129<br>
03130<br>
03131<br>
03132<br>
03133<br>
03134<br>
03135<br>
03136<br>
03137<br>
03138<br>
03139<br>
03140<br>
03141<br>
03142<br>
03143<br>
03144<br>
03145<br>
03146<br>
03147<br>
03148<br>
03149<br>
03150<br>
03151<br>
03152<br>
03153<br>
03154<br>
03155<br>
03156<br>
03157<br>
03158<br>
03159<br>
03160<br>
03161<br>
03162<br>
03163<br>
03164<br>
03165<br>
03166<br>
03167<br>
03168<br>
03169<br>
03170<br>
03171<br>
03172<br>
03173<br>
03174<br>
03175<br>
03176<br>
03177<br>
03178<br>
03179<br>
03180<br>
03181<br>
03182<br>
03183<br>
03184<br>
03185<br>
03186<br>
03187<br>
03188<br>
03189<br>
03190<br>
03191<br>
03192<br>
03193<br>
03194<br>
03195<br>
03196<br>
03197<br>
03198<br>
03199<br>
03200<br>
03201<br>
03202<br>
03203<br>
03204<br>
03205<br>
03206<br>
03207<br>
03208<br>
03209<br>
03210<br>
03211<br>
03212<br>
03213<br>
03214<br>
03215<br>
03216<br>
03217<br>
03218<br>
03219<br>
03220<br>
03221<br>
03222<br>
03223<br>
03224<br>
03225<br>
03226<br>
03227<br>
03228<br>
03229<br>
03230<br>
03231<br>
03232<br>
03233<br>
03234<br>
03235<br>
03236<br>
03237<br>
03238<br>
03239<br>
03240<br>
03241<br>
03242<br>
03243<br>
03244<br>
03245<br>
03246<br>
03247<br>
03248<br>
03249<br>
03250<br>
03251<br>
03252<br>
03253<br>
03254<br>
03255<br>
03256<br>
03257<br>
03258<br>
03259<br>
03260<br>
03261<br>
03262<br>
03263<br>
03264<br>
03265<br>
03266<br>
03267<br>
03268<br>
03269<br>
03270<br>
03271<br>
03272<br>
03273<br>
03274<br>
03275<br>
03276<br>
03277<br>
03278<br>
03279<br>
03280<br>
03281<br>
03282<br>
03283<br>
03284<br>
03285<br>
03286<br>
03287<br>
03288<br>
03289<br>
03290<br>
03291<br>
03292<br>
03293<br>
03294<br>
03295<br>
03296<br>
03297<br>
03298<br>
03299<br>
03300<br>
03301<br>
03302<br>
03303<br>
03304<br>
03305<br>
03306<br>
03307<br>
03308<br>
03309<br>
03310<br>
03311<br>
03312<br>
03313<br>
03314<br>
03315<br>
03316<br>
03317<br>
03318<br>
03319<br>
03320<br>
03321<br>
03322<br>
03323<br>
03324<br>
03325<br>
03326<br>
03327<br>
03328<br>
03329<br>
03330<br>
03331<br>
03332<br>
03333<br>
03334<br>
03335<br>
03336<br>
03337<br>
03338<br>
03339<br>
03340<br>
03341<br>
03342<br>
03343<br>
03344<br>
03345<br>
03346<br>
03347<br>
03348<br>
03349<br>
03350<br>
03351<br>
03352<br>
03353<br>
03354<br>
03355<br>
03356<br>
03357<br>
03358<br>
03359<br>
03360<br>
03361<br>
03362<br>
03363<br>
03364<br>
03365<br>
03366<br>
03367<br>
03368<br>
03369<br>
03370<br>
03371<br>
03372<br>
03373<br>
03374<br>
03375<br>
03376<br>
03377<br>
03378<br>
03379<br>
03380<br>
03381<br>
03382<br>
03383<br>
03384<br>
03385<br>
03386<br>
03387<br>
03388<br>
03389<br>
03390<br>
03391<br>
03392<br>
03393<br>
03394<br>
03395<br>
03396<br>
03397<br>
03398<br>
03399<br>
03400<br>
03401<br>
03402<br>
03403<br>
03404<br>
03405<br>
03406<br>
03407<br>
03408<br>
03409<br>
03410<br>
03411<br>
03412<br>
03413<br>
03414<br>
03415<br>
03416<br>
03417<br>
03418<br>
03419<br>
03420<br>
03421<br>
03422<br>
03423<br>
03424<br>
03425<br>
03426<br>
03427<br>
03428<br>
03429<br>
03430<br>
03431<br>
03432<br>
03433<br>
03434<br>
03435<br>
03436<br>
03437<br>
03438<br>
03439<br>
03440<br>
03441<br>
03442<br>
03443<br>
03444<br>
03445<br>
03446<br>
03447<br>
03448<br>
03449<br>
03450<br>
03451<br>
03452<br>
03453<br>
03454<br>
03455<br>
03456<br>
03457<br>
03458<br>
03459<br>
03460<br>
03461<br>
03462<br>
03463<br>
03464<br>
03465<br>
03466<br>
03467<br>
03468<br>
03469<br>
03470<br>
03471<br>
03472<br>
03473<br>
03474<br>
03475<br>
03476<br>
03477<br>
03478<br>
03479<br>
03480<br>
03481<br>
03482<br>
03483<br>
03484<br>
03485<br>
03486<br>
03487<br>
03488<br>
03489<br>
03490<br>
03491<br>
03492<br>
03493<br>
03494<br>
03495<br>
03496<br>
03497<br>
03498<br>
03499<br>
03500<br>
03501<br>
03502<br>
03503<br>
03504<br>
03505<br>
03506<br>
03507<br>
03508<br>
03509<br>
03510<br>
03511<br>
03512<br>
03513<br>
03514<br>
03515<br>
03516<br>
03517<br>
03518<br>
03519<br>
03520<br>
03521<br>
03522<br>
03523<br>
03524<br>
03525<br>
03526<br>
03527<br>
03528<br>
03529<br>
03530<br>
03531<br>
03532<br>
03533<br>
03534<br>
03535<br>
03536<br>
03537<br>
03538<br>
03539<br>
03540<br>
03541<br>
03542<br>
03543<br>
03544<br>
03545<br>
03546<br>
03547<br>
03548<br>
03549<br>
03550<br>
03551<br>
03552<br>
03553<br>
03554<br>
03555<br>
03556<br>
03557<br>
03558<br>
03559<br>
03560<br>
03561<br>
03562<br>
03563<br>
03564<br>
03565<br>
03566<br>
03567<br>
03568<br>
03569<br>
03570<br>
03571<br>
03572<br>
03573<br>
03574<br>
03575<br>
03576<br>
03577<br>
03578<br>
03579<br>
03580<br>
03581<br>
03582<br>
03583<br>
03584<br>
03585<br>
03586<br>
03587<br>
03588<br>
03589<br>
03590<br>
03591<br>
03592<br>
03593<br>
03594<br>
03595<br>
03596<br>
03597<br>
03598<br>
03599<br>
03600<br>
03601<br>
03602<br>
03603<br>
03604<br>
03605<br>
03606<br>
03607<br>
03608<br>
03609<br>
03610<br>
03611<br>
03612<br>
03613<br>
03614<br>
03615<br>
03616<br>
03617<br>
03618<br>
03619<br>
03620<br>
03621<br>
03622<br>
03623<br>
03624<br>
03625<br>
03626<br>
03627<br>
03628<br>
03629<br>
03630<br>
03631<br>
03632<br>
03633<br>
03634<br>
03635<br>
03636<br>
03637<br>
03638<br>
03639<br>
03640<br>
03641<br>
03642<br>
03643<br>
03644<br>
03645<br>
03646<br>
03647<br>
03648<br>
03649<br>
03650<br>
03651<br>
03652<br>
03653<br>
03654<br>
03655<br>
03656<br>
03657<br>
03658<br>
03659<br>
03660<br>
03661<br>
03662<br>
03663<br>
03664<br>
03665<br>
03666<br>
03667<br>
03668<br>
03669<br>
03670<br>
03671<br>
03672<br>
03673<br>
03674<br>
03675<br>
03676<br>
03677<br>
03678<br>
03679<br>
03680<br>
03681<br>
03682<br>
03683<br>
03684<br>
03685<br>
03686<br>
03687<br>
03688<br>
03689<br>
03690<br>
03691<br>
03692<br>
03693<br>
03694<br>
03695<br>
03696<br>
03697<br>
03698<br>
03699<br>
03700<br>
03701<br>
03702<br>
03703<br>
03704<br>
03705<br>
03706<br>
03707<br>
03708<br>
03709<br>
03710<br>
03711<br>
03712<br>
03713<br>
03714<br>
03715<br>
03716<br>
03717<br>
03718<br>
03719<br>
03720<br>
03721<br>
03722<br>
03723<br>
03724<br>
03725<br>
03726<br>
03727<br>
03728<br>
03729<br>
03730<br>
03731<br>
03732<br>
03733<br>
03734<br>
03735<br>
03736<br>
03737<br>
03738<br>
03739<br>
03740<br>
03741<br>
03742<br>
03743<br>
03744<br>
03745<br>
03746<br>
03747<br>
03748<br>
03749<br>
03750<br>
03751<br>
03752<br>
03753<br>
03754<br>
03755<br>
03756<br>
03757<br>
03758<br>
03759<br>
03760<br>
03761<br>
03762<br>
03763<br>
03764<br>
03765<br>
03766<br>
03767<br>
03768<br>
03769<br>
03770<br>
03771<br>
03772<br>
03773<br>
03774<br>
03775<br>
03776<br>
03777<br>
03778<br>
03779<br>
03780<br>
03781<br>
03782<br>
03783<br>
03784<br>
03785<br>
03786<br>
03787<br>
03788<br>
03789<br>
03790<br>
03791<br>
03792<br>
03793<br>
03794<br>
03795<br>
03796<br>
03797<br>
03798<br>
03799<br>
03800<br>
03801<br>
03802<br>
03803<br>
03804<br>
03805<br>
03806<br>
03807<br>
03808<br>
03809<br>
03810<br>
03811<br>
03812<br>
03813<br>
03814<br>
03815<br>
03816<br>
03817<br>
03818<br>
03819<br>
03820<br>
03821<br>
03822<br>
03823<br>
03824<br>
03825<br>
03826<br>
03827<br>
03828<br>
03829<br>
03830<br>
03831<br>
03832<br>
03833<br>
03834<br>
03835<br>
03836<br>
03837<br>
03838<br>
03839<br>
03840<br>
03841<br>
03842<br>
03843<br>
03844<br>
03845<br>
03846<br>
03847<br>
03848<br>
03849<br>
03850<br>
03851<br>
03852<br>
03853<br>
03854<br>
03855<br>
03856<br>
03857<br>
03858<br>
03859<br>
03860<br>
03861<br>
03862<br>
03863<br>
03864<br>
03865<br>
03866<br>
03867<br>
03868<br>
03869<br>
03870<br>
03871<br>
03872<br>
03873<br>
03874<br>
03875<br>
03876<br>
03877<br>
03878<br>
03879<br>
03880<br>
03881<br>
03882<br>
03883<br>
03884<br>
03885<br>
03886<br>
03887<br>
03888<br>
03889<br>
03890<br>
03891<br>
03892<br>
03893<br>
03894<br>
03895<br>
03896<br>
03897<br>
03898<br>
03899<br>
03900<br>
03901<br>
03902<br>
03903<br>
03904<br>
03905<br>
03906<br>
03907<br>
03908<br>
03909<br>
03910<br>
03911<br>
03912<br>
03913<br>
03914<br>
03915<br>
03916<br>
03917<br>
03918<br>
03919<br>
03920<br>
03921<br>
03922<br>
03923<br>
03924<br>
03925<br>
03926<br>
03927<br>
03928<br>
03929<br>
03930<br>
03931<br>
03932<br>
03933<br>
03934<br>
03935<br>
03936<br>
03937<br>
03938<br>
03939<br>
03940<br>
03941<br>
03942<br>
03943<br>
03944<br>
03945<br>
03946<br>
03947<br>
03948<br>
03949<br>
03950<br>
03951<br>
03952<br>
03953<br>
03954<br>
03955<br>
03956<br>
03957<br>
03958<br>
03959<br>
03960<br>
03961<br>
03962<br>
03963<br>
03964<br>
03965<br>
03966<br>
03967<br>
03968<br>
03969<br>
03970<br>
03971<br>
03972<br>
03973<br>
03974<br>
03975<br>
03976<br>
03977<br>
03978<br>
03979<br>
03980<br>
03981<br>
03982<br>
03983<br>
03984<br>
03985<br>
03986<br>
03987<br>
03988<br>
03989<br>
03990<br>
03991<br>
03992<br>
03993<br>
03994<br>
03995<br>
03996<br>
03997<br>
03998<br>
03999<br>
04000<br>
04001<br>
04002<br>
04003<br>
04004<br>
04005<br>
04006<br>
04007<br>
04008<br>
04009<br>
04010<br>
04011<br>
04012<br>
04013<br>
04014<br>
04015<br>
04016<br>
04017<br>
04018<br>
04019<br>
04020<br>
04021<br>
04022<br>
04023<br>
04024<br>
04025<br>
04026<br>
04027<br>
04028<br>
04029<br>
04030<br>
04031<br>
04032<br>
04033<br>
04034<br>
04035<br>
04036<br>
04037<br>
04038<br>
04039<br>
04040<br>
04041<br>
04042<br>
04043<br>
04044<br>
04045<br>
04046<br>
04047<br>
04048<br>
04049<br>
04050<br>
04051<br>
04052<br>
04053<br>
04054<br>
04055<br>
04056<br>
04057<br>
04058<br>
04059<br>
04060<br>
04061<br>
04062<br>
04063<br>
04064<br>
04065<br>
04066<br>
04067<br>
04068<br>
04069<br>
04070<br>
04071<br>
04072<br>
04073<br>
04074<br>
04075<br>
04076<br>
04077<br>
04078<br>
04079<br>
04080<br>
04081<br>
04082<br>
04083<br>
04084<br>
04085<br>
04086<br>
04087<br>
04088<br>
04089<br>
04090<br>
04091<br>
04092<br>
04093<br>
04094<br>
04095<br>
04096<br>
04097<br>
04098<br>
04099<br>
04100<br>
04101<br>
04102<br>
04103<br>
04104<br>
04105<br>
04106<br>
04107<br>
04108<br>
04109<br>
04110<br>
04111<br>
04112<br>
04113<br>
04114<br>
04115<br>
04116<br>
04117<br>
04118<br>
04119<br>
04120<br>
04121<br>
04122<br>
04123<br>
04124<br>
04125<br>
04126<br>
04127<br>
04128<br>
04129<br>
04130<br>
04131<br>
04132<br>
04133<br>
04134<br>
04135<br>
04136<br>
04137<br>
04138<br>
04139<br>
04140<br>
04141<br>
04142<br>
04143<br>
04144<br>
04145<br>
04146<br>
04147<br>
04148<br>
04149<br>
04150<br>
04151<br>
04152<br>
04153<br>
04154<br>
04155<br>
04156<br>
04157<br>
04158<br>
04159<br>
04160<br>
04161<br>
04162<br>
04163<br>
04164<br>
04165<br>
04166<br>
04167<br>
04168<br>
04169<br>
04170<br>
04171<br>
04172<br>
04173<br>
04174<br>
04175<br>
04176<br>
04177<br>
04178<br>
04179<br>
04180<br>
04181<br>
04182<br>
04183<br>
04184<br>
04185<br>
04186<br>
04187<br>
04188<br>
04189<br>
04190<br>
04191<br>
04192<br>
04193<br>
04194<br>
04195<br>
04196<br>
04197<br>
04198<br>
04199<br>
04200<br>
04201<br>
04202<br>
04203<br>
04204<br>
04205<br>
04206<br>
04207<br>
04208<br>
04209<br>
04210<br>
04211<br>
04212<br>
04213<br>
04214<br>
04215<br>
04216<br>
04217<br>
04218<br>
04219<br>
04220<br>
04221<br>
04222<br>
04223<br>
04224<br>
04225<br>
04226<br>
04227<br>
04228<br>
04229<br>
04230<br>
04231<br>
04232<br>
04233<br>
04234<br>
04235<br>
04236<br>
04237<br>
04238<br>
04239<br>
04240<br>
04241<br>
04242<br>
04243<br>
04244<br>
04245<br>
04246<br>
04247<br>
04248<br>
04249<br>
04250<br>
04251<br>
04252<br>
04253<br>
04254<br>
04255<br>
04256<br>
04257<br>
04258<br>
04259<br>
04260<br>
04261<br>
04262<br>
04263<br>
04264<br>
04265<br>
04266<br>
04267<br>
04268<br>
04269<br>
04270<br>
04271<br>
04272<br>
04273<br>
04274<br>
04275<br>
04276<br>
04277<br>
04278<br>
04279<br>
04280<br>
04281<br>
04282<br>
04283<br>
04284<br>
04285<br>
04286<br>
04287<br>
04288<br>
04289<br>
04290<br>
04291<br>
04292<br>
04293<br>
04294<br>
04295<br>
04296<br>
04297<br>
04298<br>
04299<br>
04300<br>
04301<br>
04302<br>
04303<br>
04304<br>
04305<br>
04306<br>
04307<br>
04308<br>
04309<br>
04310<br>
04311<br>
04312<br>
04313<br>
04314<br>
04315<br>
04316<br>
04317<br>
04318<br>
04319<br>
04320<br>
04321<br>
04322<br>
04323<br>
04324<br>
04325<br>
04326<br>
04327<br>
04328<br>
04329<br>
04330<br>
04331<br>
04332<br>
04333<br>
04334<br>
04335<br>
04336<br>
04337<br>
04338<br>
04339<br>
04340<br>
04341<br>
04342<br>
04343<br>
04344<br>
04345<br>
04346<br>
04347<br>
04348<br>
04349<br>
04350<br>
04351<br>
04352<br>
04353<br>
04354<br>
04355<br>
04356<br>
04357<br>
04358<br>
04359<br>
04360<br>
04361<br>
04362<br>
04363<br>
04364<br>
04365<br>
04366<br>
04367<br>
04368<br>
04369<br>
04370<br>
04371<br>
04372<br>
04373<br>
04374<br>
04375<br>
04376<br>
04377<br>
04378<br>
04379<br>
04380<br>
04381<br>
04382<br>
04383<br>
04384<br>
04385<br>
04386<br>
04387<br>
04388<br>
04389<br>
04390<br>
04391<br>
04392<br>
04393<br>
04394<br>
04395<br>
04396<br>
04397<br>
04398<br>
04399<br>
04400<br>
04401<br>
04402<br>
04403<br>
04404<br>
04405<br>
04406<br>
04407<br>
04408<br>
04409<br>
04410<br>
04411<br>
04412<br>
04413<br>
04414<br>
04415<br>
04416<br>
04417<br>
04418<br>
04419<br>
04420<br>
04421<br>
04422<br>
04423<br>
04424<br>
04425<br>
04426<br>
04427<br>
04428<br>
04429<br>
04430<br>
04431<br>
04432<br>
04433<br>
04434<br>
04435<br>
04436<br>
04437<br>
04438<br>
04439<br>
04440<br>
04441<br>
04442<br>
04443<br>
04444<br>
04445<br>
04446<br>
04447<br>
04448<br>
04449<br>
04450<br>
04451<br>
04452<br>
04453<br>
04454<br>
04455<br>
04456<br>
04457<br>
04458<br>
04459<br>
04460<br>
04461<br>
04462<br>
04463<br>
04464<br>
04465<br>
04466<br>
04467<br>
04468<br>
04469<br>
04470<br>
04471<br>
04472<br>
04473<br>
04474<br>
04475<br>
04476<br>
04477<br>
04478<br>
04479<br>
04480<br>
04481<br>
04482<br>
04483<br>
04484<br>
04485<br>
04486<br>
04487<br>
04488<br>
04489<br>
04490<br>
04491<br>
04492<br>
04493<br>
04494<br>
04495<br>
04496<br>
04497<br>
04498<br>
04499<br>
04500<br>
04501<br>
04502<br>
04503<br>
04504<br>
04505<br>
04506<br>
04507<br>
04508<br>
04509<br>
04510<br>
04511<br>
04512<br>
04513<br>
04514<br>
04515<br>
04516<br>
04517<br>
04518<br>
04519<br>
04520<br>
04521<br>
04522<br>
04523<br>
04524<br>
04525<br>
04526<br>
04527<br>
04528<br>
04529<br>
04530<br>
04531<br>
04532<br>
04533<br>
04534<br>
04535<br>
04536<br>
04537<br>
04538<br>
04539<br>
04540<br>
04541<br>
04542<br>
04543<br>
04544<br>
04545<br>
04546<br>
04547<br>
04548<br>
04549<br>
04550<br>
04551<br>
04552<br>
04553<br>
04554<br>
04555<br>
04556<br>
04557<br>
04558<br>
04559<br>
04560<br>
04561<br>
04562<br>
04563<br>
04564<br>
04565<br>
04566<br>
04567<br>
04568<br>
04569<br>
04570<br>
04571<br>
04572<br>
04573<br>
04574<br>
04575<br>
04576<br>
04577<br>
04578<br>
04579<br>
04580<br>
04581<br>
04582<br>
04583<br>
04584<br>
04585<br>
04586<br>
04587<br>
04588<br>
04589<br>
04590<br>
04591<br>
04592<br>
04593<br>
04594<br>
04595<br>
04596<br>
04597<br>
04598<br>
04599<br>
04600<br>
04601<br>
04602<br>
04603<br>
04604<br>
04605<br>
04606<br>
04607<br>
04608<br>
04609<br>
04610<br>
04611<br>
04612<br>
04613<br>
04614<br>
04615<br>
04616<br>
04617<br>
04618<br>
04619<br>
04620<br>
04621<br>
04622<br>
04623<br>
04624<br>
04625<br>
04626<br>
04627<br>
04628<br>
04629<br>
04630<br>
04631<br>
04632<br>
04633<br>
04634<br>
04635<br>
04636<br>
04637<br>
04638<br>
04639<br>
04640<br>
04641<br>
04642<br>
04643<br>
04644<br>
04645<br>
04646<br>
04647<br>
04648<br>
04649<br>
04650<br>
04651<br>
04652<br>
04653<br>
04654<br>
04655<br>
04656<br>
04657<br>
04658<br>
04659<br>
04660<br>
04661<br>
04662<br>
04663<br>
04664<br>
04665<br>
04666<br>
04667<br>
04668<br>
04669<br>
04670<br>
04671<br>
04672<br>
04673<br>
04674<br>
04675<br>
04676<br>
04677<br>
04678<br>
04679<br>
04680<br>
04681<br>
04682<br>
04683<br>
04684<br>
04685<br>
04686<br>
04687<br>
04688<br>
04689<br>
04690<br>
04691<br>
04692<br>
04693<br>
04694<br>
04695<br>
04696<br>
04697<br>
04698<br>
04699<br>
04700<br>
04701<br>
04702<br>
04703<br>
04704<br>
04705<br>
04706<br>
04707<br>
04708<br>
04709<br>
04710<br>
04711<br>
04712<br>
04713<br>
04714<br>
04715<br>
04716<br>
04717<br>
04718<br>
04719<br>
04720<br>
04721<br>
04722<br>
04723<br>
04724<br>
04725<br>
04726<br>
04727<br>
04728<br>
04729<br>
04730<br>
04731<br>
04732<br>
04733<br>
04734<br>
04735<br>
04736<br>
04737<br>
04738<br>
04739<br>
04740<br>
04741<br>
04742<br>
04743<br>
04744<br>
04745<br>
04746<br>
04747<br>
04748<br>
04749<br>
04750<br>
04751<br>
04752<br>
04753<br>
04754<br>
04755<br>
04756<br>
04757<br>
04758<br>
04759<br>
04760<br>
04761<br>
04762<br>
04763<br>
04764<br>
04765<br>
04766<br>
04767<br>
04768<br>
04769<br>
04770<br>
04771<br>
04772<br>
04773<br>
04774<br>
04775<br>
04776<br>
04777<br>
04778<br>
04779<br>
04780<br>
04781<br>
04782<br>
04783<br>
04784<br>
04785<br>
04786<br>
04787<br>
04788<br>
04789<br>
04790<br>
04791<br>
04792<br>
04793<br>
04794<br>
04795<br>
04796<br>
04797<br>
04798<br>
04799<br>
04800<br>
04801<br>
04802<br>
04803<br>
04804<br>
04805<br>
04806<br>
04807<br>
04808<br>
04809<br>
04810<br>
04811<br>
04812<br>
04813<br>
04814<br>
04815<br>
04816<br>
04817<br>
04818<br>
04819<br>
04820<br>
04821<br>
04822<br>
04823<br>
04824<br>
04825<br>
04826<br>
04827<br>
04828<br>
04829<br>
04830<br>
04831<br>
04832<br>
04833<br>
04834<br>
04835<br>
04836<br>
04837<br>
04838<br>
04839<br>
04840<br>
04841<br>
04842<br>
04843<br>
04844<br>
04845<br>
04846<br>
04847<br>
04848<br>
04849<br>
04850<br>
04851<br>
04852<br>
04853<br>
04854<br>
04855<br>
04856<br>
04857<br>
04858<br>
04859<br>
04860<br>
04861<br>
04862<br>
04863<br>
04864<br>
04865<br>
04866<br>
04867<br>
04868<br>
04869<br>
04870<br>
04871<br>
04872<br>
04873<br>
04874<br>
04875<br>
04876<br>
04877<br>
04878<br>
04879<br>
04880<br>
04881<br>
04882<br>
04883<br>
04884<br>
04885<br>
04886<br>
04887<br>
04888<br>
04889<br>
04890<br>
04891<br>
04892<br>
04893<br>
04894<br>
04895<br>
04896<br>
04897<br>
04898<br>
04899<br>
04900<br>
04901<br>
04902<br>
04903<br>
04904<br>
04905<br>
04906<br>
04907<br>
04908<br>
04909<br>
04910<br>
04911<br>
04912<br>
04913<br>
04914<br>
04915<br>
04916<br>
04917<br>
04918<br>
04919<br>
04920<br>
04921<br>
04922<br>
04923<br>
04924<br>
04925<br>
04926<br>
04927<br>
04928<br>
04929<br>
04930<br>
04931<br>
04932<br>
04933<br>
04934<br>
04935<br>
04936<br>
04937<br>
04938<br>
04939<br>
04940<br>
04941<br>
04942<br>
04943<br>
04944<br>
04945<br>
04946<br>
04947<br>
04948<br>
04949<br>
04950<br>
04951<br>
04952<br>
04953<br>
04954<br>
04955<br>
04956<br>
04957<br>
04958<br>
04959<br>
04960<br>
04961<br>
04962<br>
04963<br>
04964<br>
04965<br>
04966<br>
04967<br>
04968<br>
04969<br>
04970<br>
04971<br>
04972<br>
04973<br>
04974<br>
04975<br>
04976<br>
04977<br>
04978<br>
04979<br>
04980<br>
04981<br>
04982<br>
04983<br>
04984<br>
04985<br>
04986<br>
04987<br>
04988<br>
04989<br>
04990<br>
04991<br>
04992<br>
04993<br>
04994<br>
04995<br>
04996<br>
04997<br>
04998<br>
04999<br>
05000<br>
05001<br>
05002<br>
05003<br>
05004<br>
05005<br>
05006<br>
05007<br>
05008<br>
05009<br>
05010<br>
05011<br>
05012<br>
05013<br>
05014<br>
05015<br>
05016<br>
05017<br>
05018<br>
05019<br>
05020<br>
05021<br>
05022<br>
05023<br>
05024<br>
05025<br>
05026<br>
05027<br>
05028<br>
05029<br>
05030<br>
05031<br>
05032<br>
05033<br>
05034<br>
05035<br>
05036<br>
05037<br>
05038<br>
05039<br>
05040<br>
05041<br>
05042<br>
05043<br>
05044<br>
05045<br>
05046<br>
05047<br>
05048<br>
05049<br>
05050<br>
05051<br>
05052<br>
05053<br>
05054<br>
05055<br>
05056<br>
05057<br>
05058<br>
05059<br>
05060<br>
05061<br>
05062<br>
05063<br>
05064<br>
05065<br>
05066<br>
05067<br>
05068<br>
05069<br>
05070<br>
05071<br>
05072<br>
05073<br>
05074<br>
05075<br>
05076<br>
05077<br>
05078<br>
05079<br>
05080<br>
05081<br>
05082<br>
05083<br>
05084<br>
05085<br>
05086<br>
05087<br>
05088<br>
05089<br>
05090<br>
05091<br>
05092<br>
05093<br>
05094<br>
05095<br>
05096<br>
05097<br>
05098<br>
05099<br>
05100<br>
05101<br>
05102<br>
05103<br>
05104<br>
05105<br>
05106<br>
05107<br>
05108<br>
05109<br>
05110<br>
05111<br>
05112<br>
05113<br>
05114<br>
05115<br>
05116<br>
05117<br>
05118<br>
05119<br>
05120<br>
05121<br>
05122<br>
05123<br>
05124<br>
05125<br>
05126<br>
05127<br>
05128<br>
05129<br>
05130<br>
05131<br>
05132<br>
05133<br>
05134<br>
05135<br>
05136<br>
05137<br>
05138<br>
05139<br>
05140<br>
05141<br>
05142<br>
05143<br>
05144<br>
05145<br>
05146<br>
05147<br>
05148<br>
05149<br>
05150<br>
05151<br>
05152<br>
05153<br>
05154<br>
05155<br>
05156<br>
05157<br>
05158<br>
05159<br>
05160<br>
05161<br>
05162<br>
05163<br>
05164<br>
05165<br>
05166<br>
05167<br>
05168<br>
05169<br>
05170<br>
05171<br>
05172<br>
05173<br>
05174<br>
05175<br>
05176<br>
05177<br>
05178<br>
05179<br>
05180<br>
05181<br>
05182<br>
05183<br>
05184<br>
05185<br>
05186<br>
05187<br>
05188<br>
05189<br>
05190<br>
05191<br>
05192<br>
05193<br>
05194<br>
05195<br>
05196<br>
05197<br>
05198<br>
05199<br>
05200<br>
05201<br>
05202<br>
05203<br>
05204<br>
05205<br>
05206<br>
05207<br>
05208<br>
05209<br>
05210<br>
05211<br>
05212<br>
05213<br>
05214<br>
05215<br>
05216<br>
05217<br>
05218<br>
05219<br>
05220<br>
05221<br>
05222<br>
05223<br>
05224<br>
05225<br>
05226<br>
05227<br>
05228<br>
05229<br>
05230<br>
05231<br>
05232<br>
05233<br>
05234<br>
05235<br>
05236<br>
05237<br>
05238<br>
05239<br>
05240<br>
05241<br>
05242<br>
05243<br>
05244<br>
05245<br>
05246<br>
05247<br>
05248<br>
05249<br>
05250<br>
05251<br>
05252<br>
05253<br>
05254<br>
05255<br>
05256<br>
05257<br>
05258<br>
05259<br>
05260<br>
05261<br>
05262<br>
05263<br>
05264<br>
05265<br>
05266<br>
05267<br>
</font></td><td class="source"><pre class="source"><a name="1"></a><font class="source_comment">//=============================================================================
</font><a name="2"></a><font class="source_comment">// Bots.
</font><a name="3"></a><font class="source_comment">//=============================================================================
</font><a name="4"></a><font class="source_keyword">class</font> <font class="source_type"><a href="..\unrealshare\bots.html" class="source">Bots</a></font> <font class="source_keyword">extends</font> <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>
<a name="5"></a>    <font class="source_keyword2">abstract</font>;
<a name="6"></a>
<a name="7"></a><font class="source_macro">#exec AUDIO IMPORT FILE="Sounds\Generic\land1.WAV" NAME="Land1" GROUP="Generic"
</font><a name="8"></a><font class="source_macro">#exec AUDIO IMPORT FILE="Sounds\Generic\lsplash.WAV" NAME="LSplash" GROUP="Generic"
</font><a name="9"></a>
<a name="10"></a><font class="source_keyword">var</font>(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>) <font class="source_keyword">class</font>&lt;<font class="source_type"><a href="..\engine\carcass.html" class="source">carcass</a></font>&gt; CarcassType;
<a name="11"></a>
<a name="12"></a><font class="source_comment">// Advanced AI attributes.
</font><a name="13"></a><font class="source_keyword">var</font> <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>            TeamLeader;
<a name="14"></a><font class="source_keyword">var</font> <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font>           OrderObject;
<a name="15"></a><font class="source_keyword">var</font>(Combat) <font class="source_keyword">float</font>   TimeBetweenAttacks;  <font class="source_comment">// seconds - modified by difficulty
</font><a name="16"></a><font class="source_keyword">var</font>     <font class="source_keyword">name</font>        NextAnim;       <font class="source_comment">// used in states with multiple, sequenced animations	
</font><a name="17"></a><font class="source_keyword">var</font>(Combat) <font class="source_keyword">float</font>   Aggressiveness; <font class="source_comment">//0.0 to 1.0 (typically) 
</font><a name="18"></a><font class="source_keyword">var</font>     <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>        OldEnemy;
<a name="19"></a><font class="source_keyword">var</font>     <font class="source_keyword">int</font>         numHuntPaths;
<a name="20"></a><font class="source_keyword">var</font>     <font class="source_keyword">float</font>       HuntStartTime;
<a name="21"></a><font class="source_keyword">var</font>     <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font>      HidingSpot;
<a name="22"></a><font class="source_keyword">var</font>     <font class="source_keyword">float</font>       WalkingSpeed;
<a name="23"></a><font class="source_keyword">var</font>(Combat) <font class="source_keyword">float</font>   RefireRate;
<a name="24"></a>
<a name="25"></a><font class="source_comment">//AI flags
</font><a name="26"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bReadyToAttack;     <font class="source_comment">// can attack again 
</font><a name="27"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bCanFire;           <font class="source_comment">//used by TacticalMove and Charging states
</font><a name="28"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bCanDuck;
<a name="29"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bStrafeDir;
<a name="30"></a><font class="source_keyword">var</font>(Combat) <font class="source_keyword">bool</font>    bIsWuss;            <font class="source_comment">// always takes hit
</font><a name="31"></a><font class="source_keyword">var</font>(Combat) <font class="source_keyword">bool</font>    bLeadTarget;        <font class="source_comment">// lead target with projectile attack
</font><a name="32"></a><font class="source_keyword">var</font>(Combat) <font class="source_keyword">bool</font>    bWarnTarget;        <font class="source_comment">// warn target when projectile attack
</font><a name="33"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bCrouching;
<a name="34"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bFirstHatePlayer;
<a name="35"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bClearShot;
<a name="36"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bSpecialGoal;
<a name="37"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bChangeDir;         <font class="source_comment">// tactical move boolean
</font><a name="38"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bMoraleBoosted;
<a name="39"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bFiringPaused;
<a name="40"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bSpecialPausing;
<a name="41"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bGreenBlood;
<a name="42"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bFrustrated;
<a name="43"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bNoShootDecor;
<a name="44"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bGathering;
<a name="45"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bCamping;
<a name="46"></a><font class="source_keyword">var</font> <font class="source_keyword2">config</font>  <font class="source_keyword">bool</font>    bVerbose; <font class="source_comment">//for debugging
</font><a name="47"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bViewTarget; <font class="source_comment">//is being used as a viewtarget
</font><a name="48"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bWantsToCamp;
<a name="49"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bWallAdjust;
<a name="50"></a><font class="source_keyword">var</font>     <font class="source_keyword">bool</font>        bNoClearSpecial;
<a name="51"></a>
<a name="52"></a><font class="source_keyword">var</font> <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> EnemyDropped;
<a name="53"></a><font class="source_keyword">var</font> <font class="source_keyword">float</font> PlayerKills;
<a name="54"></a><font class="source_keyword">var</font> <font class="source_keyword">float</font> PlayerDeaths;
<a name="55"></a><font class="source_keyword">var</font> <font class="source_keyword">float</font> LastInvFind;
<a name="56"></a><font class="source_keyword">var</font> <font class="source_keyword">class</font>&lt;<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>&gt; FavoriteWeapon;
<a name="57"></a><font class="source_keyword">var</font> <font class="source_keyword">float</font> Accuracy;
<a name="58"></a>
<a name="59"></a><font class="source_keyword">var</font>     <font class="source_keyword">name</font>        LastPainAnim;
<a name="60"></a><font class="source_keyword">var</font>     <font class="source_keyword">float</font>       LastPainTime;
<a name="61"></a>
<a name="62"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   drown;
<a name="63"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   breathagain;
<a name="64"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   Footstep1;
<a name="65"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   Footstep2;
<a name="66"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   Footstep3;
<a name="67"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   HitSound3;
<a name="68"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   HitSound4;
<a name="69"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   Die2;
<a name="70"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   Die3;
<a name="71"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   Die4;
<a name="72"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   GaspSound;
<a name="73"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   UWHit1;
<a name="74"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   UWHit2;
<a name="75"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   LandGrunt;
<a name="76"></a><font class="source_keyword">var</font>(Sounds) <font class="source_type">sound</font>   JumpSound;
<a name="77"></a>
<a name="78"></a><font class="source_keyword">var</font> <font class="source_keyword">float</font> CampTime;
<a name="79"></a><font class="source_keyword">var</font> <font class="source_keyword">float</font> CampingRate;
<a name="80"></a><font class="source_keyword">var</font> <font class="source_keyword">float</font> LastCampCheck;
<a name="81"></a><font class="source_keyword">var</font> <font class="source_type"><a href="..\engine\ambushpoint.html" class="source">Ambushpoint</a></font> AmbushSpot;
<a name="82"></a><font class="source_keyword">var</font> <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font>   Pointer;
<a name="83"></a>
<a name="84"></a><font class="source_keyword">function</font> PreBeginPlay()
<a name="85"></a>{
<a name="86"></a>    bIsPlayer = <font class="source_keyword">true</font>;
<a name="87"></a>    <font class="source_keyword">Super</font>.PreBeginPlay();
<a name="88"></a>}
<a name="89"></a>
<a name="90"></a>singular <font class="source_keyword">event</font> BaseChange()
<a name="91"></a>{
<a name="92"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="93"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal, HitLocation;
<a name="94"></a>
<a name="95"></a>    <font class="source_keyword">if</font> ( (Base != <font class="source_keyword">None</font>) && Base.IsA(<font class="source_name">'Mover'</font>) )
<a name="96"></a>    {
<a name="97"></a>        <font class="source_comment">// handle shootable secret floors
</font><a name="98"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\mover.html" class="source">Mover</a></font>(Base).bDamageTriggered && !<font class="source_type"><a href="..\engine\mover.html" class="source">Mover</a></font>(Base).bOpening
<a name="99"></a>            && (MoveTarget != <font class="source_keyword">None</font>) )
<a name="100"></a>        {
<a name="101"></a>            HitActor = Trace(HitLocation, HitNormal, MoveTarget.Location, Location, <font class="source_keyword">true</font>);
<a name="102"></a>            <font class="source_keyword">if</font> ( HitActor == Base )
<a name="103"></a>            {
<a name="104"></a>                Target = Base;
<a name="105"></a>                bShootSpecial = <font class="source_keyword">true</font>;
<a name="106"></a>                FireWeapon();
<a name="107"></a>                bFire = <font class="source_int">0</font>;
<a name="108"></a>                bAltFire = <font class="source_int">0</font>;
<a name="109"></a>                Base.<font class="source_type"><a href="..\engine\trigger.html" class="source">Trigger</a></font>(Base, Self);
<a name="110"></a>                bShootSpecial = <font class="source_keyword">false</font>;
<a name="111"></a>            }
<a name="112"></a>        }
<a name="113"></a>    }
<a name="114"></a>    <font class="source_keyword">else</font>
<a name="115"></a>        <font class="source_keyword">Super</font>.BaseChange();
<a name="116"></a>}
<a name="117"></a>
<a name="118"></a><font class="source_keyword">function</font> HaltFiring()
<a name="119"></a>{
<a name="120"></a>    bCanFire = <font class="source_keyword">false</font>;
<a name="121"></a>    bFire = <font class="source_int">0</font>;
<a name="122"></a>    bAltFire = <font class="source_int">0</font>;
<a name="123"></a>    SetTimer((<font class="source_int">0.75</font> + <font class="source_int">0.5</font> * FRand()) * TimeBetweenAttacks, <font class="source_keyword">false</font>);
<a name="124"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != <font class="source_keyword">None</font> )
<a name="125"></a>        <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.Tick(<font class="source_int">0.001</font>);
<a name="126"></a>}
<a name="127"></a>
<a name="128"></a><font class="source_keyword">function</font> <font class="source_keyword">float</font> AdjustDesireFor(<font class="source_type"><a href="..\engine\inventory.html" class="source">Inventory</a></font> Inv)
<a name="129"></a>{
<a name="130"></a>    <font class="source_keyword">if</font> ( inv.<font class="source_keyword">class</font> == FavoriteWeapon )
<a name="131"></a>        <font class="source_keyword">return</font> <font class="source_int">0.3</font>;
<a name="132"></a>
<a name="133"></a>    <font class="source_keyword">return</font> <font class="source_int">0</font>;
<a name="134"></a>}
<a name="135"></a>
<a name="136"></a><font class="source_keyword">function</font> <font class="source_keyword">bool</font> SwitchToBestWeapon()
<a name="137"></a>{
<a name="138"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> rating;
<a name="139"></a>    <font class="source_keyword">local</font> <font class="source_keyword">int</font> usealt, favalt;
<a name="140"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\inventory.html" class="source">inventory</a></font> MyFav;
<a name="141"></a>
<a name="142"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\inventory.html" class="source">Inventory</a></font> == <font class="source_keyword">None</font> )
<a name="143"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="144"></a>
<a name="145"></a>    PendingWeapon = <font class="source_type"><a href="..\engine\inventory.html" class="source">Inventory</a></font>.RecommendWeapon(rating, usealt);
<a name="146"></a>
<a name="147"></a>    <font class="source_keyword">if</font> ( PendingWeapon == <font class="source_keyword">None</font> )
<a name="148"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="149"></a>
<a name="150"></a>    <font class="source_keyword">if</font> ( (FavoriteWeapon != <font class="source_keyword">None</font>) && (PendingWeapon.<font class="source_keyword">class</font> != FavoriteWeapon) )
<a name="151"></a>    {
<a name="152"></a>        MyFav = FindInventoryType(FavoriteWeapon);
<a name="153"></a>        <font class="source_keyword">if</font> ( (MyFav != <font class="source_keyword">None</font>) && (<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>(MyFav).RateSelf(favalt) + <font class="source_int">0.22</font> &gt; PendingWeapon.RateSelf(usealt)) )
<a name="154"></a>        {
<a name="155"></a>            usealt = favalt;
<a name="156"></a>            PendingWeapon = <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>(MyFav);
<a name="157"></a>        }
<a name="158"></a>    }
<a name="159"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> == <font class="source_keyword">None</font> )
<a name="160"></a>        ChangedWeapon();
<a name="161"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != PendingWeapon )
<a name="162"></a>        <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.PutDown();
<a name="163"></a>
<a name="164"></a>    <font class="source_keyword">return</font> (usealt &gt; <font class="source_int">0</font>);
<a name="165"></a>}
<a name="166"></a>
<a name="167"></a><font class="source_keyword">function</font> SpecialFire()
<a name="168"></a>{
<a name="169"></a>    bFiringPaused = <font class="source_keyword">true</font>;
<a name="170"></a>    SpecialPause = <font class="source_int">0.75</font> + VSize(Target.Location - Location)/Weapon.AltProjectileSpeed;
<a name="171"></a>    NextState = <font class="source_name">'Attacking'</font>;
<a name="172"></a>    NextLabel = <font class="source_name">'Begin'</font>; 
<a name="173"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="174"></a>    GotoState(<font class="source_name">'RangedAttack'</font>);
<a name="175"></a>}
<a name="176"></a>
<a name="177"></a><font class="source_comment">//*********************************************************************
</font><a name="178"></a><font class="source_comment">/* Default location specific take hits  - make sure pain frames are named right */</font>
<a name="179"></a><font class="source_keyword">function</font> PlayGutHit(<font class="source_keyword">float</font> tweentime)
<a name="180"></a>{
<a name="181"></a>    <font class="source_keyword">if</font> ( (LastPainTime - <font class="source_type">Level</font>.TimeSeconds &lt; <font class="source_int">0.3</font>) && (LastPainAnim == <font class="source_name">'GutHit'</font>) )
<a name="182"></a>    {
<a name="183"></a>        <font class="source_keyword">if</font> (FRand() &lt; <font class="source_int">0.5</font>)
<a name="184"></a>            TweenAnim(<font class="source_name">'LeftHit'</font>, tweentime);
<a name="185"></a>        <font class="source_keyword">else</font>
<a name="186"></a>            TweenAnim(<font class="source_name">'RightHit'</font>, tweentime);
<a name="187"></a>    }
<a name="188"></a>    <font class="source_keyword">else</font>
<a name="189"></a>        TweenAnim(<font class="source_name">'GutHit'</font>, tweentime);
<a name="190"></a>}
<a name="191"></a>
<a name="192"></a><font class="source_keyword">function</font> PlayHeadHit(<font class="source_keyword">float</font> tweentime)
<a name="193"></a>{
<a name="194"></a>    <font class="source_keyword">if</font> ( (LastPainTime - <font class="source_type">Level</font>.TimeSeconds &lt; <font class="source_int">0.3</font>) && (LastPainAnim == <font class="source_name">'HeadHit'</font>) )
<a name="195"></a>    {
<a name="196"></a>        <font class="source_keyword">if</font> (FRand() &lt; <font class="source_int">0.5</font>)
<a name="197"></a>            TweenAnim(<font class="source_name">'LeftHit'</font>, tweentime);
<a name="198"></a>        <font class="source_keyword">else</font>
<a name="199"></a>            TweenAnim(<font class="source_name">'RightHit'</font>, tweentime);
<a name="200"></a>    }
<a name="201"></a>    <font class="source_keyword">else</font>
<a name="202"></a>        TweenAnim(<font class="source_name">'HeadHit'</font>, tweentime);
<a name="203"></a>}
<a name="204"></a>
<a name="205"></a><font class="source_keyword">function</font> PlayLeftHit(<font class="source_keyword">float</font> tweentime)
<a name="206"></a>{
<a name="207"></a>    <font class="source_keyword">if</font> ( (LastPainTime - <font class="source_type">Level</font>.TimeSeconds &lt; <font class="source_int">0.3</font>) && (LastPainAnim == <font class="source_name">'LeftHit'</font>) )
<a name="208"></a>        TweenAnim(<font class="source_name">'GutHit'</font>, tweentime);
<a name="209"></a>    <font class="source_keyword">else</font>
<a name="210"></a>        TweenAnim(<font class="source_name">'LeftHit'</font>, tweentime);
<a name="211"></a>}
<a name="212"></a>
<a name="213"></a><font class="source_keyword">function</font> PlayRightHit(<font class="source_keyword">float</font> tweentime)
<a name="214"></a>{
<a name="215"></a>    <font class="source_keyword">if</font> ( (LastPainTime - <font class="source_type">Level</font>.TimeSeconds &lt; <font class="source_int">0.3</font>) && (LastPainAnim == <font class="source_name">'RightHit'</font>) )
<a name="216"></a>        TweenAnim(<font class="source_name">'GutHit'</font>, tweentime);
<a name="217"></a>    <font class="source_keyword">else</font>
<a name="218"></a>        TweenAnim(<font class="source_name">'RightHit'</font>, tweentime);
<a name="219"></a>}
<a name="220"></a>
<a name="221"></a><font class="source_keyword">function</font> <font class="source_keyword">bool</font> StrafeFromDamage(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> momentum, <font class="source_keyword">float</font> Damage,<font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">DamageType</a></font>, <font class="source_keyword">bool</font> bFindDest);
<a name="222"></a>
<a name="223"></a><font class="source_comment">//**********************************************************************
</font><a name="224"></a>
<a name="225"></a><font class="source_keyword">function</font> PlayHit(<font class="source_keyword">float</font> Damage, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> Momentum)
<a name="226"></a>{
<a name="227"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> rnd;
<a name="228"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\unrealshare\bubble1.html" class="source">Bubble1</a></font> bub;
<a name="229"></a>    <font class="source_keyword">local</font> <font class="source_keyword">bool</font> bOptionalTakeHit;
<a name="230"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> BloodOffset;
<a name="231"></a>
<a name="232"></a>    <font class="source_keyword">if</font> (Damage &gt; <font class="source_int">1</font>) <font class="source_comment">//spawn some blood
</font><a name="233"></a>    {
<a name="234"></a>        <font class="source_keyword">if</font> (<font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font> == <font class="source_name">'Drowned'</font>)
<a name="235"></a>        {
<a name="236"></a>            bub = spawn(<font class="source_keyword">class</font> <font class="source_name">'Bubble1'</font>,,, Location 
<a name="237"></a>                + <font class="source_int">0.7</font> * CollisionRadius * <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font>(ViewRotation) + <font class="source_int">0.3</font> * EyeHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>));
<a name="238"></a>            <font class="source_keyword">if</font> (bub != <font class="source_keyword">None</font>)
<a name="239"></a>                bub.DrawScale = FRand()*<font class="source_int">0.06</font>+<font class="source_int">0.04</font>; 
<a name="240"></a>        }
<a name="241"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font> != <font class="source_name">'Corroded'</font> )
<a name="242"></a>        {
<a name="243"></a>            BloodOffset = <font class="source_int">0.2</font> * CollisionRadius * Normal(HitLocation - Location);
<a name="244"></a>            BloodOffset.Z = BloodOffset.Z * <font class="source_int">0.5</font>;
<a name="245"></a>            spawn(<font class="source_keyword">class</font> <font class="source_name">'BloodSpray'</font>,,,hitLocation + BloodOffset, <font class="source_type"><a href="..\core\object.html#Rotator" class="source">rotator</a></font>(BloodOffset));
<a name="246"></a>        }
<a name="247"></a>    }   
<a name="248"></a>    
<a name="249"></a>    bOptionalTakeHit = bIsWuss || ( (<font class="source_type">Level</font>.TimeSeconds - LastPainTime &gt; <font class="source_int">0.3</font> + <font class="source_int">0.25</font> * skill)
<a name="250"></a>                        && (Damage * FRand() &gt; <font class="source_int">0.08</font> * <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font>) && (Skill &lt; <font class="source_int">3</font>)
<a name="251"></a>                        && (GetAnimGroup(AnimSequence) != <font class="source_name">'MovingAttack'</font>) 
<a name="252"></a>                        && (GetAnimGroup(AnimSequence) != <font class="source_name">'Attack'</font>) ); 
<a name="253"></a>    <font class="source_keyword">if</font> ( ((<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> == <font class="source_keyword">None</font>) || !<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.bPointing) && (GetAnimGroup(AnimSequence) != <font class="source_name">'Dodge'</font>) 
<a name="254"></a>        && (bOptionalTakeHit || (Momentum.Z &gt; <font class="source_int">140</font>)
<a name="255"></a>             || (Damage * FRand() &gt; (<font class="source_int">0.17</font> + <font class="source_int">0.04</font> * skill) * <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font>)) ) 
<a name="256"></a>    {
<a name="257"></a>        PlayTakeHitSound(Damage, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>, <font class="source_int">3</font>);
<a name="258"></a>        PlayHitAnim(HitLocation, Damage);
<a name="259"></a>    }
<a name="260"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font> (NextState == <font class="source_name">'TakeHit'</font>)
<a name="261"></a>    {
<a name="262"></a>        PlayTakeHitSound(Damage, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>, <font class="source_int">2</font>);
<a name="263"></a>        NextState = <font class="source_name">''</font>;
<a name="264"></a>    }
<a name="265"></a>}
<a name="266"></a>
<a name="267"></a><font class="source_keyword">function</font> PlayHitAnim(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, <font class="source_keyword">float</font> Damage)
<a name="268"></a>{
<a name="269"></a>    NextAnim = <font class="source_name">''</font>; 
<a name="270"></a>    NextState = <font class="source_name">'TakeHit'</font>;
<a name="271"></a>    PlayTakeHit(<font class="source_int">0.08</font>, hitLocation, Damage); 
<a name="272"></a>} 
<a name="273"></a>
<a name="274"></a><font class="source_keyword">function</font> PlayDeathHit(<font class="source_keyword">float</font> Damage, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> Momentum)
<a name="275"></a>{
<a name="276"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\unrealshare\bubble1.html" class="source">Bubble1</a></font> bub;
<a name="277"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\unrealshare\bloodburst.html" class="source">BloodBurst</a></font> b;
<a name="278"></a>
<a name="279"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.bDestructive && (<font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.ExitActor != <font class="source_keyword">None</font>) )
<a name="280"></a>        Spawn(<font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.ExitActor);
<a name="281"></a>    <font class="source_keyword">if</font> (HeadRegion.Zone.bWaterZone)
<a name="282"></a>    {
<a name="283"></a>        bub = spawn(<font class="source_keyword">class</font> <font class="source_name">'Bubble1'</font>,,, Location 
<a name="284"></a>            + <font class="source_int">0.3</font> * CollisionRadius * <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font>(Rotation) + <font class="source_int">0.8</font> * EyeHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>));
<a name="285"></a>        <font class="source_keyword">if</font> (bub != <font class="source_keyword">None</font>)
<a name="286"></a>            bub.DrawScale = FRand()*<font class="source_int">0.08</font>+<font class="source_int">0.03</font>; 
<a name="287"></a>        bub = spawn(<font class="source_keyword">class</font> <font class="source_name">'Bubble1'</font>,,, Location 
<a name="288"></a>            + <font class="source_int">0.2</font> * CollisionRadius * VRand() + <font class="source_int">0.7</font> * EyeHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>));
<a name="289"></a>        <font class="source_keyword">if</font> (bub != <font class="source_keyword">None</font>)
<a name="290"></a>            bub.DrawScale = FRand()*<font class="source_int">0.08</font>+<font class="source_int">0.03</font>; 
<a name="291"></a>        bub = spawn(<font class="source_keyword">class</font> <font class="source_name">'Bubble1'</font>,,, Location 
<a name="292"></a>            + <font class="source_int">0.3</font> * CollisionRadius * VRand() + <font class="source_int">0.6</font> * EyeHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>));
<a name="293"></a>        <font class="source_keyword">if</font> (bub != <font class="source_keyword">None</font>)
<a name="294"></a>            bub.DrawScale = FRand()*<font class="source_int">0.08</font>+<font class="source_int">0.03</font>; 
<a name="295"></a>    }
<a name="296"></a>    <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font> != <font class="source_name">'Burned'</font>) && (<font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font> != <font class="source_name">'Corroded'</font>) 
<a name="297"></a>         && (<font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font> != <font class="source_name">'Drowned'</font>) && (<font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font> != <font class="source_name">'Fell'</font>) )
<a name="298"></a>    {
<a name="299"></a>        b = spawn(<font class="source_keyword">class</font> <font class="source_name">'BloodBurst'</font>,self,<font class="source_name">''</font>, hitLocation);
<a name="300"></a>        <font class="source_keyword">if</font> ( bGreenBlood && (b != <font class="source_keyword">None</font>) ) 
<a name="301"></a>            b.GreenBlood();     
<a name="302"></a>    }
<a name="303"></a>}
<a name="304"></a>
<a name="305"></a><font class="source_keyword">function</font> PlayChallenge()
<a name="306"></a>{
<a name="307"></a>    TweenToFighter(<font class="source_int">0.1</font>);
<a name="308"></a>}
<a name="309"></a>
<a name="310"></a><font class="source_keyword">function</font> AdjustSkill(<font class="source_keyword">bool</font> bWinner)
<a name="311"></a>{
<a name="312"></a>    <font class="source_keyword">if</font> ( bWinner )
<a name="313"></a>    {
<a name="314"></a>        PlayerKills += <font class="source_int">1</font>;
<a name="315"></a>        skill -= <font class="source_int">1</font>/Min(PlayerKills, <font class="source_int">20</font>);
<a name="316"></a>        skill = FClamp(skill, <font class="source_int">0</font>, <font class="source_int">3</font>);
<a name="317"></a>    }
<a name="318"></a>    <font class="source_keyword">else</font>
<a name="319"></a>    {
<a name="320"></a>        PlayerDeaths += <font class="source_int">1</font>;
<a name="321"></a>        skill += <font class="source_int">1</font>/Min(PlayerDeaths, <font class="source_int">20</font>);
<a name="322"></a>        skill = FClamp(skill, <font class="source_int">0</font>, <font class="source_int">3</font>);
<a name="323"></a>    }
<a name="324"></a>}
<a name="325"></a>
<a name="326"></a><font class="source_keyword2">simulated</font> <font class="source_keyword">function</font> PlayFootStep()
<a name="327"></a>{
<a name="328"></a>    <font class="source_keyword">local</font> <font class="source_type">sound</font> step;
<a name="329"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> decision;
<a name="330"></a>
<a name="331"></a>    <font class="source_keyword">if</font> ( FootRegion.Zone.bWaterZone )
<a name="332"></a>    {
<a name="333"></a>        PlaySound(<font class="source_type">sound</font> <font class="source_name">'LSplash'</font>, SLOT_Interact, <font class="source_int">1</font>, <font class="source_keyword">false</font>, <font class="source_int">1500.0</font>, <font class="source_int">1.0</font>);
<a name="334"></a>        <font class="source_keyword">return</font>;
<a name="335"></a>    }
<a name="336"></a>
<a name="337"></a>    decision = FRand();
<a name="338"></a>    <font class="source_keyword">if</font> ( decision &lt; <font class="source_int">0.34</font> )
<a name="339"></a>        step = Footstep1;
<a name="340"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font> (decision &lt; <font class="source_int">0.67</font> )
<a name="341"></a>        step = Footstep2;
<a name="342"></a>    <font class="source_keyword">else</font>
<a name="343"></a>        step = Footstep3;
<a name="344"></a>
<a name="345"></a>    <font class="source_keyword">if</font> ( DesiredSpeed &lt;= <font class="source_int">0.5</font> )
<a name="346"></a>        PlaySound(step, SLOT_Interact, <font class="source_int">0.5</font>, <font class="source_keyword">false</font>, <font class="source_int">400.0</font>, <font class="source_int">1.0</font>);
<a name="347"></a>    <font class="source_keyword">else</font> 
<a name="348"></a>        PlaySound(step, SLOT_Interact, <font class="source_int">1</font>, <font class="source_keyword">false</font>, <font class="source_int">1200.0</font>, <font class="source_int">1.0</font>);
<a name="349"></a>}
<a name="350"></a>
<a name="351"></a><font class="source_keyword">function</font> PlayDyingSound()
<a name="352"></a>{
<a name="353"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> rnd;
<a name="354"></a>
<a name="355"></a>    <font class="source_keyword">if</font> ( HeadRegion.Zone.bWaterZone )
<a name="356"></a>    {
<a name="357"></a>        <font class="source_keyword">if</font> ( FRand() &lt; <font class="source_int">0.5</font> )
<a name="358"></a>            PlaySound(UWHit1, SLOT_Pain,<font class="source_int">2.0</font>,,,Frand()*<font class="source_int">0.2</font>+<font class="source_int">0.9</font>);
<a name="359"></a>        <font class="source_keyword">else</font>
<a name="360"></a>            PlaySound(UWHit2, SLOT_Pain,<font class="source_int">2.0</font>,,,Frand()*<font class="source_int">0.2</font>+<font class="source_int">0.9</font>);
<a name="361"></a>        <font class="source_keyword">return</font>;
<a name="362"></a>    }
<a name="363"></a>
<a name="364"></a>    rnd = FRand();
<a name="365"></a>    <font class="source_keyword">if</font> (rnd &lt; <font class="source_int">0.25</font>)
<a name="366"></a>        PlaySound(Die, SLOT_Talk,<font class="source_int">2.0</font>);
<a name="367"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font> (rnd &lt; <font class="source_int">0.5</font>)
<a name="368"></a>        PlaySound(Die2, SLOT_Talk,<font class="source_int">2.0</font>);
<a name="369"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font> (rnd &lt; <font class="source_int">0.75</font>)
<a name="370"></a>        PlaySound(Die3, SLOT_Talk,<font class="source_int">2.0</font>);
<a name="371"></a>    <font class="source_keyword">else</font> 
<a name="372"></a>        PlaySound(Die4, SLOT_Talk,<font class="source_int">2.0</font>);
<a name="373"></a>}
<a name="374"></a>
<a name="375"></a><font class="source_keyword">function</font> PlayTakeHitSound(<font class="source_keyword">int</font> damage, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>, <font class="source_keyword">int</font> Mult)
<a name="376"></a>{
<a name="377"></a>    <font class="source_keyword">if</font> ( <font class="source_type">Level</font>.TimeSeconds - LastPainSound &lt; <font class="source_int">0.25</font> )
<a name="378"></a>        <font class="source_keyword">return</font>;
<a name="379"></a>    LastPainSound = <font class="source_type">Level</font>.TimeSeconds;
<a name="380"></a>
<a name="381"></a>    <font class="source_keyword">if</font> ( HeadRegion.Zone.bWaterZone )
<a name="382"></a>    {
<a name="383"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font> == <font class="source_name">'Drowned'</font> )
<a name="384"></a>            PlaySound(drown, SLOT_Pain, <font class="source_int">1.5</font>);
<a name="385"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( FRand() &lt; <font class="source_int">0.5</font> )
<a name="386"></a>            PlaySound(UWHit1, SLOT_Pain,<font class="source_int">2.0</font>,,,Frand()*<font class="source_int">0.15</font>+<font class="source_int">0.9</font>);
<a name="387"></a>        <font class="source_keyword">else</font>
<a name="388"></a>            PlaySound(UWHit2, SLOT_Pain,<font class="source_int">2.0</font>,,,Frand()*<font class="source_int">0.15</font>+<font class="source_int">0.9</font>);
<a name="389"></a>        <font class="source_keyword">return</font>;
<a name="390"></a>    }
<a name="391"></a>    damage *= FRand();
<a name="392"></a>
<a name="393"></a>    <font class="source_keyword">if</font> (damage &lt; <font class="source_int">8</font>) 
<a name="394"></a>        PlaySound(HitSound1, SLOT_Pain,<font class="source_int">2.0</font>,,,Frand()*<font class="source_int">0.2</font>+<font class="source_int">0.9</font>);
<a name="395"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font> (damage &lt; <font class="source_int">25</font>)
<a name="396"></a>    {
<a name="397"></a>        <font class="source_keyword">if</font> (FRand() &lt; <font class="source_int">0.5</font>) PlaySound(HitSound2, SLOT_Pain,<font class="source_int">2.0</font>,,,Frand()*<font class="source_int">0.15</font>+<font class="source_int">0.9</font>);          
<a name="398"></a>        <font class="source_keyword">else</font> PlaySound(HitSound3, SLOT_Pain,<font class="source_int">2.0</font>,,,Frand()*<font class="source_int">0.15</font>+<font class="source_int">0.9</font>);
<a name="399"></a>    }
<a name="400"></a>    <font class="source_keyword">else</font>
<a name="401"></a>        PlaySound(HitSound4, SLOT_Pain,<font class="source_int">2.0</font>,,,Frand()*<font class="source_int">0.15</font>+<font class="source_int">0.9</font>);         
<a name="402"></a>}
<a name="403"></a>
<a name="404"></a><font class="source_keyword">function</font> CallForHelp()
<a name="405"></a>{
<a name="406"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> P;
<a name="407"></a>        
<a name="408"></a>    <font class="source_keyword">for</font> ( P=<font class="source_type">Level</font>.PawnList; P!=<font class="source_keyword">None</font>; P=P.NextPawn )
<a name="409"></a>        <font class="source_keyword">if</font> ( P.IsA(<font class="source_name">'Bot'</font>) && (P.<font class="source_type"><a href="..\engine\playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></font>.Team == <font class="source_type"><a href="..\engine\playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></font>.Team) )
<a name="410"></a>            P.HandleHelpMessageFrom(self);
<a name="411"></a>}
<a name="412"></a>
<a name="413"></a><font class="source_keyword">function</font> <font class="source_keyword">string</font> KillMessage( <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>, <font class="source_type"><a href="..\engine\pawn.html" class="source">pawn</a></font> Other )
<a name="414"></a>{
<a name="415"></a>    <font class="source_keyword">return</font> ( Other.<font class="source_type"><a href="..\engine\playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></font>.PlayerName$<font class="source_type">Level</font>.Game.PlayerKillMessage(<font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>, Other.<font class="source_type"><a href="..\engine\playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></font>)$<font class="source_type"><a href="..\engine\playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></font>.PlayerName );
<a name="416"></a>}
<a name="417"></a>
<a name="418"></a><font class="source_keyword">function</font> Gasp()
<a name="419"></a>{
<a name="420"></a>    <font class="source_keyword">if</font> ( PainTime &lt; <font class="source_int">2</font> )
<a name="421"></a>        PlaySound(GaspSound, SLOT_Talk, <font class="source_int">2.0</font>);
<a name="422"></a>    <font class="source_keyword">else</font>
<a name="423"></a>        PlaySound(BreathAgain, SLOT_Talk, <font class="source_int">2.0</font>);
<a name="424"></a>}
<a name="425"></a>
<a name="426"></a><font class="source_keyword">function</font> ZoneChange(<font class="source_type"><a href="..\engine\zoneinfo.html" class="source">ZoneInfo</a></font> newZone)
<a name="427"></a>{
<a name="428"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> jumpDir;
<a name="429"></a>
<a name="430"></a>    <font class="source_keyword">if</font> ( newZone.bWaterZone )
<a name="431"></a>    {
<a name="432"></a>        <font class="source_keyword">if</font> (!bCanSwim)
<a name="433"></a>            MoveTimer = -<font class="source_int">1.0</font>;
<a name="434"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> (Physics != PHYS_Swimming)
<a name="435"></a>        {
<a name="436"></a>            <font class="source_keyword">if</font> (Physics != PHYS_Falling)
<a name="437"></a>                PlayDive(); 
<a name="438"></a>            setPhysics(PHYS_Swimming);
<a name="439"></a>        }
<a name="440"></a>    }
<a name="441"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font> (Physics == PHYS_Swimming)
<a name="442"></a>    {
<a name="443"></a>        <font class="source_keyword">if</font> ( bCanFly )
<a name="444"></a>             SetPhysics(PHYS_Flying); 
<a name="445"></a>        <font class="source_keyword">else</font>
<a name="446"></a>        { 
<a name="447"></a>            SetPhysics(PHYS_Falling);
<a name="448"></a>            <font class="source_keyword">if</font> ( bCanWalk && (Abs(Acceleration.X) + Abs(Acceleration.Y) &gt; <font class="source_int">0</font>)
<a name="449"></a>                && (Destination.Z &gt;= Location.Z) 
<a name="450"></a>                && CheckWaterJump(jumpDir) )
<a name="451"></a>                JumpOutOfWater(jumpDir);
<a name="452"></a>        }
<a name="453"></a>    }
<a name="454"></a>}
<a name="455"></a>
<a name="456"></a><font class="source_keyword">function</font> JumpOutOfWater(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> jumpDir)
<a name="457"></a>{
<a name="458"></a>    Falling();
<a name="459"></a>    Velocity = jumpDir * WaterSpeed;
<a name="460"></a>    Acceleration = jumpDir * AccelRate;
<a name="461"></a>    velocity.Z = <font class="source_int">380</font>; <font class="source_comment">//set here so physics uses this for remainder of tick
</font><a name="462"></a>    PlayOutOfWater();
<a name="463"></a>    bUpAndOut = <font class="source_keyword">true</font>;
<a name="464"></a>}
<a name="465"></a>
<a name="466"></a><font class="source_keyword">function</font> PreSetMovement()
<a name="467"></a>{
<a name="468"></a>    <font class="source_keyword">if</font> ( Skill == <font class="source_int">3</font> )
<a name="469"></a>    {
<a name="470"></a>        PeripheralVision = -<font class="source_int">0.1</font>;
<a name="471"></a>        RotationRate.Yaw = <font class="source_int">100000</font>;
<a name="472"></a>    }
<a name="473"></a>    <font class="source_keyword">else</font>
<a name="474"></a>    {
<a name="475"></a>        PeripheralVision = <font class="source_int">0.7</font> - <font class="source_int">0.35</font> * skill;
<a name="476"></a>        RotationRate.Yaw = <font class="source_int">30000</font> + <font class="source_int">16000</font> * skill;
<a name="477"></a>    }
<a name="478"></a>    <font class="source_keyword">if</font> (JumpZ &gt; <font class="source_int">0</font>)
<a name="479"></a>        bCanJump = <font class="source_keyword">true</font>;
<a name="480"></a>    bCanWalk = <font class="source_keyword">true</font>;
<a name="481"></a>    bCanSwim = <font class="source_keyword">true</font>;
<a name="482"></a>    bCanFly = <font class="source_keyword">false</font>;
<a name="483"></a>    MinHitWall = -<font class="source_int">0.5</font>;
<a name="484"></a>    bCanOpenDoors = <font class="source_keyword">true</font>;
<a name="485"></a>    bCanDoSpecial = <font class="source_keyword">true</font>;
<a name="486"></a>    <font class="source_keyword">if</font> ( skill &lt;= <font class="source_int">1</font> )
<a name="487"></a>    {
<a name="488"></a>        bCanDuck = <font class="source_keyword">false</font>;
<a name="489"></a>        MaxDesiredSpeed = <font class="source_int">0.8</font> + <font class="source_int">0.1</font> * skill;
<a name="490"></a>    }
<a name="491"></a>    <font class="source_keyword">else</font>
<a name="492"></a>    {
<a name="493"></a>        MaxDesiredSpeed = <font class="source_int">1</font>;
<a name="494"></a>        bCanDuck = <font class="source_keyword">true</font>;
<a name="495"></a>    }
<a name="496"></a>}
<a name="497"></a>
<a name="498"></a><font class="source_keyword">function</font> PainTimer()
<a name="499"></a>{
<a name="500"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> depth;
<a name="501"></a>    <font class="source_keyword">if</font> (<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font>)
<a name="502"></a>        <font class="source_keyword">return</font>;
<a name="503"></a>
<a name="504"></a>    <font class="source_keyword">if</font> (FootRegion.Zone.bPainZone)
<a name="505"></a>        <font class="source_keyword">Super</font>.PainTimer();
<a name="506"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font> (HeadRegion.Zone.bWaterZone)
<a name="507"></a>    {
<a name="508"></a>        <font class="source_keyword">if</font> (bDrowning)
<a name="509"></a>            self.TakeDamage(<font class="source_int">5</font>, <font class="source_keyword">None</font>, Location, vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>), <font class="source_name">'Drowned'</font>); 
<a name="510"></a>        <font class="source_keyword">else</font>
<a name="511"></a>        {
<a name="512"></a>            bDrowning = <font class="source_keyword">true</font>;
<a name="513"></a>            GotoState(<font class="source_name">'FindAir'</font>);
<a name="514"></a>        }
<a name="515"></a>        <font class="source_keyword">if</font> (<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &gt; <font class="source_int">0</font>)
<a name="516"></a>            PainTime = <font class="source_int">2.0</font>;
<a name="517"></a>    }
<a name="518"></a>}   
<a name="519"></a>
<a name="520"></a><font class="source_keyword">function</font> ChangedWeapon()
<a name="521"></a>{
<a name="522"></a>    <font class="source_keyword">local</font> <font class="source_keyword">int</font> usealt;
<a name="523"></a>
<a name="524"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> == PendingWeapon )
<a name="525"></a>    {
<a name="526"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> == <font class="source_keyword">None</font> )
<a name="527"></a>            SwitchToBestWeapon();
<a name="528"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.GetStateName() == <font class="source_name">'DownWeapon'</font> ) 
<a name="529"></a>            <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.GotoState(<font class="source_name">'Idle'</font>);
<a name="530"></a>        PendingWeapon = <font class="source_keyword">None</font>;
<a name="531"></a>    }
<a name="532"></a>    <font class="source_keyword">else</font>
<a name="533"></a>        <font class="source_keyword">Super</font>.ChangedWeapon();
<a name="534"></a>
<a name="535"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != <font class="source_keyword">None</font> )
<a name="536"></a>    {
<a name="537"></a>        <font class="source_keyword">if</font> ( (bFire &gt; <font class="source_int">0</font>) || (bAltFire &gt; <font class="source_int">0</font>) )
<a name="538"></a>        {
<a name="539"></a>            <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.RateSelf(usealt);
<a name="540"></a>            <font class="source_keyword">if</font> ( usealt == <font class="source_int">0</font> )
<a name="541"></a>            {
<a name="542"></a>                bAltFire = <font class="source_int">0</font>;
<a name="543"></a>                bFire = <font class="source_int">1</font>;
<a name="544"></a>                <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.Fire(<font class="source_int">1.0</font>);
<a name="545"></a>            }
<a name="546"></a>            <font class="source_keyword">else</font>
<a name="547"></a>            {
<a name="548"></a>                bAltFire = <font class="source_int">0</font>;
<a name="549"></a>                bFire = <font class="source_int">1</font>;
<a name="550"></a>                <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.AltFire(<font class="source_int">1.0</font>);
<a name="551"></a>            }
<a name="552"></a>        }
<a name="553"></a>        <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.SetHand(<font class="source_int">0</font>);
<a name="554"></a>    }
<a name="555"></a>}
<a name="556"></a>
<a name="557"></a><font class="source_keyword">function</font> <font class="source_keyword">bool</font> Gibbed(<font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="558"></a>{
<a name="559"></a>    <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font> == <font class="source_name">'decapitated'</font>) || (<font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font> == <font class="source_name">'shot'</font>) )
<a name="560"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;   
<a name="561"></a>    <font class="source_keyword">return</font> ( (<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt; -<font class="source_int">80</font>) || ((<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt; -<font class="source_int">40</font>) && (FRand() &lt; <font class="source_int">0.65</font>)) );
<a name="562"></a>}
<a name="563"></a>
<a name="564"></a><font class="source_keyword">function</font> SpawnGibbedCarcass()
<a name="565"></a>{
<a name="566"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\carcass.html" class="source">carcass</a></font> carc;
<a name="567"></a>
<a name="568"></a>    carc = Spawn(CarcassType);
<a name="569"></a>    <font class="source_keyword">if</font> ( carc != <font class="source_keyword">None</font> )
<a name="570"></a>    {
<a name="571"></a>        carc.Initfor(self);
<a name="572"></a>        carc.ChunkUp(-<font class="source_int">1</font> * <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font>);
<a name="573"></a>    }
<a name="574"></a>}
<a name="575"></a>
<a name="576"></a><font class="source_keyword">function</font> <font class="source_type"><a href="..\engine\carcass.html" class="source">Carcass</a></font> SpawnCarcass()
<a name="577"></a>{
<a name="578"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\carcass.html" class="source">carcass</a></font> carc;
<a name="579"></a>
<a name="580"></a>    carc = Spawn(CarcassType);
<a name="581"></a>    <font class="source_keyword">if</font> ( carc != <font class="source_keyword">None</font> )
<a name="582"></a>        carc.Initfor(self);
<a name="583"></a>
<a name="584"></a>    <font class="source_keyword">return</font> carc;
<a name="585"></a>}
<a name="586"></a>
<a name="587"></a><font class="source_keyword">function</font> JumpOffPawn()
<a name="588"></a>{
<a name="589"></a>    Velocity += (<font class="source_int">60</font> + CollisionRadius) * VRand();
<a name="590"></a>    Velocity.Z = <font class="source_int">180</font> + CollisionHeight;
<a name="591"></a>    SetPhysics(PHYS_Falling);
<a name="592"></a>    bJumpOffPawn = <font class="source_keyword">true</font>;
<a name="593"></a>    SetFall();
<a name="594"></a>}
<a name="595"></a>
<a name="596"></a><font class="source_comment">//=============================================================================
</font><a name="597"></a>    
<a name="598"></a><font class="source_keyword">function</font> SetMovementPhysics()
<a name="599"></a>{
<a name="600"></a>    <font class="source_keyword">if</font> (Physics == PHYS_Falling)
<a name="601"></a>        <font class="source_keyword">return</font>;
<a name="602"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.bWaterZone )
<a name="603"></a>        SetPhysics(PHYS_Swimming);
<a name="604"></a>    <font class="source_keyword">else</font>
<a name="605"></a>        SetPhysics(PHYS_Walking); 
<a name="606"></a>}
<a name="607"></a>
<a name="608"></a><font class="source_keyword">function</font> FearThisSpot(<font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> aSpot)
<a name="609"></a>{
<a name="610"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="611"></a>    MoveTimer = -<font class="source_int">1.0</font>;
<a name="612"></a>}
<a name="613"></a>
<a name="614"></a><font class="source_comment">/*
<a name="615"></a>SetAlertness()
<a name="616"></a>Change creature's alertness, and appropriately modify attributes used by engine for determining
<a name="617"></a>seeing and hearing.
<a name="618"></a>SeePlayer() is affected by PeripheralVision, and also by SightRadius and the target's visibility
<a name="619"></a>HearNoise() is affected by HearingThreshold
<a name="620"></a>*/</font>
<a name="621"></a><font class="source_keyword2">final</font> <font class="source_keyword">function</font> SetAlertness(<font class="source_keyword">float</font> NewAlertness)
<a name="622"></a>{
<a name="623"></a>    <font class="source_keyword">if</font> ( Alertness != NewAlertness )
<a name="624"></a>    {
<a name="625"></a>        PeripheralVision += <font class="source_int">0.707</font> * (Alertness - NewAlertness); <font class="source_comment">//Used by engine for SeePlayer()
</font><a name="626"></a>        HearingThreshold += <font class="source_int">0.5</font> * (Alertness - NewAlertness); <font class="source_comment">//Used by engine for HearNoise()
</font><a name="627"></a>        Alertness = NewAlertness;
<a name="628"></a>    }
<a name="629"></a>}
<a name="630"></a>
<a name="631"></a><font class="source_keyword">function</font> WhatToDoNext(<font class="source_keyword">name</font> LikelyState, <font class="source_keyword">name</font> LikelyLabel)
<a name="632"></a>{
<a name="633"></a>    bFire = <font class="source_int">0</font>;
<a name="634"></a>    bAltFire = <font class="source_int">0</font>;
<a name="635"></a>    bReadyToAttack = <font class="source_keyword">false</font>;
<a name="636"></a>    Enemy = <font class="source_keyword">None</font>;
<a name="637"></a>    <font class="source_keyword">if</font> ( OldEnemy != <font class="source_keyword">None</font> )
<a name="638"></a>    {
<a name="639"></a>        Enemy = OldEnemy;
<a name="640"></a>        OldEnemy = <font class="source_keyword">None</font>;
<a name="641"></a>        GotoState(<font class="source_name">'Attacking'</font>);
<a name="642"></a>    }
<a name="643"></a>    <font class="source_keyword">else</font>
<a name="644"></a>    {
<a name="645"></a>        GotoState(<font class="source_name">'Roaming'</font>);
<a name="646"></a>        <font class="source_keyword">if</font> ( Skill &gt; <font class="source_int">2.7</font> )
<a name="647"></a>            bReadyToAttack = <font class="source_keyword">true</font>; 
<a name="648"></a>    }
<a name="649"></a>}
<a name="650"></a>
<a name="651"></a><font class="source_keyword">function</font> Bump(<font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Other)
<a name="652"></a>{
<a name="653"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> VelDir, OtherDir;
<a name="654"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> speed;
<a name="655"></a>
<a name="656"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font> )
<a name="657"></a>    {
<a name="658"></a>        log(<font class="source_string">"Bump while dead"</font>);
<a name="659"></a>        <font class="source_keyword">return</font>;
<a name="660"></a>    }
<a name="661"></a>    <font class="source_keyword">if</font> ( Enemy != <font class="source_keyword">None</font> )
<a name="662"></a>    {
<a name="663"></a>        <font class="source_keyword">if</font> (Other == Enemy)
<a name="664"></a>        {
<a name="665"></a>            GotoState(<font class="source_name">'RangedAttack'</font>);
<a name="666"></a>            <font class="source_keyword">return</font>;
<a name="667"></a>        }
<a name="668"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Other) != <font class="source_keyword">None</font>) && SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Other)) )
<a name="669"></a>        {
<a name="670"></a>            GotoState(<font class="source_name">'RangedAttack'</font>);
<a name="671"></a>            <font class="source_keyword">return</font>;
<a name="672"></a>        } 
<a name="673"></a>    }
<a name="674"></a>    <font class="source_keyword">else</font>
<a name="675"></a>    {
<a name="676"></a>        <font class="source_keyword">if</font> (<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Other) != <font class="source_keyword">None</font>)
<a name="677"></a>        {
<a name="678"></a>            <font class="source_keyword">if</font> ( SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Other)) )
<a name="679"></a>            {
<a name="680"></a>                bReadyToAttack = <font class="source_keyword">True</font>; <font class="source_comment">//can melee right away
</font><a name="681"></a>                GotoState(<font class="source_name">'Attacking'</font>);
<a name="682"></a>                <font class="source_keyword">return</font>;
<a name="683"></a>            }
<a name="684"></a>        }
<a name="685"></a>        <font class="source_keyword">if</font> ( TimerRate &lt;= <font class="source_int">0</font> )
<a name="686"></a>            setTimer(<font class="source_int">1.0</font>, <font class="source_keyword">false</font>);
<a name="687"></a>    }
<a name="688"></a>    
<a name="689"></a>    speed = VSize(Velocity);
<a name="690"></a>    <font class="source_keyword">if</font> ( speed &gt; <font class="source_int">1</font> )
<a name="691"></a>    {
<a name="692"></a>        VelDir = Velocity/speed;
<a name="693"></a>        VelDir.Z = <font class="source_int">0</font>;
<a name="694"></a>        OtherDir = Other.Location - Location;
<a name="695"></a>        OtherDir.Z = <font class="source_int">0</font>;
<a name="696"></a>        OtherDir = Normal(OtherDir);
<a name="697"></a>        <font class="source_keyword">if</font> ( (VelDir Dot OtherDir) &gt; <font class="source_int">0.8</font> )
<a name="698"></a>        {
<a name="699"></a>            Velocity.X = VelDir.Y;
<a name="700"></a>            Velocity.Y = -<font class="source_int">1</font> * VelDir.X;
<a name="701"></a>            Velocity *= FMax(speed, <font class="source_int">280</font>);
<a name="702"></a>        }
<a name="703"></a>    } 
<a name="704"></a>    Disable(<font class="source_name">'Bump'</font>);
<a name="705"></a>}
<a name="706"></a>        
<a name="707"></a>singular <font class="source_keyword">function</font> Falling()
<a name="708"></a>{
<a name="709"></a>    <font class="source_keyword">if</font> (bCanFly)
<a name="710"></a>    {
<a name="711"></a>        SetPhysics(PHYS_Flying);
<a name="712"></a>        <font class="source_keyword">return</font>;
<a name="713"></a>    }           
<a name="714"></a>    <font class="source_comment">//log(class$" Falling");
</font><a name="715"></a>    <font class="source_comment">// SetPhysics(PHYS_Falling); //note - done by default in physics
</font><a name="716"></a>    <font class="source_keyword">if</font> (<font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &gt; <font class="source_int">0</font>)
<a name="717"></a>        SetFall();
<a name="718"></a>}
<a name="719"></a>    
<a name="720"></a><font class="source_keyword">function</font> SetFall()
<a name="721"></a>{
<a name="722"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font> )
<a name="723"></a>        log(<font class="source_string">"setfall while dead"</font>);
<a name="724"></a>    <font class="source_keyword">if</font> (Enemy != <font class="source_keyword">None</font>)
<a name="725"></a>    {
<a name="726"></a>        NextState = <font class="source_name">'Attacking'</font>; <font class="source_comment">//default
</font><a name="727"></a>        NextLabel = <font class="source_name">'Begin'</font>;
<a name="728"></a>        TweenToFalling();
<a name="729"></a>        NextAnim = AnimSequence;
<a name="730"></a>        GotoState(<font class="source_name">'FallingState'</font>);
<a name="731"></a>    }
<a name="732"></a>}
<a name="733"></a>
<a name="734"></a><font class="source_keyword">function</font> LongFall()
<a name="735"></a>{
<a name="736"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font> )
<a name="737"></a>        log(<font class="source_string">"longfall while dead"</font>);
<a name="738"></a>    SetFall();
<a name="739"></a>    GotoState(<font class="source_name">'FallingState'</font>, <font class="source_name">'LongFall'</font>);
<a name="740"></a>}
<a name="741"></a>
<a name="742"></a><font class="source_keyword">function</font> BecomeViewTarget()
<a name="743"></a>{
<a name="744"></a>    bViewTarget = <font class="source_keyword">true</font>;
<a name="745"></a>}
<a name="746"></a>
<a name="747"></a><font class="source_keyword">event</font> UpdateEyeHeight(<font class="source_keyword">float</font> DeltaTime)
<a name="748"></a>{
<a name="749"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> smooth, bound, TargetYaw, TargetPitch;
<a name="750"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> P;
<a name="751"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Rotator" class="source">rotator</a></font> OldViewRotation;
<a name="752"></a>
<a name="753"></a>    <font class="source_keyword">if</font> ( !bViewTarget )
<a name="754"></a>    {
<a name="755"></a>        ViewRotation = Rotation;
<a name="756"></a>        <font class="source_keyword">return</font>;
<a name="757"></a>    }
<a name="758"></a>
<a name="759"></a>    <font class="source_comment">// update viewrotation
</font><a name="760"></a>    OldViewRotation = ViewRotation;         
<a name="761"></a>    ViewRotation = Rotation;
<a name="762"></a>
<a name="763"></a>    <font class="source_comment">//check if still viewtarget
</font><a name="764"></a>    bViewTarget = <font class="source_keyword">false</font>;
<a name="765"></a>    <font class="source_keyword">for</font> ( P=<font class="source_type">Level</font>.PawnList; P!=<font class="source_keyword">None</font>; P=P.NextPawn )
<a name="766"></a>        <font class="source_keyword">if</font> ( P.IsA(<font class="source_name">'PlayerPawn'</font>) && (<font class="source_type"><a href="..\engine\playerpawn.html" class="source">PlayerPawn</a></font>(P).ViewTarget == self) )
<a name="767"></a>        {
<a name="768"></a>            bViewTarget = <font class="source_keyword">true</font>;
<a name="769"></a>            <font class="source_keyword">if</font> ( bVerbose )
<a name="770"></a>                P.ClientMessage(<font class="source_type"><a href="..\engine\playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></font>.PlayerName$<font class="source_string">" State "</font>$GetStateName()$<font class="source_string">" MoveTarget "</font>$MoveTarget, <font class="source_name">'CriticalEvent'</font> );
<a name="771"></a>            <font class="source_keyword">break</font>;
<a name="772"></a>        }
<a name="773"></a>
<a name="774"></a>    <font class="source_keyword">if</font> ( !bViewTarget )
<a name="775"></a>        <font class="source_keyword">return</font>;
<a name="776"></a>
<a name="777"></a>    <font class="source_keyword">if</font> ( bVerbose && (MoveTarget != <font class="source_keyword">None</font>) )
<a name="778"></a>    {
<a name="779"></a>        <font class="source_keyword">if</font> ( Pointer == <font class="source_keyword">None</font> )
<a name="780"></a>            Pointer = Spawn(<font class="source_keyword">class</font><font class="source_name">'WayBeacon'</font>, self,, MoveTarget.Location);
<a name="781"></a>        <font class="source_keyword">else</font>
<a name="782"></a>            Pointer.SetLocation(MoveTarget.Location);
<a name="783"></a>    }
<a name="784"></a>
<a name="785"></a>    <font class="source_keyword">if</font> ( Enemy == <font class="source_keyword">None</font> )
<a name="786"></a>    {
<a name="787"></a>        ViewRotation.Roll = <font class="source_int">0</font>;
<a name="788"></a>        <font class="source_keyword">if</font> ( DeltaTime &lt; <font class="source_int">0.2</font> )
<a name="789"></a>        {
<a name="790"></a>            OldViewRotation.Yaw = OldViewRotation.Yaw & <font class="source_int">65535</font>;
<a name="791"></a>            OldViewRotation.Pitch = OldViewRotation.Pitch & <font class="source_int">65535</font>;
<a name="792"></a>            TargetYaw = <font class="source_keyword">float</font>(ViewRotation.Yaw & <font class="source_int">65535</font>);
<a name="793"></a>            <font class="source_keyword">if</font> ( Abs(TargetYaw - OldViewRotation.Yaw) &gt; <font class="source_int">32768</font> )
<a name="794"></a>            {
<a name="795"></a>                <font class="source_keyword">if</font> ( TargetYaw &lt; OldViewRotation.Yaw )
<a name="796"></a>                    TargetYaw += <font class="source_int">65536</font>;
<a name="797"></a>                <font class="source_keyword">else</font>
<a name="798"></a>                    TargetYaw -= <font class="source_int">65536</font>;
<a name="799"></a>            }
<a name="800"></a>            TargetYaw = <font class="source_keyword">float</font>(OldViewRotation.Yaw) * (<font class="source_int">1</font> - <font class="source_int">5</font> * DeltaTime) + TargetYaw * <font class="source_int">5</font> * DeltaTime;
<a name="801"></a>            ViewRotation.Yaw = <font class="source_keyword">int</font>(TargetYaw);
<a name="802"></a>
<a name="803"></a>            TargetPitch = <font class="source_keyword">float</font>(ViewRotation.Pitch & <font class="source_int">65535</font>);
<a name="804"></a>            <font class="source_keyword">if</font> ( Abs(TargetPitch - OldViewRotation.Pitch) &gt; <font class="source_int">32768</font> )
<a name="805"></a>            {
<a name="806"></a>                <font class="source_keyword">if</font> ( TargetPitch &lt; OldViewRotation.Pitch )
<a name="807"></a>                    TargetPitch += <font class="source_int">65536</font>;
<a name="808"></a>                <font class="source_keyword">else</font>
<a name="809"></a>                    TargetPitch -= <font class="source_int">65536</font>;
<a name="810"></a>            }
<a name="811"></a>            TargetPitch = <font class="source_keyword">float</font>(OldViewRotation.Pitch) * (<font class="source_int">1</font> - <font class="source_int">5</font> * DeltaTime) + TargetPitch * <font class="source_int">5</font> * DeltaTime;
<a name="812"></a>            ViewRotation.Pitch = <font class="source_keyword">int</font>(TargetPitch);
<a name="813"></a>        }
<a name="814"></a>    }
<a name="815"></a>
<a name="816"></a>    smooth = FMin(<font class="source_int">1.0</font>, <font class="source_int">10.0</font> * DeltaTime/Level.TimeDilation);
<a name="817"></a>    <font class="source_comment">// smooth up/down stairs
</font><a name="818"></a>    <font class="source_keyword">If</font> ( (Physics == PHYS_Walking) && !bJustLanded)
<a name="819"></a>    {
<a name="820"></a>        EyeHeight = (EyeHeight - Location.Z + OldLocation.Z) * (<font class="source_int">1</font> - smooth) + BaseEyeHeight * smooth;
<a name="821"></a>        bound = -<font class="source_int">0.5</font> * CollisionHeight;
<a name="822"></a>        <font class="source_keyword">if</font> (EyeHeight &lt; bound)
<a name="823"></a>            EyeHeight = bound;
<a name="824"></a>        <font class="source_keyword">else</font>
<a name="825"></a>        {
<a name="826"></a>            bound = CollisionHeight + FMin(FMax(<font class="source_int">0.0</font>,(OldLocation.Z - Location.Z)), MaxStepHeight); 
<a name="827"></a>             <font class="source_keyword">if</font> ( EyeHeight &gt; bound )
<a name="828"></a>                EyeHeight = bound;
<a name="829"></a>        }
<a name="830"></a>    }
<a name="831"></a>    <font class="source_keyword">else</font>
<a name="832"></a>    {
<a name="833"></a>        smooth = FMax(smooth, <font class="source_int">0.35</font>);
<a name="834"></a>        bJustLanded = <font class="source_keyword">false</font>;
<a name="835"></a>        EyeHeight = EyeHeight * ( <font class="source_int">1</font> - smooth) + BaseEyeHeight * smooth;
<a name="836"></a>    }
<a name="837"></a>}
<a name="838"></a>
<a name="839"></a><font class="source_comment">/* Adjust hit location - adjusts the hit location in for pawns, and returns
<a name="840"></a>true if it was really a hit, and false if not (for ducking, etc.)
<a name="841"></a>*/</font>
<a name="842"></a><font class="source_keyword">function</font> <font class="source_keyword">bool</font> AdjustHitLocation(<font class="source_keyword2">out</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> TraceDir)
<a name="843"></a>{
<a name="844"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> adjZ, maxZ;
<a name="845"></a>
<a name="846"></a>    TraceDir = Normal(TraceDir);
<a name="847"></a>    HitLocation = HitLocation + <font class="source_int">0.5</font> * CollisionRadius * TraceDir;
<a name="848"></a>    <font class="source_keyword">if</font> ( BaseEyeHeight == Default.BaseEyeHeight )
<a name="849"></a>        <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="850"></a>
<a name="851"></a>    maxZ = Location.Z + EyeHeight + <font class="source_int">0.25</font> * CollisionHeight;
<a name="852"></a>    <font class="source_keyword">if</font> ( HitLocation.Z &gt; maxZ )
<a name="853"></a>    {
<a name="854"></a>        <font class="source_keyword">if</font> ( TraceDir.Z &gt;= <font class="source_int">0</font> )
<a name="855"></a>            <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="856"></a>        adjZ = (maxZ - HitLocation.Z)/TraceDir.Z;
<a name="857"></a>        HitLocation.Z = maxZ;
<a name="858"></a>        HitLocation.X = HitLocation.X + TraceDir.X * adjZ;
<a name="859"></a>        HitLocation.Y = HitLocation.Y + TraceDir.Y * adjZ;
<a name="860"></a>        <font class="source_keyword">if</font> ( VSize(HitLocation - Location) &gt; CollisionRadius )  
<a name="861"></a>            <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="862"></a>    }
<a name="863"></a>    <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="864"></a>}
<a name="865"></a>
<a name="866"></a><font class="source_keyword">function</font> HearNoise(<font class="source_keyword">float</font> Loudness, <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> NoiseMaker)
<a name="867"></a>{
<a name="868"></a>    <font class="source_comment">//log(class$" heard noise by "$NoiseMaker.class);
</font><a name="869"></a>    <font class="source_keyword">if</font> ( SetEnemy(NoiseMaker.instigator) )
<a name="870"></a>        LastSeenPos = <font class="source_int">0.5</font> * (NoiseMaker.Location + VSize(NoiseMaker.Location - Location) * <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font>(Rotation));
<a name="871"></a>}
<a name="872"></a>
<a name="873"></a><font class="source_keyword">function</font> SeePlayer(<font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> SeenPlayer)
<a name="874"></a>{
<a name="875"></a>    <font class="source_keyword">if</font> (SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(SeenPlayer)))
<a name="876"></a>    {
<a name="877"></a>        <font class="source_keyword">if</font> ( Enemy == <font class="source_keyword">None</font> )
<a name="878"></a>            log(<font class="source_string">"SetEnemy but no enemy"</font>); <font class="source_comment">//FIXME
</font><a name="879"></a>        LastSeenPos = Enemy.Location;
<a name="880"></a>    }
<a name="881"></a>}
<a name="882"></a>
<a name="883"></a><font class="source_comment">/* FindBestPathToward() assumes the desired destination is not directly reachable, 
<a name="884"></a>given the creature's intelligence, it tries to set Destination to the location of the 
<a name="885"></a>best waypoint, and returns true if successful
<a name="886"></a>*/</font>
<a name="887"></a><font class="source_keyword">function</font> <font class="source_keyword">bool</font> FindBestPathToward(<font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> desired)
<a name="888"></a>{
<a name="889"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> path;
<a name="890"></a>    <font class="source_keyword">local</font> <font class="source_keyword">bool</font> success;
<a name="891"></a>    
<a name="892"></a>    <font class="source_keyword">if</font> ( specialGoal != <font class="source_keyword">None</font>)
<a name="893"></a>        desired = specialGoal;
<a name="894"></a>    path = <font class="source_keyword">None</font>;
<a name="895"></a>    path = FindPathToward(desired); 
<a name="896"></a>        
<a name="897"></a>    success = (path != <font class="source_keyword">None</font>);   
<a name="898"></a>    <font class="source_keyword">if</font> (success)
<a name="899"></a>    {
<a name="900"></a>        MoveTarget = path; 
<a name="901"></a>        Destination = path.Location;
<a name="902"></a>    }   
<a name="903"></a>    <font class="source_keyword">return</font> success;
<a name="904"></a>}   
<a name="905"></a>
<a name="906"></a><font class="source_keyword">function</font> <font class="source_keyword">bool</font> NeedToTurn(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> targ)
<a name="907"></a>{
<a name="908"></a>    <font class="source_keyword">local</font> <font class="source_keyword">int</font> YawErr;
<a name="909"></a>
<a name="910"></a>    DesiredRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(targ - location);
<a name="911"></a>    DesiredRotation.Yaw = DesiredRotation.Yaw & <font class="source_int">65535</font>;
<a name="912"></a>    YawErr = (DesiredRotation.Yaw - (Rotation.Yaw & <font class="source_int">65535</font>)) & <font class="source_int">65535</font>;
<a name="913"></a>    <font class="source_keyword">if</font> ( (YawErr &lt; <font class="source_int">4000</font>) || (YawErr &gt; <font class="source_int">61535</font>) )
<a name="914"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="915"></a>
<a name="916"></a>    <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="917"></a>}
<a name="918"></a>
<a name="919"></a><font class="source_comment">/* NearWall() returns true if there is a nearby barrier at eyeheight, and
<a name="920"></a>changes Focus to a suggested value
<a name="921"></a>*/</font>
<a name="922"></a><font class="source_keyword">function</font> <font class="source_keyword">bool</font> NearWall(<font class="source_keyword">float</font> walldist)
<a name="923"></a>{
<a name="924"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="925"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, HitNormal, ViewSpot, ViewDist, LookDir;
<a name="926"></a>
<a name="927"></a>    LookDir = <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font>(Rotation);
<a name="928"></a>    ViewSpot = Location + BaseEyeHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>);
<a name="929"></a>    ViewDist = LookDir * walldist; 
<a name="930"></a>    HitActor = Trace(HitLocation, HitNormal, ViewSpot + ViewDist, ViewSpot, <font class="source_keyword">false</font>);
<a name="931"></a>    <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="932"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="933"></a>
<a name="934"></a>    ViewDist = Normal(HitNormal Cross vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>)) * walldist;
<a name="935"></a>    <font class="source_keyword">if</font> (FRand() &lt; <font class="source_int">0.5</font>)
<a name="936"></a>        ViewDist *= -<font class="source_int">1</font>;
<a name="937"></a>
<a name="938"></a>    HitActor = Trace(HitLocation, HitNormal, ViewSpot + ViewDist, ViewSpot, <font class="source_keyword">false</font>);
<a name="939"></a>    <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="940"></a>    {
<a name="941"></a>        Focus = Location + ViewDist;
<a name="942"></a>        <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="943"></a>    }
<a name="944"></a>
<a name="945"></a>    ViewDist *= -<font class="source_int">1</font>;
<a name="946"></a>
<a name="947"></a>    HitActor = Trace(HitLocation, HitNormal, ViewSpot + ViewDist, ViewSpot, <font class="source_keyword">false</font>);
<a name="948"></a>    <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="949"></a>    {
<a name="950"></a>        Focus = Location + ViewDist;
<a name="951"></a>        <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="952"></a>    }
<a name="953"></a>
<a name="954"></a>    Focus = Location - LookDir * <font class="source_int">300</font>;
<a name="955"></a>    <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="956"></a>}
<a name="957"></a>
<a name="958"></a><font class="source_keyword">function</font> FireWeapon()
<a name="959"></a>{
<a name="960"></a>    <font class="source_keyword">local</font> <font class="source_keyword">bool</font> bUseAltMode;
<a name="961"></a>
<a name="962"></a>    <font class="source_keyword">if</font> ( (Enemy == <font class="source_keyword">None</font>) && bShootSpecial )
<a name="963"></a>    {
<a name="964"></a>        <font class="source_comment">//fake use dispersion pistol
</font><a name="965"></a>        Spawn(<font class="source_keyword">class</font><font class="source_name">'DispersionAmmo'</font>,,, Location,<font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(Target.Location - Location));
<a name="966"></a>        <font class="source_keyword">return</font>;
<a name="967"></a>    }
<a name="968"></a>
<a name="969"></a>    bUseAltMode = SwitchToBestWeapon();
<a name="970"></a>
<a name="971"></a>    <font class="source_keyword">if</font>( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>!=<font class="source_keyword">None</font> )
<a name="972"></a>    {
<a name="973"></a>        <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.AmmoType != <font class="source_keyword">None</font>) && (<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.AmmoType.AmmoAmount &lt;= <font class="source_int">0</font>) )
<a name="974"></a>        {
<a name="975"></a>            bReadyToAttack = <font class="source_keyword">true</font>;
<a name="976"></a>            <font class="source_keyword">return</font>;
<a name="977"></a>        }
<a name="978"></a>
<a name="979"></a>        <font class="source_keyword">if</font> ( !bFiringPaused && !bShootSpecial && (Enemy != <font class="source_keyword">None</font>) )
<a name="980"></a>            Target = Enemy;
<a name="981"></a>        ViewRotation = Rotation;
<a name="982"></a>        <font class="source_keyword">if</font> ( bUseAltMode )
<a name="983"></a>        {
<a name="984"></a>            bFire = <font class="source_int">0</font>;
<a name="985"></a>            bAltFire = <font class="source_int">1</font>;
<a name="986"></a>            <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.AltFire(<font class="source_int">1.0</font>);
<a name="987"></a>        }
<a name="988"></a>        <font class="source_keyword">else</font>
<a name="989"></a>        {
<a name="990"></a>            bFire = <font class="source_int">1</font>;
<a name="991"></a>            bAltFire = <font class="source_int">0</font>;
<a name="992"></a>            <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.Fire(<font class="source_int">1.0</font>);
<a name="993"></a>        }
<a name="994"></a>        PlayFiring();
<a name="995"></a>    }
<a name="996"></a>    bShootSpecial = <font class="source_keyword">false</font>;
<a name="997"></a>}
<a name="998"></a>
<a name="999"></a><font class="source_keyword">function</font> PlayFiring();
<a name="1000"></a>
<a name="1001"></a><font class="source_comment">// check for line of sight to target deltatime from now.
</font><a name="1002"></a><font class="source_keyword">function</font> <font class="source_keyword">bool</font> CheckFutureSight(<font class="source_keyword">float</font> deltatime)
<a name="1003"></a>{
<a name="1004"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> FutureLoc, HitLocation, HitNormal, FireSpot;
<a name="1005"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="1006"></a>
<a name="1007"></a>    <font class="source_keyword">if</font> ( Target == <font class="source_keyword">None</font> )
<a name="1008"></a>        Target = Enemy;
<a name="1009"></a>    <font class="source_keyword">if</font> ( Target == <font class="source_keyword">None</font> )
<a name="1010"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1011"></a>
<a name="1012"></a>    FutureLoc = Location + Velocity * deltatime;
<a name="1013"></a>
<a name="1014"></a>    <font class="source_comment">//make sure won't run into something
</font><a name="1015"></a>    HitActor = Trace(HitLocation, HitNormal, FutureLoc, Location, <font class="source_keyword">false</font>);
<a name="1016"></a>    <font class="source_keyword">if</font> ( HitActor != <font class="source_keyword">None</font> )
<a name="1017"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1018"></a>
<a name="1019"></a>    <font class="source_comment">//check if can still see target
</font><a name="1020"></a>    HitActor = Trace(HitLocation, HitNormal, 
<a name="1021"></a>                    Target.Location + Target.Velocity * deltatime, FutureLoc, <font class="source_keyword">false</font>);
<a name="1022"></a>
<a name="1023"></a>    <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="1024"></a>        <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="1025"></a>
<a name="1026"></a>    <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1027"></a>}
<a name="1028"></a>
<a name="1029"></a><font class="source_comment">/*
<a name="1030"></a>Adjust the aim at target.  
<a name="1031"></a>    - add aim error
<a name="1032"></a>    - adjust up or down if barrier
<a name="1033"></a>*/</font>
<a name="1034"></a>
<a name="1035"></a><font class="source_keyword">function</font> <font class="source_type"><a href="..\core\object.html#Rotator" class="source">rotator</a></font> AdjustToss(<font class="source_keyword">float</font> projSpeed, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> projStart, <font class="source_keyword">int</font> aimerror, <font class="source_keyword">bool</font> leadTarget, <font class="source_keyword">bool</font> warnTarget)
<a name="1036"></a>{
<a name="1037"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Rotator" class="source">rotator</a></font> FireRotation;
<a name="1038"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> FireSpot;
<a name="1039"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="1040"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, HitNormal;
<a name="1041"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> TargetDist, TossSpeed, TossTime;
<a name="1042"></a>
<a name="1043"></a>    <font class="source_keyword">if</font> ( projSpeed == <font class="source_int">0</font> )
<a name="1044"></a>        <font class="source_keyword">return</font> AdjustAim(projSpeed, projStart, aimerror, leadTarget, warnTarget);
<a name="1045"></a>    <font class="source_keyword">if</font> ( Target == <font class="source_keyword">None</font> )
<a name="1046"></a>        Target = Enemy;
<a name="1047"></a>    <font class="source_keyword">if</font> ( Target == <font class="source_keyword">None</font> )
<a name="1048"></a>        <font class="source_keyword">return</font> Rotation;
<a name="1049"></a>    <font class="source_keyword">if</font> ( !Target.IsA(<font class="source_name">'Pawn'</font>) )
<a name="1050"></a>        <font class="source_keyword">return</font> <font class="source_type"><a href="..\core\object.html#Rotator" class="source">rotator</a></font>(Target.Location - Location);
<a name="1051"></a>                    
<a name="1052"></a>    FireSpot = Target.Location;
<a name="1053"></a>    TargetDist = VSize(Target.Location - ProjStart);
<a name="1054"></a>    aimerror = aimerror * (<font class="source_int">11</font> - <font class="source_int">10</font> *  
<a name="1055"></a>        ((Target.Location - Location)/TargetDist 
<a name="1056"></a>            Dot Normal((Target.Location + <font class="source_int">0.5</font> * Target.Velocity) - (ProjStart + <font class="source_int">0.5</font> * Velocity)))); 
<a name="1057"></a>
<a name="1058"></a>    aimerror = aimerror * (<font class="source_int">2.4</font> - <font class="source_int">0.5</font> * (skill + FRand()));  
<a name="1059"></a>    <font class="source_keyword">if</font> ( !leadTarget || (accuracy &lt; <font class="source_int">0</font>) )
<a name="1060"></a>        aimerror -= aimerror * accuracy;
<a name="1061"></a>
<a name="1062"></a>    <font class="source_keyword">if</font> ( leadTarget )
<a name="1063"></a>    {
<a name="1064"></a>        FireSpot += FMin(<font class="source_int">1</font>, <font class="source_int">0.7</font> + <font class="source_int">0.6</font> * FRand()) * (Target.Velocity * TargetDist/projSpeed);
<a name="1065"></a>        HitActor = Trace(HitLocation, HitNormal, FireSpot, ProjStart, <font class="source_keyword">false</font>);
<a name="1066"></a>        <font class="source_keyword">if</font> (HitActor != <font class="source_keyword">None</font>)
<a name="1067"></a>            FireSpot = <font class="source_int">0.5</font> * (FireSpot + Target.Location);
<a name="1068"></a>    }
<a name="1069"></a>
<a name="1070"></a>    <font class="source_comment">//try middle
</font><a name="1071"></a>    FireSpot.Z = Target.Location.Z;
<a name="1072"></a>    HitActor = Trace(HitLocation, HitNormal, FireSpot, ProjStart, <font class="source_keyword">false</font>);
<a name="1073"></a>
<a name="1074"></a>    <font class="source_keyword">if</font> ( (HitActor != <font class="source_keyword">None</font>) && (Target == Enemy) )
<a name="1075"></a>    {
<a name="1076"></a>        FireSpot = LastSeenPos;
<a name="1077"></a>        <font class="source_keyword">if</font> ( Location.Z &gt;= LastSeenPos.Z )
<a name="1078"></a>            FireSpot.Z -= <font class="source_int">0.5</font> * Enemy.CollisionHeight;
<a name="1079"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != <font class="source_keyword">None</font> )
<a name="1080"></a>        {
<a name="1081"></a>            HitActor = Trace(HitLocation, HitNormal, FireSpot, ProjStart, <font class="source_keyword">false</font>);
<a name="1082"></a>            <font class="source_keyword">if</font> ( HitActor != <font class="source_keyword">None</font> )
<a name="1083"></a>            {
<a name="1084"></a>                bFire = <font class="source_int">0</font>;
<a name="1085"></a>                bAltFire = <font class="source_int">0</font>;
<a name="1086"></a>                SetTimer(TimeBetweenAttacks, <font class="source_keyword">false</font>);
<a name="1087"></a>            }
<a name="1088"></a>        }
<a name="1089"></a>    }
<a name="1090"></a>
<a name="1091"></a>    <font class="source_comment">// adjust for toss distance (assume 200 z velocity add & 60 init height)
</font><a name="1092"></a>    <font class="source_keyword">if</font> ( FRand() &lt; <font class="source_int">0.75</font> )
<a name="1093"></a>    {
<a name="1094"></a>        TossSpeed = projSpeed + <font class="source_int">0.4</font> * VSize(Velocity); 
<a name="1095"></a>        <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.ZoneGravity.Z != <font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.Default.ZoneGravity.Z) 
<a name="1096"></a>            || (TargetDist &gt; TossSpeed) )
<a name="1097"></a>        {
<a name="1098"></a>            TossTime = TargetDist/TossSpeed;
<a name="1099"></a>            FireSpot.Z -= ((<font class="source_int">0.25</font> * <font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.ZoneGravity.Z * TossTime + <font class="source_int">200</font>) * TossTime + <font class="source_int">60</font>);    
<a name="1100"></a>        }
<a name="1101"></a>    }
<a name="1102"></a>    
<a name="1103"></a>    FireRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(FireSpot - ProjStart);
<a name="1104"></a>         
<a name="1105"></a>    FireRotation.Yaw = FireRotation.Yaw + <font class="source_int">0.5</font> * (Rand(<font class="source_int">2</font> * aimerror) - aimerror);
<a name="1106"></a>    <font class="source_keyword">if</font> (warnTarget && <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Target) != <font class="source_keyword">None</font>) 
<a name="1107"></a>        <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Target).WarnTarget(self, projSpeed, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font>(FireRotation)); 
<a name="1108"></a>
<a name="1109"></a>    FireRotation.Yaw = FireRotation.Yaw & <font class="source_int">65535</font>;
<a name="1110"></a>    <font class="source_keyword">if</font> ( (Abs(FireRotation.Yaw - (Rotation.Yaw & <font class="source_int">65535</font>)) &gt; <font class="source_int">8192</font>)
<a name="1111"></a>        && (Abs(FireRotation.Yaw - (Rotation.Yaw & <font class="source_int">65535</font>)) &lt; <font class="source_int">57343</font>) )
<a name="1112"></a>    {
<a name="1113"></a>        <font class="source_keyword">if</font> ( (FireRotation.Yaw &gt; Rotation.Yaw + <font class="source_int">32768</font>) || 
<a name="1114"></a>            ((FireRotation.Yaw &lt; Rotation.Yaw) && (FireRotation.Yaw &gt; Rotation.Yaw - <font class="source_int">32768</font>)) )
<a name="1115"></a>            FireRotation.Yaw = Rotation.Yaw - <font class="source_int">8192</font>;
<a name="1116"></a>        <font class="source_keyword">else</font>
<a name="1117"></a>            FireRotation.Yaw = Rotation.Yaw + <font class="source_int">8192</font>;
<a name="1118"></a>    }
<a name="1119"></a>    viewRotation = FireRotation;            
<a name="1120"></a>    <font class="source_keyword">return</font> FireRotation;
<a name="1121"></a>}
<a name="1122"></a>
<a name="1123"></a><font class="source_keyword">function</font> <font class="source_type"><a href="..\core\object.html#Rotator" class="source">rotator</a></font> AdjustAim(<font class="source_keyword">float</font> projSpeed, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> projStart, <font class="source_keyword">int</font> aimerror, <font class="source_keyword">bool</font> leadTarget, <font class="source_keyword">bool</font> warnTarget)
<a name="1124"></a>{
<a name="1125"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Rotator" class="source">rotator</a></font> FireRotation;
<a name="1126"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> FireSpot;
<a name="1127"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="1128"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, HitNormal;
<a name="1129"></a>
<a name="1130"></a>    <font class="source_keyword">if</font> ( Target == <font class="source_keyword">None</font> )
<a name="1131"></a>        Target = Enemy;
<a name="1132"></a>    <font class="source_keyword">if</font> ( Target == <font class="source_keyword">None</font> )
<a name="1133"></a>        <font class="source_keyword">return</font> Rotation;
<a name="1134"></a>    <font class="source_keyword">if</font> ( !Target.IsA(<font class="source_name">'Pawn'</font>) )
<a name="1135"></a>        <font class="source_keyword">return</font> <font class="source_type"><a href="..\core\object.html#Rotator" class="source">rotator</a></font>(Target.Location - Location);
<a name="1136"></a>                    
<a name="1137"></a>    FireSpot = Target.Location;
<a name="1138"></a>    aimerror = aimerror * (<font class="source_int">11</font> - <font class="source_int">10</font> *  
<a name="1139"></a>        (Normal(Target.Location - Location) 
<a name="1140"></a>            Dot Normal((Target.Location + <font class="source_int">0.5</font> * Target.Velocity) - (Location + <font class="source_int">0.5</font> * Velocity)))); 
<a name="1141"></a>
<a name="1142"></a>    aimerror = aimerror * (<font class="source_int">2.4</font> - <font class="source_int">0.5</font> * (skill + FRand()));  
<a name="1143"></a>    <font class="source_keyword">if</font> ( !leadTarget || (accuracy &lt; <font class="source_int">0</font>) )
<a name="1144"></a>        aimerror -= aimerror * accuracy;
<a name="1145"></a>
<a name="1146"></a>    <font class="source_keyword">if</font> (leadTarget && (projSpeed &gt; <font class="source_int">0</font>))
<a name="1147"></a>    {
<a name="1148"></a>        FireSpot += FMin(<font class="source_int">1</font>, <font class="source_int">0.7</font> + <font class="source_int">0.6</font> * FRand()) * (Target.Velocity * VSize(Target.Location - ProjStart)/projSpeed);
<a name="1149"></a>        <font class="source_keyword">if</font> ( (FRand() &lt; <font class="source_int">0.55</font>) && (VSize(FireSpot - ProjStart) &gt; <font class="source_int">1600</font>)
<a name="1150"></a>            && ((<font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font>(Target.Rotation) Dot Normal(Target.Velocity)) &lt; <font class="source_int">0.7</font>) )
<a name="1151"></a>            HitActor = self;
<a name="1152"></a>        <font class="source_keyword">else</font>
<a name="1153"></a>            HitActor = Trace(HitLocation, HitNormal, FireSpot, ProjStart, <font class="source_keyword">false</font>);
<a name="1154"></a>        <font class="source_keyword">if</font> (HitActor != <font class="source_keyword">None</font>)
<a name="1155"></a>            FireSpot = <font class="source_int">0.5</font> * (FireSpot + Target.Location);
<a name="1156"></a>    }
<a name="1157"></a>
<a name="1158"></a>    HitActor = self; <font class="source_comment">//so will fail first check unless shooting at feet  
</font><a name="1159"></a>    <font class="source_keyword">if</font> ( (Location.Z + <font class="source_int">19</font> &gt;= Target.Location.Z) && Target.IsA(<font class="source_name">'Pawn'</font>) 
<a name="1160"></a>        && (<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != <font class="source_keyword">None</font>) && <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.bSplashDamage && (<font class="source_int">0.5</font> * (skill - <font class="source_int">1</font>) &gt; FRand()) )
<a name="1161"></a>    {
<a name="1162"></a>        <font class="source_comment">// Try to aim at feet
</font><a name="1163"></a>        HitActor = Trace(HitLocation, HitNormal, FireSpot - vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">80</font>), FireSpot, <font class="source_keyword">false</font>);
<a name="1164"></a>        <font class="source_keyword">if</font> ( HitActor != <font class="source_keyword">None</font> )
<a name="1165"></a>        {
<a name="1166"></a>            FireSpot = HitLocation + vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">3</font>);
<a name="1167"></a>            HitActor = Trace(HitLocation, HitNormal, FireSpot, ProjStart, <font class="source_keyword">false</font>);
<a name="1168"></a>        }
<a name="1169"></a>        <font class="source_keyword">else</font>
<a name="1170"></a>            HitActor = self;
<a name="1171"></a>    }
<a name="1172"></a>    <font class="source_keyword">if</font> ( HitActor != <font class="source_keyword">None</font> )
<a name="1173"></a>    {
<a name="1174"></a>        <font class="source_comment">//try middle
</font><a name="1175"></a>        FireSpot.Z = Target.Location.Z;
<a name="1176"></a>        HitActor = Trace(HitLocation, HitNormal, FireSpot, ProjStart, <font class="source_keyword">false</font>);
<a name="1177"></a>    }
<a name="1178"></a>    <font class="source_keyword">if</font>( HitActor != <font class="source_keyword">None</font> ) 
<a name="1179"></a>    {
<a name="1180"></a>        <font class="source_comment">////try head
</font><a name="1181"></a>        FireSpot.Z = Target.Location.Z + <font class="source_int">0.9</font> * Target.CollisionHeight;
<a name="1182"></a>        HitActor = Trace(HitLocation, HitNormal, FireSpot, ProjStart, <font class="source_keyword">false</font>);
<a name="1183"></a>    }
<a name="1184"></a>    <font class="source_keyword">if</font> ( (HitActor != <font class="source_keyword">None</font>) && (Target == Enemy) )
<a name="1185"></a>    {
<a name="1186"></a>        FireSpot = LastSeenPos;
<a name="1187"></a>        <font class="source_keyword">if</font> ( Location.Z &gt;= LastSeenPos.Z )
<a name="1188"></a>            FireSpot.Z -= <font class="source_int">0.5</font> * Enemy.CollisionHeight;
<a name="1189"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != <font class="source_keyword">None</font> )
<a name="1190"></a>        {
<a name="1191"></a>            HitActor = Trace(HitLocation, HitNormal, FireSpot, ProjStart, <font class="source_keyword">false</font>);
<a name="1192"></a>            <font class="source_keyword">if</font> ( HitActor != <font class="source_keyword">None</font> )
<a name="1193"></a>            {
<a name="1194"></a>                bFire = <font class="source_int">0</font>;
<a name="1195"></a>                bAltFire = <font class="source_int">0</font>;
<a name="1196"></a>                SetTimer(TimeBetweenAttacks, <font class="source_keyword">false</font>);
<a name="1197"></a>            }
<a name="1198"></a>        }
<a name="1199"></a>    }
<a name="1200"></a>    
<a name="1201"></a>    FireRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(FireSpot - ProjStart);
<a name="1202"></a>         
<a name="1203"></a>    FireRotation.Yaw = FireRotation.Yaw + <font class="source_int">0.5</font> * (Rand(<font class="source_int">2</font> * aimerror) - aimerror);
<a name="1204"></a>    <font class="source_keyword">if</font> (warnTarget && <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Target) != <font class="source_keyword">None</font>) 
<a name="1205"></a>        <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Target).WarnTarget(self, projSpeed, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font>(FireRotation)); 
<a name="1206"></a>
<a name="1207"></a>    FireRotation.Yaw = FireRotation.Yaw & <font class="source_int">65535</font>;
<a name="1208"></a>    <font class="source_keyword">if</font> ( (Abs(FireRotation.Yaw - (Rotation.Yaw & <font class="source_int">65535</font>)) &gt; <font class="source_int">8192</font>)
<a name="1209"></a>        && (Abs(FireRotation.Yaw - (Rotation.Yaw & <font class="source_int">65535</font>)) &lt; <font class="source_int">57343</font>) )
<a name="1210"></a>    {
<a name="1211"></a>        <font class="source_keyword">if</font> ( (FireRotation.Yaw &gt; Rotation.Yaw + <font class="source_int">32768</font>) || 
<a name="1212"></a>            ((FireRotation.Yaw &lt; Rotation.Yaw) && (FireRotation.Yaw &gt; Rotation.Yaw - <font class="source_int">32768</font>)) )
<a name="1213"></a>            FireRotation.Yaw = Rotation.Yaw - <font class="source_int">8192</font>;
<a name="1214"></a>        <font class="source_keyword">else</font>
<a name="1215"></a>            FireRotation.Yaw = Rotation.Yaw + <font class="source_int">8192</font>;
<a name="1216"></a>    }
<a name="1217"></a>    viewRotation = FireRotation;            
<a name="1218"></a>    <font class="source_keyword">return</font> FireRotation;
<a name="1219"></a>}
<a name="1220"></a>
<a name="1221"></a><font class="source_keyword">function</font> WarnTarget(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> shooter, <font class="source_keyword">float</font> projSpeed, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> FireDir)
<a name="1222"></a>{
<a name="1223"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> enemyDist;
<a name="1224"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\pawn.html#EAttitude" class="source">eAttitude</a></font> att;
<a name="1225"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> X,Y,Z, enemyDir;
<a name="1226"></a>
<a name="1227"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="1228"></a>        <font class="source_keyword">return</font>; 
<a name="1229"></a>    att = AttitudeTo(shooter);
<a name="1230"></a>    <font class="source_keyword">if</font> ( (att == ATTITUDE_Ignore) || (att == ATTITUDE_Threaten) )
<a name="1231"></a>    {
<a name="1232"></a>        damageAttitudeTo(shooter);
<a name="1233"></a>        <font class="source_keyword">if</font> (att == ATTITUDE_Ignore)
<a name="1234"></a>            <font class="source_keyword">return</font>; 
<a name="1235"></a>    }
<a name="1236"></a>    
<a name="1237"></a>    <font class="source_comment">// AI controlled creatures may duck if not falling
</font><a name="1238"></a>    <font class="source_keyword">if</font> ( !bCanDuck || (Enemy == <font class="source_keyword">None</font>) || (Physics == PHYS_Falling) || (Physics == PHYS_Swimming) )
<a name="1239"></a>        <font class="source_keyword">return</font>;
<a name="1240"></a>
<a name="1241"></a>    <font class="source_keyword">if</font> ( FRand() &gt; <font class="source_int">0.33</font> * skill )
<a name="1242"></a>        <font class="source_keyword">return</font>;
<a name="1243"></a>
<a name="1244"></a>    <font class="source_comment">// and projectile time is long enough
</font><a name="1245"></a>    enemyDist = VSize(shooter.Location - Location);
<a name="1246"></a>    <font class="source_keyword">if</font> (enemyDist/projSpeed &lt; <font class="source_int">0.11</font> + <font class="source_int">0.15</font> * FRand()) 
<a name="1247"></a>        <font class="source_keyword">return</font>;
<a name="1248"></a>                    
<a name="1249"></a>    <font class="source_comment">// only if tight FOV
</font><a name="1250"></a>    GetAxes(Rotation,X,Y,Z);
<a name="1251"></a>    enemyDir = (shooter.Location - Location)/enemyDist;
<a name="1252"></a>    <font class="source_keyword">if</font> ((enemyDir Dot X) &lt; <font class="source_int">0.8</font>)
<a name="1253"></a>        <font class="source_keyword">return</font>;
<a name="1254"></a>
<a name="1255"></a>    <font class="source_keyword">if</font> ( (FireDir Dot Y) &gt; <font class="source_int">0</font> )
<a name="1256"></a>    {
<a name="1257"></a>        Y *= -<font class="source_int">1</font>;
<a name="1258"></a>        TryToDuck(Y, <font class="source_keyword">true</font>);
<a name="1259"></a>    }
<a name="1260"></a>    <font class="source_keyword">else</font>
<a name="1261"></a>        TryToDuck(Y, <font class="source_keyword">false</font>);
<a name="1262"></a>}
<a name="1263"></a>
<a name="1264"></a><font class="source_keyword">function</font> TryToDuck(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> duckDir, <font class="source_keyword">bool</font> bReversed)
<a name="1265"></a>{
<a name="1266"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, HitNormal, Extent;
<a name="1267"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="1268"></a>    <font class="source_keyword">local</font> <font class="source_keyword">bool</font> bSuccess, bDuckLeft;
<a name="1269"></a>
<a name="1270"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="1271"></a>        log(<font class="source_string">"duck"</font>);            
<a name="1272"></a>    duckDir.Z = <font class="source_int">0</font>;
<a name="1273"></a>    bDuckLeft = !bReversed;
<a name="1274"></a>    Extent.X = CollisionRadius;
<a name="1275"></a>    Extent.Y = CollisionRadius;
<a name="1276"></a>    Extent.Z = CollisionHeight;
<a name="1277"></a>    HitActor = Trace(HitLocation, HitNormal, Location + <font class="source_int">240</font> * duckDir, Location, <font class="source_keyword">false</font>, Extent);
<a name="1278"></a>    bSuccess = ( (HitActor == <font class="source_keyword">None</font>) || (VSize(HitLocation - Location) &gt; <font class="source_int">150</font>) );
<a name="1279"></a>    <font class="source_keyword">if</font> ( !bSuccess )
<a name="1280"></a>    {
<a name="1281"></a>        bDuckLeft = !bDuckLeft;
<a name="1282"></a>        duckDir *= -<font class="source_int">1</font>;
<a name="1283"></a>        HitActor = Trace(HitLocation, HitNormal, Location + <font class="source_int">240</font> * duckDir, Location, <font class="source_keyword">false</font>, Extent);
<a name="1284"></a>        bSuccess = ( (HitActor == <font class="source_keyword">None</font>) || (VSize(HitLocation - Location) &gt; <font class="source_int">150</font>) );
<a name="1285"></a>    }
<a name="1286"></a>    <font class="source_keyword">if</font> ( !bSuccess )
<a name="1287"></a>        <font class="source_keyword">return</font>;
<a name="1288"></a>    
<a name="1289"></a>    <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="1290"></a>        HitLocation = Location + <font class="source_int">240</font> * duckDir; 
<a name="1291"></a>
<a name="1292"></a>    HitActor = Trace(HitLocation, HitNormal, HitLocation - MaxStepHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>), HitLocation, <font class="source_keyword">false</font>, Extent);
<a name="1293"></a>    <font class="source_keyword">if</font> (HitActor == <font class="source_keyword">None</font>)
<a name="1294"></a>        <font class="source_keyword">return</font>;
<a name="1295"></a>        
<a name="1296"></a>    <font class="source_comment">//log("good duck");
</font><a name="1297"></a>
<a name="1298"></a>    SetFall();
<a name="1299"></a>    Velocity = duckDir * <font class="source_int">400</font>;
<a name="1300"></a>    Velocity.Z = <font class="source_int">160</font>;
<a name="1301"></a>    PlayDodge(bDuckLeft);
<a name="1302"></a>    SetPhysics(PHYS_Falling);
<a name="1303"></a>    <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != <font class="source_keyword">None</font>) && <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.bSplashDamage
<a name="1304"></a>        && ((bFire != <font class="source_int">0</font>) || (bAltFire != <font class="source_int">0</font>)) && (Enemy != <font class="source_keyword">None</font>) )
<a name="1305"></a>    {
<a name="1306"></a>        HitActor = Trace(HitLocation, HitNormal, Enemy.Location, HitLocation, <font class="source_keyword">false</font>);
<a name="1307"></a>        <font class="source_keyword">if</font> ( HitActor != <font class="source_keyword">None</font> )
<a name="1308"></a>        {
<a name="1309"></a>            HitActor = Trace(HitLocation, HitNormal, Enemy.Location, Location, <font class="source_keyword">false</font>);
<a name="1310"></a>            <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="1311"></a>            {
<a name="1312"></a>                bFire = <font class="source_int">0</font>;
<a name="1313"></a>                bAltFire = <font class="source_int">0</font>;
<a name="1314"></a>            }
<a name="1315"></a>        }
<a name="1316"></a>    }
<a name="1317"></a>    GotoState(<font class="source_name">'FallingState'</font>,<font class="source_name">'Ducking'</font>);
<a name="1318"></a>}
<a name="1319"></a>
<a name="1320"></a><font class="source_keyword">function</font> PlayDodge(<font class="source_keyword">bool</font> bDuckLeft)
<a name="1321"></a>{
<a name="1322"></a>    PlayDuck();
<a name="1323"></a>}
<a name="1324"></a>
<a name="1325"></a><font class="source_comment">/* TryToCrouch()
<a name="1326"></a>See if far enough away, and geometry favorable for crouching
<a name="1327"></a>*/</font>
<a name="1328"></a><font class="source_keyword">function</font> <font class="source_keyword">bool</font> TryToCrouch()
<a name="1329"></a>{
<a name="1330"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> ViewDist;
<a name="1331"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="1332"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, HitNormal, ViewSpot, StartSpot, ViewDir, Dir2D;
<a name="1333"></a>
<a name="1334"></a>    bCrouching = <font class="source_keyword">false</font>;
<a name="1335"></a>    <font class="source_keyword">if</font> ( Enemy == <font class="source_keyword">None</font> )
<a name="1336"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1337"></a>    ViewDist = VSize(Location - Enemy.Location); 
<a name="1338"></a>    <font class="source_keyword">if</font> ( ViewDist &lt; <font class="source_int">400</font> )
<a name="1339"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1340"></a>    <font class="source_keyword">if</font> ( FRand() &lt; <font class="source_int">0.3</font> )
<a name="1341"></a>        <font class="source_keyword">return</font> <font class="source_keyword">true</font>; 
<a name="1342"></a>
<a name="1343"></a>    ViewSpot = Enemy.Location + Enemy.BaseEyeHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>);
<a name="1344"></a>    StartSpot = Location - CollisionHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0.5</font>);
<a name="1345"></a>    ViewDir = (ViewSpot - StartSpot)/ViewDist;
<a name="1346"></a>    Dir2D = ViewDir;
<a name="1347"></a>    Dir2D.Z = <font class="source_int">0</font>;
<a name="1348"></a>    <font class="source_keyword">if</font> ( (Dir2D Dot <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font>(Rotation)) &lt; <font class="source_int">0.8</font> )
<a name="1349"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1350"></a>    HitActor = Trace(HitLocation, HitNormal, StartSpot + <font class="source_int">100</font> * ViewDir ,StartSpot, <font class="source_keyword">false</font>);
<a name="1351"></a>    <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="1352"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1353"></a>    bCrouching = <font class="source_keyword">true</font>;
<a name="1354"></a>    <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="1355"></a>}
<a name="1356"></a>
<a name="1357"></a><font class="source_comment">// Can Stake Out - check if I can see my current Destination point, and so can enemy
</font><a name="1358"></a><font class="source_keyword">function</font> <font class="source_keyword">bool</font> CanStakeOut()
<a name="1359"></a>{
<a name="1360"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, HitNormal;
<a name="1361"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="1362"></a>
<a name="1363"></a>    <font class="source_keyword">if</font> ( (Physics == PHYS_Flying) && !bCanStrafe )
<a name="1364"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1365"></a>    <font class="source_keyword">if</font> ( VSize(Enemy.Location - LastSeenPos) &gt; <font class="source_int">800</font> )
<a name="1366"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;       
<a name="1367"></a>    
<a name="1368"></a>    HitActor = Trace(HitLocation, HitNormal, LastSeenPos, Location + EyeHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>), <font class="source_keyword">false</font>);
<a name="1369"></a>    <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="1370"></a>    {
<a name="1371"></a>        HitActor = Trace(HitLocation, HitNormal, LastSeenPos , Enemy.Location + Enemy.BaseEyeHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>), <font class="source_keyword">false</font>);
<a name="1372"></a>        <font class="source_keyword">return</font> (HitActor == <font class="source_keyword">None</font>);
<a name="1373"></a>    }
<a name="1374"></a>    <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1375"></a>}
<a name="1376"></a>
<a name="1377"></a><font class="source_keyword">function</font> <font class="source_type"><a href="..\engine\pawn.html#EAttitude" class="source">eAttitude</a></font> AttitudeTo(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> Other)
<a name="1378"></a>{
<a name="1379"></a>    <font class="source_keyword">local</font> <font class="source_keyword">byte</font> result;
<a name="1380"></a>
<a name="1381"></a>    <font class="source_keyword">if</font> ( <font class="source_type">Level</font>.Game.bTeamGame && (<font class="source_type"><a href="..\engine\playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></font>.Team == Other.<font class="source_type"><a href="..\engine\playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></font>.Team) )
<a name="1382"></a>        <font class="source_keyword">return</font> ATTITUDE_Friendly; <font class="source_comment">//teammate
</font><a name="1383"></a>
<a name="1384"></a>    <font class="source_keyword">return</font> ATTITUDE_Hate;
<a name="1385"></a>}
<a name="1386"></a>
<a name="1387"></a><font class="source_keyword">function</font> <font class="source_keyword">float</font> AssessThreat( <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> NewThreat )
<a name="1388"></a>{
<a name="1389"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> ThreatValue, NewStrength, Dist;
<a name="1390"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\pawn.html#EAttitude" class="source">eAttitude</a></font> NewAttitude;
<a name="1391"></a>
<a name="1392"></a>    NewStrength = RelativeStrength(NewThreat);
<a name="1393"></a>    <font class="source_keyword">if</font> ( !NewThreat.bIsPlayer )
<a name="1394"></a>        <font class="source_keyword">return</font> NewStrength;
<a name="1395"></a>
<a name="1396"></a>    ThreatValue = FMax(<font class="source_int">0</font>, NewStrength);
<a name="1397"></a>    <font class="source_keyword">if</font> ( NewThreat.<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt; <font class="source_int">20</font> )
<a name="1398"></a>        ThreatValue += <font class="source_int">0.3</font>;
<a name="1399"></a>
<a name="1400"></a>    Dist = VSize(NewThreat.Location - Location);
<a name="1401"></a>    <font class="source_keyword">if</font> ( Dist &lt; <font class="source_int">800</font> )
<a name="1402"></a>        ThreatValue += <font class="source_int">0.3</font>;
<a name="1403"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( Dist &gt; <font class="source_int">0.7</font> * VSize(Enemy.Location - Location) )
<a name="1404"></a>        ThreatValue -= <font class="source_int">0.25</font>;
<a name="1405"></a>
<a name="1406"></a>    <font class="source_keyword">if</font> ( (NewThreat != Enemy) && (Enemy != <font class="source_keyword">None</font>) )
<a name="1407"></a>    {
<a name="1408"></a>        ThreatValue -= <font class="source_int">0.2</font>;
<a name="1409"></a>
<a name="1410"></a>        <font class="source_keyword">if</font> ( !LineOfSightTo(Enemy) )
<a name="1411"></a>        {
<a name="1412"></a>            <font class="source_keyword">if</font> ( Dist &lt; <font class="source_int">1200</font> )
<a name="1413"></a>                ThreatValue += <font class="source_int">0.2</font>;
<a name="1414"></a>            <font class="source_keyword">if</font> ( SpecialPause &gt; <font class="source_int">0</font> )
<a name="1415"></a>                ThreatValue += <font class="source_int">5</font>;
<a name="1416"></a>            <font class="source_keyword">if</font> ( IsInState(<font class="source_name">'Hunting'</font>) && (NewStrength &lt; <font class="source_int">0.2</font>) 
<a name="1417"></a>                && (<font class="source_type">Level</font>.TimeSeconds - HuntStartTime &lt; <font class="source_int">3</font>)
<a name="1418"></a>                && (relativeStrength(Enemy) &lt; FMin(<font class="source_int">0</font>, NewStrength)) )
<a name="1419"></a>                ThreatValue -= <font class="source_int">0.3</font>;
<a name="1420"></a>        }
<a name="1421"></a>    }
<a name="1422"></a>
<a name="1423"></a>    <font class="source_keyword">if</font> ( NewThreat.IsA(<font class="source_name">'PlayerPawn'</font>) )
<a name="1424"></a>        ThreatValue += <font class="source_int">0.15</font>;
<a name="1425"></a>
<a name="1426"></a>    <font class="source_keyword">return</font> ThreatValue;
<a name="1427"></a>}
<a name="1428"></a>
<a name="1429"></a>
<a name="1430"></a><font class="source_keyword">function</font> <font class="source_keyword">bool</font> SetEnemy( <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> NewEnemy )
<a name="1431"></a>{
<a name="1432"></a>    <font class="source_keyword">local</font> <font class="source_keyword">bool</font> result;
<a name="1433"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\pawn.html#EAttitude" class="source">eAttitude</a></font> newAttitude, oldAttitude;
<a name="1434"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> newStrength;
<a name="1435"></a>
<a name="1436"></a>    <font class="source_keyword">if</font> (Enemy == NewEnemy)
<a name="1437"></a>        <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="1438"></a>    <font class="source_keyword">if</font> ( (NewEnemy == Self) || (NewEnemy == <font class="source_keyword">None</font>) || (NewEnemy.<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font>) || NewEnemy.IsA(<font class="source_name">'FlockPawn'</font>) )
<a name="1439"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1440"></a>
<a name="1441"></a>    result = <font class="source_keyword">false</font>;
<a name="1442"></a>    newAttitude = AttitudeTo(NewEnemy);
<a name="1443"></a>
<a name="1444"></a>    <font class="source_keyword">if</font> ( newAttitude == ATTITUDE_Friendly )
<a name="1445"></a>    {
<a name="1446"></a>        NewEnemy = NewEnemy.Enemy;
<a name="1447"></a>        <font class="source_keyword">if</font> ( (NewEnemy == <font class="source_keyword">None</font>) || (NewEnemy == Self) || (NewEnemy.<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font>) || NewEnemy.IsA(<font class="source_name">'FlockPawn'</font>) )
<a name="1448"></a>            <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1449"></a>        <font class="source_keyword">if</font> (Enemy == NewEnemy)
<a name="1450"></a>            <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="1451"></a>
<a name="1452"></a>        newAttitude = AttitudeTo(NewEnemy);
<a name="1453"></a>    }
<a name="1454"></a>
<a name="1455"></a>    <font class="source_keyword">if</font> ( newAttitude &gt;= ATTITUDE_Ignore )
<a name="1456"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1457"></a>
<a name="1458"></a>    <font class="source_keyword">if</font> ( Enemy != <font class="source_keyword">None</font> )
<a name="1459"></a>    {
<a name="1460"></a>        <font class="source_keyword">if</font> ( AssessThreat(NewEnemy) &gt; AssessThreat(Enemy) )
<a name="1461"></a>        {
<a name="1462"></a>            OldEnemy = Enemy;
<a name="1463"></a>            Enemy = NewEnemy;
<a name="1464"></a>            result = <font class="source_keyword">true</font>;
<a name="1465"></a>        }
<a name="1466"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( OldEnemy == <font class="source_keyword">None</font> )
<a name="1467"></a>            OldEnemy = NewEnemy;
<a name="1468"></a>    }
<a name="1469"></a>    <font class="source_keyword">else</font>
<a name="1470"></a>    {
<a name="1471"></a>        result = <font class="source_keyword">true</font>;
<a name="1472"></a>        Enemy = NewEnemy;
<a name="1473"></a>    }
<a name="1474"></a>
<a name="1475"></a>    <font class="source_keyword">if</font> ( result )
<a name="1476"></a>    {
<a name="1477"></a>        LastSeenPos = Enemy.Location;
<a name="1478"></a>        LastSeeingPos = Location;
<a name="1479"></a>        EnemyAcquired();
<a name="1480"></a>    }
<a name="1481"></a>                
<a name="1482"></a>    <font class="source_keyword">return</font> result;
<a name="1483"></a>}
<a name="1484"></a>
<a name="1485"></a><font class="source_keyword">function</font> ReSetSkill()
<a name="1486"></a>{
<a name="1487"></a>    bLeadTarget = (<font class="source_int">1.5</font> * FRand() &lt; Skill);
<a name="1488"></a>    <font class="source_keyword">if</font> ( Skill == <font class="source_int">0</font> )
<a name="1489"></a>    {
<a name="1490"></a>        <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> = <font class="source_int">80</font>;
<a name="1491"></a>        ReFireRate = <font class="source_int">0.75</font> * Default.ReFireRate;
<a name="1492"></a>    }
<a name="1493"></a>    <font class="source_keyword">else</font>
<a name="1494"></a>        ReFireRate = Default.ReFireRate * (<font class="source_int">1</font> - <font class="source_int">0.25</font> * skill);
<a name="1495"></a>
<a name="1496"></a>    PreSetMovement();
<a name="1497"></a>}
<a name="1498"></a>
<a name="1499"></a><font class="source_keyword">function</font> Killed(<font class="source_type"><a href="..\engine\pawn.html" class="source">pawn</a></font> Killer, <font class="source_type"><a href="..\engine\pawn.html" class="source">pawn</a></font> Other, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="1500"></a>{
<a name="1501"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> aPawn;
<a name="1502"></a>
<a name="1503"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font> )
<a name="1504"></a>        <font class="source_keyword">return</font>;
<a name="1505"></a>
<a name="1506"></a>    <font class="source_keyword">if</font> ( OldEnemy == Other )
<a name="1507"></a>        OldEnemy = <font class="source_keyword">None</font>;
<a name="1508"></a>
<a name="1509"></a>    <font class="source_keyword">if</font> ( Enemy == Other )
<a name="1510"></a>    {
<a name="1511"></a>        bFire = <font class="source_int">0</font>;
<a name="1512"></a>        bAltFire = <font class="source_int">0</font>;
<a name="1513"></a>        bReadyToAttack = ( skill &gt; <font class="source_int">3</font> * FRand() );
<a name="1514"></a>        EnemyDropped = Enemy.<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>;
<a name="1515"></a>        Enemy = <font class="source_keyword">None</font>;
<a name="1516"></a>        <font class="source_keyword">if</font> ( (Killer == self) && (OldEnemy == <font class="source_keyword">None</font>) )
<a name="1517"></a>        {
<a name="1518"></a>            <font class="source_keyword">for</font> ( aPawn=<font class="source_type">Level</font>.PawnList; aPawn!=<font class="source_keyword">None</font>; aPawn=aPawn.nextPawn )
<a name="1519"></a>                <font class="source_keyword">if</font> ( ((aPawn.IsA(<font class="source_name">'PlayerPawn'</font>) && !aPawn.IsA(<font class="source_name">'Spectator'</font>)) 
<a name="1520"></a>                    || aPawn.IsA(<font class="source_name">'ScriptedPawn'</font>) || aPawn.IsA(<font class="source_name">'Bot'</font>))
<a name="1521"></a>                    && (VSize(Location - aPawn.Location) &lt; <font class="source_int">1000</font>)
<a name="1522"></a>                    && CanSee(aPawn) && SetEnemy(aPawn) )
<a name="1523"></a>                {
<a name="1524"></a>                    GotoState(<font class="source_name">'Attacking'</font>);
<a name="1525"></a>                    <font class="source_keyword">return</font>;
<a name="1526"></a>                }
<a name="1527"></a>
<a name="1528"></a>            Target = Other;
<a name="1529"></a>            GotoState(<font class="source_name">'VictoryDance'</font>); 
<a name="1530"></a>        }
<a name="1531"></a>        <font class="source_keyword">else</font> 
<a name="1532"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="1533"></a>    }
<a name="1534"></a>}   
<a name="1535"></a>
<a name="1536"></a><font class="source_keyword">function</font> EnemyAcquired()
<a name="1537"></a>{
<a name="1538"></a>    <font class="source_comment">//log(Class$" just acquired an enemy - no action");
</font><a name="1539"></a>}
<a name="1540"></a>
<a name="1541"></a><font class="source_comment">/* RelativeStrength()
<a name="1542"></a>returns a value indicating the relative strength of other
<a name="1543"></a>0.0 = equal to self
<a name="1544"></a>&gt; 0 stronger than self
<a name="1545"></a>&lt; 0 weaker than self
<a name="1546"></a>
<a name="1547"></a>Since the result will be compared to the creature's aggressiveness, it should be
<a name="1548"></a>on the same order of magnitude (-1 to 1)
<a name="1549"></a>
<a name="1550"></a>Assess based on health and weapon
<a name="1551"></a>*/</font>
<a name="1552"></a>
<a name="1553"></a><font class="source_keyword">function</font> <font class="source_keyword">float</font> RelativeStrength(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> Other)
<a name="1554"></a>{
<a name="1555"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> compare;
<a name="1556"></a>    <font class="source_keyword">local</font> <font class="source_keyword">int</font> adjustedStrength, adjustedOther;
<a name="1557"></a>    <font class="source_keyword">local</font> <font class="source_keyword">int</font> bTemp;
<a name="1558"></a>
<a name="1559"></a>    adjustedStrength = <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font>;
<a name="1560"></a>    adjustedOther = <font class="source_int">0.5</font> * (Other.<font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> + Other.Default.<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font>);    
<a name="1561"></a>    compare = <font class="source_int">0.01</font> * <font class="source_keyword">float</font>(adjustedOther - adjustedStrength);
<a name="1562"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != <font class="source_keyword">None</font> )
<a name="1563"></a>    {
<a name="1564"></a>        compare -= (<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.RateSelf(bTemp) - <font class="source_int">0.3</font>);
<a name="1565"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.AIRating &lt; <font class="source_int">0.4</font> )
<a name="1566"></a>        {
<a name="1567"></a>            compare += <font class="source_int">0.2</font>;
<a name="1568"></a>            <font class="source_keyword">if</font> ( (Other.<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != <font class="source_keyword">None</font>) && (Other.<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.AIRating &gt;= <font class="source_int">0.4</font>) )
<a name="1569"></a>                compare += <font class="source_int">0.3</font>;
<a name="1570"></a>        }
<a name="1571"></a>    }
<a name="1572"></a>    <font class="source_keyword">if</font> ( Other.<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != <font class="source_keyword">None</font> )
<a name="1573"></a>        compare += (Other.<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.RateSelf(bTemp) - <font class="source_int">0.3</font>);
<a name="1574"></a>    <font class="source_comment">//log(other.class$" relative strength to "$class$" is "$compare);
</font><a name="1575"></a>    <font class="source_keyword">return</font> compare;
<a name="1576"></a>}
<a name="1577"></a>
<a name="1578"></a><font class="source_keyword">function</font> <font class="source_keyword">bool</font> CanFireAtEnemy()
<a name="1579"></a>{
<a name="1580"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, HitNormal,X,Y,Z, projStart;
<a name="1581"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="1582"></a>    
<a name="1583"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> == <font class="source_keyword">None</font> )
<a name="1584"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1585"></a>    
<a name="1586"></a>    GetAxes(Rotation,X,Y,Z);
<a name="1587"></a>    projStart = Location + <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.CalcDrawOffset() + <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.FireOffset.X * X + <font class="source_int">1.2</font> * <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.FireOffset.Y * Y + <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.FireOffset.Z * Z;
<a name="1588"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.bInstantHit )
<a name="1589"></a>        HitActor = Trace(HitLocation, HitNormal, Enemy.Location + Enemy.CollisionHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0.7</font>), projStart, <font class="source_keyword">true</font>);
<a name="1590"></a>    <font class="source_keyword">else</font>
<a name="1591"></a>        HitActor = Trace(HitLocation, HitNormal, 
<a name="1592"></a>                projStart + <font class="source_int">220</font> * Normal(Enemy.Location + Enemy.CollisionHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0.7</font>) - Location), 
<a name="1593"></a>                projStart, <font class="source_keyword">true</font>);
<a name="1594"></a>
<a name="1595"></a>    <font class="source_keyword">if</font> ( HitActor == Enemy )
<a name="1596"></a>        <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="1597"></a>    <font class="source_keyword">if</font> ( (HitActor != <font class="source_keyword">None</font>) && (VSize(HitLocation - Location) &lt; <font class="source_int">200</font>) )
<a name="1598"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1599"></a>    <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(HitActor) != <font class="source_keyword">None</font>) && (AttitudeTo(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(HitActor)) &gt; ATTITUDE_Ignore) )
<a name="1600"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1601"></a>
<a name="1602"></a>    <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="1603"></a>}
<a name="1604"></a>
<a name="1605"></a><font class="source_keyword">function</font> PlayMeleeAttack()
<a name="1606"></a>{
<a name="1607"></a>    <font class="source_comment">//log("play melee attack");
</font><a name="1608"></a>    Acceleration = AccelRate * VRand();
<a name="1609"></a>    TweenToWaiting(<font class="source_int">0.15</font>); 
<a name="1610"></a>    FireWeapon();
<a name="1611"></a>}
<a name="1612"></a>
<a name="1613"></a><font class="source_keyword">function</font> PlayRangedAttack()
<a name="1614"></a>{
<a name="1615"></a>    TweenToWaiting(<font class="source_int">0.11</font>);
<a name="1616"></a>    FireWeapon();
<a name="1617"></a>}
<a name="1618"></a>
<a name="1619"></a><font class="source_keyword">function</font> PlayMovingAttack()
<a name="1620"></a>{
<a name="1621"></a>    PlayRunning();
<a name="1622"></a>    FireWeapon();
<a name="1623"></a>}
<a name="1624"></a>
<a name="1625"></a><font class="source_keyword">function</font> PlayOutOfWater()
<a name="1626"></a>{
<a name="1627"></a>    PlayDuck();
<a name="1628"></a>}
<a name="1629"></a>
<a name="1630"></a><font class="source_comment">//FIXME - here decide when to pause/start firing based on weapon,etc
</font><a name="1631"></a><font class="source_keyword">function</font> PlayCombatMove()
<a name="1632"></a>{   
<a name="1633"></a>    PlayRunning();
<a name="1634"></a>    <font class="source_keyword">if</font> ( skill &gt;= <font class="source_int">2</font> )
<a name="1635"></a>        bReadyToAttack = <font class="source_keyword">true</font>;
<a name="1636"></a>    <font class="source_keyword">if</font> ( bReadyToAttack && bCanFire )
<a name="1637"></a>    {
<a name="1638"></a>        <font class="source_keyword">if</font> ( NeedToTurn(Enemy.Location) )
<a name="1639"></a>        {
<a name="1640"></a>            bAltFire = <font class="source_int">0</font>;
<a name="1641"></a>            bFire = <font class="source_int">0</font>;
<a name="1642"></a>        }
<a name="1643"></a>        <font class="source_keyword">else</font> 
<a name="1644"></a>            FireWeapon(); 
<a name="1645"></a>    }       
<a name="1646"></a>    <font class="source_keyword">else</font> 
<a name="1647"></a>    {
<a name="1648"></a>        bFire = <font class="source_int">0</font>;
<a name="1649"></a>        bAltFire = <font class="source_int">0</font>;
<a name="1650"></a>    }
<a name="1651"></a>}
<a name="1652"></a>
<a name="1653"></a><font class="source_keyword">function</font> <font class="source_keyword">float</font> StrafeAdjust()
<a name="1654"></a>{
<a name="1655"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> Focus2D, Loc2D, Dest2D;
<a name="1656"></a>    <font class="source_keyword">local</font> <font class="source_keyword">float</font> strafemag; 
<a name="1657"></a>
<a name="1658"></a>    Focus2D = Focus;
<a name="1659"></a>    Focus2D.Z = <font class="source_int">0</font>;
<a name="1660"></a>    Loc2D = Location;
<a name="1661"></a>    Loc2D.Z = <font class="source_int">0</font>;
<a name="1662"></a>    Dest2D = Destination;
<a name="1663"></a>    Dest2D.Z = <font class="source_int">0</font>;
<a name="1664"></a>    strafeMag = Abs( Normal(Focus2D - Loc2D) dot Normal(Dest2D - Loc2D) );
<a name="1665"></a>
<a name="1666"></a>    <font class="source_keyword">return</font> ((strafeMag - <font class="source_int">2.0</font>)/GroundSpeed);
<a name="1667"></a>}
<a name="1668"></a>
<a name="1669"></a><font class="source_keyword">function</font> <font class="source_type"><a href="..\engine\trigger.html" class="source">Trigger</a></font>( <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Other, <font class="source_type"><a href="..\engine\pawn.html" class="source">pawn</a></font> EventInstigator )
<a name="1670"></a>{
<a name="1671"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> currentEnemy;
<a name="1672"></a>
<a name="1673"></a>    <font class="source_keyword">if</font> ( (Other == Self) || (<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font>) )
<a name="1674"></a>        <font class="source_keyword">return</font>;
<a name="1675"></a>    currentEnemy = Enemy;
<a name="1676"></a>    SetEnemy(EventInstigator);
<a name="1677"></a>    <font class="source_keyword">if</font> (Enemy != currentEnemy)
<a name="1678"></a>        GotoState(<font class="source_name">'Attacking'</font>);
<a name="1679"></a>}
<a name="1680"></a>
<a name="1681"></a><font class="source_comment">//**********************************************************************************
</font><a name="1682"></a><font class="source_comment">//Base Monster AI
</font><a name="1683"></a>
<a name="1684"></a><font class="source_keyword2">auto</font> <font class="source_keyword">state</font> StartUp
<a name="1685"></a>{
<a name="1686"></a>    <font class="source_keyword">function</font> BeginState()
<a name="1687"></a>    {
<a name="1688"></a>        SetMovementPhysics(); 
<a name="1689"></a>        <font class="source_keyword">if</font> (Physics == PHYS_Walking)
<a name="1690"></a>            SetPhysics(PHYS_Falling);
<a name="1691"></a>    }
<a name="1692"></a>
<a name="1693"></a>Begin:
<a name="1694"></a>    WhatToDoNext(<font class="source_name">''</font>,<font class="source_name">''</font>);
<a name="1695"></a>}
<a name="1696"></a>
<a name="1697"></a><font class="source_keyword">state</font> Roaming
<a name="1698"></a>{
<a name="1699"></a>    <font class="source_keyword">ignores</font> EnemyNotVisible;
<a name="1700"></a>
<a name="1701"></a>    <font class="source_keyword">function</font> Bump(<font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Other)
<a name="1702"></a>    {
<a name="1703"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> VelDir, OtherDir;
<a name="1704"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> speed;
<a name="1705"></a>
<a name="1706"></a>        <font class="source_comment">//log(Other.class$" bumped "$class);
</font><a name="1707"></a>        <font class="source_keyword">if</font> (<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Other) != <font class="source_keyword">None</font>)
<a name="1708"></a>        {
<a name="1709"></a>            <font class="source_keyword">if</font> ( (Other == Enemy) || SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Other)) )
<a name="1710"></a>            {
<a name="1711"></a>                bReadyToAttack = <font class="source_keyword">true</font>;
<a name="1712"></a>                GotoState(<font class="source_name">'Attacking'</font>);
<a name="1713"></a>            }
<a name="1714"></a>            <font class="source_keyword">return</font>;
<a name="1715"></a>        }
<a name="1716"></a>        <font class="source_keyword">if</font> ( TimerRate &lt;= <font class="source_int">0</font> )
<a name="1717"></a>            setTimer(<font class="source_int">1.0</font>, <font class="source_keyword">false</font>);
<a name="1718"></a>        speed = VSize(Velocity);
<a name="1719"></a>        <font class="source_keyword">if</font> ( speed &gt; <font class="source_int">1</font> )
<a name="1720"></a>        {
<a name="1721"></a>            VelDir = Velocity/speed;
<a name="1722"></a>            VelDir.Z = <font class="source_int">0</font>;
<a name="1723"></a>            OtherDir = Other.Location - Location;
<a name="1724"></a>            OtherDir.Z = <font class="source_int">0</font>;
<a name="1725"></a>            OtherDir = Normal(OtherDir);
<a name="1726"></a>            <font class="source_keyword">if</font> ( (VelDir Dot OtherDir) &gt; <font class="source_int">0.9</font> )
<a name="1727"></a>            {
<a name="1728"></a>                Velocity.X = VelDir.Y;
<a name="1729"></a>                Velocity.Y = -<font class="source_int">1</font> * VelDir.X;
<a name="1730"></a>                Velocity *= FMax(speed, <font class="source_int">200</font>);
<a name="1731"></a>            }
<a name="1732"></a>        }
<a name="1733"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( bCamping )
<a name="1734"></a>            GotoState(<font class="source_name">'Wandering'</font>);
<a name="1735"></a>        Disable(<font class="source_name">'Bump'</font>);
<a name="1736"></a>    }
<a name="1737"></a>    
<a name="1738"></a>    <font class="source_keyword">function</font> HandleHelpMessageFrom(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> Other)
<a name="1739"></a>    {
<a name="1740"></a>        <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &gt; <font class="source_int">70</font>) && (<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.AIRating &gt; <font class="source_int">0.5</font>) && (Other.<font class="source_type"><a href="..\engine\playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></font>.Team == <font class="source_type"><a href="..\engine\playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></font>.Team)
<a name="1741"></a>            && (Other.Enemy != <font class="source_keyword">None</font>)
<a name="1742"></a>            && (VSize(Other.Enemy.Location - Location) &lt; <font class="source_int">1200</font>) )
<a name="1743"></a>        {
<a name="1744"></a>            SetEnemy(Other.Enemy);
<a name="1745"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="1746"></a>        }
<a name="1747"></a>    }
<a name="1748"></a>
<a name="1749"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="1750"></a>                            <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="1751"></a>    {
<a name="1752"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="1753"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="1754"></a>            <font class="source_keyword">return</font>;
<a name="1755"></a>        <font class="source_keyword">if</font> (NextState == <font class="source_name">'TakeHit'</font>)
<a name="1756"></a>        {
<a name="1757"></a>            NextState = <font class="source_name">'Attacking'</font>; 
<a name="1758"></a>            NextLabel = <font class="source_name">''</font>;
<a name="1759"></a>            GotoState(<font class="source_name">'TakeHit'</font>); 
<a name="1760"></a>        }
<a name="1761"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( !bCanFire && (skill &gt; <font class="source_int">3</font> * FRand()) )
<a name="1762"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="1763"></a>    }
<a name="1764"></a>
<a name="1765"></a>    <font class="source_keyword">function</font> FearThisSpot(<font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> aSpot)
<a name="1766"></a>    {
<a name="1767"></a>        Destination = Location + <font class="source_int">120</font> * Normal(Location - aSpot.Location); 
<a name="1768"></a>        GotoState(<font class="source_name">'Wandering'</font>, <font class="source_name">'Moving'</font>);
<a name="1769"></a>    }
<a name="1770"></a>    
<a name="1771"></a>    <font class="source_keyword">function</font> Timer()
<a name="1772"></a>    {
<a name="1773"></a>        bReadyToAttack = <font class="source_keyword">True</font>;
<a name="1774"></a>        Enable(<font class="source_name">'Bump'</font>);
<a name="1775"></a>    }
<a name="1776"></a>
<a name="1777"></a>    <font class="source_keyword">function</font> SetFall()
<a name="1778"></a>    {
<a name="1779"></a>        bWallAdjust = <font class="source_keyword">false</font>;
<a name="1780"></a>        NextState = <font class="source_name">'Roaming'</font>; 
<a name="1781"></a>        NextLabel = <font class="source_name">'Landed'</font>;
<a name="1782"></a>        NextAnim = AnimSequence;
<a name="1783"></a>        GotoState(<font class="source_name">'FallingState'</font>); 
<a name="1784"></a>    }
<a name="1785"></a>
<a name="1786"></a>    <font class="source_keyword">function</font> EnemyAcquired()
<a name="1787"></a>    {
<a name="1788"></a>        GotoState(<font class="source_name">'Acquisition'</font>);
<a name="1789"></a>    }
<a name="1790"></a>
<a name="1791"></a>    <font class="source_keyword">function</font> HitWall(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal, <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Wall)
<a name="1792"></a>    {
<a name="1793"></a>        <font class="source_keyword">if</font> (Physics == PHYS_Falling)
<a name="1794"></a>            <font class="source_keyword">return</font>;
<a name="1795"></a>        <font class="source_keyword">if</font> ( Wall.IsA(<font class="source_name">'Mover'</font>) && <font class="source_type"><a href="..\engine\mover.html" class="source">Mover</a></font>(Wall).HandleDoor(self) )
<a name="1796"></a>        {
<a name="1797"></a>            <font class="source_keyword">if</font> ( SpecialPause &gt; <font class="source_int">0</font> )
<a name="1798"></a>                Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="1799"></a>            GotoState(<font class="source_name">'Roaming'</font>, <font class="source_name">'SpecialNavig'</font>);
<a name="1800"></a>            <font class="source_keyword">return</font>;
<a name="1801"></a>        }
<a name="1802"></a>        Focus = Destination;
<a name="1803"></a>        <font class="source_keyword">if</font> ( !bWallAdjust && PickWallAdjust() )
<a name="1804"></a>            GotoState(<font class="source_name">'Roaming'</font>, <font class="source_name">'AdjustFromWall'</font>);
<a name="1805"></a>        <font class="source_keyword">else</font>
<a name="1806"></a>        {
<a name="1807"></a>            MoveTimer = -<font class="source_int">1.0</font>;
<a name="1808"></a>            bWallAdjust = <font class="source_keyword">false</font>;
<a name="1809"></a>        }
<a name="1810"></a>    }
<a name="1811"></a>
<a name="1812"></a>    <font class="source_keyword">function</font> PickDestination()
<a name="1813"></a>    {
<a name="1814"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\inventory.html" class="source">inventory</a></font> Inv, BestInv, KnowPath;
<a name="1815"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> Bestweight, NewWeight, DroppedDist;
<a name="1816"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> BestPath, HitActor;
<a name="1817"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal, HitLocation;
<a name="1818"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\decoration.html" class="source">decoration</a></font> Dec;
<a name="1819"></a>        <font class="source_keyword">local</font> <font class="source_keyword">bool</font> bCanReach;
<a name="1820"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\navigationpoint.html" class="source">NavigationPoint</a></font> N;
<a name="1821"></a>        <font class="source_keyword">local</font> <font class="source_keyword">int</font> i;
<a name="1822"></a>
<a name="1823"></a>        <font class="source_keyword">if</font> ( (EnemyDropped != <font class="source_keyword">None</font>) && !EnemyDropped.bDeleteMe 
<a name="1824"></a>            && (EnemyDropped.Owner == <font class="source_keyword">None</font>) )
<a name="1825"></a>        {
<a name="1826"></a>            DroppedDist = VSize(EnemyDropped.Location - Location);
<a name="1827"></a>            <font class="source_keyword">if</font> ( (DroppedDist &lt; <font class="source_int">800</font>) && ActorReachable(EnemyDropped) )
<a name="1828"></a>            {
<a name="1829"></a>                BestWeight = EnemyDropped.BotDesireability(self);       
<a name="1830"></a>                <font class="source_keyword">if</font> ( BestWeight &gt; <font class="source_int">0.4</font> )
<a name="1831"></a>                {
<a name="1832"></a>                    MoveTarget = EnemyDropped;
<a name="1833"></a>                    EnemyDropped = <font class="source_keyword">None</font>;
<a name="1834"></a>                    <font class="source_keyword">return</font>; 
<a name="1835"></a>                }
<a name="1836"></a>                BestInv = EnemyDropped;
<a name="1837"></a>                BestWeight = BestWeight/DroppedDist;
<a name="1838"></a>                KnowPath = BestInv;
<a name="1839"></a>            }   
<a name="1840"></a>            <font class="source_keyword">else</font>
<a name="1841"></a>                BestWeight = <font class="source_int">0</font>;
<a name="1842"></a>        }   
<a name="1843"></a>        <font class="source_keyword">else</font>
<a name="1844"></a>            BestWeight = <font class="source_int">0</font>;
<a name="1845"></a>
<a name="1846"></a>        EnemyDropped = <font class="source_keyword">None</font>;
<a name="1847"></a>                                    
<a name="1848"></a>        <font class="source_comment">//first look at nearby inventory &lt; 600 dist
</font><a name="1849"></a>        <font class="source_keyword">foreach</font> visiblecollidingactors(<font class="source_keyword">class</font><font class="source_name">'Inventory'</font>, Inv, <font class="source_int">600</font>)
<a name="1850"></a>            <font class="source_keyword">if</font> ( (Inv.IsInState(<font class="source_name">'PickUp'</font>)) && (Inv.MaxDesireability/5<font class="source_int">0</font> &gt; BestWeight)
<a name="1851"></a>                && (Inv.Location.Z &lt; Location.Z + MaxStepHeight + CollisionHeight) )
<a name="1852"></a>            {
<a name="1853"></a>                NewWeight = inv.BotDesireability(self)/VSize(Inv.Location - Location);
<a name="1854"></a>                <font class="source_comment">// log("looking at local "$Inv$" weight "$100000*NewWeight);
</font><a name="1855"></a>                <font class="source_keyword">if</font> ( NewWeight &gt; BestWeight )
<a name="1856"></a>                {
<a name="1857"></a>                    BestWeight = NewWeight;
<a name="1858"></a>                    BestInv = Inv;
<a name="1859"></a>                }
<a name="1860"></a>            }
<a name="1861"></a>
<a name="1862"></a>        <font class="source_keyword">if</font> ( BestInv != <font class="source_keyword">None</font> )
<a name="1863"></a>        {
<a name="1864"></a>            bCanJump = ( BestInv.Location.Z &gt; Location.Z - CollisionHeight - MaxStepHeight );
<a name="1865"></a>            bCanReach = ActorReachable(BestInv);
<a name="1866"></a>        }
<a name="1867"></a>        <font class="source_keyword">else</font>
<a name="1868"></a>            bCanReach = <font class="source_keyword">false</font>;
<a name="1869"></a>        bCanJump = <font class="source_keyword">true</font>;
<a name="1870"></a>        <font class="source_keyword">if</font> ( bCanReach )
<a name="1871"></a>        {
<a name="1872"></a>            <font class="source_comment">//log("Roam to local "$BestInv);
</font><a name="1873"></a>            MoveTarget = BestInv;
<a name="1874"></a>            <font class="source_keyword">return</font>;
<a name="1875"></a>        }
<a name="1876"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( KnowPath != <font class="source_keyword">None</font> )
<a name="1877"></a>        {
<a name="1878"></a>            MoveTarget = KnowPath;
<a name="1879"></a>            <font class="source_keyword">return</font>;
<a name="1880"></a>        }
<a name="1881"></a>
<a name="1882"></a>        <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.AIRating &gt; <font class="source_int">0.5</font>) && (<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &gt; <font class="source_int">90</font>) )
<a name="1883"></a>        {
<a name="1884"></a>            bWantsToCamp = ( bWantsToCamp || (FRand() &lt; CampingRate * FMin(<font class="source_int">1.0</font>, <font class="source_type">Level</font>.TimeSeconds - LastCampCheck)) );
<a name="1885"></a>            LastCampCheck = <font class="source_type">Level</font>.TimeSeconds;
<a name="1886"></a>        }
<a name="1887"></a>        <font class="source_keyword">else</font> 
<a name="1888"></a>            bWantsToCamp = <font class="source_keyword">false</font>;
<a name="1889"></a>
<a name="1890"></a>        <font class="source_keyword">if</font> ( bWantsToCamp && FindAmbushSpot() )
<a name="1891"></a>            <font class="source_keyword">return</font>;
<a name="1892"></a>
<a name="1893"></a>        <font class="source_comment">// if none found, check for decorations with inventory
</font><a name="1894"></a>        <font class="source_keyword">if</font> ( !bNoShootDecor )
<a name="1895"></a>            <font class="source_keyword">foreach</font> visiblecollidingactors(<font class="source_keyword">class</font><font class="source_name">'Decoration'</font>, Dec, <font class="source_int">500</font>)
<a name="1896"></a>                <font class="source_keyword">if</font> ( Dec.Contents != <font class="source_keyword">None</font> )
<a name="1897"></a>                {
<a name="1898"></a>                    bNoShootDecor = <font class="source_keyword">true</font>;
<a name="1899"></a>                    Target = Dec;
<a name="1900"></a>                    GotoState(<font class="source_name">'Roaming'</font>, <font class="source_name">'ShootDecoration'</font>);
<a name="1901"></a>                    <font class="source_keyword">return</font>;
<a name="1902"></a>                }
<a name="1903"></a>
<a name="1904"></a>        bNoShootDecor = <font class="source_keyword">false</font>;
<a name="1905"></a>        BestWeight = <font class="source_int">0</font>;
<a name="1906"></a>
<a name="1907"></a>        <font class="source_comment">// look for long distance inventory 
</font><a name="1908"></a>        BestPath = FindBestInventoryPath(BestWeight, (skill &gt;= <font class="source_int">2</font>));
<a name="1909"></a>        <font class="source_comment">//log("roam to "$BestPath);
</font><a name="1910"></a>        <font class="source_comment">//log("---------------------------------");
</font><a name="1911"></a>        <font class="source_keyword">if</font> ( BestPath != <font class="source_keyword">None</font> )
<a name="1912"></a>        {
<a name="1913"></a>            MoveTarget = BestPath;
<a name="1914"></a>            <font class="source_keyword">return</font>;
<a name="1915"></a>        }
<a name="1916"></a>
<a name="1917"></a>         <font class="source_comment">// if nothing, then wander or camp
</font><a name="1918"></a>        <font class="source_keyword">if</font> ( FRand() &lt; <font class="source_int">0.35</font> )
<a name="1919"></a>            GotoState(<font class="source_name">'Wandering'</font>);
<a name="1920"></a>        <font class="source_keyword">else</font>
<a name="1921"></a>        {
<a name="1922"></a>            CampTime = <font class="source_int">3.5</font> + FRand() - skill;
<a name="1923"></a>            GotoState(<font class="source_name">'Roaming'</font>, <font class="source_name">'Camp'</font>);
<a name="1924"></a>        }
<a name="1925"></a>    }
<a name="1926"></a>
<a name="1927"></a>    <font class="source_keyword">function</font> <font class="source_keyword">bool</font> FindAmbushSpot()
<a name="1928"></a>    {
<a name="1929"></a>        <font class="source_keyword">if</font> ( (AmbushSpot == <font class="source_keyword">None</font>) && (<font class="source_type"><a href="..\engine\ambushpoint.html" class="source">Ambushpoint</a></font>(MoveTarget) != <font class="source_keyword">None</font>) )
<a name="1930"></a>            AmbushSpot = <font class="source_type"><a href="..\engine\ambushpoint.html" class="source">Ambushpoint</a></font>(MoveTarget);
<a name="1931"></a>
<a name="1932"></a>        <font class="source_keyword">if</font> ( Ambushspot != <font class="source_keyword">None</font> )
<a name="1933"></a>        {
<a name="1934"></a>            Ambushspot.taken = <font class="source_keyword">true</font>;
<a name="1935"></a>            <font class="source_keyword">if</font> ( VSize(Ambushspot.Location - Location) &lt; <font class="source_int">2</font> * CollisionRadius )
<a name="1936"></a>            {   
<a name="1937"></a>                CampTime = <font class="source_int">10.0</font>;
<a name="1938"></a>                GotoState(<font class="source_name">'Roaming'</font>, <font class="source_name">'LongCamp'</font>);
<a name="1939"></a>                <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="1940"></a>            }
<a name="1941"></a>            <font class="source_keyword">if</font> ( ActorReachable(Ambushspot) )
<a name="1942"></a>            {
<a name="1943"></a>                MoveTarget = Ambushspot;
<a name="1944"></a>                <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="1945"></a>            }
<a name="1946"></a>            MoveTarget = FindPathToward(Ambushspot);
<a name="1947"></a>            <font class="source_keyword">if</font> ( MoveTarget != <font class="source_keyword">None</font> )
<a name="1948"></a>                <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="1949"></a>            Ambushspot.taken = <font class="source_keyword">false</font>;
<a name="1950"></a>            Ambushspot = <font class="source_keyword">None</font>;
<a name="1951"></a>        }
<a name="1952"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="1953"></a>    }       
<a name="1954"></a>
<a name="1955"></a>    <font class="source_keyword">function</font> AnimEnd() 
<a name="1956"></a>    {
<a name="1957"></a>        <font class="source_keyword">if</font> ( bCamping )
<a name="1958"></a>            PlayWaiting();
<a name="1959"></a>        <font class="source_keyword">else</font>
<a name="1960"></a>            PlayRunning();
<a name="1961"></a>    }
<a name="1962"></a>
<a name="1963"></a>    <font class="source_keyword">function</font> ShareWithTeam()
<a name="1964"></a>    {
<a name="1965"></a>        <font class="source_keyword">local</font> <font class="source_keyword">bool</font> bHaveItem, bIsHealth, bOtherHas;
<a name="1966"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\inventory.html" class="source">Inventory</a></font> goalItem;
<a name="1967"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> P;
<a name="1968"></a>
<a name="1969"></a>        goalItem = <font class="source_type"><a href="..\engine\inventoryspot.html" class="source">InventorySpot</a></font>(MoveTarget).markedItem;
<a name="1970"></a>        <font class="source_keyword">if</font> ( goalItem == <font class="source_keyword">None</font> ) <font class="source_comment">// FIXME REMOVE
</font><a name="1971"></a>        {
<a name="1972"></a>            log(<font class="source_string">" No marked item for "</font>$MoveTarget);
<a name="1973"></a>            <font class="source_keyword">return</font>;
<a name="1974"></a>        }
<a name="1975"></a>
<a name="1976"></a>        <font class="source_keyword">if</font> ( goalItem.IsA(<font class="source_name">'Weapon'</font>) )
<a name="1977"></a>        {
<a name="1978"></a>            <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> == <font class="source_keyword">None</font>) || (<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.AIRating &lt; <font class="source_int">0.45</font>) )
<a name="1979"></a>                <font class="source_keyword">return</font>;
<a name="1980"></a>            bHaveItem = (FindInventoryType(goalItem.<font class="source_keyword">class</font>) != <font class="source_keyword">None</font>);
<a name="1981"></a>        }
<a name="1982"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( goalItem.IsA(<font class="source_name">'Health'</font>) )
<a name="1983"></a>        {
<a name="1984"></a>            bIsHealth = <font class="source_keyword">true</font>;
<a name="1985"></a>            <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt; <font class="source_int">60</font> )
<a name="1986"></a>                <font class="source_keyword">return</font>;
<a name="1987"></a>        }
<a name="1988"></a>        <font class="source_keyword">else</font> 
<a name="1989"></a>            <font class="source_keyword">return</font>;
<a name="1990"></a>
<a name="1991"></a>        CampTime = <font class="source_int">2.0</font>;
<a name="1992"></a>
<a name="1993"></a>        <font class="source_keyword">for</font> ( P=<font class="source_type">Level</font>.PawnList; P!=<font class="source_keyword">None</font>; P=P.nextPawn )
<a name="1994"></a>            <font class="source_keyword">if</font> ( P.bIsPlayer && (P.<font class="source_type"><a href="..\engine\playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></font>.Team == <font class="source_type"><a href="..\engine\playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></font>.Team)
<a name="1995"></a>                && ((P.MoveTarget == MoveTarget) || (P.MoveTarget == goalItem) 
<a name="1996"></a>                    || (!bIsHealth && P.IsA(<font class="source_name">'PlayerPawn'</font>) && !P.IsA(<font class="source_name">'Spectator'</font>) 
<a name="1997"></a>                        && (VSize(P.Location - Location) &lt; <font class="source_int">1250</font>) && LineOfSightTo(P))) )
<a name="1998"></a>            {
<a name="1999"></a>                <font class="source_comment">//decide who needs it more
</font><a name="2000"></a>                <font class="source_keyword">if</font> ( bIsHealth )
<a name="2001"></a>                {
<a name="2002"></a>                    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &gt; P.<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> + <font class="source_int">10</font> )
<a name="2003"></a>                    {
<a name="2004"></a>                        GotoState(<font class="source_name">'Roaming'</font>, <font class="source_name">'GiveWay'</font>);
<a name="2005"></a>                        <font class="source_keyword">return</font>;
<a name="2006"></a>                    }
<a name="2007"></a>                    <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( (P.IsInState(<font class="source_name">'Roaming'</font>)) && (<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt; P.<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> - <font class="source_int">10</font>) )
<a name="2008"></a>                        P.GotoState(<font class="source_name">'Roaming'</font>, <font class="source_name">'GiveWay'</font>);
<a name="2009"></a>                }
<a name="2010"></a>                <font class="source_keyword">else</font>
<a name="2011"></a>                {
<a name="2012"></a>                    bOtherHas = (P.FindInventoryType(goalItem.<font class="source_keyword">class</font>) != <font class="source_keyword">None</font>);
<a name="2013"></a>                    <font class="source_keyword">if</font> ( !bHaveItem && bOtherHas )
<a name="2014"></a>                    {
<a name="2015"></a>                        <font class="source_keyword">if</font> ( P.IsInState(<font class="source_name">'Roaming'</font>) )
<a name="2016"></a>                            P.GotoState(<font class="source_name">'Roaming'</font>, <font class="source_name">'GiveWay'</font>);  
<a name="2017"></a>                    }                   
<a name="2018"></a>                    <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( bHaveItem && !bOtherHas )
<a name="2019"></a>                    {
<a name="2020"></a>                        GotoState(<font class="source_name">'Roaming'</font>, <font class="source_name">'GiveWay'</font>);
<a name="2021"></a>                        <font class="source_keyword">return</font>;
<a name="2022"></a>                    }
<a name="2023"></a>                }
<a name="2024"></a>            }
<a name="2025"></a>    }
<a name="2026"></a>                         
<a name="2027"></a>    <font class="source_keyword">function</font> BeginState()
<a name="2028"></a>    {
<a name="2029"></a>        bNoShootDecor = <font class="source_keyword">false</font>;
<a name="2030"></a>        bCanFire = <font class="source_keyword">false</font>;
<a name="2031"></a>        bCamping = <font class="source_keyword">false</font>;
<a name="2032"></a>        <font class="source_keyword">if</font> ( bNoClearSpecial )
<a name="2033"></a>            bNoClearSpecial = <font class="source_keyword">false</font>;
<a name="2034"></a>        <font class="source_keyword">else</font>
<a name="2035"></a>        {
<a name="2036"></a>            bSpecialPausing = <font class="source_keyword">false</font>;
<a name="2037"></a>            bSpecialGoal = <font class="source_keyword">false</font>;
<a name="2038"></a>            SpecialGoal = <font class="source_keyword">None</font>;
<a name="2039"></a>            SpecialPause = <font class="source_int">0.0</font>;
<a name="2040"></a>        }
<a name="2041"></a>    }
<a name="2042"></a>
<a name="2043"></a>    <font class="source_keyword">function</font> EndState()
<a name="2044"></a>    {
<a name="2045"></a>        <font class="source_keyword">if</font> ( AmbushSpot != <font class="source_keyword">None</font> )
<a name="2046"></a>        {
<a name="2047"></a>            AmbushSpot.taken = <font class="source_keyword">false</font>;
<a name="2048"></a>            <font class="source_keyword">if</font> ( Enemy != <font class="source_keyword">None</font> )
<a name="2049"></a>                AmbushSpot = <font class="source_keyword">None</font>;
<a name="2050"></a>        }
<a name="2051"></a>        bCamping = <font class="source_keyword">false</font>;
<a name="2052"></a>        bWallAdjust = <font class="source_keyword">false</font>;
<a name="2053"></a>    }
<a name="2054"></a>
<a name="2055"></a>LongCamp:
<a name="2056"></a>    bCamping = <font class="source_keyword">true</font>;
<a name="2057"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2058"></a>    TweenToWaiting(<font class="source_int">0.15</font>);
<a name="2059"></a>    <font class="source_keyword">if</font> ( OrderObject.IsA(<font class="source_name">'AmbushPoint'</font>) )
<a name="2060"></a>        TurnTo(Location + (<font class="source_type"><a href="..\engine\ambushpoint.html" class="source">Ambushpoint</a></font>(OrderObject)).lookdir);
<a name="2061"></a>    Sleep(CampTime);
<a name="2062"></a>    Goto(<font class="source_name">'Begin'</font>);
<a name="2063"></a>
<a name="2064"></a>GiveWay:    
<a name="2065"></a>    <font class="source_comment">// log("sharing");	
</font><a name="2066"></a>    bCamping = <font class="source_keyword">true</font>;
<a name="2067"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2068"></a>    TweenToWaiting(<font class="source_int">0.15</font>);
<a name="2069"></a>    <font class="source_keyword">if</font> ( NearWall(<font class="source_int">200</font>) )
<a name="2070"></a>    {
<a name="2071"></a>        PlayTurning();
<a name="2072"></a>        TurnTo(MoveTarget.Location);
<a name="2073"></a>    }
<a name="2074"></a>    Sleep(CampTime);
<a name="2075"></a>    Goto(<font class="source_name">'Begin'</font>);
<a name="2076"></a>
<a name="2077"></a>Camp:
<a name="2078"></a>    bCamping = <font class="source_keyword">true</font>;
<a name="2079"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2080"></a>    TweenToWaiting(<font class="source_int">0.15</font>);
<a name="2081"></a>ReCamp:
<a name="2082"></a>    <font class="source_keyword">if</font> ( NearWall(<font class="source_int">200</font>) )
<a name="2083"></a>    {
<a name="2084"></a>        PlayTurning();
<a name="2085"></a>        TurnTo(Focus);
<a name="2086"></a>    }
<a name="2087"></a>    Sleep(CampTime);
<a name="2088"></a>    <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != <font class="source_keyword">None</font>) && (<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.AIRating &gt; <font class="source_int">0.4</font>) && (<font class="source_int">3</font> * FRand() &gt; skill + <font class="source_int">1</font>) )
<a name="2089"></a>        Goto(<font class="source_name">'ReCamp'</font>);
<a name="2090"></a>Begin:
<a name="2091"></a>    bCamping = <font class="source_keyword">false</font>;
<a name="2092"></a>    TweenToRunning(<font class="source_int">0.1</font>);
<a name="2093"></a>    WaitForLanding();
<a name="2094"></a>    
<a name="2095"></a>RunAway:
<a name="2096"></a>    PickDestination();
<a name="2097"></a>SpecialNavig:
<a name="2098"></a>    <font class="source_keyword">if</font> (SpecialPause &gt; <font class="source_int">0.0</font>)
<a name="2099"></a>    {
<a name="2100"></a>        Disable(<font class="source_name">'AnimEnd'</font>);
<a name="2101"></a>        Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2102"></a>        TweenToPatrolStop(<font class="source_int">0.3</font>);
<a name="2103"></a>        Sleep(SpecialPause);
<a name="2104"></a>        SpecialPause = <font class="source_int">0.0</font>;
<a name="2105"></a>        Enable(<font class="source_name">'AnimEnd'</font>);
<a name="2106"></a>        TweenToRunning(<font class="source_int">0.1</font>);
<a name="2107"></a>        Goto(<font class="source_name">'RunAway'</font>);
<a name="2108"></a>    }
<a name="2109"></a>Moving:
<a name="2110"></a>    <font class="source_keyword">if</font> ( !IsAnimating() )
<a name="2111"></a>        AnimEnd();
<a name="2112"></a>    <font class="source_keyword">if</font> ( MoveTarget == <font class="source_keyword">None</font> )
<a name="2113"></a>    {
<a name="2114"></a>        Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2115"></a>        Sleep(<font class="source_int">0.0</font>);
<a name="2116"></a>        Goto(<font class="source_name">'RunAway'</font>);
<a name="2117"></a>    }
<a name="2118"></a>    <font class="source_keyword">if</font> ( MoveTarget.IsA(<font class="source_name">'InventorySpot'</font>) ) 
<a name="2119"></a>    {
<a name="2120"></a>        <font class="source_keyword">if</font> ( <font class="source_type">Level</font>.Game.bTeamGame )
<a name="2121"></a>            ShareWithTeam();
<a name="2122"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\inventoryspot.html" class="source">InventorySpot</a></font>(MoveTarget).markedItem.BotDesireability(self) &gt; <font class="source_int">0</font> )
<a name="2123"></a>        {
<a name="2124"></a>            <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\inventoryspot.html" class="source">InventorySpot</a></font>(MoveTarget).markedItem.GetStateName() == <font class="source_name">'Pickup'</font> )
<a name="2125"></a>                MoveTarget = <font class="source_type"><a href="..\engine\inventoryspot.html" class="source">InventorySpot</a></font>(MoveTarget).markedItem;
<a name="2126"></a>            <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( VSize(Location - MoveTarget.Location) &lt; CollisionRadius )
<a name="2127"></a>            {
<a name="2128"></a>                CampTime = <font class="source_int">3.5</font> + FRand() - skill;
<a name="2129"></a>                Goto(<font class="source_name">'Camp'</font>);
<a name="2130"></a>            }
<a name="2131"></a>        }
<a name="2132"></a>    }
<a name="2133"></a>    bCamping = <font class="source_keyword">false</font>;
<a name="2134"></a>    MoveToward(MoveTarget);
<a name="2135"></a>    Goto(<font class="source_name">'RunAway'</font>);
<a name="2136"></a>
<a name="2137"></a>TakeHit:
<a name="2138"></a>    TweenToRunning(<font class="source_int">0.12</font>);
<a name="2139"></a>    Goto(<font class="source_name">'Moving'</font>);
<a name="2140"></a>
<a name="2141"></a>Landed:
<a name="2142"></a>    <font class="source_keyword">if</font> ( MoveTarget == <font class="source_keyword">None</font> ) <font class="source_comment">//FIXME - do this in all landed: !!!
</font><a name="2143"></a>        Goto(<font class="source_name">'RunAway'</font>);
<a name="2144"></a>    Goto(<font class="source_name">'Moving'</font>);
<a name="2145"></a>
<a name="2146"></a>AdjustFromWall:
<a name="2147"></a>    bWallAdjust = <font class="source_keyword">true</font>;
<a name="2148"></a>    bCamping = <font class="source_keyword">false</font>;
<a name="2149"></a>    StrafeTo(Destination, Focus); 
<a name="2150"></a>    Destination = Focus; 
<a name="2151"></a>    MoveTo(Destination);
<a name="2152"></a>    bWallAdjust = <font class="source_keyword">false</font>;
<a name="2153"></a>    Goto(<font class="source_name">'Moving'</font>);
<a name="2154"></a>
<a name="2155"></a>ShootDecoration:
<a name="2156"></a>    TurnToward(Target);
<a name="2157"></a>    <font class="source_keyword">if</font> ( Target != <font class="source_keyword">None</font> )
<a name="2158"></a>    {
<a name="2159"></a>        FireWeapon();
<a name="2160"></a>        bAltFire = <font class="source_int">0</font>;
<a name="2161"></a>        bFire = <font class="source_int">0</font>;
<a name="2162"></a>    }
<a name="2163"></a>    Goto(<font class="source_name">'RunAway'</font>);
<a name="2164"></a>}
<a name="2165"></a>
<a name="2166"></a><font class="source_keyword">state</font> Wandering
<a name="2167"></a>{
<a name="2168"></a>    <font class="source_keyword">ignores</font> EnemyNotVisible;
<a name="2169"></a>
<a name="2170"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="2171"></a>                        <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="2172"></a>    {
<a name="2173"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="2174"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="2175"></a>            <font class="source_keyword">return</font>;
<a name="2176"></a>        <font class="source_keyword">if</font> ( Enemy != <font class="source_keyword">None</font> )
<a name="2177"></a>            LastSeenPos = Enemy.Location;
<a name="2178"></a>
<a name="2179"></a>        <font class="source_keyword">if</font> ( NextState == <font class="source_name">'TakeHit'</font> )
<a name="2180"></a>            {
<a name="2181"></a>            NextState = <font class="source_name">'Attacking'</font>; 
<a name="2182"></a>            NextLabel = <font class="source_name">'Begin'</font>;
<a name="2183"></a>            GotoState(<font class="source_name">'TakeHit'</font>); 
<a name="2184"></a>            }
<a name="2185"></a>        <font class="source_keyword">else</font>
<a name="2186"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="2187"></a>    }
<a name="2188"></a>
<a name="2189"></a>    <font class="source_keyword">function</font> Timer()
<a name="2190"></a>    {
<a name="2191"></a>        Enable(<font class="source_name">'Bump'</font>);
<a name="2192"></a>    }
<a name="2193"></a>
<a name="2194"></a>    <font class="source_keyword">function</font> SetFall()
<a name="2195"></a>    {
<a name="2196"></a>        NextState = <font class="source_name">'Wandering'</font>; 
<a name="2197"></a>        NextLabel = <font class="source_name">'ContinueWander'</font>;
<a name="2198"></a>        NextAnim = AnimSequence;
<a name="2199"></a>        GotoState(<font class="source_name">'FallingState'</font>); 
<a name="2200"></a>    }
<a name="2201"></a>
<a name="2202"></a>    <font class="source_keyword">function</font> EnemyAcquired()
<a name="2203"></a>    {
<a name="2204"></a>        GotoState(<font class="source_name">'Acquisition'</font>);
<a name="2205"></a>    }
<a name="2206"></a>
<a name="2207"></a>    <font class="source_keyword">function</font> HitWall(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal, <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Wall)
<a name="2208"></a>    {
<a name="2209"></a>        <font class="source_keyword">if</font> (Physics == PHYS_Falling)
<a name="2210"></a>            <font class="source_keyword">return</font>;
<a name="2211"></a>        <font class="source_keyword">if</font> ( Wall.IsA(<font class="source_name">'Mover'</font>) && <font class="source_type"><a href="..\engine\mover.html" class="source">Mover</a></font>(Wall).HandleDoor(self) )
<a name="2212"></a>        {
<a name="2213"></a>            <font class="source_keyword">if</font> ( SpecialPause &gt; <font class="source_int">0</font> )
<a name="2214"></a>                Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2215"></a>            GotoState(<font class="source_name">'Wandering'</font>, <font class="source_name">'Pausing'</font>);
<a name="2216"></a>            <font class="source_keyword">return</font>;
<a name="2217"></a>        }
<a name="2218"></a>        Focus = Destination;
<a name="2219"></a>        <font class="source_keyword">if</font> (PickWallAdjust())
<a name="2220"></a>            GotoState(<font class="source_name">'Wandering'</font>, <font class="source_name">'AdjustFromWall'</font>);
<a name="2221"></a>        <font class="source_keyword">else</font>
<a name="2222"></a>            MoveTimer = -<font class="source_int">1.0</font>;
<a name="2223"></a>    }
<a name="2224"></a>    
<a name="2225"></a>    <font class="source_keyword">function</font> <font class="source_keyword">bool</font> TestDirection(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> dir, <font class="source_keyword2">out</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> pick)
<a name="2226"></a>    {   
<a name="2227"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, HitNormal, dist;
<a name="2228"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> minDist;
<a name="2229"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="2230"></a>
<a name="2231"></a>        minDist = FMin(<font class="source_int">150.0</font>, <font class="source_int">4</font>*CollisionRadius);
<a name="2232"></a>        pick = dir * (minDist + (<font class="source_int">450</font> + <font class="source_int">12</font> * CollisionRadius) * FRand());
<a name="2233"></a>
<a name="2234"></a>        HitActor = Trace(HitLocation, HitNormal, Location + pick + <font class="source_int">1.5</font> * CollisionRadius * dir , Location, <font class="source_keyword">false</font>);
<a name="2235"></a>        <font class="source_keyword">if</font> (HitActor != <font class="source_keyword">None</font>)
<a name="2236"></a>        {
<a name="2237"></a>            pick = HitLocation + (HitNormal - dir) * <font class="source_int">2</font> * CollisionRadius;
<a name="2238"></a>            HitActor = Trace(HitLocation, HitNormal, pick , Location, <font class="source_keyword">false</font>);
<a name="2239"></a>            <font class="source_keyword">if</font> (HitActor != <font class="source_keyword">None</font>)
<a name="2240"></a>                <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="2241"></a>        }
<a name="2242"></a>        <font class="source_keyword">else</font>
<a name="2243"></a>            pick = Location + pick;
<a name="2244"></a>         
<a name="2245"></a>        dist = pick - Location;
<a name="2246"></a>        <font class="source_keyword">if</font> (Physics == PHYS_Walking)
<a name="2247"></a>            dist.Z = <font class="source_int">0</font>;
<a name="2248"></a>        
<a name="2249"></a>        <font class="source_keyword">return</font> (VSize(dist) &gt; minDist); 
<a name="2250"></a>    }
<a name="2251"></a>            
<a name="2252"></a>    <font class="source_keyword">function</font> PickDestination()
<a name="2253"></a>    {
<a name="2254"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> pick, pickdir;
<a name="2255"></a>        <font class="source_keyword">local</font> <font class="source_keyword">bool</font> success;
<a name="2256"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> XY;
<a name="2257"></a>        <font class="source_comment">//Favor XY alignment
</font><a name="2258"></a>        XY = FRand();
<a name="2259"></a>        <font class="source_keyword">if</font> (XY &lt; <font class="source_int">0.3</font>)
<a name="2260"></a>        {
<a name="2261"></a>            pickdir.X = <font class="source_int">1</font>;
<a name="2262"></a>            pickdir.Y = <font class="source_int">0</font>;
<a name="2263"></a>        }
<a name="2264"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> (XY &lt; <font class="source_int">0.6</font>)
<a name="2265"></a>        {
<a name="2266"></a>            pickdir.X = <font class="source_int">0</font>;
<a name="2267"></a>            pickdir.Y = <font class="source_int">1</font>;
<a name="2268"></a>        }
<a name="2269"></a>        <font class="source_keyword">else</font>
<a name="2270"></a>        {
<a name="2271"></a>            pickdir.X = <font class="source_int">2</font> * FRand() - <font class="source_int">1</font>;
<a name="2272"></a>            pickdir.Y = <font class="source_int">2</font> * FRand() - <font class="source_int">1</font>;
<a name="2273"></a>        }
<a name="2274"></a>        <font class="source_keyword">if</font> (Physics != PHYS_Walking)
<a name="2275"></a>        {
<a name="2276"></a>            pickdir.Z = <font class="source_int">2</font> * FRand() - <font class="source_int">1</font>;
<a name="2277"></a>            pickdir = Normal(pickdir);
<a name="2278"></a>        }
<a name="2279"></a>        <font class="source_keyword">else</font>
<a name="2280"></a>        {
<a name="2281"></a>            pickdir.Z = <font class="source_int">0</font>;
<a name="2282"></a>            <font class="source_keyword">if</font> (XY &gt;= <font class="source_int">0.6</font>)
<a name="2283"></a>                pickdir = Normal(pickdir);
<a name="2284"></a>        }   
<a name="2285"></a>
<a name="2286"></a>        success = TestDirection(pickdir, pick);
<a name="2287"></a>        <font class="source_keyword">if</font> (!success)
<a name="2288"></a>            success = TestDirection(-<font class="source_int">1</font> * pickdir, pick);
<a name="2289"></a>        
<a name="2290"></a>        <font class="source_keyword">if</font> (success)    
<a name="2291"></a>            Destination = pick;
<a name="2292"></a>        <font class="source_keyword">else</font>
<a name="2293"></a>            GotoState(<font class="source_name">'Wandering'</font>, <font class="source_name">'Turn'</font>);
<a name="2294"></a>    }
<a name="2295"></a>
<a name="2296"></a>    <font class="source_keyword">function</font> AnimEnd()
<a name="2297"></a>    {
<a name="2298"></a>        PlayPatrolStop();
<a name="2299"></a>    }
<a name="2300"></a>
<a name="2301"></a>    <font class="source_keyword">function</font> FearThisSpot(<font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> aSpot)
<a name="2302"></a>    {
<a name="2303"></a>        Destination = Location + <font class="source_int">120</font> * Normal(Location - aSpot.Location); 
<a name="2304"></a>    }
<a name="2305"></a>
<a name="2306"></a>    <font class="source_keyword">function</font> BeginState()
<a name="2307"></a>    {
<a name="2308"></a>        Enemy = <font class="source_keyword">None</font>;
<a name="2309"></a>        SetAlertness(<font class="source_int">0.2</font>);
<a name="2310"></a>        bReadyToAttack = <font class="source_keyword">false</font>;
<a name="2311"></a>        Disable(<font class="source_name">'AnimEnd'</font>);
<a name="2312"></a>        NextAnim = <font class="source_name">''</font>;
<a name="2313"></a>        bCanJump = <font class="source_keyword">false</font>;
<a name="2314"></a>    }
<a name="2315"></a>    
<a name="2316"></a>    <font class="source_keyword">function</font> EndState()
<a name="2317"></a>    {
<a name="2318"></a>        <font class="source_keyword">if</font> (JumpZ &gt; <font class="source_int">0</font>)
<a name="2319"></a>            bCanJump = <font class="source_keyword">true</font>;
<a name="2320"></a>    }
<a name="2321"></a>
<a name="2322"></a>
<a name="2323"></a>Begin:
<a name="2324"></a>    <font class="source_comment">//log(class$" Wandering");
</font><a name="2325"></a>
<a name="2326"></a>Wander: 
<a name="2327"></a>    WaitForLanding();
<a name="2328"></a>    PickDestination();
<a name="2329"></a>    TweenToWalking(<font class="source_int">0.2</font>);
<a name="2330"></a>    FinishAnim();
<a name="2331"></a>    PlayWalking();
<a name="2332"></a>    
<a name="2333"></a>Moving:
<a name="2334"></a>    Enable(<font class="source_name">'HitWall'</font>);
<a name="2335"></a>    MoveTo(Destination, WalkingSpeed);
<a name="2336"></a>Pausing:
<a name="2337"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2338"></a>    <font class="source_keyword">if</font> ( NearWall(<font class="source_int">200</font>) )
<a name="2339"></a>    {
<a name="2340"></a>        PlayTurning();
<a name="2341"></a>        TurnTo(Focus);
<a name="2342"></a>    }
<a name="2343"></a>    Enable(<font class="source_name">'AnimEnd'</font>);
<a name="2344"></a>    NextAnim = <font class="source_name">''</font>;
<a name="2345"></a>    TweenToPatrolStop(<font class="source_int">0.2</font>);
<a name="2346"></a>    Sleep(<font class="source_int">1.0</font>);
<a name="2347"></a>    Disable(<font class="source_name">'AnimEnd'</font>);
<a name="2348"></a>    FinishAnim();
<a name="2349"></a>    GotoState(<font class="source_name">'Roaming'</font>);
<a name="2350"></a>
<a name="2351"></a>ContinueWander:
<a name="2352"></a>    FinishAnim();
<a name="2353"></a>    PlayWalking();
<a name="2354"></a>    <font class="source_keyword">if</font> (FRand() &lt; <font class="source_int">0.2</font>)
<a name="2355"></a>        Goto(<font class="source_name">'Turn'</font>);
<a name="2356"></a>    Goto(<font class="source_name">'Wander'</font>);
<a name="2357"></a>
<a name="2358"></a>Turn:
<a name="2359"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2360"></a>    PlayTurning();
<a name="2361"></a>    TurnTo(Location + <font class="source_int">20</font> * VRand());
<a name="2362"></a>    Goto(<font class="source_name">'Pausing'</font>);
<a name="2363"></a>
<a name="2364"></a>AdjustFromWall:
<a name="2365"></a>    StrafeTo(Destination, Focus); 
<a name="2366"></a>    Destination = Focus; 
<a name="2367"></a>    Goto(<font class="source_name">'Moving'</font>);
<a name="2368"></a>}
<a name="2369"></a>    
<a name="2370"></a><font class="source_comment">/* Acquisition - 
<a name="2371"></a>Creature has just reacted to stimulus, and set an enemy
<a name="2372"></a>- depending on strength of stimulus, and ongoing stimulii, vary time to focus on target and start attacking (or whatever.  FIXME - need some acquisition specific animation
<a name="2373"></a>HearNoise and SeePlayer used to improve/change stimulus
<a name="2374"></a>*/</font>
<a name="2375"></a>
<a name="2376"></a><font class="source_keyword">state</font> Acquisition
<a name="2377"></a>{
<a name="2378"></a><font class="source_keyword">ignores</font> falling, landed; <font class="source_comment">//fixme
</font><a name="2379"></a>
<a name="2380"></a>    <font class="source_keyword">function</font> WarnTarget(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> shooter, <font class="source_keyword">float</font> projSpeed, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> FireDir)
<a name="2381"></a>    {
<a name="2382"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\pawn.html#EAttitude" class="source">eAttitude</a></font> att;
<a name="2383"></a>
<a name="2384"></a>        att = AttitudeTo(shooter);
<a name="2385"></a>        <font class="source_keyword">if</font> ( ((att == ATTITUDE_Ignore) || (att == ATTITUDE_Threaten)) )
<a name="2386"></a>            damageAttitudeTo(shooter);
<a name="2387"></a>    }
<a name="2388"></a>
<a name="2389"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="2390"></a>                            <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="2391"></a>    {
<a name="2392"></a>        LastSeenPos = Enemy.Location;
<a name="2393"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="2394"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="2395"></a>            <font class="source_keyword">return</font>;
<a name="2396"></a>        <font class="source_keyword">if</font> (NextState == <font class="source_name">'TakeHit'</font>)
<a name="2397"></a>        {
<a name="2398"></a>            NextState = <font class="source_name">'Attacking'</font>; 
<a name="2399"></a>            NextLabel = <font class="source_name">'Begin'</font>;
<a name="2400"></a>            GotoState(<font class="source_name">'TakeHit'</font>); 
<a name="2401"></a>        }
<a name="2402"></a>        <font class="source_keyword">else</font>
<a name="2403"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="2404"></a>    }
<a name="2405"></a>    
<a name="2406"></a>    <font class="source_keyword">function</font> HearNoise(<font class="source_keyword">float</font> Loudness, <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> NoiseMaker)
<a name="2407"></a>    {
<a name="2408"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> OldLastSeenPos;
<a name="2409"></a>        
<a name="2410"></a>        <font class="source_keyword">if</font> ( SetEnemy(NoiseMaker.instigator) )
<a name="2411"></a>        {
<a name="2412"></a>            OldLastSeenPos = LastSeenPos;
<a name="2413"></a>            <font class="source_keyword">if</font> ( Enemy ==  NoiseMaker.instigator  )
<a name="2414"></a>                LastSeenPos = <font class="source_int">0.5</font> * (NoiseMaker.Location + VSize(NoiseMaker.Location - Location) * <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font>(Rotation));
<a name="2415"></a>            <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(NoiseMaker) != <font class="source_keyword">None</font>) && (Enemy == <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(NoiseMaker).Enemy) )
<a name="2416"></a>                LastSeenPos = <font class="source_int">0.5</font> * (<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(NoiseMaker).Enemy.Location + VSize(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(NoiseMaker).Enemy.Location - Location) * <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font>(Rotation));
<a name="2417"></a>            <font class="source_keyword">if</font> ( VSize(OldLastSeenPos - Enemy.Location) &lt; VSize(LastSeenPos - Enemy.Location) )
<a name="2418"></a>                LastSeenPos = OldLastSeenPos;               
<a name="2419"></a>        }
<a name="2420"></a>        
<a name="2421"></a>    }
<a name="2422"></a>    
<a name="2423"></a>    <font class="source_keyword">function</font> SeePlayer(<font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> SeenPlayer)
<a name="2424"></a>    {
<a name="2425"></a>        <font class="source_keyword">if</font> ( SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(SeenPlayer)) )
<a name="2426"></a>        {
<a name="2427"></a>            MakeNoise(<font class="source_int">1.0</font>);
<a name="2428"></a>            NextAnim = <font class="source_name">''</font>;
<a name="2429"></a>            LastSeenPos = Enemy.Location;
<a name="2430"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="2431"></a>        }
<a name="2432"></a>    } 
<a name="2433"></a>    
<a name="2434"></a>    <font class="source_keyword">function</font> BeginState()
<a name="2435"></a>    {
<a name="2436"></a>        <font class="source_keyword">if</font> (<font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font>)
<a name="2437"></a>            log(self$<font class="source_string">" acquisition while dead"</font>);
<a name="2438"></a>        Disable(<font class="source_name">'Tick'</font>); <font class="source_comment">//only used for bounding anim time
</font><a name="2439"></a>        SetAlertness(-<font class="source_int">0.5</font>);
<a name="2440"></a>    }
<a name="2441"></a>    
<a name="2442"></a>PlayOut:
<a name="2443"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2444"></a>    <font class="source_keyword">if</font> ( (AnimFrame &lt; <font class="source_int">0.6</font>) && IsAnimating() )
<a name="2445"></a>    {
<a name="2446"></a>        Sleep(<font class="source_int">0.05</font>);
<a name="2447"></a>        Goto(<font class="source_name">'PlayOut'</font>);
<a name="2448"></a>    }
<a name="2449"></a>        
<a name="2450"></a>Begin:
<a name="2451"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2452"></a>    <font class="source_keyword">if</font> (NeedToTurn(LastSeenPos))
<a name="2453"></a>    {   
<a name="2454"></a>        PlayTurning();
<a name="2455"></a>        TurnTo(LastSeenPos);
<a name="2456"></a>    }
<a name="2457"></a>    DesiredRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(LastSeenPos - Location);
<a name="2458"></a>    TweenToFighter(<font class="source_int">0.2</font>); 
<a name="2459"></a>    FinishAnim();   
<a name="2460"></a>    <font class="source_comment">////log("Stimulus = "$Stimulus);
</font><a name="2461"></a>    <font class="source_keyword">if</font> ( AttitudeTo(Enemy) == ATTITUDE_Fear )  <font class="source_comment">//will run away from noise
</font><a name="2462"></a>    {
<a name="2463"></a>        LastSeenPos = Enemy.Location; 
<a name="2464"></a>        MakeNoise(<font class="source_int">1.0</font>);
<a name="2465"></a>        NextAnim = <font class="source_name">''</font>;
<a name="2466"></a>        GotoState(<font class="source_name">'Attacking'</font>);
<a name="2467"></a>    }
<a name="2468"></a>    <font class="source_keyword">else</font> <font class="source_comment">//investigate noise
</font><a name="2469"></a>    {
<a name="2470"></a>        <font class="source_comment">////log("investigate noise");
</font><a name="2471"></a>        <font class="source_keyword">if</font> ( pointReachable((Location + LastSeenPos) * <font class="source_int">0.5</font>) )
<a name="2472"></a>        {
<a name="2473"></a>            TweenToWalking(<font class="source_int">0.3</font>);
<a name="2474"></a>            FinishAnim();
<a name="2475"></a>            PlayWalking();
<a name="2476"></a>            MoveTo((Location + LastSeenPos) * <font class="source_int">0.5</font>, WalkingSpeed);
<a name="2477"></a>            Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2478"></a>        }
<a name="2479"></a>        WhatToDoNext(<font class="source_name">''</font>,<font class="source_name">''</font>);
<a name="2480"></a>    }
<a name="2481"></a>}
<a name="2482"></a>
<a name="2483"></a><font class="source_comment">/* Attacking
<a name="2484"></a>Master attacking state - choose which type of attack to do from here
<a name="2485"></a>*/</font>
<a name="2486"></a><font class="source_keyword">state</font> Attacking
<a name="2487"></a>{
<a name="2488"></a><font class="source_keyword">ignores</font> SeePlayer, HearNoise, Bump, HitWall;
<a name="2489"></a>
<a name="2490"></a>    <font class="source_keyword">function</font> ChooseAttackMode()
<a name="2491"></a>    {
<a name="2492"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\pawn.html#EAttitude" class="source">eAttitude</a></font> AttitudeToEnemy;
<a name="2493"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> Aggression;
<a name="2494"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\pawn.html" class="source">pawn</a></font> changeEn;
<a name="2495"></a>
<a name="2496"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="2497"></a>            log(self$<font class="source_string">" choose attack while dead"</font>);      
<a name="2498"></a>        <font class="source_keyword">if</font> ((Enemy == <font class="source_keyword">None</font>) || (Enemy.<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font>))
<a name="2499"></a>        {
<a name="2500"></a>            WhatToDoNext(<font class="source_name">''</font>,<font class="source_name">''</font>);
<a name="2501"></a>            <font class="source_keyword">return</font>;
<a name="2502"></a>        }
<a name="2503"></a>            
<a name="2504"></a>        AttitudeToEnemy = AttitudeTo(Enemy);
<a name="2505"></a>            
<a name="2506"></a>        <font class="source_keyword">if</font> (AttitudeToEnemy == ATTITUDE_Fear)
<a name="2507"></a>        {
<a name="2508"></a>            GotoState(<font class="source_name">'Retreating'</font>);
<a name="2509"></a>            <font class="source_keyword">return</font>;
<a name="2510"></a>        }
<a name="2511"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> (AttitudeToEnemy == ATTITUDE_Friendly)
<a name="2512"></a>        {
<a name="2513"></a>            WhatToDoNext(<font class="source_name">''</font>,<font class="source_name">''</font>);
<a name="2514"></a>            <font class="source_keyword">return</font>;
<a name="2515"></a>        }
<a name="2516"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( !LineOfSightTo(Enemy) )
<a name="2517"></a>        {
<a name="2518"></a>            <font class="source_keyword">if</font> ( (OldEnemy != <font class="source_keyword">None</font>) 
<a name="2519"></a>                && (AttitudeTo(OldEnemy) == ATTITUDE_Hate) && LineOfSightTo(OldEnemy) )
<a name="2520"></a>            {
<a name="2521"></a>                changeEn = enemy;
<a name="2522"></a>                enemy = oldenemy;
<a name="2523"></a>                oldenemy = changeEn;
<a name="2524"></a>            }   
<a name="2525"></a>            <font class="source_keyword">else</font> 
<a name="2526"></a>            {
<a name="2527"></a>                <font class="source_keyword">if</font> ( VSize(Enemy.Location - Location) 
<a name="2528"></a>                            &gt; <font class="source_int">600</font> + (FRand() * RelativeStrength(Enemy) - CombatStyle) * <font class="source_int">600</font> )
<a name="2529"></a>                    GotoState(<font class="source_name">'Hunting'</font>);
<a name="2530"></a>                <font class="source_keyword">else</font>
<a name="2531"></a>                {
<a name="2532"></a>                    HuntStartTime = <font class="source_type">Level</font>.TimeSeconds;
<a name="2533"></a>                    NumHuntPaths = <font class="source_int">0</font>; 
<a name="2534"></a>                    GotoState(<font class="source_name">'StakeOut'</font>);
<a name="2535"></a>                }
<a name="2536"></a>                <font class="source_keyword">return</font>;
<a name="2537"></a>            }
<a name="2538"></a>        }   
<a name="2539"></a>        
<a name="2540"></a>        <font class="source_keyword">if</font> (bReadyToAttack)
<a name="2541"></a>        {
<a name="2542"></a>            <font class="source_comment">////log("Attack!");
</font><a name="2543"></a>            Target = Enemy;
<a name="2544"></a>            <font class="source_keyword">If</font> (VSize(Enemy.Location - Location) &lt;= (MeleeRange + Enemy.CollisionRadius + CollisionRadius))
<a name="2545"></a>            {
<a name="2546"></a>                GotoState(<font class="source_name">'RangedAttack'</font>);
<a name="2547"></a>                <font class="source_keyword">return</font>;
<a name="2548"></a>            }
<a name="2549"></a>            <font class="source_keyword">else</font>
<a name="2550"></a>                SetTimer(TimeBetweenAttacks, <font class="source_keyword">False</font>);
<a name="2551"></a>        }
<a name="2552"></a>            
<a name="2553"></a>        GotoState(<font class="source_name">'TacticalMove'</font>);
<a name="2554"></a>        <font class="source_comment">//log("Next state is "$state);
</font><a name="2555"></a>    }
<a name="2556"></a>    
<a name="2557"></a>    <font class="source_comment">//EnemyNotVisible implemented so engine will update LastSeenPos
</font><a name="2558"></a>    <font class="source_keyword">function</font> EnemyNotVisible()
<a name="2559"></a>    {
<a name="2560"></a>        <font class="source_comment">////log("enemy not visible");
</font><a name="2561"></a>    }
<a name="2562"></a>
<a name="2563"></a>    <font class="source_keyword">function</font> Timer()
<a name="2564"></a>    {
<a name="2565"></a>        bReadyToAttack = <font class="source_keyword">True</font>;
<a name="2566"></a>    }
<a name="2567"></a>
<a name="2568"></a>    <font class="source_keyword">function</font> BeginState()
<a name="2569"></a>    {
<a name="2570"></a>        <font class="source_keyword">if</font> ( TimerRate &lt;= <font class="source_int">0.0</font> )
<a name="2571"></a>            SetTimer(TimeBetweenAttacks  * (<font class="source_int">1.0</font> + FRand()),<font class="source_keyword">false</font>); 
<a name="2572"></a>        <font class="source_keyword">if</font> (Physics == PHYS_None)
<a name="2573"></a>            SetMovementPhysics(); 
<a name="2574"></a>    }
<a name="2575"></a>
<a name="2576"></a>Begin:
<a name="2577"></a>    <font class="source_comment">//log(class$" choose Attack");
</font><a name="2578"></a>    ChooseAttackMode();
<a name="2579"></a>}
<a name="2580"></a>
<a name="2581"></a>
<a name="2582"></a><font class="source_comment">/* Retreating for a bot is going toward an item while still engaged with an enemy, but fearing that enemy (so
<a name="2583"></a>no desire to remain engaged)
<a name="2584"></a>   TacticalGet is for going to an item while engaged, and remaining engaged. TBD
<a name="2585"></a>   Roaming is going to items w/ no enemy. TBD
<a name="2586"></a>*/</font>
<a name="2587"></a>
<a name="2588"></a><font class="source_keyword">state</font> Retreating
<a name="2589"></a>{
<a name="2590"></a><font class="source_keyword">ignores</font> EnemyNotVisible;
<a name="2591"></a>
<a name="2592"></a>    <font class="source_keyword">function</font> WarnTarget(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> shooter, <font class="source_keyword">float</font> projSpeed, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> FireDir)
<a name="2593"></a>    {   
<a name="2594"></a>        <font class="source_keyword">if</font> ( bCanFire && (FRand() &lt; <font class="source_int">0.4</font>) ) 
<a name="2595"></a>            <font class="source_keyword">return</font>;
<a name="2596"></a>
<a name="2597"></a>        <font class="source_keyword">Super</font>.WarnTarget(shooter, projSpeed, FireDir);
<a name="2598"></a>    }
<a name="2599"></a>
<a name="2600"></a>    <font class="source_keyword">function</font> SeePlayer(<font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> SeenPlayer)
<a name="2601"></a>    {
<a name="2602"></a>        <font class="source_keyword">if</font> ( (SeenPlayer == Enemy) || LineOfSightTo(Enemy) )
<a name="2603"></a>            <font class="source_keyword">return</font>;
<a name="2604"></a>        <font class="source_keyword">if</font> ( SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(SeenPlayer)) )
<a name="2605"></a>        {
<a name="2606"></a>            LastSeenPos = SeenPlayer.Location;
<a name="2607"></a>            MakeNoise(<font class="source_int">1.0</font>);
<a name="2608"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="2609"></a>        }
<a name="2610"></a>    }
<a name="2611"></a>
<a name="2612"></a>    <font class="source_keyword">function</font> HearNoise(<font class="source_keyword">float</font> Loudness, <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> NoiseMaker)
<a name="2613"></a>    {
<a name="2614"></a>        <font class="source_keyword">if</font> ( (NoiseMaker.instigator == Enemy) || LineOfSightTo(Enemy) )
<a name="2615"></a>            <font class="source_keyword">return</font>;
<a name="2616"></a>
<a name="2617"></a>        <font class="source_keyword">if</font> ( SetEnemy(NoiseMaker.instigator) )
<a name="2618"></a>        {
<a name="2619"></a>            LastSeenPos = <font class="source_int">0.5</font> * (NoiseMaker.Location + VSize(NoiseMaker.Location - Location) * <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font>(Rotation));
<a name="2620"></a>            MakeNoise(<font class="source_int">1.0</font>);
<a name="2621"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="2622"></a>        }
<a name="2623"></a>    }
<a name="2624"></a>    
<a name="2625"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="2626"></a>                            <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="2627"></a>    {
<a name="2628"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="2629"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="2630"></a>            <font class="source_keyword">return</font>;
<a name="2631"></a>        <font class="source_keyword">if</font> (NextState == <font class="source_name">'TakeHit'</font>)
<a name="2632"></a>        {
<a name="2633"></a>            NextState = <font class="source_name">'Retreating'</font>; 
<a name="2634"></a>            NextLabel = <font class="source_name">'TakeHit'</font>;
<a name="2635"></a>            GotoState(<font class="source_name">'TakeHit'</font>); 
<a name="2636"></a>        }
<a name="2637"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( !bCanFire && (skill &gt; <font class="source_int">3</font> * FRand()) )
<a name="2638"></a>            GotoState(<font class="source_name">'Retreating'</font>, <font class="source_name">'Moving'</font>);
<a name="2639"></a>    }
<a name="2640"></a>
<a name="2641"></a>    <font class="source_keyword">function</font> Timer()
<a name="2642"></a>    {
<a name="2643"></a>        bReadyToAttack = <font class="source_keyword">True</font>;
<a name="2644"></a>        Enable(<font class="source_name">'Bump'</font>);
<a name="2645"></a>    }
<a name="2646"></a>    
<a name="2647"></a>    <font class="source_keyword">function</font> SetFall()
<a name="2648"></a>    {
<a name="2649"></a>        NextState = <font class="source_name">'Retreating'</font>; 
<a name="2650"></a>        NextLabel = <font class="source_name">'Landed'</font>;
<a name="2651"></a>        NextAnim = AnimSequence;
<a name="2652"></a>        GotoState(<font class="source_name">'FallingState'</font>); 
<a name="2653"></a>    }
<a name="2654"></a>
<a name="2655"></a>    <font class="source_keyword">function</font> HitWall(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal, <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Wall)
<a name="2656"></a>    {
<a name="2657"></a>        <font class="source_keyword">if</font> (Physics == PHYS_Falling)
<a name="2658"></a>            <font class="source_keyword">return</font>;
<a name="2659"></a>        <font class="source_keyword">if</font> ( Wall.IsA(<font class="source_name">'Mover'</font>) && <font class="source_type"><a href="..\engine\mover.html" class="source">Mover</a></font>(Wall).HandleDoor(self) )
<a name="2660"></a>        {
<a name="2661"></a>            <font class="source_keyword">if</font> ( SpecialPause &gt; <font class="source_int">0</font> )
<a name="2662"></a>                Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2663"></a>            GotoState(<font class="source_name">'Retreating'</font>, <font class="source_name">'SpecialNavig'</font>);
<a name="2664"></a>            <font class="source_keyword">return</font>;
<a name="2665"></a>        }
<a name="2666"></a>        Focus = Destination;
<a name="2667"></a>        <font class="source_keyword">if</font> (PickWallAdjust())
<a name="2668"></a>            GotoState(<font class="source_name">'Retreating'</font>, <font class="source_name">'AdjustFromWall'</font>);
<a name="2669"></a>        <font class="source_keyword">else</font>
<a name="2670"></a>            MoveTimer = -<font class="source_int">1.0</font>;
<a name="2671"></a>    }
<a name="2672"></a>
<a name="2673"></a>    <font class="source_keyword">function</font> PickDestination()
<a name="2674"></a>    {
<a name="2675"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\inventory.html" class="source">inventory</a></font> Inv, BestInv, SecondInv;
<a name="2676"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> Bestweight, NewWeight, invDist, MaxDist, SecondWeight;
<a name="2677"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> BestPath;
<a name="2678"></a>        <font class="source_keyword">local</font> <font class="source_keyword">bool</font> bTriedFar;
<a name="2679"></a>
<a name="2680"></a>        <font class="source_keyword">if</font> ( !bReadyToAttack && (TimerRate == <font class="source_int">0.0</font>) )
<a name="2681"></a>            SetTimer(<font class="source_int">0.7</font>, <font class="source_keyword">false</font>);
<a name="2682"></a>
<a name="2683"></a>        <font class="source_comment">// do I still fear my enemy?
</font><a name="2684"></a>        <font class="source_keyword">if</font> ( (Enemy == <font class="source_keyword">None</font>) || (AttitudeTo(Enemy) &gt; ATTITUDE_Fear) )
<a name="2685"></a>        {
<a name="2686"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="2687"></a>            <font class="source_keyword">return</font>;
<a name="2688"></a>        }
<a name="2689"></a>
<a name="2690"></a>        bestweight = <font class="source_int">0</font>;
<a name="2691"></a>
<a name="2692"></a>        <font class="source_comment">//first look at nearby inventory &lt; 500 dist
</font><a name="2693"></a>        <font class="source_comment">// FIXME reduce favoring of stuff nearer/visible to enemy
</font><a name="2694"></a>        MaxDist = <font class="source_int">500</font> + <font class="source_int">70</font> * skill;
<a name="2695"></a>        <font class="source_keyword">foreach</font> visiblecollidingactors(<font class="source_keyword">class</font><font class="source_name">'Inventory'</font>, Inv, MaxDist)
<a name="2696"></a>            <font class="source_keyword">if</font> ( (Inv.IsInState(<font class="source_name">'PickUp'</font>)) && (Inv.MaxDesireability/2<font class="source_int">00</font> &gt; BestWeight)
<a name="2697"></a>                && (Inv.Location.Z &lt; Location.Z + MaxStepHeight + CollisionHeight)
<a name="2698"></a>                && (Inv.Location.Z &gt; FMin(Location.Z, Enemy.Location.Z) - CollisionHeight) )
<a name="2699"></a>            {
<a name="2700"></a>                NewWeight = inv.BotDesireability(self)/VSize(Inv.Location - Location);
<a name="2701"></a>                <font class="source_keyword">if</font> ( NewWeight &gt; BestWeight )
<a name="2702"></a>                {
<a name="2703"></a>                    SecondWeight = BestWeight;
<a name="2704"></a>                    BestWeight = NewWeight;
<a name="2705"></a>                    SecondInv = BestInv;
<a name="2706"></a>                    BestInv = Inv;
<a name="2707"></a>                }
<a name="2708"></a>            }
<a name="2709"></a>
<a name="2710"></a>         <font class="source_comment">// see if better long distance inventory 
</font><a name="2711"></a>        <font class="source_keyword">if</font> ( BestWeight &lt; <font class="source_int">0.2</font> )
<a name="2712"></a>        { 
<a name="2713"></a>            bTriedFar = <font class="source_keyword">true</font>;
<a name="2714"></a>            BestPath = FindBestInventoryPath(BestWeight, <font class="source_keyword">false</font>);
<a name="2715"></a>            <font class="source_keyword">if</font> ( BestPath != <font class="source_keyword">None</font> )
<a name="2716"></a>            {
<a name="2717"></a>                MoveTarget = BestPath;
<a name="2718"></a>                <font class="source_keyword">return</font>;
<a name="2719"></a>            }
<a name="2720"></a>        }
<a name="2721"></a>
<a name="2722"></a>         <font class="source_comment">// if nothing, then tactical move
</font><a name="2723"></a>        <font class="source_keyword">if</font> ( (BestInv != <font class="source_keyword">None</font>) && ActorReachable(BestInv) )
<a name="2724"></a>        {
<a name="2725"></a>            MoveTarget = BestInv;
<a name="2726"></a>            <font class="source_keyword">return</font>;
<a name="2727"></a>        }
<a name="2728"></a>
<a name="2729"></a>        <font class="source_keyword">if</font> ( (SecondInv != <font class="source_keyword">None</font>) && ActorReachable(SecondInv) )
<a name="2730"></a>        {
<a name="2731"></a>            MoveTarget = BestInv;
<a name="2732"></a>            <font class="source_keyword">return</font>;
<a name="2733"></a>        }
<a name="2734"></a>        <font class="source_keyword">if</font> ( !bTriedFar )
<a name="2735"></a>        { 
<a name="2736"></a>            BestWeight = <font class="source_int">0</font>;
<a name="2737"></a>            BestPath = FindBestInventoryPath(BestWeight, <font class="source_keyword">false</font>);
<a name="2738"></a>            <font class="source_keyword">if</font> ( BestPath != <font class="source_keyword">None</font> )
<a name="2739"></a>            {
<a name="2740"></a>                MoveTarget = BestPath;
<a name="2741"></a>                <font class="source_keyword">return</font>;
<a name="2742"></a>            }
<a name="2743"></a>        }
<a name="2744"></a>
<a name="2745"></a>        LastInvFind = <font class="source_type">Level</font>.TimeSeconds;
<a name="2746"></a>        GotoState(<font class="source_name">'TacticalMove'</font>, <font class="source_name">'NoCharge'</font>);
<a name="2747"></a>    }
<a name="2748"></a>
<a name="2749"></a>
<a name="2750"></a>    <font class="source_keyword">function</font> ChangeDestination()
<a name="2751"></a>    {
<a name="2752"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> oldTarget;
<a name="2753"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> path;
<a name="2754"></a>        
<a name="2755"></a>        oldTarget = Home;
<a name="2756"></a>        PickDestination();
<a name="2757"></a>        <font class="source_keyword">if</font> (Home == oldTarget)
<a name="2758"></a>        {
<a name="2759"></a>            Aggressiveness += <font class="source_int">0.3</font>;
<a name="2760"></a>            <font class="source_comment">//log("same old target");
</font><a name="2761"></a>            GotoState(<font class="source_name">'TacticalMove'</font>, <font class="source_name">'TacticalTick'</font>);
<a name="2762"></a>        }
<a name="2763"></a>        <font class="source_keyword">else</font>
<a name="2764"></a>        {
<a name="2765"></a>            path = FindPathToward(Home);
<a name="2766"></a>            <font class="source_keyword">if</font> (path == <font class="source_keyword">None</font>)
<a name="2767"></a>            {
<a name="2768"></a>                <font class="source_comment">//log("no new target");
</font><a name="2769"></a>                Aggressiveness += <font class="source_int">0.3</font>;
<a name="2770"></a>                GotoState(<font class="source_name">'TacticalMove'</font>, <font class="source_name">'TacticalTick'</font>);
<a name="2771"></a>            }
<a name="2772"></a>            <font class="source_keyword">else</font> 
<a name="2773"></a>            {
<a name="2774"></a>                MoveTarget = path;
<a name="2775"></a>                Destination = path.Location;
<a name="2776"></a>            }
<a name="2777"></a>        }
<a name="2778"></a>    }
<a name="2779"></a>
<a name="2780"></a>    <font class="source_keyword">function</font> Bump(<font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Other)
<a name="2781"></a>    {
<a name="2782"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> VelDir, OtherDir;
<a name="2783"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> speed;
<a name="2784"></a>
<a name="2785"></a>        <font class="source_comment">//log(Other.class$" bumped "$class);
</font><a name="2786"></a>        <font class="source_keyword">if</font> (<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Other) != <font class="source_keyword">None</font>)
<a name="2787"></a>        {
<a name="2788"></a>            <font class="source_keyword">if</font> ( (Other == Enemy) || SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Other)) )
<a name="2789"></a>            {
<a name="2790"></a>                bReadyToAttack = <font class="source_keyword">true</font>;
<a name="2791"></a>                GotoState(<font class="source_name">'Attacking'</font>);
<a name="2792"></a>            }
<a name="2793"></a>            <font class="source_keyword">return</font>;
<a name="2794"></a>        }
<a name="2795"></a>        <font class="source_keyword">if</font> ( TimerRate &lt;= <font class="source_int">0</font> )
<a name="2796"></a>            setTimer(<font class="source_int">1.0</font>, <font class="source_keyword">false</font>);
<a name="2797"></a>        speed = VSize(Velocity);
<a name="2798"></a>        <font class="source_keyword">if</font> ( speed &gt; <font class="source_int">1</font> )
<a name="2799"></a>        {
<a name="2800"></a>            VelDir = Velocity/speed;
<a name="2801"></a>            VelDir.Z = <font class="source_int">0</font>;
<a name="2802"></a>            OtherDir = Other.Location - Location;
<a name="2803"></a>            OtherDir.Z = <font class="source_int">0</font>;
<a name="2804"></a>            OtherDir = Normal(OtherDir);
<a name="2805"></a>            <font class="source_keyword">if</font> ( (VelDir Dot OtherDir) &gt; <font class="source_int">0.9</font> )
<a name="2806"></a>            {
<a name="2807"></a>                Velocity.X = VelDir.Y;
<a name="2808"></a>                Velocity.Y = -<font class="source_int">1</font> * VelDir.X;
<a name="2809"></a>                Velocity *= FMax(speed, <font class="source_int">200</font>);
<a name="2810"></a>            }
<a name="2811"></a>        }
<a name="2812"></a>        Disable(<font class="source_name">'Bump'</font>);
<a name="2813"></a>    }
<a name="2814"></a>    
<a name="2815"></a>    <font class="source_keyword">function</font> ReachedHome()
<a name="2816"></a>    {
<a name="2817"></a>        <font class="source_keyword">if</font> (LineOfSightTo(Enemy))
<a name="2818"></a>        {
<a name="2819"></a>            <font class="source_keyword">if</font> (<font class="source_type"><a href="..\engine\homebase.html" class="source">Homebase</a></font>(home) != <font class="source_keyword">None</font>)
<a name="2820"></a>            {
<a name="2821"></a>                <font class="source_comment">//log(class$" reached home base - turn and fight");
</font><a name="2822"></a>                Aggressiveness += <font class="source_int">0.2</font>;
<a name="2823"></a>                <font class="source_keyword">if</font> ( !bMoraleBoosted )
<a name="2824"></a>                    <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> = Min(default.<font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font>, <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font>+<font class="source_int">20</font>);
<a name="2825"></a>                MakeNoise(<font class="source_int">1.0</font>);
<a name="2826"></a>                GotoState(<font class="source_name">'Attacking'</font>);
<a name="2827"></a>            }
<a name="2828"></a>            <font class="source_keyword">else</font>
<a name="2829"></a>                ChangeDestination();
<a name="2830"></a>        }
<a name="2831"></a>        <font class="source_keyword">else</font>
<a name="2832"></a>        {
<a name="2833"></a>            <font class="source_keyword">if</font> (<font class="source_type"><a href="..\engine\homebase.html" class="source">Homebase</a></font>(home) != <font class="source_keyword">None</font>)
<a name="2834"></a>                MakeNoise(<font class="source_int">1.0</font>);
<a name="2835"></a>            aggressiveness += <font class="source_int">0.2</font>;
<a name="2836"></a>            <font class="source_keyword">if</font> ( !bMoraleBoosted )
<a name="2837"></a>                <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> = Min(default.<font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font>, <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font>+<font class="source_int">5</font>);
<a name="2838"></a>            GotoState(<font class="source_name">'Retreating'</font>, <font class="source_name">'TurnAtHome'</font>);
<a name="2839"></a>        }
<a name="2840"></a>        bMoraleBoosted = <font class="source_keyword">true</font>;  
<a name="2841"></a>    }
<a name="2842"></a>
<a name="2843"></a>    <font class="source_keyword">function</font> PickNextSpot()
<a name="2844"></a>    {
<a name="2845"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> path;
<a name="2846"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> dist2d;
<a name="2847"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> zdiff;
<a name="2848"></a>
<a name="2849"></a>        <font class="source_keyword">if</font> ( Home == <font class="source_keyword">None</font> )
<a name="2850"></a>        {
<a name="2851"></a>            PickDestination();
<a name="2852"></a>            <font class="source_keyword">if</font> ( Home == <font class="source_keyword">None</font> )
<a name="2853"></a>                <font class="source_keyword">return</font>;
<a name="2854"></a>        }
<a name="2855"></a>        <font class="source_comment">//log("find retreat spot");
</font><a name="2856"></a>        dist2d = Home.Location - Location;
<a name="2857"></a>        zdiff = dist2d.Z;
<a name="2858"></a>        dist2d.Z = <font class="source_int">0.0</font>; 
<a name="2859"></a>        <font class="source_keyword">if</font> ((VSize(dist2d) &lt; <font class="source_int">2</font> * CollisionRadius) && (Abs(zdiff) &lt; CollisionHeight))
<a name="2860"></a>            ReachedHome();
<a name="2861"></a>        <font class="source_keyword">else</font>
<a name="2862"></a>        {
<a name="2863"></a>            <font class="source_keyword">if</font> (ActorReachable(Home))
<a name="2864"></a>            {
<a name="2865"></a>                <font class="source_comment">//log("almost there");
</font><a name="2866"></a>                path = Home;
<a name="2867"></a>                <font class="source_keyword">if</font> (<font class="source_type"><a href="..\engine\homebase.html" class="source">HomeBase</a></font>(Home) == <font class="source_keyword">None</font>)
<a name="2868"></a>                    Home = <font class="source_keyword">None</font>;
<a name="2869"></a>            }
<a name="2870"></a>            <font class="source_keyword">else</font>
<a name="2871"></a>            {
<a name="2872"></a>                <font class="source_keyword">if</font> (SpecialGoal != <font class="source_keyword">None</font>)
<a name="2873"></a>                    path = FindPathToward(SpecialGoal);
<a name="2874"></a>                <font class="source_keyword">else</font>
<a name="2875"></a>                    path = FindPathToward(Home);
<a name="2876"></a>            }
<a name="2877"></a>                
<a name="2878"></a>            <font class="source_keyword">if</font> (path == <font class="source_keyword">None</font>)
<a name="2879"></a>                ChangeDestination();
<a name="2880"></a>            <font class="source_keyword">else</font>
<a name="2881"></a>            {
<a name="2882"></a>                MoveTarget = path;
<a name="2883"></a>                Destination = path.Location;
<a name="2884"></a>            }
<a name="2885"></a>        }
<a name="2886"></a>    }
<a name="2887"></a>
<a name="2888"></a>    <font class="source_keyword">function</font> AnimEnd() 
<a name="2889"></a>    {
<a name="2890"></a>        <font class="source_keyword">if</font> ( bCanFire && LineOfSightTo(Enemy) )
<a name="2891"></a>            PlayCombatMove();
<a name="2892"></a>        <font class="source_keyword">else</font>
<a name="2893"></a>            PlayRunning();
<a name="2894"></a>    }
<a name="2895"></a>
<a name="2896"></a>    <font class="source_keyword">function</font> BeginState()
<a name="2897"></a>    {
<a name="2898"></a>        <font class="source_keyword">if</font> ( <font class="source_type">Level</font>.Game.bTeamGame )
<a name="2899"></a>            CallForHelp();
<a name="2900"></a>        bSpecialPausing = <font class="source_keyword">false</font>;
<a name="2901"></a>        bCanFire = <font class="source_keyword">false</font>;
<a name="2902"></a>        SpecialGoal = <font class="source_keyword">None</font>;
<a name="2903"></a>        SpecialPause = <font class="source_int">0.0</font>;
<a name="2904"></a>    }
<a name="2905"></a>
<a name="2906"></a>Begin:
<a name="2907"></a>    <font class="source_keyword">if</font> ( (TimerRate == <font class="source_int">0.0</font>) || (bReadyToAttack && (FRand() &lt; <font class="source_int">0.4</font>)) )
<a name="2908"></a>    {
<a name="2909"></a>        SetTimer(TimeBetweenAttacks, <font class="source_keyword">false</font>);
<a name="2910"></a>        bReadyToAttack = <font class="source_keyword">false</font>;
<a name="2911"></a>    }
<a name="2912"></a>    TweenToRunning(<font class="source_int">0.15</font>);
<a name="2913"></a>    WaitForLanding();
<a name="2914"></a>    
<a name="2915"></a>RunAway:
<a name="2916"></a>    PickDestination();
<a name="2917"></a>SpecialNavig:
<a name="2918"></a>    <font class="source_keyword">if</font> (SpecialPause &gt; <font class="source_int">0.0</font>)
<a name="2919"></a>    {
<a name="2920"></a>        <font class="source_keyword">if</font> ( LineOfSightTo(Enemy) )
<a name="2921"></a>        {
<a name="2922"></a>            <font class="source_keyword">if</font> ( ((Base == <font class="source_keyword">None</font>) || (Base == <font class="source_type">Level</font>))
<a name="2923"></a>                && (FRand() &lt; <font class="source_int">0.6</font>) )
<a name="2924"></a>                GotoState(<font class="source_name">'TacticalMove'</font>, <font class="source_name">'NoCharge'</font>);
<a name="2925"></a>            Target = Enemy;
<a name="2926"></a>            bFiringPaused = <font class="source_keyword">true</font>;
<a name="2927"></a>            NextState = <font class="source_name">'Retreating'</font>;
<a name="2928"></a>            NextLabel = <font class="source_name">'RunAway'</font>;
<a name="2929"></a>            GotoState(<font class="source_name">'RangedAttack'</font>);
<a name="2930"></a>        }
<a name="2931"></a>        Disable(<font class="source_name">'AnimEnd'</font>);
<a name="2932"></a>        Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="2933"></a>        TweenToPatrolStop(<font class="source_int">0.3</font>);
<a name="2934"></a>        Sleep(SpecialPause);
<a name="2935"></a>        SpecialPause = <font class="source_int">0.0</font>;
<a name="2936"></a>        Enable(<font class="source_name">'AnimEnd'</font>);
<a name="2937"></a>        TweenToRunning(<font class="source_int">0.1</font>);
<a name="2938"></a>        Goto(<font class="source_name">'RunAway'</font>);
<a name="2939"></a>    }
<a name="2940"></a>Moving:
<a name="2941"></a>    <font class="source_keyword">if</font> ( !IsAnimating() )
<a name="2942"></a>        AnimEnd();
<a name="2943"></a>    <font class="source_keyword">if</font> ( MoveTarget == <font class="source_keyword">None</font> )
<a name="2944"></a>    {
<a name="2945"></a>        Sleep(<font class="source_int">0.0</font>);
<a name="2946"></a>        Goto(<font class="source_name">'RunAway'</font>);
<a name="2947"></a>    }
<a name="2948"></a>    <font class="source_keyword">if</font> ( MoveTarget.IsA(<font class="source_name">'InventorySpot'</font>) && (<font class="source_type"><a href="..\engine\inventoryspot.html" class="source">InventorySpot</a></font>(MoveTarget).markedItem != <font class="source_keyword">None</font>) 
<a name="2949"></a>        && (<font class="source_type"><a href="..\engine\inventoryspot.html" class="source">InventorySpot</a></font>(MoveTarget).markedItem.GetStateName() == <font class="source_name">'Pickup'</font>)
<a name="2950"></a>        && (<font class="source_type"><a href="..\engine\inventoryspot.html" class="source">InventorySpot</a></font>(MoveTarget).markedItem.BotDesireability(self) &gt; <font class="source_int">0</font>) )
<a name="2951"></a>            MoveTarget = <font class="source_type"><a href="..\engine\inventoryspot.html" class="source">InventorySpot</a></font>(MoveTarget).markedItem;
<a name="2952"></a>    <font class="source_keyword">if</font> ( (skill &lt; <font class="source_int">3</font>) && (!LineOfSightTo(Enemy) ||
<a name="2953"></a>        (Skill - <font class="source_int">2</font> * FRand() + (Normal(Enemy.Location - Location - vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>) * (Enemy.Location.Z - Location.Z)) 
<a name="2954"></a>            Dot Normal(MoveTarget.Location - Location - vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>) * (MoveTarget.Location.Z - Location.Z))) &lt; <font class="source_int">0</font>)) )
<a name="2955"></a>    {
<a name="2956"></a>        HaltFiring();
<a name="2957"></a>        MoveToward(MoveTarget);
<a name="2958"></a>    }
<a name="2959"></a>    <font class="source_keyword">else</font>
<a name="2960"></a>    {
<a name="2961"></a>        bCanFire = <font class="source_keyword">true</font>;
<a name="2962"></a>        StrafeFacing(MoveTarget.Location, Enemy);
<a name="2963"></a>    }
<a name="2964"></a>    Goto(<font class="source_name">'RunAway'</font>);
<a name="2965"></a>
<a name="2966"></a>Landed:
<a name="2967"></a>    <font class="source_keyword">if</font> ( MoveTarget == <font class="source_keyword">None</font> )
<a name="2968"></a>        Goto(<font class="source_name">'RunAway'</font>);
<a name="2969"></a>    Goto(<font class="source_name">'Moving'</font>);
<a name="2970"></a>
<a name="2971"></a>TakeHit:
<a name="2972"></a>    TweenToRunning(<font class="source_int">0.12</font>);
<a name="2973"></a>    Goto(<font class="source_name">'Moving'</font>);
<a name="2974"></a>
<a name="2975"></a>AdjustFromWall:
<a name="2976"></a>    StrafeTo(Destination, Focus); 
<a name="2977"></a>    Destination = Focus; 
<a name="2978"></a>    MoveTo(Destination);
<a name="2979"></a>    Goto(<font class="source_name">'Moving'</font>);
<a name="2980"></a>}
<a name="2981"></a>
<a name="2982"></a><font class="source_keyword">state</font> Fallback
<a name="2983"></a>{
<a name="2984"></a><font class="source_keyword">ignores</font> EnemyNotVisible;
<a name="2985"></a>
<a name="2986"></a>    <font class="source_keyword">function</font> EnemyNotVisible()
<a name="2987"></a>    {
<a name="2988"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> P;
<a name="2989"></a>        <font class="source_keyword">if</font> ( (OldEnemy != <font class="source_keyword">None</font>) && LineOfSightTo(OldEnemy) )
<a name="2990"></a>        {
<a name="2991"></a>            P = OldEnemy;
<a name="2992"></a>            OldEnemy = Enemy;
<a name="2993"></a>            Enemy = P;
<a name="2994"></a>        }
<a name="2995"></a>    }
<a name="2996"></a>
<a name="2997"></a>    <font class="source_keyword">function</font> SeePlayer(<font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> SeenPlayer)
<a name="2998"></a>    {
<a name="2999"></a>        <font class="source_keyword">if</font> ( SeenPlayer == Enemy )
<a name="3000"></a>            <font class="source_keyword">return</font>;
<a name="3001"></a>        <font class="source_keyword">if</font> ( SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(SeenPlayer)) )
<a name="3002"></a>        {
<a name="3003"></a>            LastSeenPos = Enemy.Location;
<a name="3004"></a>            MakeNoise(<font class="source_int">1.0</font>);
<a name="3005"></a>        }
<a name="3006"></a>    }
<a name="3007"></a>
<a name="3008"></a>    <font class="source_keyword">function</font> HearNoise(<font class="source_keyword">float</font> Loudness, <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> NoiseMaker)
<a name="3009"></a>    {
<a name="3010"></a>        <font class="source_keyword">if</font> ( (NoiseMaker.instigator == Enemy) || LineOfSightTo(Enemy) )
<a name="3011"></a>            <font class="source_keyword">return</font>;
<a name="3012"></a>
<a name="3013"></a>        <font class="source_keyword">if</font> ( SetEnemy(NoiseMaker.instigator) )
<a name="3014"></a>        {
<a name="3015"></a>            LastSeenPos = <font class="source_int">0.5</font> * (NoiseMaker.Location + VSize(NoiseMaker.Location - Location) * <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font>(Rotation));
<a name="3016"></a>            MakeNoise(<font class="source_int">1.0</font>);
<a name="3017"></a>        }
<a name="3018"></a>    }
<a name="3019"></a>    
<a name="3020"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="3021"></a>                            <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="3022"></a>    {
<a name="3023"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="3024"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="3025"></a>            <font class="source_keyword">return</font>;
<a name="3026"></a>        <font class="source_keyword">if</font> (NextState == <font class="source_name">'TakeHit'</font>)
<a name="3027"></a>        {
<a name="3028"></a>            NextState = <font class="source_name">'Fallback'</font>; 
<a name="3029"></a>            NextLabel = <font class="source_name">'TakeHit'</font>;
<a name="3030"></a>            GotoState(<font class="source_name">'TakeHit'</font>); 
<a name="3031"></a>        }
<a name="3032"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( !bCanFire && (skill &gt; <font class="source_int">3</font> * FRand()) )
<a name="3033"></a>            GotoState(<font class="source_name">'Fallback'</font>, <font class="source_name">'Moving'</font>);
<a name="3034"></a>    }
<a name="3035"></a>
<a name="3036"></a>    <font class="source_keyword">function</font> Timer()
<a name="3037"></a>    {
<a name="3038"></a>        bReadyToAttack = <font class="source_keyword">True</font>;
<a name="3039"></a>        Enable(<font class="source_name">'Bump'</font>);
<a name="3040"></a>    }
<a name="3041"></a>    
<a name="3042"></a>    <font class="source_keyword">function</font> SetFall()
<a name="3043"></a>    {
<a name="3044"></a>        NextState = <font class="source_name">'Fallback'</font>; 
<a name="3045"></a>        NextLabel = <font class="source_name">'Landed'</font>;
<a name="3046"></a>        NextAnim = AnimSequence;
<a name="3047"></a>        GotoState(<font class="source_name">'FallingState'</font>); 
<a name="3048"></a>    }
<a name="3049"></a>
<a name="3050"></a>    <font class="source_keyword">function</font> HitWall(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal, <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Wall)
<a name="3051"></a>    {
<a name="3052"></a>        <font class="source_keyword">if</font> (Physics == PHYS_Falling)
<a name="3053"></a>            <font class="source_keyword">return</font>;
<a name="3054"></a>        <font class="source_keyword">if</font> ( Wall.IsA(<font class="source_name">'Mover'</font>) && <font class="source_type"><a href="..\engine\mover.html" class="source">Mover</a></font>(Wall).HandleDoor(self) )
<a name="3055"></a>        {
<a name="3056"></a>            <font class="source_keyword">if</font> ( SpecialPause &gt; <font class="source_int">0</font> )
<a name="3057"></a>                Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="3058"></a>            GotoState(<font class="source_name">'Fallback'</font>, <font class="source_name">'SpecialNavig'</font>);
<a name="3059"></a>            <font class="source_keyword">return</font>;
<a name="3060"></a>        }
<a name="3061"></a>        Focus = Destination;
<a name="3062"></a>        <font class="source_keyword">if</font> (PickWallAdjust())
<a name="3063"></a>            GotoState(<font class="source_name">'Fallback'</font>, <font class="source_name">'AdjustFromWall'</font>);
<a name="3064"></a>        <font class="source_keyword">else</font>
<a name="3065"></a>            MoveTimer = -<font class="source_int">1.0</font>;
<a name="3066"></a>    }
<a name="3067"></a>
<a name="3068"></a>    <font class="source_keyword">function</font> PickDestination()
<a name="3069"></a>    {
<a name="3070"></a>        <font class="source_keyword">if</font> ( (VSize(Location - OrderObject.Location) &lt; <font class="source_int">20</font>)
<a name="3071"></a>            || ((VSize(Location - OrderObject.Location) &lt; <font class="source_int">600</font>) && LineOfSightTo(OrderObject)) )
<a name="3072"></a>        {
<a name="3073"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="3074"></a>        }
<a name="3075"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( ActorReachable(OrderObject) )
<a name="3076"></a>            MoveTarget = OrderObject;
<a name="3077"></a>        <font class="source_keyword">else</font>
<a name="3078"></a>        {
<a name="3079"></a>            MoveTarget = FindPathToward(OrderObject);
<a name="3080"></a>            <font class="source_keyword">if</font> ( MoveTarget == <font class="source_keyword">None</font> )
<a name="3081"></a>                GotoState(<font class="source_name">'Attacking'</font>);
<a name="3082"></a>        }
<a name="3083"></a>    }
<a name="3084"></a>
<a name="3085"></a>    <font class="source_keyword">function</font> Bump(<font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Other)
<a name="3086"></a>    {
<a name="3087"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> VelDir, OtherDir;
<a name="3088"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> speed;
<a name="3089"></a>
<a name="3090"></a>        <font class="source_comment">//log(Other.class$" bumped "$class);
</font><a name="3091"></a>        <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Other) != <font class="source_keyword">None</font>) && (Other != Enemy) )
<a name="3092"></a>            SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Other));
<a name="3093"></a>
<a name="3094"></a>        <font class="source_keyword">if</font> ( TimerRate &lt;= <font class="source_int">0</font> )
<a name="3095"></a>            setTimer(<font class="source_int">1.0</font>, <font class="source_keyword">false</font>);
<a name="3096"></a>        speed = VSize(Velocity);
<a name="3097"></a>        <font class="source_keyword">if</font> ( speed &gt; <font class="source_int">1</font> )
<a name="3098"></a>        {
<a name="3099"></a>            VelDir = Velocity/speed;
<a name="3100"></a>            VelDir.Z = <font class="source_int">0</font>;
<a name="3101"></a>            OtherDir = Other.Location - Location;
<a name="3102"></a>            OtherDir.Z = <font class="source_int">0</font>;
<a name="3103"></a>            OtherDir = Normal(OtherDir);
<a name="3104"></a>            <font class="source_keyword">if</font> ( (VelDir Dot OtherDir) &gt; <font class="source_int">0.9</font> )
<a name="3105"></a>            {
<a name="3106"></a>                Velocity.X = VelDir.Y;
<a name="3107"></a>                Velocity.Y = -<font class="source_int">1</font> * VelDir.X;
<a name="3108"></a>                Velocity *= FMax(speed, <font class="source_int">200</font>);
<a name="3109"></a>            }
<a name="3110"></a>        }
<a name="3111"></a>        Disable(<font class="source_name">'Bump'</font>);
<a name="3112"></a>    }
<a name="3113"></a>    <font class="source_keyword">function</font> AnimEnd() 
<a name="3114"></a>    {
<a name="3115"></a>        <font class="source_keyword">if</font> ( bCanFire && LineOfSightTo(Enemy) )
<a name="3116"></a>            PlayCombatMove();
<a name="3117"></a>        <font class="source_keyword">else</font>
<a name="3118"></a>            PlayRunning();
<a name="3119"></a>    }
<a name="3120"></a>
<a name="3121"></a>    <font class="source_keyword">function</font> BeginState()
<a name="3122"></a>    {
<a name="3123"></a>        bCanFire = <font class="source_keyword">false</font>;
<a name="3124"></a>        <font class="source_keyword">if</font> ( bNoClearSpecial )
<a name="3125"></a>            bNoClearSpecial = <font class="source_keyword">false</font>;
<a name="3126"></a>        <font class="source_keyword">else</font>
<a name="3127"></a>        {
<a name="3128"></a>            bSpecialPausing = <font class="source_keyword">false</font>;
<a name="3129"></a>            SpecialGoal = <font class="source_keyword">None</font>;
<a name="3130"></a>            SpecialPause = <font class="source_int">0.0</font>;
<a name="3131"></a>        }
<a name="3132"></a>    }
<a name="3133"></a>
<a name="3134"></a>Begin:
<a name="3135"></a>    TweenToRunning(<font class="source_int">0.12</font>);
<a name="3136"></a>    WaitForLanding();
<a name="3137"></a>    
<a name="3138"></a>RunAway:
<a name="3139"></a>    PickDestination();
<a name="3140"></a>SpecialNavig:
<a name="3141"></a>    <font class="source_keyword">if</font> (SpecialPause &gt; <font class="source_int">0.0</font>)
<a name="3142"></a>    {
<a name="3143"></a>        <font class="source_keyword">if</font> ( LineOfSightTo(Enemy) )
<a name="3144"></a>        {
<a name="3145"></a>            Target = Enemy;
<a name="3146"></a>            bFiringPaused = <font class="source_keyword">true</font>;
<a name="3147"></a>            NextState = <font class="source_name">'Fallback'</font>;
<a name="3148"></a>            NextLabel = <font class="source_name">'RunAway'</font>;
<a name="3149"></a>            GotoState(<font class="source_name">'RangedAttack'</font>);
<a name="3150"></a>        }
<a name="3151"></a>        Disable(<font class="source_name">'AnimEnd'</font>);
<a name="3152"></a>        Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="3153"></a>        TweenToPatrolStop(<font class="source_int">0.3</font>);
<a name="3154"></a>        Sleep(SpecialPause);
<a name="3155"></a>        SpecialPause = <font class="source_int">0.0</font>;
<a name="3156"></a>        Enable(<font class="source_name">'AnimEnd'</font>);
<a name="3157"></a>        TweenToRunning(<font class="source_int">0.1</font>);
<a name="3158"></a>        Goto(<font class="source_name">'RunAway'</font>);
<a name="3159"></a>    }
<a name="3160"></a>Moving:
<a name="3161"></a>    <font class="source_keyword">if</font> ( !IsAnimating() )
<a name="3162"></a>        AnimEnd();
<a name="3163"></a>    <font class="source_keyword">if</font> ( MoveTarget == <font class="source_keyword">None</font> )
<a name="3164"></a>    {
<a name="3165"></a>        log(<font class="source_string">"no movetarget"</font>);
<a name="3166"></a>        Sleep(<font class="source_int">0.0</font>);
<a name="3167"></a>        Goto(<font class="source_name">'RunAway'</font>);
<a name="3168"></a>    }
<a name="3169"></a>    <font class="source_keyword">if</font> ( (skill &lt; <font class="source_int">3</font>) && (!LineOfSightTo(Enemy) ||
<a name="3170"></a>        (Skill - FRand() + (Normal(Enemy.Location - Location - vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>) * (Enemy.Location.Z - Location.Z)) 
<a name="3171"></a>            Dot Normal(MoveTarget.Location - Location - vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>) * (MoveTarget.Location.Z - Location.Z))) &lt; <font class="source_int">0</font>)) )
<a name="3172"></a>    {
<a name="3173"></a>        HaltFiring();
<a name="3174"></a>        MoveToward(MoveTarget);
<a name="3175"></a>    }
<a name="3176"></a>    <font class="source_keyword">else</font>
<a name="3177"></a>    {
<a name="3178"></a>        bReadyToAttack = <font class="source_keyword">True</font>;
<a name="3179"></a>        bCanFire = <font class="source_keyword">true</font>;
<a name="3180"></a>        StrafeFacing(MoveTarget.Location, Enemy);
<a name="3181"></a>    }
<a name="3182"></a>    Goto(<font class="source_name">'RunAway'</font>);
<a name="3183"></a>
<a name="3184"></a>Landed:
<a name="3185"></a>    <font class="source_keyword">if</font> ( MoveTarget == <font class="source_keyword">None</font> )
<a name="3186"></a>        Goto(<font class="source_name">'RunAway'</font>);
<a name="3187"></a>    Goto(<font class="source_name">'Moving'</font>);
<a name="3188"></a>
<a name="3189"></a>TakeHit:
<a name="3190"></a>    TweenToRunning(<font class="source_int">0.12</font>);
<a name="3191"></a>    Goto(<font class="source_name">'Moving'</font>);
<a name="3192"></a>
<a name="3193"></a>AdjustFromWall:
<a name="3194"></a>    StrafeTo(Destination, Focus); 
<a name="3195"></a>    Destination = Focus; 
<a name="3196"></a>    MoveTo(Destination);
<a name="3197"></a>    Goto(<font class="source_name">'Moving'</font>);
<a name="3198"></a>}
<a name="3199"></a>
<a name="3200"></a><font class="source_keyword">state</font> Charging
<a name="3201"></a>{
<a name="3202"></a><font class="source_keyword">ignores</font> SeePlayer, HearNoise;
<a name="3203"></a>
<a name="3204"></a>    <font class="source_comment">/* MayFall() called by engine physics if walking and bCanJump, and
<a name="3205"></a>        is about to go off a ledge.  Pawn has opportunity (by setting 
<a name="3206"></a>        bCanJump to false) to avoid fall
<a name="3207"></a>    */</font>
<a name="3208"></a>    <font class="source_keyword">function</font> MayFall()
<a name="3209"></a>    {
<a name="3210"></a>        <font class="source_keyword">if</font> ( MoveTarget != Enemy )
<a name="3211"></a>            <font class="source_keyword">return</font>;
<a name="3212"></a>
<a name="3213"></a>        bCanJump = ActorReachable(Enemy);
<a name="3214"></a>        <font class="source_keyword">if</font> ( !bCanJump )
<a name="3215"></a>                GotoState(<font class="source_name">'TacticalMove'</font>, <font class="source_name">'NoCharge'</font>);
<a name="3216"></a>    }
<a name="3217"></a>
<a name="3218"></a>    <font class="source_keyword">function</font> TryToDuck(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> duckDir, <font class="source_keyword">bool</font> bReversed)
<a name="3219"></a>    {
<a name="3220"></a>        <font class="source_keyword">if</font> ( FRand() &lt; <font class="source_int">0.7</font> )
<a name="3221"></a>        {
<a name="3222"></a>            Global.TryToDuck(duckDir, bReversed);
<a name="3223"></a>            <font class="source_keyword">return</font>;
<a name="3224"></a>        }
<a name="3225"></a>        <font class="source_keyword">if</font> ( MoveTarget == Enemy ) 
<a name="3226"></a>            TryStrafe(duckDir);
<a name="3227"></a>    }
<a name="3228"></a>
<a name="3229"></a>    <font class="source_keyword">function</font> HitWall(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal, <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Wall)
<a name="3230"></a>    {
<a name="3231"></a>        <font class="source_keyword">if</font> (Physics == PHYS_Falling)
<a name="3232"></a>            <font class="source_keyword">return</font>;
<a name="3233"></a>        <font class="source_keyword">if</font> ( Wall.IsA(<font class="source_name">'Mover'</font>) && <font class="source_type"><a href="..\engine\mover.html" class="source">Mover</a></font>(Wall).HandleDoor(self) )
<a name="3234"></a>        {
<a name="3235"></a>            <font class="source_keyword">if</font> ( SpecialPause &gt; <font class="source_int">0</font> )
<a name="3236"></a>                Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="3237"></a>            GotoState(<font class="source_name">'Charging'</font>, <font class="source_name">'SpecialNavig'</font>);
<a name="3238"></a>            <font class="source_keyword">return</font>;
<a name="3239"></a>        }
<a name="3240"></a>        Focus = Destination;
<a name="3241"></a>        <font class="source_keyword">if</font> (PickWallAdjust())
<a name="3242"></a>            GotoState(<font class="source_name">'Charging'</font>, <font class="source_name">'AdjustFromWall'</font>);
<a name="3243"></a>        <font class="source_keyword">else</font>
<a name="3244"></a>            MoveTimer = -<font class="source_int">1.0</font>;
<a name="3245"></a>    }
<a name="3246"></a>    
<a name="3247"></a>    <font class="source_keyword">function</font> SetFall()
<a name="3248"></a>    {
<a name="3249"></a>        NextState = <font class="source_name">'Charging'</font>; 
<a name="3250"></a>        NextLabel = <font class="source_name">'ResumeCharge'</font>;
<a name="3251"></a>        NextAnim = AnimSequence;
<a name="3252"></a>        GotoState(<font class="source_name">'FallingState'</font>); 
<a name="3253"></a>    }
<a name="3254"></a>
<a name="3255"></a>    <font class="source_keyword">function</font> FearThisSpot(<font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> aSpot)
<a name="3256"></a>    {
<a name="3257"></a>        Destination = Location + <font class="source_int">120</font> * Normal(Location - aSpot.Location); 
<a name="3258"></a>        GotoState(<font class="source_name">'TacticalMove'</font>, <font class="source_name">'DoStrafeMove'</font>);
<a name="3259"></a>    }
<a name="3260"></a>
<a name="3261"></a>    <font class="source_keyword">function</font> <font class="source_keyword">bool</font> StrafeFromDamage(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> momentum, <font class="source_keyword">float</font> Damage, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">DamageType</a></font>, <font class="source_keyword">bool</font> bFindDest)
<a name="3262"></a>    {
<a name="3263"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> sideDir;
<a name="3264"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> healthpct;
<a name="3265"></a>
<a name="3266"></a>        <font class="source_keyword">if</font> ( (<font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font> == <font class="source_name">'shot'</font>) || (<font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font> == <font class="source_name">'jolted'</font>) )
<a name="3267"></a>            healthpct = <font class="source_int">0.17</font>;
<a name="3268"></a>        <font class="source_keyword">else</font>
<a name="3269"></a>            healthpct = <font class="source_int">0.25</font>;
<a name="3270"></a>
<a name="3271"></a>        healthpct *= CombatStyle;
<a name="3272"></a>        <font class="source_keyword">if</font> ( FRand() * Damage &lt; healthpct * <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> ) 
<a name="3273"></a>            <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="3274"></a>
<a name="3275"></a>        <font class="source_keyword">if</font> ( !bFindDest )
<a name="3276"></a>            <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="3277"></a>
<a name="3278"></a>        sideDir = Normal( Normal(Enemy.Location - Location) Cross vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>) );
<a name="3279"></a>        <font class="source_keyword">if</font> ( (momentum Dot sidedir) &gt; <font class="source_int">0</font> )
<a name="3280"></a>            sidedir *= -<font class="source_int">1</font>;
<a name="3281"></a>
<a name="3282"></a>        <font class="source_keyword">return</font> TryStrafe(sideDir);
<a name="3283"></a>    }
<a name="3284"></a>
<a name="3285"></a>    <font class="source_keyword">function</font> <font class="source_keyword">bool</font> TryStrafe(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> sideDir)
<a name="3286"></a>    { 
<a name="3287"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> extent, HitLocation, HitNormal;
<a name="3288"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="3289"></a>
<a name="3290"></a>        Extent.X = CollisionRadius;
<a name="3291"></a>        Extent.Y = CollisionRadius;
<a name="3292"></a>        Extent.Z = CollisionHeight;
<a name="3293"></a>        HitActor = Trace(HitLocation, HitNormal, Location + <font class="source_int">100</font> * sideDir, Location, <font class="source_keyword">false</font>, Extent);
<a name="3294"></a>        <font class="source_keyword">if</font> (HitActor != <font class="source_keyword">None</font>)
<a name="3295"></a>        {
<a name="3296"></a>            sideDir *= -<font class="source_int">1</font>;
<a name="3297"></a>            HitActor = Trace(HitLocation, HitNormal, Location + <font class="source_int">100</font> * sideDir, Location, <font class="source_keyword">false</font>, Extent);
<a name="3298"></a>        }
<a name="3299"></a>        <font class="source_keyword">if</font> (HitActor != <font class="source_keyword">None</font>)
<a name="3300"></a>            <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="3301"></a>        
<a name="3302"></a>        <font class="source_keyword">if</font> ( Physics == PHYS_Walking )
<a name="3303"></a>        {
<a name="3304"></a>            HitActor = Trace(HitLocation, HitNormal, Location + <font class="source_int">100</font> * sideDir - MaxStepHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>), Location + <font class="source_int">100</font> * sideDir, <font class="source_keyword">false</font>, Extent);
<a name="3305"></a>            <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="3306"></a>                <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="3307"></a>        }
<a name="3308"></a>        Destination = Location + <font class="source_int">250</font> * sideDir;
<a name="3309"></a>        GotoState(<font class="source_name">'TacticalMove'</font>, <font class="source_name">'DoStrafeMove'</font>);
<a name="3310"></a>        <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="3311"></a>    }
<a name="3312"></a>            
<a name="3313"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="3314"></a>                            <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="3315"></a>    {
<a name="3316"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> pick;
<a name="3317"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> sideDir, extent;
<a name="3318"></a>        <font class="source_keyword">local</font> <font class="source_keyword">bool</font> bWasOnGround;
<a name="3319"></a>
<a name="3320"></a>        bWasOnGround = (Physics == PHYS_Walking);
<a name="3321"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="3322"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="3323"></a>            <font class="source_keyword">return</font>;
<a name="3324"></a>        <font class="source_keyword">if</font> (NextState == <font class="source_name">'TakeHit'</font>)
<a name="3325"></a>        {
<a name="3326"></a>            <font class="source_keyword">if</font> (AttitudeTo(Enemy) == ATTITUDE_Fear)
<a name="3327"></a>            {
<a name="3328"></a>                NextState = <font class="source_name">'Retreating'</font>;
<a name="3329"></a>                NextLabel = <font class="source_name">'Begin'</font>;
<a name="3330"></a>            }
<a name="3331"></a>            <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( StrafeFromDamage(momentum, Damage, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>, <font class="source_keyword">false</font>) )
<a name="3332"></a>            {
<a name="3333"></a>                NextState = <font class="source_name">'TacticalMove'</font>;
<a name="3334"></a>                NextLabel = <font class="source_name">'NoCharge'</font>;
<a name="3335"></a>            }
<a name="3336"></a>            <font class="source_keyword">else</font>
<a name="3337"></a>            {
<a name="3338"></a>                NextState = <font class="source_name">'Charging'</font>;
<a name="3339"></a>                NextLabel = <font class="source_name">'TakeHit'</font>;
<a name="3340"></a>            }
<a name="3341"></a>            GotoState(<font class="source_name">'TakeHit'</font>); 
<a name="3342"></a>        }
<a name="3343"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( StrafeFromDamage(momentum, Damage, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>, <font class="source_keyword">true</font>) )
<a name="3344"></a>            <font class="source_keyword">return</font>;
<a name="3345"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( bWasOnGround && (MoveTarget == Enemy) && 
<a name="3346"></a>                    (Physics == PHYS_Falling) ) <font class="source_comment">//weave
</font><a name="3347"></a>        {
<a name="3348"></a>            pick = <font class="source_int">1.0</font>;
<a name="3349"></a>            <font class="source_keyword">if</font> ( bStrafeDir )
<a name="3350"></a>                pick = -<font class="source_int">1.0</font>;
<a name="3351"></a>            sideDir = Normal( Normal(Enemy.Location - Location) Cross vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>) );
<a name="3352"></a>            sideDir.Z = <font class="source_int">0</font>;
<a name="3353"></a>            Velocity += pick * GroundSpeed * <font class="source_int">0.7</font> * sideDir;   
<a name="3354"></a>            <font class="source_keyword">if</font> ( FRand() &lt; <font class="source_int">0.2</font> )
<a name="3355"></a>                bStrafeDir = !bStrafeDir;
<a name="3356"></a>        }
<a name="3357"></a>    }
<a name="3358"></a>                            
<a name="3359"></a>    <font class="source_keyword">function</font> AnimEnd() 
<a name="3360"></a>    {
<a name="3361"></a>        PlayCombatMove();
<a name="3362"></a>    }
<a name="3363"></a>    
<a name="3364"></a>    <font class="source_keyword">function</font> Timer()
<a name="3365"></a>    {
<a name="3366"></a>        bReadyToAttack = <font class="source_keyword">True</font>;
<a name="3367"></a>        Target = Enemy; 
<a name="3368"></a>        <font class="source_keyword">if</font> ( (VSize(Enemy.Location - Location) 
<a name="3369"></a>                &lt;= (MeleeRange + Enemy.CollisionRadius + CollisionRadius))
<a name="3370"></a>            || (FRand() &gt; <font class="source_int">0.7</font> + <font class="source_int">0.1</font> * skill) ) 
<a name="3371"></a>            GotoState(<font class="source_name">'RangedAttack'</font>);
<a name="3372"></a>    }
<a name="3373"></a>    
<a name="3374"></a>    <font class="source_keyword">function</font> EnemyNotVisible()
<a name="3375"></a>    {
<a name="3376"></a>        GotoState(<font class="source_name">'Hunting'</font>); 
<a name="3377"></a>    }
<a name="3378"></a>
<a name="3379"></a>    <font class="source_keyword">function</font> BeginState()
<a name="3380"></a>    {
<a name="3381"></a>        bCanFire = <font class="source_keyword">false</font>;
<a name="3382"></a>        SpecialGoal = <font class="source_keyword">None</font>;
<a name="3383"></a>        SpecialPause = <font class="source_int">0.0</font>;
<a name="3384"></a>    }
<a name="3385"></a>
<a name="3386"></a>    <font class="source_keyword">function</font> EndState()
<a name="3387"></a>    {
<a name="3388"></a>        <font class="source_keyword">if</font> ( JumpZ &gt; <font class="source_int">0</font> )
<a name="3389"></a>            bCanJump = <font class="source_keyword">true</font>;
<a name="3390"></a>    }
<a name="3391"></a>
<a name="3392"></a>AdjustFromWall:
<a name="3393"></a>    StrafeTo(Destination, Focus); 
<a name="3394"></a>    Goto(<font class="source_name">'CloseIn'</font>);
<a name="3395"></a>
<a name="3396"></a>ResumeCharge:
<a name="3397"></a>    PlayRunning();
<a name="3398"></a>    Goto(<font class="source_name">'Charge'</font>);
<a name="3399"></a>
<a name="3400"></a>Begin:
<a name="3401"></a>    TweenToRunning(<font class="source_int">0.15</font>);
<a name="3402"></a>
<a name="3403"></a>Charge:
<a name="3404"></a>    bFromWall = <font class="source_keyword">false</font>;
<a name="3405"></a>    
<a name="3406"></a>CloseIn:
<a name="3407"></a>    <font class="source_keyword">if</font> ( (Enemy == <font class="source_keyword">None</font>) || (Enemy.<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;=<font class="source_int">0</font>) )
<a name="3408"></a>        GotoState(<font class="source_name">'Attacking'</font>);
<a name="3409"></a>
<a name="3410"></a>    <font class="source_keyword">if</font> ( Enemy.<font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.bWaterZone )
<a name="3411"></a>    {
<a name="3412"></a>        <font class="source_keyword">if</font> (!bCanSwim)
<a name="3413"></a>            GotoState(<font class="source_name">'TacticalMove'</font>, <font class="source_name">'NoCharge'</font>);
<a name="3414"></a>    }
<a name="3415"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font> (!bCanFly && !bCanWalk)
<a name="3416"></a>        GotoState(<font class="source_name">'TacticalMove'</font>, <font class="source_name">'NoCharge'</font>);
<a name="3417"></a>
<a name="3418"></a>    <font class="source_keyword">if</font> (Physics == PHYS_Falling)
<a name="3419"></a>    {
<a name="3420"></a>        DesiredRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(Enemy.Location - Location);
<a name="3421"></a>        Focus = Enemy.Location;
<a name="3422"></a>        Destination = Enemy.Location;
<a name="3423"></a>        WaitForLanding();
<a name="3424"></a>    }
<a name="3425"></a>    <font class="source_keyword">if</font>( actorReachable(Enemy) )
<a name="3426"></a>    {
<a name="3427"></a>        bCanFire = <font class="source_keyword">true</font>;
<a name="3428"></a>        MoveToward(Enemy);
<a name="3429"></a>        <font class="source_keyword">if</font> (bFromWall)
<a name="3430"></a>        {
<a name="3431"></a>            bFromWall = <font class="source_keyword">false</font>;
<a name="3432"></a>            <font class="source_keyword">if</font> (PickWallAdjust())
<a name="3433"></a>                StrafeFacing(Destination, Enemy);
<a name="3434"></a>            <font class="source_keyword">else</font>
<a name="3435"></a>                GotoState(<font class="source_name">'TacticalMove'</font>, <font class="source_name">'NoCharge'</font>);
<a name="3436"></a>        }
<a name="3437"></a>    }
<a name="3438"></a>    <font class="source_keyword">else</font>
<a name="3439"></a>    {
<a name="3440"></a>NoReach:
<a name="3441"></a>        bCanFire = <font class="source_keyword">false</font>;
<a name="3442"></a>        bFromWall = <font class="source_keyword">false</font>;
<a name="3443"></a>        <font class="source_comment">//log("route to enemy "$Enemy);
</font><a name="3444"></a>        <font class="source_keyword">if</font> (!FindBestPathToward(Enemy))
<a name="3445"></a>        {
<a name="3446"></a>            Sleep(<font class="source_int">0.0</font>);
<a name="3447"></a>            GotoState(<font class="source_name">'TacticalMove'</font>, <font class="source_name">'NoCharge'</font>);
<a name="3448"></a>        }
<a name="3449"></a>SpecialNavig:
<a name="3450"></a>        <font class="source_keyword">if</font> ( SpecialPause &gt; <font class="source_int">0.0</font> )
<a name="3451"></a>        {
<a name="3452"></a>            Target = Enemy;
<a name="3453"></a>            bFiringPaused = <font class="source_keyword">true</font>;
<a name="3454"></a>            NextState = <font class="source_name">'Charging'</font>;
<a name="3455"></a>            NextLabel = <font class="source_name">'Begin'</font>;
<a name="3456"></a>            GotoState(<font class="source_name">'RangedAttack'</font>);
<a name="3457"></a>        }
<a name="3458"></a>Moving:
<a name="3459"></a>        <font class="source_keyword">if</font> (VSize(MoveTarget.Location - Location) &lt; <font class="source_int">2.5</font> * CollisionRadius)
<a name="3460"></a>        {
<a name="3461"></a>            bCanFire = <font class="source_keyword">true</font>;
<a name="3462"></a>            StrafeFacing(MoveTarget.Location, Enemy);
<a name="3463"></a>        }
<a name="3464"></a>        <font class="source_keyword">else</font>
<a name="3465"></a>        {
<a name="3466"></a>            <font class="source_keyword">if</font> ( !bCanStrafe || !LineOfSightTo(Enemy) ||
<a name="3467"></a>                (Skill - <font class="source_int">2</font> * FRand() + (Normal(Enemy.Location - Location - vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>) * (Enemy.Location.Z - Location.Z)) 
<a name="3468"></a>                    Dot Normal(MoveTarget.Location - Location - vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>) * (MoveTarget.Location.Z - Location.Z))) &lt; <font class="source_int">0</font>) )
<a name="3469"></a>            {
<a name="3470"></a>                <font class="source_keyword">if</font> ( GetAnimGroup(AnimSequence) == <font class="source_name">'MovingAttack'</font> )
<a name="3471"></a>                {
<a name="3472"></a>                    AnimSequence = <font class="source_name">''</font>;
<a name="3473"></a>                    TweenToRunning(<font class="source_int">0.12</font>);
<a name="3474"></a>                }
<a name="3475"></a>                HaltFiring();
<a name="3476"></a>                MoveToward(MoveTarget);
<a name="3477"></a>            }
<a name="3478"></a>            <font class="source_keyword">else</font>
<a name="3479"></a>            {
<a name="3480"></a>                bCanFire = <font class="source_keyword">true</font>;
<a name="3481"></a>                StrafeFacing(MoveTarget.Location, Enemy);   
<a name="3482"></a>            }
<a name="3483"></a>        }
<a name="3484"></a>    }
<a name="3485"></a>
<a name="3486"></a>    GotoState(<font class="source_name">'Attacking'</font>);
<a name="3487"></a>
<a name="3488"></a>GotThere:
<a name="3489"></a>    <font class="source_comment">////log("Got to enemy");
</font><a name="3490"></a>    Target = Enemy;
<a name="3491"></a>    GotoState(<font class="source_name">'RangedAttack'</font>);
<a name="3492"></a>
<a name="3493"></a>TakeHit:
<a name="3494"></a>    TweenToRunning(<font class="source_int">0.12</font>);
<a name="3495"></a>    <font class="source_keyword">if</font> (MoveTarget == Enemy)
<a name="3496"></a>    {
<a name="3497"></a>        bCanFire = <font class="source_keyword">true</font>;
<a name="3498"></a>        MoveToward(MoveTarget);
<a name="3499"></a>    }
<a name="3500"></a>    
<a name="3501"></a>    Goto(<font class="source_name">'Charge'</font>);
<a name="3502"></a>}
<a name="3503"></a>
<a name="3504"></a><font class="source_keyword">state</font> TacticalMove
<a name="3505"></a>{
<a name="3506"></a><font class="source_keyword">ignores</font> SeePlayer, HearNoise;
<a name="3507"></a>
<a name="3508"></a>    <font class="source_keyword">function</font> SetFall()
<a name="3509"></a>    {
<a name="3510"></a>        Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="3511"></a>        Destination = Location;
<a name="3512"></a>        NextState = <font class="source_name">'Attacking'</font>; 
<a name="3513"></a>        NextLabel = <font class="source_name">'Begin'</font>;
<a name="3514"></a>        NextAnim = <font class="source_name">'Fighter'</font>;
<a name="3515"></a>        GotoState(<font class="source_name">'FallingState'</font>);
<a name="3516"></a>    }
<a name="3517"></a>
<a name="3518"></a>    <font class="source_keyword">function</font> WarnTarget(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> shooter, <font class="source_keyword">float</font> projSpeed, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> FireDir)
<a name="3519"></a>    {   
<a name="3520"></a>        <font class="source_keyword">if</font> ( bCanFire && (FRand() &lt; <font class="source_int">0.4</font>) ) 
<a name="3521"></a>            <font class="source_keyword">return</font>;
<a name="3522"></a>
<a name="3523"></a>        <font class="source_keyword">Super</font>.WarnTarget(shooter, projSpeed, FireDir);
<a name="3524"></a>    }
<a name="3525"></a>
<a name="3526"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="3527"></a>                        <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="3528"></a>    {
<a name="3529"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="3530"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="3531"></a>            <font class="source_keyword">return</font>;
<a name="3532"></a>        <font class="source_keyword">if</font> ( NextState == <font class="source_name">'TakeHit'</font> )
<a name="3533"></a>        {
<a name="3534"></a>            NextState = <font class="source_name">'TacticalMove'</font>; 
<a name="3535"></a>            NextLabel = <font class="source_name">'TakeHit'</font>;
<a name="3536"></a>            GotoState(<font class="source_name">'TakeHit'</font>); 
<a name="3537"></a>        }
<a name="3538"></a>    }
<a name="3539"></a>
<a name="3540"></a>    <font class="source_keyword">function</font> HitWall(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal, <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Wall)
<a name="3541"></a>    {
<a name="3542"></a>        <font class="source_keyword">if</font> (Physics == PHYS_Falling)
<a name="3543"></a>            <font class="source_keyword">return</font>;
<a name="3544"></a>        Focus = Destination;
<a name="3545"></a>        <font class="source_comment">//if (PickWallAdjust())
</font><a name="3546"></a>        <font class="source_comment">//	GotoState('TacticalMove', 'AdjustFromWall');
</font><a name="3547"></a>        <font class="source_keyword">if</font> ( bChangeDir || (FRand() &lt; <font class="source_int">0.5</font>) 
<a name="3548"></a>            || (((Enemy.Location - Location) Dot HitNormal) &lt; <font class="source_int">0</font>) )
<a name="3549"></a>        {
<a name="3550"></a>            DesiredRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(Enemy.Location - location);
<a name="3551"></a>            GiveUpTactical(<font class="source_keyword">false</font>);
<a name="3552"></a>        }
<a name="3553"></a>        <font class="source_keyword">else</font>
<a name="3554"></a>        {
<a name="3555"></a>            bChangeDir = <font class="source_keyword">true</font>;
<a name="3556"></a>            Destination = Location - HitNormal * FRand() * <font class="source_int">500</font>;
<a name="3557"></a>        }
<a name="3558"></a>    }
<a name="3559"></a>
<a name="3560"></a>    <font class="source_keyword">function</font> FearThisSpot(<font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> aSpot)
<a name="3561"></a>    {
<a name="3562"></a>        Destination = Location + <font class="source_int">120</font> * Normal(Location - aSpot.Location); 
<a name="3563"></a>    }
<a name="3564"></a>
<a name="3565"></a>    <font class="source_keyword">function</font> AnimEnd() 
<a name="3566"></a>    {
<a name="3567"></a>        PlayCombatMove();
<a name="3568"></a>    }
<a name="3569"></a>
<a name="3570"></a>    <font class="source_keyword">function</font> Timer()
<a name="3571"></a>    {
<a name="3572"></a>        bReadyToAttack = <font class="source_keyword">True</font>;
<a name="3573"></a>        Enable(<font class="source_name">'Bump'</font>);
<a name="3574"></a>        Target = Enemy;
<a name="3575"></a>        <font class="source_keyword">if</font> (VSize(Enemy.Location - Location) 
<a name="3576"></a>                &lt;= (MeleeRange + Enemy.CollisionRadius + CollisionRadius))
<a name="3577"></a>            GotoState(<font class="source_name">'RangedAttack'</font>);       
<a name="3578"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( FRand() &gt; <font class="source_int">0.5</font> + <font class="source_int">0.17</font> * skill ) 
<a name="3579"></a>            GotoState(<font class="source_name">'RangedAttack'</font>);
<a name="3580"></a>    }
<a name="3581"></a>
<a name="3582"></a>    <font class="source_keyword">function</font> EnemyNotVisible()
<a name="3583"></a>    {
<a name="3584"></a>        <font class="source_keyword">if</font> ( !bGathering && (aggressiveness &gt; relativestrength(enemy)) )
<a name="3585"></a>        {
<a name="3586"></a>            <font class="source_keyword">if</font> (ValidRecovery())
<a name="3587"></a>                GotoState(<font class="source_name">'TacticalMove'</font>,<font class="source_name">'RecoverEnemy'</font>);
<a name="3588"></a>            <font class="source_keyword">else</font>
<a name="3589"></a>                GotoState(<font class="source_name">'Attacking'</font>);
<a name="3590"></a>        }
<a name="3591"></a>        Disable(<font class="source_name">'EnemyNotVisible'</font>);
<a name="3592"></a>    }
<a name="3593"></a>
<a name="3594"></a>    <font class="source_keyword">function</font> <font class="source_keyword">bool</font> ValidRecovery()
<a name="3595"></a>    {
<a name="3596"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="3597"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, HitNormal;
<a name="3598"></a>        
<a name="3599"></a>        HitActor = Trace(HitLocation, HitNormal, Enemy.Location, LastSeeingPos, <font class="source_keyword">false</font>);
<a name="3600"></a>        <font class="source_keyword">return</font> (HitActor == <font class="source_keyword">None</font>);
<a name="3601"></a>    }
<a name="3602"></a>        
<a name="3603"></a>    <font class="source_keyword">function</font> GiveUpTactical(<font class="source_keyword">bool</font> bNoCharge)
<a name="3604"></a>    {   
<a name="3605"></a>        <font class="source_keyword">if</font> ( !bNoCharge && (<font class="source_int">2</font> * CombatStyle &gt; (<font class="source_int">3</font> - Skill) * FRand()) )
<a name="3606"></a>            GotoState(<font class="source_name">'Charging'</font>);
<a name="3607"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( bReadyToAttack && (skill &gt; <font class="source_int">3</font> * FRand() - <font class="source_int">1</font>) )
<a name="3608"></a>            GotoState(<font class="source_name">'RangedAttack'</font>);
<a name="3609"></a>        <font class="source_keyword">else</font>
<a name="3610"></a>            GotoState(<font class="source_name">'RangedAttack'</font>, <font class="source_name">'Challenge'</font>); 
<a name="3611"></a>    }       
<a name="3612"></a>
<a name="3613"></a>    <font class="source_keyword">function</font> <font class="source_keyword">bool</font> TryToward(<font class="source_type"><a href="..\engine\inventory.html" class="source">inventory</a></font> Inv, <font class="source_keyword">float</font> Weight)
<a name="3614"></a>    {
<a name="3615"></a>        <font class="source_keyword">local</font> <font class="source_keyword">bool</font> success; 
<a name="3616"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> pickdir, collSpec, minDest, HitLocation, HitNormal;
<a name="3617"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> HitActor;
<a name="3618"></a>
<a name="3619"></a>        <font class="source_keyword">if</font> ( (Weight &lt; <font class="source_int">0.0008</font>) && ((Weight &lt; <font class="source_int">0.0008</font> - <font class="source_int">0.0002</font> * skill) 
<a name="3620"></a>                || !Enemy.LineOfSightTo(Inv)) )
<a name="3621"></a>            <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="3622"></a>
<a name="3623"></a>        pickdir = Inv.Location - Location;
<a name="3624"></a>        <font class="source_keyword">if</font> ( Physics == PHYS_Walking )
<a name="3625"></a>            pickDir.Z = <font class="source_int">0</font>;
<a name="3626"></a>        pickDir = Normal(PickDir);
<a name="3627"></a>
<a name="3628"></a>        collSpec.X = CollisionRadius;
<a name="3629"></a>        collSpec.Y = CollisionRadius;
<a name="3630"></a>        collSpec.Z = FMax(<font class="source_int">6</font>, CollisionHeight - <font class="source_int">18</font>);
<a name="3631"></a>        
<a name="3632"></a>        minDest = Location + FMin(<font class="source_int">160.0</font>, <font class="source_int">3</font>*CollisionRadius) * pickDir;
<a name="3633"></a>        HitActor = Trace(HitLocation, HitNormal, minDest, Location, <font class="source_keyword">false</font>, collSpec);
<a name="3634"></a>        <font class="source_keyword">if</font> (HitActor == <font class="source_keyword">None</font>)
<a name="3635"></a>        {
<a name="3636"></a>            success = (Physics != PHYS_Walking);
<a name="3637"></a>            <font class="source_keyword">if</font> ( !success )
<a name="3638"></a>            {
<a name="3639"></a>                collSpec.X = FMin(<font class="source_int">14</font>, <font class="source_int">0.5</font> * CollisionRadius);
<a name="3640"></a>                collSpec.Y = collSpec.X;
<a name="3641"></a>                HitActor = Trace(HitLocation, HitNormal, minDest - (<font class="source_int">18</font> + MaxStepHeight) * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>), minDest, <font class="source_keyword">false</font>, collSpec);
<a name="3642"></a>                success = (HitActor != <font class="source_keyword">None</font>);
<a name="3643"></a>            }
<a name="3644"></a>            <font class="source_keyword">if</font> ( success )
<a name="3645"></a>            {
<a name="3646"></a>                Destination = Inv.Location;
<a name="3647"></a>                bGathering = <font class="source_keyword">true</font>;
<a name="3648"></a>                <font class="source_keyword">if</font> ( <font class="source_int">2.7</font> * FRand() &lt; skill )
<a name="3649"></a>                    GotoState(<font class="source_name">'TacticalMove'</font>,<font class="source_name">'DoStrafeMove'</font>);
<a name="3650"></a>                <font class="source_keyword">else</font>
<a name="3651"></a>                    GotoState(<font class="source_name">'TacticalMove'</font>,<font class="source_name">'DoDirectMove'</font>);
<a name="3652"></a>                <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="3653"></a>            }
<a name="3654"></a>        }
<a name="3655"></a>
<a name="3656"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="3657"></a>    }
<a name="3658"></a>
<a name="3659"></a>    <font class="source_keyword">function</font> PainTimer()
<a name="3660"></a>    {
<a name="3661"></a>        <font class="source_keyword">if</font> ( (FootRegion.Zone.bPainZone) && (FootRegion.Zone.DamagePerSec &gt; <font class="source_int">0</font>)
<a name="3662"></a>            && (FootRegion.Zone.<font class="source_type"><a href="..\engine\damagetype.html" class="source">DamageType</a></font> != ReducedDamageType) )
<a name="3663"></a>            GotoState(<font class="source_name">'Retreating'</font>);
<a name="3664"></a>        <font class="source_keyword">Super</font>.PainTimer();
<a name="3665"></a>    }
<a name="3666"></a>
<a name="3667"></a>
<a name="3668"></a><font class="source_comment">/* PickDestination()
<a name="3669"></a>Choose a destination for the tactical move, based on aggressiveness and the tactical
<a name="3670"></a>situation. Make sure destination is reachable
<a name="3671"></a>*/</font>
<a name="3672"></a>    <font class="source_keyword">function</font> PickDestination(<font class="source_keyword">bool</font> bNoCharge)
<a name="3673"></a>    {
<a name="3674"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\inventory.html" class="source">inventory</a></font> Inv, BestInv, SecondInv;
<a name="3675"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> Bestweight, NewWeight, MaxDist, SecondWeight;
<a name="3676"></a>
<a name="3677"></a>        <font class="source_comment">// possibly pick nearby inventory
</font><a name="3678"></a>        <font class="source_comment">// higher skill bots will always strafe, lower skill
</font><a name="3679"></a>        <font class="source_comment">// both do this less, and strafe less
</font><a name="3680"></a>
<a name="3681"></a>        <font class="source_keyword">if</font> ( !bReadyToAttack && (TimerRate == <font class="source_int">0.0</font>) )
<a name="3682"></a>            SetTimer(<font class="source_int">0.7</font>, <font class="source_keyword">false</font>);
<a name="3683"></a>        <font class="source_keyword">if</font> ( <font class="source_type">Level</font>.TimeSeconds - LastInvFind &lt; <font class="source_int">2.5</font> - <font class="source_int">0.5</font> * skill )
<a name="3684"></a>        {
<a name="3685"></a>            PickRegDestination(bNoCharge);
<a name="3686"></a>            <font class="source_keyword">return</font>;
<a name="3687"></a>        }
<a name="3688"></a>
<a name="3689"></a>        LastInvFind = <font class="source_type">Level</font>.TimeSeconds;
<a name="3690"></a>        bGathering = <font class="source_keyword">false</font>;
<a name="3691"></a>        BestWeight = <font class="source_int">0</font>;
<a name="3692"></a>        MaxDist = <font class="source_int">600</font> + <font class="source_int">70</font> * skill;
<a name="3693"></a>        <font class="source_keyword">foreach</font> visiblecollidingactors(<font class="source_keyword">class</font><font class="source_name">'Inventory'</font>, Inv, MaxDist)
<a name="3694"></a>            <font class="source_keyword">if</font> ( (Inv.IsInState(<font class="source_name">'PickUp'</font>)) && (Inv.MaxDesireability/2<font class="source_int">00</font> &gt; BestWeight)
<a name="3695"></a>                && (Inv.Location.Z &lt; Location.Z + MaxStepHeight + CollisionHeight)
<a name="3696"></a>                && (Inv.Location.Z &gt; FMin(Location.Z, Enemy.Location.Z) - CollisionHeight) )
<a name="3697"></a>            {
<a name="3698"></a>                NewWeight = inv.BotDesireability(self)/VSize(Inv.Location - Location);
<a name="3699"></a>                <font class="source_keyword">if</font> ( NewWeight &gt; BestWeight )
<a name="3700"></a>                {
<a name="3701"></a>                    SecondWeight = BestWeight;
<a name="3702"></a>                    BestWeight = NewWeight;
<a name="3703"></a>                    SecondInv = BestInv;
<a name="3704"></a>                    BestInv = Inv;
<a name="3705"></a>                }
<a name="3706"></a>            }
<a name="3707"></a>
<a name="3708"></a>        <font class="source_keyword">if</font> ( BestInv == <font class="source_keyword">None</font> )
<a name="3709"></a>        {
<a name="3710"></a>            PickRegDestination(bNoCharge);
<a name="3711"></a>            <font class="source_keyword">return</font>;
<a name="3712"></a>        }
<a name="3713"></a>
<a name="3714"></a>        <font class="source_keyword">if</font> ( TryToward(BestInv, BestWeight) )
<a name="3715"></a>            <font class="source_keyword">return</font>;
<a name="3716"></a>
<a name="3717"></a>        <font class="source_keyword">if</font> ( SecondInv == <font class="source_keyword">None</font> )
<a name="3718"></a>        {
<a name="3719"></a>            PickRegDestination(bNoCharge);
<a name="3720"></a>            <font class="source_keyword">return</font>;
<a name="3721"></a>        }
<a name="3722"></a>
<a name="3723"></a>        <font class="source_keyword">if</font> ( TryToward(SecondInv, SecondWeight) )
<a name="3724"></a>            <font class="source_keyword">return</font>;
<a name="3725"></a>
<a name="3726"></a>        PickRegDestination(bNoCharge);
<a name="3727"></a>    }
<a name="3728"></a>
<a name="3729"></a>    <font class="source_keyword">function</font> PickRegDestination(<font class="source_keyword">bool</font> bNoCharge)
<a name="3730"></a>    {
<a name="3731"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> pickdir, enemydir, enemyPart, Y, minDest;
<a name="3732"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="3733"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, HitNormal, collSpec;
<a name="3734"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> Aggression, enemydist, minDist, strafeSize, optDist;
<a name="3735"></a>        <font class="source_keyword">local</font> <font class="source_keyword">bool</font> success, bNoReach;
<a name="3736"></a>    
<a name="3737"></a>        bChangeDir = <font class="source_keyword">false</font>;
<a name="3738"></a>        <font class="source_keyword">if</font> (<font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.bWaterZone && !bCanSwim && bCanFly)
<a name="3739"></a>        {
<a name="3740"></a>            Destination = Location + <font class="source_int">75</font> * (VRand() + vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>));
<a name="3741"></a>            Destination.Z += <font class="source_int">100</font>;
<a name="3742"></a>            <font class="source_keyword">return</font>;
<a name="3743"></a>        }
<a name="3744"></a>        <font class="source_keyword">if</font> ( Enemy.<font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.bWaterZone )
<a name="3745"></a>            bNoCharge = bNoCharge || !bCanSwim;
<a name="3746"></a>        <font class="source_keyword">else</font> 
<a name="3747"></a>            bNoCharge = bNoCharge || (!bCanFly && !bCanWalk);
<a name="3748"></a>        
<a name="3749"></a>        success = <font class="source_keyword">false</font>;
<a name="3750"></a>        enemyDist = VSize(Location - Enemy.Location);
<a name="3751"></a>        Aggression = <font class="source_int">2</font> * (CombatStyle + FRand()) - <font class="source_int">1.1</font>;
<a name="3752"></a>        <font class="source_keyword">if</font> ( Enemy.bIsPlayer && (AttitudeTo(Enemy) == ATTITUDE_Fear) && (CombatStyle &gt; <font class="source_int">0</font>) )
<a name="3753"></a>            Aggression = Aggression - <font class="source_int">2</font> - <font class="source_int">2</font> * CombatStyle;
<a name="3754"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != <font class="source_keyword">None</font> )
<a name="3755"></a>            Aggression += <font class="source_int">2</font> * <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.SuggestAttackStyle();
<a name="3756"></a>        <font class="source_keyword">if</font> ( Enemy.<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> != <font class="source_keyword">None</font> )
<a name="3757"></a>            Aggression += <font class="source_int">2</font> * Enemy.<font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.SuggestDefenseStyle();
<a name="3758"></a>
<a name="3759"></a>        <font class="source_keyword">if</font> ( enemyDist &gt; <font class="source_int">1000</font> )
<a name="3760"></a>            Aggression += <font class="source_int">1</font>;
<a name="3761"></a>        <font class="source_keyword">if</font> ( !bNoCharge )
<a name="3762"></a>            bNoCharge = ( Aggression &lt; FRand() );
<a name="3763"></a>
<a name="3764"></a>        <font class="source_keyword">if</font> ( (Physics == PHYS_Walking) || (Physics == PHYS_Falling) )
<a name="3765"></a>        {
<a name="3766"></a>            <font class="source_keyword">if</font> (Location.Z &gt; Enemy.Location.Z + <font class="source_int">140</font>) <font class="source_comment">//tactical height advantage
</font><a name="3767"></a>                Aggression = FMax(<font class="source_int">0.0</font>, Aggression - <font class="source_int">1.0</font> + CombatStyle);
<a name="3768"></a>            <font class="source_keyword">else</font> <font class="source_keyword">if</font> (Location.Z &lt; Enemy.Location.Z - CollisionHeight) <font class="source_comment">// below enemy
</font><a name="3769"></a>            {
<a name="3770"></a>                <font class="source_keyword">if</font> ( !bNoCharge && (Aggression &gt; <font class="source_int">0</font>) && (FRand() &lt; <font class="source_int">0.6</font>) )
<a name="3771"></a>                {
<a name="3772"></a>                    GotoState(<font class="source_name">'Charging'</font>);
<a name="3773"></a>                    <font class="source_keyword">return</font>;
<a name="3774"></a>                }
<a name="3775"></a>                <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( (enemyDist &lt; <font class="source_int">1.1</font> * (Enemy.Location.Z - Location.Z)) 
<a name="3776"></a>                        && !actorReachable(Enemy) ) 
<a name="3777"></a>                {
<a name="3778"></a>                    bNoReach = <font class="source_keyword">true</font>;
<a name="3779"></a>                    aggression = -<font class="source_int">1.5</font> * FRand();
<a name="3780"></a>                }
<a name="3781"></a>            }
<a name="3782"></a>        }
<a name="3783"></a>    
<a name="3784"></a>        <font class="source_keyword">if</font> (!bNoCharge && (Aggression &gt; <font class="source_int">2</font> * FRand()))
<a name="3785"></a>        {
<a name="3786"></a>            <font class="source_keyword">if</font> ( bNoReach && (Physics != PHYS_Falling) )
<a name="3787"></a>            {
<a name="3788"></a>                TweenToRunning(<font class="source_int">0.15</font>);
<a name="3789"></a>                GotoState(<font class="source_name">'Charging'</font>, <font class="source_name">'NoReach'</font>);
<a name="3790"></a>            }
<a name="3791"></a>            <font class="source_keyword">else</font>
<a name="3792"></a>                GotoState(<font class="source_name">'Charging'</font>);
<a name="3793"></a>            <font class="source_keyword">return</font>;
<a name="3794"></a>        }
<a name="3795"></a>
<a name="3796"></a>        <font class="source_keyword">if</font> (enemyDist &gt; FMax(VSize(OldLocation - Enemy.OldLocation), <font class="source_int">240</font>))
<a name="3797"></a>            Aggression += <font class="source_int">0.4</font> * FRand();
<a name="3798"></a>             
<a name="3799"></a>        enemydir = (Enemy.Location - Location)/enemyDist;
<a name="3800"></a>        minDist = FMin(<font class="source_int">160.0</font>, <font class="source_int">3</font>*CollisionRadius);
<a name="3801"></a>        optDist = <font class="source_int">80</font> + FMin(EnemyDist, <font class="source_int">250</font> * (FRand() + FRand()));  
<a name="3802"></a>        Y = (enemydir Cross vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>));
<a name="3803"></a>        <font class="source_keyword">if</font> ( Physics == PHYS_Walking )
<a name="3804"></a>        {
<a name="3805"></a>            Y.Z = <font class="source_int">0</font>;
<a name="3806"></a>            enemydir.Z = <font class="source_int">0</font>;
<a name="3807"></a>        }
<a name="3808"></a>        <font class="source_keyword">else</font> 
<a name="3809"></a>            enemydir.Z = FMax(<font class="source_int">0</font>,enemydir.Z);
<a name="3810"></a>            
<a name="3811"></a>        strafeSize = FMax(-<font class="source_int">0.7</font>, FMin(<font class="source_int">0.85</font>, (<font class="source_int">2</font> * Aggression * FRand() - <font class="source_int">0.3</font>)));
<a name="3812"></a>        enemyPart = enemydir * strafeSize;
<a name="3813"></a>        strafeSize = FMax(<font class="source_int">0.0</font>, <font class="source_int">1</font> - Abs(strafeSize));
<a name="3814"></a>        pickdir = strafeSize * Y;
<a name="3815"></a>        <font class="source_keyword">if</font> ( bStrafeDir )
<a name="3816"></a>            pickdir *= -<font class="source_int">1</font>;
<a name="3817"></a>        bStrafeDir = !bStrafeDir;
<a name="3818"></a>        collSpec.X = CollisionRadius;
<a name="3819"></a>        collSpec.Y = CollisionRadius;
<a name="3820"></a>        collSpec.Z = FMax(<font class="source_int">6</font>, CollisionHeight - <font class="source_int">18</font>);
<a name="3821"></a>        
<a name="3822"></a>        minDest = Location + minDist * (pickdir + enemyPart);
<a name="3823"></a>        HitActor = Trace(HitLocation, HitNormal, minDest, Location, <font class="source_keyword">false</font>, collSpec);
<a name="3824"></a>        <font class="source_keyword">if</font> (HitActor == <font class="source_keyword">None</font>)
<a name="3825"></a>        {
<a name="3826"></a>            success = (Physics != PHYS_Walking);
<a name="3827"></a>            <font class="source_keyword">if</font> ( !success )
<a name="3828"></a>            {
<a name="3829"></a>                collSpec.X = FMin(<font class="source_int">14</font>, <font class="source_int">0.5</font> * CollisionRadius);
<a name="3830"></a>                collSpec.Y = collSpec.X;
<a name="3831"></a>                HitActor = Trace(HitLocation, HitNormal, minDest - (<font class="source_int">18</font> + MaxStepHeight) * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>), minDest, <font class="source_keyword">false</font>, collSpec);
<a name="3832"></a>                success = (HitActor != <font class="source_keyword">None</font>);
<a name="3833"></a>            }
<a name="3834"></a>            <font class="source_keyword">if</font> (success)
<a name="3835"></a>                Destination = minDest + (pickdir + enemyPart) * optDist;
<a name="3836"></a>        }
<a name="3837"></a>    
<a name="3838"></a>        <font class="source_keyword">if</font> ( !success )
<a name="3839"></a>        {                   
<a name="3840"></a>            collSpec.X = CollisionRadius;
<a name="3841"></a>            collSpec.Y = CollisionRadius;
<a name="3842"></a>            minDest = Location + minDist * (enemyPart - pickdir); 
<a name="3843"></a>            HitActor = Trace(HitLocation, HitNormal, minDest, Location, <font class="source_keyword">false</font>, collSpec);
<a name="3844"></a>            <font class="source_keyword">if</font> (HitActor == <font class="source_keyword">None</font>)
<a name="3845"></a>            {
<a name="3846"></a>                success = (Physics != PHYS_Walking);
<a name="3847"></a>                <font class="source_keyword">if</font> ( !success )
<a name="3848"></a>                {
<a name="3849"></a>                    collSpec.X = FMin(<font class="source_int">14</font>, <font class="source_int">0.5</font> * CollisionRadius);
<a name="3850"></a>                    collSpec.Y = collSpec.X;
<a name="3851"></a>                    HitActor = Trace(HitLocation, HitNormal, minDest - (<font class="source_int">18</font> + MaxStepHeight) * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>), minDest, <font class="source_keyword">false</font>, collSpec);
<a name="3852"></a>                    success = (HitActor != <font class="source_keyword">None</font>);
<a name="3853"></a>                }
<a name="3854"></a>                <font class="source_keyword">if</font> (success)
<a name="3855"></a>                    Destination = minDest + (enemyPart - pickdir) * optDist;
<a name="3856"></a>            }
<a name="3857"></a>            <font class="source_keyword">else</font> 
<a name="3858"></a>            {
<a name="3859"></a>                <font class="source_keyword">if</font> ( (CombatStyle &lt;= <font class="source_int">0</font>) || (Enemy.bIsPlayer && (AttitudeTo(Enemy) == ATTITUDE_Fear)) )
<a name="3860"></a>                    enemypart = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="3861"></a>                <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( (enemydir Dot enemyPart) &lt; <font class="source_int">0</font> )
<a name="3862"></a>                    enemyPart = -<font class="source_int">1</font> * enemyPart;
<a name="3863"></a>                pickDir = Normal(enemyPart - pickdir + HitNormal);
<a name="3864"></a>                minDest = Location + minDist * pickDir;
<a name="3865"></a>                collSpec.X = CollisionRadius;
<a name="3866"></a>                collSpec.Y = CollisionRadius;
<a name="3867"></a>                HitActor = Trace(HitLocation, HitNormal, minDest, Location, <font class="source_keyword">false</font>, collSpec);
<a name="3868"></a>                <font class="source_keyword">if</font> (HitActor == <font class="source_keyword">None</font>)
<a name="3869"></a>                {
<a name="3870"></a>                    success = (Physics != PHYS_Walking);
<a name="3871"></a>                    <font class="source_keyword">if</font> ( !success )
<a name="3872"></a>                    {
<a name="3873"></a>                        collSpec.X = FMin(<font class="source_int">14</font>, <font class="source_int">0.5</font> * CollisionRadius);
<a name="3874"></a>                        collSpec.Y = collSpec.X;
<a name="3875"></a>                        HitActor = Trace(HitLocation, HitNormal, minDest - (<font class="source_int">18</font> + MaxStepHeight) * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>), minDest, <font class="source_keyword">false</font>, collSpec);
<a name="3876"></a>                        success = (HitActor != <font class="source_keyword">None</font>);
<a name="3877"></a>                    }
<a name="3878"></a>                    <font class="source_keyword">if</font> (success)
<a name="3879"></a>                        Destination = minDest + pickDir * optDist;
<a name="3880"></a>                }
<a name="3881"></a>            }   
<a name="3882"></a>        }
<a name="3883"></a>                    
<a name="3884"></a>        <font class="source_keyword">if</font> ( !success )
<a name="3885"></a>            GiveUpTactical(bNoCharge);
<a name="3886"></a>        <font class="source_keyword">else</font> 
<a name="3887"></a>        {
<a name="3888"></a>            pickDir = (Destination - Location);
<a name="3889"></a>            enemyDist = VSize(pickDir);
<a name="3890"></a>            <font class="source_keyword">if</font> ( enemyDist &gt; minDist + <font class="source_int">2</font> * CollisionRadius )
<a name="3891"></a>            {
<a name="3892"></a>                pickDir = pickDir/enemyDist;
<a name="3893"></a>                HitActor = Trace(HitLocation, HitNormal, Destination + <font class="source_int">2</font> * CollisionRadius * pickdir, Location, <font class="source_keyword">false</font>);
<a name="3894"></a>                <font class="source_keyword">if</font> ( (HitActor != <font class="source_keyword">None</font>) && ((HitNormal Dot pickDir) &lt; -<font class="source_int">0.6</font>) )
<a name="3895"></a>                    Destination = HitLocation - <font class="source_int">2</font> * CollisionRadius * pickdir;
<a name="3896"></a>            }
<a name="3897"></a>        }
<a name="3898"></a>    }
<a name="3899"></a>
<a name="3900"></a>    <font class="source_keyword">function</font> BeginState()
<a name="3901"></a>    {
<a name="3902"></a>        MinHitWall += <font class="source_int">0.15</font>;
<a name="3903"></a>        bAvoidLedges = ( !bCanJump && (CollisionRadius &gt; <font class="source_int">40</font>) );
<a name="3904"></a>        bCanJump = <font class="source_keyword">false</font>;
<a name="3905"></a>        bCanFire = <font class="source_keyword">false</font>;
<a name="3906"></a>    }
<a name="3907"></a>    
<a name="3908"></a>    <font class="source_keyword">function</font> EndState()
<a name="3909"></a>    {
<a name="3910"></a>        bAvoidLedges = <font class="source_keyword">false</font>;
<a name="3911"></a>        MinHitWall -= <font class="source_int">0.15</font>;
<a name="3912"></a>        <font class="source_keyword">if</font> (JumpZ &gt; <font class="source_int">0</font>)
<a name="3913"></a>            bCanJump = <font class="source_keyword">true</font>;
<a name="3914"></a>    }
<a name="3915"></a>
<a name="3916"></a><font class="source_comment">//FIXME - what if bReadyToAttack at start
</font><a name="3917"></a>TacticalTick:
<a name="3918"></a>    Sleep(<font class="source_int">0.02</font>);    
<a name="3919"></a>Begin:
<a name="3920"></a>    TweenToRunning(<font class="source_int">0.15</font>);
<a name="3921"></a>    Enable(<font class="source_name">'AnimEnd'</font>);
<a name="3922"></a>    <font class="source_keyword">if</font> (Physics == PHYS_Falling)
<a name="3923"></a>    {
<a name="3924"></a>        DesiredRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(Enemy.Location - Location);
<a name="3925"></a>        Focus = Enemy.Location;
<a name="3926"></a>        Destination = Enemy.Location;
<a name="3927"></a>        WaitForLanding();
<a name="3928"></a>    }
<a name="3929"></a>    PickDestination(<font class="source_keyword">false</font>);
<a name="3930"></a>
<a name="3931"></a>DoMove:
<a name="3932"></a>    <font class="source_keyword">if</font> ( !bCanStrafe )
<a name="3933"></a>    { 
<a name="3934"></a>DoDirectMove:
<a name="3935"></a>        Enable(<font class="source_name">'AnimEnd'</font>);
<a name="3936"></a>        <font class="source_keyword">if</font> ( GetAnimGroup(AnimSequence) == <font class="source_name">'MovingAttack'</font> )
<a name="3937"></a>        {
<a name="3938"></a>            AnimSequence = <font class="source_name">''</font>;
<a name="3939"></a>            TweenToRunning(<font class="source_int">0.12</font>);
<a name="3940"></a>        }
<a name="3941"></a>        HaltFiring();
<a name="3942"></a>        MoveTo(Destination);
<a name="3943"></a>    }
<a name="3944"></a>    <font class="source_keyword">else</font>
<a name="3945"></a>    {
<a name="3946"></a>DoStrafeMove:
<a name="3947"></a>        Enable(<font class="source_name">'AnimEnd'</font>);
<a name="3948"></a>        bCanFire = <font class="source_keyword">true</font>;
<a name="3949"></a>        StrafeFacing(Destination, Enemy);   
<a name="3950"></a>    }
<a name="3951"></a>
<a name="3952"></a>    <font class="source_keyword">if</font> ( (Enemy != <font class="source_keyword">None</font>) && !LineOfSightTo(Enemy) && ValidRecovery() )
<a name="3953"></a>        Goto(<font class="source_name">'RecoverEnemy'</font>);
<a name="3954"></a>    <font class="source_keyword">else</font>
<a name="3955"></a>    {
<a name="3956"></a>        bReadyToAttack = <font class="source_keyword">true</font>;
<a name="3957"></a>        GotoState(<font class="source_name">'Attacking'</font>);
<a name="3958"></a>    }
<a name="3959"></a>    
<a name="3960"></a>NoCharge:
<a name="3961"></a>    TweenToRunning(<font class="source_int">0.15</font>);
<a name="3962"></a>    Enable(<font class="source_name">'AnimEnd'</font>);
<a name="3963"></a>    <font class="source_keyword">if</font> (Physics == PHYS_Falling)
<a name="3964"></a>    {
<a name="3965"></a>        DesiredRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(Enemy.Location - Location);
<a name="3966"></a>        Focus = Enemy.Location;
<a name="3967"></a>        Destination = Enemy.Location;
<a name="3968"></a>        WaitForLanding();
<a name="3969"></a>    }
<a name="3970"></a>    PickDestination(<font class="source_keyword">true</font>);
<a name="3971"></a>    Goto(<font class="source_name">'DoMove'</font>);
<a name="3972"></a>    
<a name="3973"></a>AdjustFromWall:
<a name="3974"></a>    Enable(<font class="source_name">'AnimEnd'</font>);
<a name="3975"></a>    StrafeTo(Destination, Focus); 
<a name="3976"></a>    Destination = Focus; 
<a name="3977"></a>    Goto(<font class="source_name">'DoMove'</font>);
<a name="3978"></a>
<a name="3979"></a>TakeHit:
<a name="3980"></a>    TweenToRunning(<font class="source_int">0.12</font>);
<a name="3981"></a>    Goto(<font class="source_name">'DoMove'</font>);
<a name="3982"></a>
<a name="3983"></a>RecoverEnemy:
<a name="3984"></a>    Enable(<font class="source_name">'AnimEnd'</font>);
<a name="3985"></a>    bReadyToAttack = <font class="source_keyword">true</font>;
<a name="3986"></a>    HidingSpot = Location;
<a name="3987"></a>    bCanFire = <font class="source_keyword">false</font>;
<a name="3988"></a>    Destination = LastSeeingPos + <font class="source_int">3</font> * CollisionRadius * Normal(LastSeeingPos - Location);
<a name="3989"></a>    <font class="source_keyword">if</font> ( bCanStrafe || (VSize(LastSeeingPos - Location) &lt; <font class="source_int">3</font> * CollisionRadius) )
<a name="3990"></a>        StrafeFacing(Destination, Enemy);
<a name="3991"></a>    <font class="source_keyword">else</font>
<a name="3992"></a>        MoveTo(Destination);
<a name="3993"></a>    <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> == <font class="source_keyword">None</font> ) 
<a name="3994"></a>        Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="3995"></a>    <font class="source_keyword">if</font> ( NeedToTurn(Enemy.Location) )
<a name="3996"></a>    {
<a name="3997"></a>        PlayTurning();
<a name="3998"></a>        TurnToward(Enemy);
<a name="3999"></a>    }
<a name="4000"></a>    <font class="source_keyword">if</font> ( CanFireAtEnemy() )
<a name="4001"></a>    {
<a name="4002"></a>        Disable(<font class="source_name">'AnimEnd'</font>);
<a name="4003"></a>        DesiredRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(Enemy.Location - Location);
<a name="4004"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font> == <font class="source_keyword">None</font> ) 
<a name="4005"></a>        {
<a name="4006"></a>            PlayRangedAttack();
<a name="4007"></a>            FinishAnim();
<a name="4008"></a>            TweenToRunning(<font class="source_int">0.1</font>);
<a name="4009"></a>            bReadyToAttack = <font class="source_keyword">false</font>;
<a name="4010"></a>            SetTimer(TimeBetweenAttacks, <font class="source_keyword">false</font>);
<a name="4011"></a>        }
<a name="4012"></a>        <font class="source_keyword">else</font>
<a name="4013"></a>        {
<a name="4014"></a>            FireWeapon();
<a name="4015"></a>            <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\engine\weapon.html" class="source">Weapon</a></font>.bSplashDamage )
<a name="4016"></a>            {
<a name="4017"></a>                bFire = <font class="source_int">0</font>;
<a name="4018"></a>                bAltFire = <font class="source_int">0</font>;
<a name="4019"></a>                Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="4020"></a>                Sleep(<font class="source_int">0.1</font>);
<a name="4021"></a>            }
<a name="4022"></a>        }
<a name="4023"></a>
<a name="4024"></a>        <font class="source_keyword">if</font> ( (FRand() + <font class="source_int">0.1</font> &gt; CombatStyle) )
<a name="4025"></a>        {
<a name="4026"></a>            Enable(<font class="source_name">'EnemyNotVisible'</font>);
<a name="4027"></a>            Enable(<font class="source_name">'AnimEnd'</font>);
<a name="4028"></a>            Destination = HidingSpot + <font class="source_int">4</font> * CollisionRadius * Normal(HidingSpot - Location);
<a name="4029"></a>            Goto(<font class="source_name">'DoMove'</font>);
<a name="4030"></a>        }
<a name="4031"></a>    }
<a name="4032"></a>
<a name="4033"></a>    GotoState(<font class="source_name">'Attacking'</font>);
<a name="4034"></a>}
<a name="4035"></a>
<a name="4036"></a><font class="source_keyword">state</font> Hunting
<a name="4037"></a>{
<a name="4038"></a><font class="source_keyword">ignores</font> EnemyNotVisible; 
<a name="4039"></a>
<a name="4040"></a>    <font class="source_comment">/* MayFall() called by engine physics if walking and bCanJump, and
<a name="4041"></a>        is about to go off a ledge.  Pawn has opportunity (by setting 
<a name="4042"></a>        bCanJump to false) to avoid fall
<a name="4043"></a>    */</font>
<a name="4044"></a>    <font class="source_keyword">function</font> MayFall()
<a name="4045"></a>    {
<a name="4046"></a>        bCanJump = ( (MoveTarget != <font class="source_keyword">None</font>) || PointReachable(Destination) );
<a name="4047"></a>    }
<a name="4048"></a>
<a name="4049"></a>    <font class="source_keyword">function</font> Bump(<font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Other)
<a name="4050"></a>    {
<a name="4051"></a>        <font class="source_comment">//log(Other.class$" bumped "$class);
</font><a name="4052"></a>        <font class="source_keyword">if</font> (<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Other) != <font class="source_keyword">None</font>)
<a name="4053"></a>        {
<a name="4054"></a>            <font class="source_keyword">if</font> (Enemy == Other)
<a name="4055"></a>                bReadyToAttack = <font class="source_keyword">True</font>; <font class="source_comment">//can melee right away
</font><a name="4056"></a>            SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font>(Other));
<a name="4057"></a>            LastSeenPos = Enemy.Location;
<a name="4058"></a>        }
<a name="4059"></a>        setTimer(<font class="source_int">2.0</font>, <font class="source_keyword">false</font>);
<a name="4060"></a>        Disable(<font class="source_name">'Bump'</font>);
<a name="4061"></a>    }
<a name="4062"></a>    
<a name="4063"></a>    <font class="source_keyword">function</font> FearThisSpot(<font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> aSpot)
<a name="4064"></a>    {
<a name="4065"></a>        Destination = Location + <font class="source_int">120</font> * Normal(Location - aSpot.Location); 
<a name="4066"></a>        GotoState(<font class="source_name">'Wandering'</font>, <font class="source_name">'Moving'</font>);
<a name="4067"></a>    }
<a name="4068"></a>
<a name="4069"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="4070"></a>                            <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="4071"></a>    {
<a name="4072"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="4073"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="4074"></a>            <font class="source_keyword">return</font>;
<a name="4075"></a>        bFrustrated = <font class="source_keyword">true</font>;
<a name="4076"></a>        <font class="source_keyword">if</font> (NextState == <font class="source_name">'TakeHit'</font>)
<a name="4077"></a>        {
<a name="4078"></a>            <font class="source_keyword">if</font> (AttitudeTo(Enemy) == ATTITUDE_Fear)
<a name="4079"></a>            {
<a name="4080"></a>                NextState = <font class="source_name">'Retreating'</font>;
<a name="4081"></a>                NextLabel = <font class="source_name">'Begin'</font>;
<a name="4082"></a>            }
<a name="4083"></a>            <font class="source_keyword">else</font>
<a name="4084"></a>            {
<a name="4085"></a>                NextState = <font class="source_name">'Hunting'</font>;
<a name="4086"></a>                NextLabel = <font class="source_name">'AfterFall'</font>;
<a name="4087"></a>            }
<a name="4088"></a>            GotoState(<font class="source_name">'TakeHit'</font>); 
<a name="4089"></a>        }
<a name="4090"></a>    }
<a name="4091"></a>
<a name="4092"></a>    <font class="source_keyword">function</font> HearNoise(<font class="source_keyword">float</font> Loudness, <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> NoiseMaker)
<a name="4093"></a>    {
<a name="4094"></a>        <font class="source_keyword">if</font> ( SetEnemy(NoiseMaker.instigator) )
<a name="4095"></a>            LastSeenPos = Enemy.Location; 
<a name="4096"></a>    }
<a name="4097"></a>
<a name="4098"></a>    <font class="source_keyword">function</font> SetFall()
<a name="4099"></a>    {
<a name="4100"></a>        NextState = <font class="source_name">'Hunting'</font>; 
<a name="4101"></a>        NextLabel = <font class="source_name">'AfterFall'</font>;
<a name="4102"></a>        NextAnim = AnimSequence;
<a name="4103"></a>        GotoState(<font class="source_name">'FallingState'</font>); 
<a name="4104"></a>    }
<a name="4105"></a>
<a name="4106"></a>    <font class="source_keyword">function</font> <font class="source_keyword">bool</font> SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> NewEnemy)
<a name="4107"></a>    {
<a name="4108"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> rnd;
<a name="4109"></a>
<a name="4110"></a>        <font class="source_keyword">if</font> (Global.SetEnemy(NewEnemy))
<a name="4111"></a>        {
<a name="4112"></a>            rnd = FRand();
<a name="4113"></a>            bReadyToAttack = <font class="source_keyword">true</font>;
<a name="4114"></a>            DesiredRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(Enemy.Location - Location);
<a name="4115"></a>            <font class="source_keyword">if</font> ( CombatStyle &gt; FRand() )
<a name="4116"></a>                GotoState(<font class="source_name">'Charging'</font>); 
<a name="4117"></a>            <font class="source_keyword">else</font>
<a name="4118"></a>                GotoState(<font class="source_name">'Attacking'</font>);
<a name="4119"></a>            <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="4120"></a>        }
<a name="4121"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="4122"></a>    } 
<a name="4123"></a>
<a name="4124"></a>    <font class="source_keyword">function</font> AnimEnd()
<a name="4125"></a>    {
<a name="4126"></a>        PlayRunning();
<a name="4127"></a>        bFire = <font class="source_int">0</font>;
<a name="4128"></a>        bAltFire = <font class="source_int">0</font>;
<a name="4129"></a>        bReadyToAttack = <font class="source_keyword">true</font>;
<a name="4130"></a>        Disable(<font class="source_name">'AnimEnd'</font>);
<a name="4131"></a>    }
<a name="4132"></a>    
<a name="4133"></a>    <font class="source_keyword">function</font> Timer()
<a name="4134"></a>    {
<a name="4135"></a>        bReadyToAttack = <font class="source_keyword">true</font>;
<a name="4136"></a>        Enable(<font class="source_name">'Bump'</font>);
<a name="4137"></a>        SetTimer(<font class="source_int">1.0</font>, <font class="source_keyword">false</font>);
<a name="4138"></a>    }
<a name="4139"></a>
<a name="4140"></a>    <font class="source_keyword">function</font> HitWall(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal, <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Wall)
<a name="4141"></a>    {
<a name="4142"></a>        <font class="source_keyword">if</font> (Physics == PHYS_Falling)
<a name="4143"></a>            <font class="source_keyword">return</font>;
<a name="4144"></a>        <font class="source_keyword">if</font> ( Wall.IsA(<font class="source_name">'Mover'</font>) && <font class="source_type"><a href="..\engine\mover.html" class="source">Mover</a></font>(Wall).HandleDoor(self) )
<a name="4145"></a>        {
<a name="4146"></a>            <font class="source_keyword">if</font> ( SpecialPause &gt; <font class="source_int">0</font> )
<a name="4147"></a>                Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="4148"></a>            GotoState(<font class="source_name">'Hunting'</font>, <font class="source_name">'SpecialNavig'</font>);
<a name="4149"></a>            <font class="source_keyword">return</font>;
<a name="4150"></a>        }
<a name="4151"></a>        Focus = Destination;
<a name="4152"></a>        <font class="source_keyword">if</font> (PickWallAdjust())
<a name="4153"></a>            GotoState(<font class="source_name">'Hunting'</font>, <font class="source_name">'AdjustFromWall'</font>);
<a name="4154"></a>        <font class="source_keyword">else</font>
<a name="4155"></a>            MoveTimer = -<font class="source_int">1.0</font>;
<a name="4156"></a>    }
<a name="4157"></a>
<a name="4158"></a>    <font class="source_keyword">function</font> PickDestination()
<a name="4159"></a>    {
<a name="4160"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\navigationpoint.html" class="source">NavigationPoint</a></font> path;
<a name="4161"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="4162"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal, HitLocation, nextSpot, ViewSpot;
<a name="4163"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> posZ, elapsed;
<a name="4164"></a>        <font class="source_keyword">local</font> <font class="source_keyword">bool</font> bCanSeeLastSeen;
<a name="4165"></a>    
<a name="4166"></a>        <font class="source_comment">// If no enemy, or I should see him but don't, then give up		
</font><a name="4167"></a>        <font class="source_keyword">if</font> ( (Enemy == <font class="source_keyword">None</font>) || (Enemy.<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font>) )
<a name="4168"></a>        {
<a name="4169"></a>            WhatToDoNext(<font class="source_name">''</font>,<font class="source_name">''</font>);
<a name="4170"></a>            <font class="source_keyword">return</font>;
<a name="4171"></a>        }
<a name="4172"></a>    
<a name="4173"></a>        bAvoidLedges = <font class="source_keyword">false</font>;
<a name="4174"></a>        elapsed = <font class="source_type">Level</font>.TimeSeconds - HuntStartTime;
<a name="4175"></a>        <font class="source_keyword">if</font> ( elapsed &gt; <font class="source_int">30</font> )
<a name="4176"></a>        {
<a name="4177"></a>                WhatToDoNext(<font class="source_name">''</font>,<font class="source_name">''</font>);
<a name="4178"></a>                <font class="source_keyword">return</font>;
<a name="4179"></a>        }
<a name="4180"></a>
<a name="4181"></a>        <font class="source_keyword">if</font> ( JumpZ &gt; <font class="source_int">0</font> )
<a name="4182"></a>            bCanJump = <font class="source_keyword">true</font>;
<a name="4183"></a>        
<a name="4184"></a>        <font class="source_keyword">if</font> ( ActorReachable(Enemy) )
<a name="4185"></a>        {
<a name="4186"></a>            <font class="source_keyword">if</font> ( (numHuntPaths &lt; <font class="source_int">8</font> + Skill) || (elapsed &lt; <font class="source_int">15</font>)
<a name="4187"></a>                || ((Normal(Enemy.Location - Location) Dot <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font>(Rotation)) &gt; -<font class="source_int">0.5</font>) )
<a name="4188"></a>            {
<a name="4189"></a>                Destination = Enemy.Location;
<a name="4190"></a>                MoveTarget = <font class="source_keyword">None</font>;
<a name="4191"></a>                numHuntPaths++;
<a name="4192"></a>            }
<a name="4193"></a>            <font class="source_keyword">else</font>
<a name="4194"></a>                WhatToDoNext(<font class="source_name">''</font>,<font class="source_name">''</font>);
<a name="4195"></a>            <font class="source_keyword">return</font>;
<a name="4196"></a>        }
<a name="4197"></a>        numHuntPaths++;
<a name="4198"></a>
<a name="4199"></a>        ViewSpot = Location + EyeHeight * vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">1</font>);
<a name="4200"></a>        bCanSeeLastSeen = <font class="source_keyword">false</font>;
<a name="4201"></a>        HitActor = Trace(HitLocation, HitNormal, LastSeenPos, ViewSpot, <font class="source_keyword">false</font>);
<a name="4202"></a>        bCanSeeLastSeen = (HitActor == <font class="source_keyword">None</font>);
<a name="4203"></a>        <font class="source_keyword">if</font> ( bCanSeeLastSeen )
<a name="4204"></a>        {
<a name="4205"></a>            HitActor = Trace(HitLocation, HitNormal, LastSeenPos, Enemy.Location, <font class="source_keyword">false</font>);
<a name="4206"></a>            bHunting = (HitActor != <font class="source_keyword">None</font>);
<a name="4207"></a>        }
<a name="4208"></a>        <font class="source_keyword">else</font>
<a name="4209"></a>            bHunting = <font class="source_keyword">true</font>;
<a name="4210"></a>
<a name="4211"></a>        <font class="source_keyword">if</font> ( FindBestPathToward(Enemy) )
<a name="4212"></a>            <font class="source_keyword">return</font>;
<a name="4213"></a>        MoveTarget = <font class="source_keyword">None</font>;
<a name="4214"></a>        <font class="source_keyword">if</font> ( bFromWall )
<a name="4215"></a>        {
<a name="4216"></a>            bFromWall = <font class="source_keyword">false</font>;
<a name="4217"></a>            <font class="source_keyword">if</font> ( !PickWallAdjust() )
<a name="4218"></a>            {
<a name="4219"></a>                <font class="source_keyword">if</font> ( CanStakeOut() )
<a name="4220"></a>                    GotoState(<font class="source_name">'StakeOut'</font>);
<a name="4221"></a>                <font class="source_keyword">else</font>
<a name="4222"></a>                    WhatToDoNext(<font class="source_name">''</font>, <font class="source_name">''</font>);
<a name="4223"></a>            }
<a name="4224"></a>            <font class="source_keyword">return</font>;
<a name="4225"></a>        }
<a name="4226"></a>        
<a name="4227"></a>        <font class="source_keyword">if</font> ( NumHuntPaths &gt; <font class="source_int">60</font> )
<a name="4228"></a>        {
<a name="4229"></a>            WhatToDoNext(<font class="source_name">''</font>, <font class="source_name">''</font>);
<a name="4230"></a>            <font class="source_keyword">return</font>;
<a name="4231"></a>        }
<a name="4232"></a>
<a name="4233"></a>        <font class="source_keyword">if</font> ( LastSeeingPos != vect(<font class="source_int">1000000</font>,<font class="source_int">0</font>,<font class="source_int">0</font>) )
<a name="4234"></a>        {
<a name="4235"></a>            Destination = LastSeeingPos;
<a name="4236"></a>            LastSeeingPos = vect(<font class="source_int">1000000</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);      
<a name="4237"></a>            HitActor = Trace(HitLocation, HitNormal, Enemy.Location, ViewSpot, <font class="source_keyword">false</font>);
<a name="4238"></a>            <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="4239"></a>            {
<a name="4240"></a>                <font class="source_keyword">If</font> (VSize(Location - Destination) &lt; <font class="source_int">20</font>)
<a name="4241"></a>                {
<a name="4242"></a>                    HitActor = Trace(HitLocation, HitNormal, Enemy.Location, ViewSpot, <font class="source_keyword">false</font>);
<a name="4243"></a>                    <font class="source_keyword">if</font> (HitActor == <font class="source_keyword">None</font>)
<a name="4244"></a>                    {
<a name="4245"></a>                        SetEnemy(Enemy);
<a name="4246"></a>                        <font class="source_keyword">return</font>;
<a name="4247"></a>                    }
<a name="4248"></a>                }
<a name="4249"></a>                <font class="source_keyword">return</font>;
<a name="4250"></a>            }
<a name="4251"></a>        }
<a name="4252"></a>
<a name="4253"></a>        bAvoidLedges = (CollisionRadius &gt; <font class="source_int">42</font>);
<a name="4254"></a>        posZ = LastSeenPos.Z + CollisionHeight - Enemy.CollisionHeight;
<a name="4255"></a>        nextSpot = LastSeenPos - Normal(Enemy.Location - Enemy.OldLocation) * CollisionRadius;
<a name="4256"></a>        nextSpot.Z = posZ;
<a name="4257"></a>        HitActor = Trace(HitLocation, HitNormal, nextSpot , ViewSpot, <font class="source_keyword">false</font>);
<a name="4258"></a>        <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="4259"></a>            Destination = nextSpot;
<a name="4260"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( bCanSeeLastSeen )
<a name="4261"></a>            Destination = LastSeenPos;
<a name="4262"></a>        <font class="source_keyword">else</font>
<a name="4263"></a>        {
<a name="4264"></a>            Destination = LastSeenPos;
<a name="4265"></a>            HitActor = Trace(HitLocation, HitNormal, LastSeenPos , ViewSpot, <font class="source_keyword">false</font>);
<a name="4266"></a>            <font class="source_keyword">if</font> ( HitActor != <font class="source_keyword">None</font> )
<a name="4267"></a>            {
<a name="4268"></a>                <font class="source_comment">// check if could adjust and see it
</font><a name="4269"></a>                <font class="source_keyword">if</font> ( PickWallAdjust() || FindViewSpot() )
<a name="4270"></a>                    GotoState(<font class="source_name">'Hunting'</font>, <font class="source_name">'AdjustFromWall'</font>);
<a name="4271"></a>                <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( VSize(Enemy.Location - Location) &lt; <font class="source_int">1200</font> )
<a name="4272"></a>                    GotoState(<font class="source_name">'StakeOut'</font>);
<a name="4273"></a>                <font class="source_keyword">else</font>
<a name="4274"></a>                {
<a name="4275"></a>                    WhatToDoNext(<font class="source_name">'Waiting'</font>, <font class="source_name">'TurnFromWall'</font>);
<a name="4276"></a>                    <font class="source_keyword">return</font>;
<a name="4277"></a>                }
<a name="4278"></a>            }
<a name="4279"></a>        }
<a name="4280"></a>        LastSeenPos = Enemy.Location;               
<a name="4281"></a>    }   
<a name="4282"></a>
<a name="4283"></a>    <font class="source_keyword">function</font> <font class="source_keyword">bool</font> FindViewSpot()
<a name="4284"></a>    {
<a name="4285"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> X,Y,Z, HitLocation, HitNormal;
<a name="4286"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="4287"></a>        <font class="source_keyword">local</font> <font class="source_keyword">bool</font> bAlwaysTry;
<a name="4288"></a>        GetAxes(Rotation,X,Y,Z);
<a name="4289"></a>
<a name="4290"></a>        <font class="source_comment">// try left and right
</font><a name="4291"></a>        <font class="source_comment">// if frustrated, always move if possible
</font><a name="4292"></a>        bAlwaysTry = bFrustrated;
<a name="4293"></a>        bFrustrated = <font class="source_keyword">false</font>;
<a name="4294"></a>        
<a name="4295"></a>        HitActor = Trace(HitLocation, HitNormal, Enemy.Location, Location + <font class="source_int">2</font> * Y * CollisionRadius, <font class="source_keyword">false</font>);
<a name="4296"></a>        <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="4297"></a>        {
<a name="4298"></a>            Destination = Location + <font class="source_int">2.5</font> * Y * CollisionRadius;
<a name="4299"></a>            <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="4300"></a>        }
<a name="4301"></a>
<a name="4302"></a>        HitActor = Trace(HitLocation, HitNormal, Enemy.Location, Location - <font class="source_int">2</font> * Y * CollisionRadius, <font class="source_keyword">false</font>);
<a name="4303"></a>        <font class="source_keyword">if</font> ( HitActor == <font class="source_keyword">None</font> )
<a name="4304"></a>        {
<a name="4305"></a>            Destination = Location - <font class="source_int">2.5</font> * Y * CollisionRadius;
<a name="4306"></a>            <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="4307"></a>        }
<a name="4308"></a>        <font class="source_keyword">if</font> ( bAlwaysTry )
<a name="4309"></a>        {
<a name="4310"></a>            <font class="source_keyword">if</font> ( FRand() &lt; <font class="source_int">0.5</font> )
<a name="4311"></a>                Destination = Location - <font class="source_int">2.5</font> * Y * CollisionRadius;
<a name="4312"></a>            <font class="source_keyword">else</font>
<a name="4313"></a>                Destination = Location - <font class="source_int">2.5</font> * Y * CollisionRadius;
<a name="4314"></a>            <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="4315"></a>        }
<a name="4316"></a>
<a name="4317"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="4318"></a>    }
<a name="4319"></a>
<a name="4320"></a>    <font class="source_keyword">function</font> BeginState()
<a name="4321"></a>    {
<a name="4322"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="4323"></a>            log(self$<font class="source_string">" hunting while dead"</font>);
<a name="4324"></a>        SpecialGoal = <font class="source_keyword">None</font>;
<a name="4325"></a>        SpecialPause = <font class="source_int">0.0</font>;
<a name="4326"></a>        bFromWall = <font class="source_keyword">false</font>;
<a name="4327"></a>        SetAlertness(<font class="source_int">0.5</font>);
<a name="4328"></a>    }
<a name="4329"></a>
<a name="4330"></a>    <font class="source_keyword">function</font> EndState()
<a name="4331"></a>    {
<a name="4332"></a>        bAvoidLedges = <font class="source_keyword">false</font>;
<a name="4333"></a>        bHunting = <font class="source_keyword">false</font>;
<a name="4334"></a>        <font class="source_keyword">if</font> ( JumpZ &gt; <font class="source_int">0</font> )
<a name="4335"></a>            bCanJump = <font class="source_keyword">true</font>;
<a name="4336"></a>    }
<a name="4337"></a>
<a name="4338"></a>AdjustFromWall:
<a name="4339"></a>    StrafeTo(Destination, Focus); 
<a name="4340"></a>    Destination = Focus; 
<a name="4341"></a>    <font class="source_keyword">if</font> ( MoveTarget != <font class="source_keyword">None</font> )
<a name="4342"></a>        Goto(<font class="source_name">'SpecialNavig'</font>);
<a name="4343"></a>    <font class="source_keyword">else</font>
<a name="4344"></a>        Goto(<font class="source_name">'Follow'</font>);
<a name="4345"></a>
<a name="4346"></a>Begin:
<a name="4347"></a>    numHuntPaths = <font class="source_int">0</font>;
<a name="4348"></a>    HuntStartTime = <font class="source_type">Level</font>.TimeSeconds;
<a name="4349"></a>AfterFall:
<a name="4350"></a>    TweenToRunning(<font class="source_int">0.15</font>);
<a name="4351"></a>    bFromWall = <font class="source_keyword">false</font>;
<a name="4352"></a>
<a name="4353"></a>Follow:
<a name="4354"></a>    WaitForLanding();
<a name="4355"></a>    <font class="source_keyword">if</font> ( CanSee(Enemy) )
<a name="4356"></a>        SetEnemy(Enemy);
<a name="4357"></a>    PickDestination();
<a name="4358"></a>SpecialNavig:
<a name="4359"></a>    <font class="source_keyword">if</font> ( SpecialPause &gt; <font class="source_int">0.0</font> )
<a name="4360"></a>    {
<a name="4361"></a>        Disable(<font class="source_name">'AnimEnd'</font>);
<a name="4362"></a>        Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="4363"></a>        PlayChallenge();
<a name="4364"></a>        Sleep(SpecialPause);
<a name="4365"></a>        SpecialPause = <font class="source_int">0.0</font>;
<a name="4366"></a>        Enable(<font class="source_name">'AnimEnd'</font>);
<a name="4367"></a>        Goto(<font class="source_name">'AfterFall'</font>);
<a name="4368"></a>    }
<a name="4369"></a>    <font class="source_keyword">if</font> (MoveTarget == <font class="source_keyword">None</font>)
<a name="4370"></a>        MoveTo(Destination);
<a name="4371"></a>    <font class="source_keyword">else</font>
<a name="4372"></a>        MoveToward(MoveTarget); 
<a name="4373"></a>
<a name="4374"></a>    Goto(<font class="source_name">'Follow'</font>);
<a name="4375"></a>}
<a name="4376"></a>
<a name="4377"></a><font class="source_keyword">state</font> StakeOut
<a name="4378"></a>{
<a name="4379"></a><font class="source_keyword">ignores</font> EnemyNotVisible; 
<a name="4380"></a>
<a name="4381"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="4382"></a>                            <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="4383"></a>    {
<a name="4384"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="4385"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="4386"></a>            <font class="source_keyword">return</font>;
<a name="4387"></a>        bFrustrated = <font class="source_keyword">true</font>;
<a name="4388"></a>        LastSeenPos = Enemy.Location;
<a name="4389"></a>        <font class="source_keyword">if</font> (NextState == <font class="source_name">'TakeHit'</font>)
<a name="4390"></a>        {
<a name="4391"></a>            <font class="source_keyword">if</font> (AttitudeTo(Enemy) == ATTITUDE_Fear)
<a name="4392"></a>            {
<a name="4393"></a>                NextState = <font class="source_name">'Retreating'</font>;
<a name="4394"></a>                NextLabel = <font class="source_name">'Begin'</font>;
<a name="4395"></a>            }
<a name="4396"></a>            <font class="source_keyword">else</font>
<a name="4397"></a>            {
<a name="4398"></a>                NextState = <font class="source_name">'Attacking'</font>;
<a name="4399"></a>                NextLabel = <font class="source_name">'Begin'</font>;
<a name="4400"></a>            }
<a name="4401"></a>            GotoState(<font class="source_name">'TakeHit'</font>); 
<a name="4402"></a>        }
<a name="4403"></a>        <font class="source_keyword">else</font>
<a name="4404"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="4405"></a>    }
<a name="4406"></a>
<a name="4407"></a>    <font class="source_keyword">function</font> HearNoise(<font class="source_keyword">float</font> Loudness, <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> NoiseMaker)
<a name="4408"></a>    {
<a name="4409"></a>        <font class="source_keyword">if</font> ( SetEnemy(NoiseMaker.instigator) )
<a name="4410"></a>            LastSeenPos = Enemy.Location; 
<a name="4411"></a>    }
<a name="4412"></a>
<a name="4413"></a>    <font class="source_keyword">function</font> SetFall()
<a name="4414"></a>    {
<a name="4415"></a>        NextState = <font class="source_name">'StakeOut'</font>; 
<a name="4416"></a>        NextLabel = <font class="source_name">'Begin'</font>;
<a name="4417"></a>        NextAnim = AnimSequence;
<a name="4418"></a>        GotoState(<font class="source_name">'FallingState'</font>); 
<a name="4419"></a>    }
<a name="4420"></a>
<a name="4421"></a>    <font class="source_keyword">function</font> <font class="source_keyword">bool</font> SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> NewEnemy)
<a name="4422"></a>    {
<a name="4423"></a>        <font class="source_keyword">if</font> (Global.SetEnemy(NewEnemy))
<a name="4424"></a>        {
<a name="4425"></a>            bReadyToAttack = <font class="source_keyword">true</font>;
<a name="4426"></a>            DesiredRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(Enemy.Location - Location);
<a name="4427"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="4428"></a>            <font class="source_keyword">return</font> <font class="source_keyword">true</font>;
<a name="4429"></a>        }
<a name="4430"></a>        <font class="source_keyword">return</font> <font class="source_keyword">false</font>;
<a name="4431"></a>    } 
<a name="4432"></a>    
<a name="4433"></a>    <font class="source_keyword">function</font> Timer()
<a name="4434"></a>    {
<a name="4435"></a>        bReadyToAttack = <font class="source_keyword">true</font>;
<a name="4436"></a>        Enable(<font class="source_name">'Bump'</font>);
<a name="4437"></a>        SetTimer(<font class="source_int">1.0</font>, <font class="source_keyword">false</font>);
<a name="4438"></a>    }
<a name="4439"></a>
<a name="4440"></a>    <font class="source_keyword">function</font> <font class="source_type"><a href="..\core\object.html#Rotator" class="source">rotator</a></font> AdjustAim(<font class="source_keyword">float</font> projSpeed, <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> projStart, <font class="source_keyword">int</font> aimerror, <font class="source_keyword">bool</font> leadTarget, <font class="source_keyword">bool</font> warnTarget)
<a name="4441"></a>    {
<a name="4442"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Rotator" class="source">rotator</a></font> FireRotation;
<a name="4443"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> FireSpot;
<a name="4444"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="4445"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, HitNormal;
<a name="4446"></a>                
<a name="4447"></a>        FireSpot = LastSeenPos;
<a name="4448"></a>        aimerror = aimerror * (<font class="source_int">0.5</font> * (<font class="source_int">4</font> - skill - FRand()));    
<a name="4449"></a>             
<a name="4450"></a>        HitActor = Trace(HitLocation, HitNormal, FireSpot, ProjStart, <font class="source_keyword">false</font>);
<a name="4451"></a>        <font class="source_keyword">if</font>( HitActor != <font class="source_keyword">None</font> ) 
<a name="4452"></a>        {
<a name="4453"></a>            <font class="source_comment">////log("adjust aim up");
</font><a name="4454"></a>            FireSpot.Z += <font class="source_int">0.9</font> * Target.CollisionHeight;
<a name="4455"></a>            HitActor = Trace(HitLocation, HitNormal, FireSpot, ProjStart, <font class="source_keyword">false</font>);
<a name="4456"></a>            bClearShot = (HitActor == <font class="source_keyword">None</font>);
<a name="4457"></a>        }
<a name="4458"></a>        
<a name="4459"></a>        FireRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(FireSpot - ProjStart);
<a name="4460"></a>             
<a name="4461"></a>        FireRotation.Yaw = FireRotation.Yaw + <font class="source_int">0.5</font> * (Rand(<font class="source_int">2</font> * aimerror) - aimerror);
<a name="4462"></a>        viewRotation = FireRotation;            
<a name="4463"></a>        <font class="source_keyword">return</font> FireRotation;
<a name="4464"></a>    }
<a name="4465"></a>        
<a name="4466"></a>    <font class="source_keyword">function</font> BeginState()
<a name="4467"></a>    {
<a name="4468"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="4469"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, HitNormal;
<a name="4470"></a>
<a name="4471"></a>        Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="4472"></a>        bCanJump = <font class="source_keyword">false</font>;
<a name="4473"></a>        HitActor = Trace(HitLocation, HitNormal, LastSeenPos + vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0.9</font>) * Enemy.CollisionHeight, Location + vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0.8</font>) * EyeHeight, <font class="source_keyword">false</font>);
<a name="4474"></a>        bClearShot = (HitActor == <font class="source_keyword">None</font>);
<a name="4475"></a>        bReadyToAttack = <font class="source_keyword">true</font>;
<a name="4476"></a>        SetAlertness(<font class="source_int">0.5</font>);
<a name="4477"></a>    }
<a name="4478"></a>
<a name="4479"></a>    <font class="source_keyword">function</font> EndState()
<a name="4480"></a>    {
<a name="4481"></a>        <font class="source_keyword">if</font> ( JumpZ &gt; <font class="source_int">0</font> )
<a name="4482"></a>            bCanJump = <font class="source_keyword">true</font>;
<a name="4483"></a>    }
<a name="4484"></a>
<a name="4485"></a>Begin:
<a name="4486"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="4487"></a>    PlayChallenge();
<a name="4488"></a>    TurnTo(LastSeenPos);
<a name="4489"></a>    <font class="source_keyword">if</font> ( bClearShot && (FRand() &lt; <font class="source_int">0.5</font>) && (VSize(Enemy.Location - LastSeenPos) &lt; <font class="source_int">150</font>) 
<a name="4490"></a>        && CanStakeOut() )
<a name="4491"></a>        PlayRangedAttack();
<a name="4492"></a>    FinishAnim();
<a name="4493"></a>    PlayChallenge();
<a name="4494"></a>    <font class="source_keyword">if</font> ( bCrouching && !<font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.bWaterZone )
<a name="4495"></a>        Sleep(<font class="source_int">1</font>);
<a name="4496"></a>    bCrouching = <font class="source_keyword">false</font>;
<a name="4497"></a>    Sleep(<font class="source_int">1</font> + FRand());
<a name="4498"></a>    <font class="source_keyword">if</font> ( !bClearShot || (VSize(Enemy.Location - Location) 
<a name="4499"></a>                &gt; <font class="source_int">300</font> + (FRand() * RelativeStrength(Enemy) - CombatStyle) * <font class="source_int">350</font>) )
<a name="4500"></a>        GotoState(<font class="source_name">'Hunting'</font>, <font class="source_name">'AfterFall'</font>);
<a name="4501"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( CanStakeOut() )
<a name="4502"></a>        Goto(<font class="source_name">'Begin'</font>);
<a name="4503"></a>    <font class="source_keyword">else</font>
<a name="4504"></a>        GotoState(<font class="source_name">'Hunting'</font>, <font class="source_name">'AfterFall'</font>);
<a name="4505"></a>}
<a name="4506"></a>
<a name="4507"></a><font class="source_keyword">state</font> TakeHit 
<a name="4508"></a>{
<a name="4509"></a><font class="source_keyword">ignores</font> seeplayer, hearnoise, bump, hitwall;
<a name="4510"></a>
<a name="4511"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="4512"></a>                        <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="4513"></a>    {
<a name="4514"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="4515"></a>    }
<a name="4516"></a>
<a name="4517"></a>    <font class="source_keyword">function</font> Landed(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal)
<a name="4518"></a>    {
<a name="4519"></a>        <font class="source_keyword">if</font> (Velocity.Z &lt; -<font class="source_int">1.4</font> * JumpZ)
<a name="4520"></a>            MakeNoise(-<font class="source_int">0.5</font> * Velocity.Z/(FMax(JumpZ, <font class="source_int">150.0</font>)));
<a name="4521"></a>        bJustLanded = <font class="source_keyword">true</font>;
<a name="4522"></a>    }
<a name="4523"></a>
<a name="4524"></a>    <font class="source_keyword">function</font> Timer()
<a name="4525"></a>    {
<a name="4526"></a>        bReadyToAttack = <font class="source_keyword">true</font>;
<a name="4527"></a>    }
<a name="4528"></a>
<a name="4529"></a>    <font class="source_keyword">function</font> PlayHitAnim(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitLocation, <font class="source_keyword">float</font> Damage)
<a name="4530"></a>    {
<a name="4531"></a>        <font class="source_keyword">if</font> ( LastPainTime - <font class="source_type">Level</font>.TimeSeconds &gt; <font class="source_int">0.1</font> )
<a name="4532"></a>        {
<a name="4533"></a>            PlayTakeHit(<font class="source_int">0.1</font>, hitLocation, Damage);
<a name="4534"></a>            BeginState();
<a name="4535"></a>            GotoState(<font class="source_name">'TakeHit'</font>, <font class="source_name">'Begin'</font>);
<a name="4536"></a>        } 
<a name="4537"></a>    }   
<a name="4538"></a>
<a name="4539"></a>    <font class="source_keyword">function</font> BeginState()
<a name="4540"></a>    {
<a name="4541"></a>        LastPainTime = <font class="source_type">Level</font>.TimeSeconds;
<a name="4542"></a>        LastPainAnim = AnimSequence;
<a name="4543"></a>    }
<a name="4544"></a>        
<a name="4545"></a>Begin:
<a name="4546"></a>    <font class="source_comment">// Acceleration = Normal(Acceleration);
</font><a name="4547"></a>    FinishAnim();
<a name="4548"></a>    <font class="source_keyword">if</font> ( skill &lt; <font class="source_int">2</font> )
<a name="4549"></a>        Sleep(<font class="source_int">0.05</font>);
<a name="4550"></a>    <font class="source_keyword">if</font> ( (Physics == PHYS_Falling) && !<font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.bWaterZone )
<a name="4551"></a>    {
<a name="4552"></a>        Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="4553"></a>        NextAnim = <font class="source_name">''</font>;
<a name="4554"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font> )
<a name="4555"></a>            log(self$<font class="source_string">" fall from takehit while dead"</font>);
<a name="4556"></a>        GotoState(<font class="source_name">'FallingState'</font>, <font class="source_name">'Ducking'</font>);
<a name="4557"></a>    }
<a name="4558"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font> (NextState != <font class="source_name">''</font>)
<a name="4559"></a>        GotoState(NextState, NextLabel);
<a name="4560"></a>    <font class="source_keyword">else</font>
<a name="4561"></a>        GotoState(<font class="source_name">'Attacking'</font>);
<a name="4562"></a>}
<a name="4563"></a>
<a name="4564"></a><font class="source_keyword">state</font> FallingState 
<a name="4565"></a>{
<a name="4566"></a><font class="source_keyword">ignores</font> Bump, Hitwall, WarnTarget;
<a name="4567"></a>
<a name="4568"></a>    singular <font class="source_keyword">event</font> BaseChange()
<a name="4569"></a>    {
<a name="4570"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> HitActor;
<a name="4571"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal, HitLocation;
<a name="4572"></a>
<a name="4573"></a>        <font class="source_keyword">if</font> ( (Base != <font class="source_keyword">None</font>) && Base.IsA(<font class="source_name">'Mover'</font>)
<a name="4574"></a>            && ((MoveTarget == Base) 
<a name="4575"></a>                || ((MoveTarget != <font class="source_keyword">None</font>) && (MoveTarget == <font class="source_type"><a href="..\engine\mover.html" class="source">Mover</a></font>(Base).myMarker))) )
<a name="4576"></a>        {
<a name="4577"></a>            MoveTimer = -<font class="source_int">1.0</font>;
<a name="4578"></a>            MoveTarget = <font class="source_keyword">None</font>;
<a name="4579"></a>            acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="4580"></a>        }
<a name="4581"></a>        <font class="source_keyword">else</font>
<a name="4582"></a>            <font class="source_keyword">Super</font>.BaseChange();
<a name="4583"></a>    }
<a name="4584"></a>
<a name="4585"></a>    <font class="source_keyword">function</font> ZoneChange(<font class="source_type"><a href="..\engine\zoneinfo.html" class="source">ZoneInfo</a></font> newZone)
<a name="4586"></a>    {
<a name="4587"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font> )
<a name="4588"></a>            log(<font class="source_string">"Zonechange in falling state while dead"</font>);
<a name="4589"></a>        Global.ZoneChange(newZone);
<a name="4590"></a>        <font class="source_keyword">if</font> (newZone.bWaterZone)
<a name="4591"></a>        {
<a name="4592"></a>            TweenToWaiting(<font class="source_int">0.15</font>);
<a name="4593"></a>            <font class="source_comment">//FIXME - play splash sound and effect
</font><a name="4594"></a>            GotoState(<font class="source_name">'FallingState'</font>, <font class="source_name">'Splash'</font>);
<a name="4595"></a>        }
<a name="4596"></a>    }
<a name="4597"></a>    
<a name="4598"></a>    <font class="source_comment">//choose a jump velocity
</font><a name="4599"></a>    <font class="source_keyword">function</font> adjustJump()
<a name="4600"></a>    {
<a name="4601"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> velZ;
<a name="4602"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> FullVel;
<a name="4603"></a>
<a name="4604"></a>        velZ = Velocity.Z;
<a name="4605"></a>        FullVel = Normal(Velocity) * GroundSpeed;
<a name="4606"></a>
<a name="4607"></a>        <font class="source_keyword">If</font> (Location.Z &gt; Destination.Z + CollisionHeight + <font class="source_int">2</font> * MaxStepHeight)
<a name="4608"></a>        {
<a name="4609"></a>            Velocity = FullVel;
<a name="4610"></a>            Velocity.Z = velZ;
<a name="4611"></a>            Velocity = EAdjustJump();
<a name="4612"></a>            Velocity.Z = <font class="source_int">0</font>;
<a name="4613"></a>            <font class="source_keyword">if</font> ( VSize(Velocity) &lt; <font class="source_int">0.9</font> * GroundSpeed )
<a name="4614"></a>            {
<a name="4615"></a>                Velocity.Z = velZ;
<a name="4616"></a>                <font class="source_keyword">return</font>;
<a name="4617"></a>            }
<a name="4618"></a>        }
<a name="4619"></a>
<a name="4620"></a>        Velocity = FullVel;
<a name="4621"></a>        Velocity.Z = JumpZ + velZ;
<a name="4622"></a>        Velocity = EAdjustJump();
<a name="4623"></a>    }
<a name="4624"></a>
<a name="4625"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="4626"></a>                            <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="4627"></a>    {
<a name="4628"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="4629"></a>
<a name="4630"></a>        <font class="source_keyword">if</font> (Enemy == <font class="source_keyword">None</font>)
<a name="4631"></a>        {
<a name="4632"></a>            Enemy = instigatedBy;
<a name="4633"></a>            NextState = <font class="source_name">'Attacking'</font>; 
<a name="4634"></a>            NextLabel = <font class="source_name">'Begin'</font>;
<a name="4635"></a>        }
<a name="4636"></a>        <font class="source_keyword">if</font> (Enemy != <font class="source_keyword">None</font>)
<a name="4637"></a>            LastSeenPos = Enemy.Location;
<a name="4638"></a>        <font class="source_keyword">if</font> (NextState == <font class="source_name">'TakeHit'</font>)
<a name="4639"></a>        {
<a name="4640"></a>            NextState = <font class="source_name">'Attacking'</font>; 
<a name="4641"></a>            NextLabel = <font class="source_name">'Begin'</font>;
<a name="4642"></a>            GotoState(<font class="source_name">'TakeHit'</font>); 
<a name="4643"></a>        }
<a name="4644"></a>    }
<a name="4645"></a>
<a name="4646"></a>    <font class="source_keyword">function</font> <font class="source_keyword">bool</font> SetEnemy(<font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> NewEnemy)
<a name="4647"></a>    {
<a name="4648"></a>        <font class="source_keyword">local</font> <font class="source_keyword">bool</font> result;
<a name="4649"></a>        result = <font class="source_keyword">false</font>;
<a name="4650"></a>        <font class="source_keyword">if</font> ( Global.SetEnemy(NewEnemy))
<a name="4651"></a>        {
<a name="4652"></a>            result = <font class="source_keyword">true</font>;
<a name="4653"></a>            NextState = <font class="source_name">'Attacking'</font>; 
<a name="4654"></a>            NextLabel = <font class="source_name">'Begin'</font>;
<a name="4655"></a>        }
<a name="4656"></a>        <font class="source_keyword">return</font> result;
<a name="4657"></a>    } 
<a name="4658"></a>
<a name="4659"></a>    <font class="source_keyword">function</font> Timer()
<a name="4660"></a>    {
<a name="4661"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font> )
<a name="4662"></a>            log(self$<font class="source_string">" fall from timer while dead"</font>);
<a name="4663"></a>        <font class="source_keyword">if</font> ( Enemy != <font class="source_keyword">None</font> )
<a name="4664"></a>        {
<a name="4665"></a>            bReadyToAttack = <font class="source_keyword">true</font>;
<a name="4666"></a>            <font class="source_keyword">if</font> ( CanFireAtEnemy() )
<a name="4667"></a>                GotoState(<font class="source_name">'FallingState'</font>, <font class="source_name">'FireWhileFalling'</font>);
<a name="4668"></a>        }
<a name="4669"></a>    }
<a name="4670"></a>
<a name="4671"></a>    <font class="source_keyword">function</font> Landed(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal)
<a name="4672"></a>    {
<a name="4673"></a>        <font class="source_keyword">local</font> <font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> Vel2D;
<a name="4674"></a>
<a name="4675"></a>        <font class="source_keyword">if</font> ( MoveTarget != <font class="source_keyword">None</font> )
<a name="4676"></a>        {
<a name="4677"></a>            Vel2D = Velocity;
<a name="4678"></a>            Vel2D.Z = <font class="source_int">0</font>;
<a name="4679"></a>            <font class="source_keyword">if</font> ( (Vel2D Dot (MoveTarget.Location - Location)) &lt; <font class="source_int">0</font> )
<a name="4680"></a>                Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="4681"></a>        }
<a name="4682"></a>        <font class="source_comment">//Note - physics changes type to PHYS_Walking by default for landed pawns
</font><a name="4683"></a>        PlayLanded(Velocity.Z);
<a name="4684"></a>        <font class="source_keyword">if</font> (Velocity.Z &lt; -<font class="source_int">1.4</font> * JumpZ)
<a name="4685"></a>        {
<a name="4686"></a>            MakeNoise(-<font class="source_int">0.5</font> * Velocity.Z/(FMax(JumpZ, <font class="source_int">150.0</font>)));
<a name="4687"></a>            <font class="source_keyword">if</font> (Velocity.Z &lt;= -<font class="source_int">1100</font>)
<a name="4688"></a>            {
<a name="4689"></a>                <font class="source_keyword">if</font> ( (Velocity.Z &lt; -<font class="source_int">2000</font>) && (ReducedDamageType != <font class="source_name">'All'</font>) )
<a name="4690"></a>                {
<a name="4691"></a>                    <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> = -<font class="source_int">1000</font>; <font class="source_comment">//make sure gibs
</font><a name="4692"></a>                    Died(<font class="source_keyword">None</font>, <font class="source_name">'Fell'</font>, Location);
<a name="4693"></a>                }
<a name="4694"></a>                <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( Role == ROLE_Authority )
<a name="4695"></a>                    TakeDamage(-<font class="source_int">0.15</font> * (Velocity.Z + <font class="source_int">1050</font>), <font class="source_keyword">None</font>, Location, vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>), <font class="source_name">'Fell'</font>);
<a name="4696"></a>            }
<a name="4697"></a>            <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &gt; <font class="source_int">0</font> )
<a name="4698"></a>                GotoState(<font class="source_name">'FallingState'</font>, <font class="source_name">'Landed'</font>);
<a name="4699"></a>        }
<a name="4700"></a>        <font class="source_keyword">else</font> 
<a name="4701"></a>            GotoState(<font class="source_name">'FallingState'</font>, <font class="source_name">'Done'</font>);
<a name="4702"></a>    }
<a name="4703"></a>    
<a name="4704"></a>    <font class="source_keyword">function</font> SeePlayer(<font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> SeenPlayer)
<a name="4705"></a>    {
<a name="4706"></a>        Global.SeePlayer(SeenPlayer);
<a name="4707"></a>        disable(<font class="source_name">'SeePlayer'</font>);
<a name="4708"></a>        disable(<font class="source_name">'HearNoise'</font>);
<a name="4709"></a>    }
<a name="4710"></a>
<a name="4711"></a>    <font class="source_keyword">function</font> EnemyNotVisible()
<a name="4712"></a>    {
<a name="4713"></a>        enable(<font class="source_name">'SeePlayer'</font>);
<a name="4714"></a>        enable(<font class="source_name">'HearNoise'</font>);
<a name="4715"></a>    }
<a name="4716"></a>
<a name="4717"></a>    <font class="source_keyword">function</font> SetFall()
<a name="4718"></a>    {
<a name="4719"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt; <font class="source_int">0</font> )
<a name="4720"></a>            log(self$<font class="source_string">" setfall from fall"</font>);
<a name="4721"></a>        <font class="source_keyword">if</font> (!bUpAndOut)
<a name="4722"></a>            GotoState(<font class="source_name">'FallingState'</font>);
<a name="4723"></a>    }
<a name="4724"></a>    
<a name="4725"></a>    <font class="source_keyword">function</font> EnemyAcquired()
<a name="4726"></a>    {
<a name="4727"></a>        NextState = <font class="source_name">'Acquisition'</font>;
<a name="4728"></a>        NextLabel = <font class="source_name">'Begin'</font>;
<a name="4729"></a>    }
<a name="4730"></a>
<a name="4731"></a>    <font class="source_keyword">function</font> BeginState()
<a name="4732"></a>    {
<a name="4733"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font> )
<a name="4734"></a>            log(self$<font class="source_string">" entered falling state at "</font>$<font class="source_type">Level</font>.Timeseconds$ <font class="source_string">"with next "</font>$NextState);
<a name="4735"></a>        <font class="source_keyword">if</font> (Enemy == <font class="source_keyword">None</font>)
<a name="4736"></a>            Disable(<font class="source_name">'EnemyNotVisible'</font>);
<a name="4737"></a>        <font class="source_keyword">else</font>
<a name="4738"></a>        {
<a name="4739"></a>            Disable(<font class="source_name">'HearNoise'</font>);
<a name="4740"></a>            Disable(<font class="source_name">'SeePlayer'</font>);
<a name="4741"></a>        }
<a name="4742"></a>        <font class="source_keyword">if</font> ( (bFire &gt; <font class="source_int">0</font>) || (bAltFire &gt; <font class="source_int">0</font>) || (Skill == <font class="source_int">3</font>) )
<a name="4743"></a>            SetTimer(<font class="source_int">0.01</font>, <font class="source_keyword">false</font>);
<a name="4744"></a>    }
<a name="4745"></a>
<a name="4746"></a>    <font class="source_keyword">function</font> EndState()
<a name="4747"></a>    {
<a name="4748"></a>        bUpAndOut = <font class="source_keyword">false</font>;
<a name="4749"></a>    }
<a name="4750"></a>
<a name="4751"></a>FireWhileFalling:
<a name="4752"></a>    <font class="source_keyword">if</font> ( Physics != PHYS_Falling )
<a name="4753"></a>        Goto(<font class="source_name">'Done'</font>);
<a name="4754"></a>    TurnToward(Enemy);
<a name="4755"></a>    <font class="source_keyword">if</font> ( CanFireAtEnemy() )
<a name="4756"></a>        FireWeapon();
<a name="4757"></a>    Sleep(<font class="source_int">0.9</font> + <font class="source_int">0.2</font> * FRand());
<a name="4758"></a>    Goto(<font class="source_name">'FireWhileFalling'</font>);
<a name="4759"></a>            
<a name="4760"></a>LongFall:
<a name="4761"></a>    <font class="source_keyword">if</font> ( bCanFly )
<a name="4762"></a>    {
<a name="4763"></a>        SetPhysics(PHYS_Flying);
<a name="4764"></a>        Goto(<font class="source_name">'Done'</font>);
<a name="4765"></a>    }
<a name="4766"></a>    Sleep(<font class="source_int">0.7</font>);
<a name="4767"></a>    TweenToFighter(<font class="source_int">0.2</font>);
<a name="4768"></a>    <font class="source_keyword">if</font> ( Enemy != <font class="source_keyword">None</font> )
<a name="4769"></a>    {
<a name="4770"></a>        TurnToward(Enemy);
<a name="4771"></a>        FinishAnim();
<a name="4772"></a>        <font class="source_keyword">if</font> ( CanFireAtEnemy() )
<a name="4773"></a>        {
<a name="4774"></a>            PlayRangedAttack();
<a name="4775"></a>            FinishAnim();
<a name="4776"></a>        }
<a name="4777"></a>        PlayChallenge();
<a name="4778"></a>        FinishAnim();
<a name="4779"></a>    }
<a name="4780"></a>    TweenToFalling();
<a name="4781"></a>    <font class="source_keyword">if</font> ( Velocity.Z &gt; -<font class="source_int">150</font> ) <font class="source_comment">//stuck
</font><a name="4782"></a>    {
<a name="4783"></a>        SetPhysics(PHYS_Falling);
<a name="4784"></a>        <font class="source_keyword">if</font> ( Enemy != <font class="source_keyword">None</font> )
<a name="4785"></a>            Velocity = groundspeed * normal(Enemy.Location - Location);
<a name="4786"></a>        <font class="source_keyword">else</font>
<a name="4787"></a>            Velocity = groundspeed * VRand();
<a name="4788"></a>
<a name="4789"></a>        Velocity.Z = FMax(JumpZ, <font class="source_int">250</font>);
<a name="4790"></a>    }
<a name="4791"></a>    Goto(<font class="source_name">'LongFall'</font>);   
<a name="4792"></a>
<a name="4793"></a>Landed:
<a name="4794"></a>    <font class="source_comment">//log("Playing "$animsequence$" at "$animframe);
</font><a name="4795"></a>    FinishAnim();
<a name="4796"></a>    <font class="source_comment">//log("Finished "$animsequence$" at "$animframe);
</font><a name="4797"></a>Done:
<a name="4798"></a>    <font class="source_keyword">if</font> ( NextAnim == <font class="source_name">''</font> )
<a name="4799"></a>    {
<a name="4800"></a>        bUpAndOut = <font class="source_keyword">false</font>;
<a name="4801"></a>        <font class="source_keyword">if</font> ( NextState != <font class="source_name">''</font> )
<a name="4802"></a>            GotoState(NextState, NextLabel);
<a name="4803"></a>        <font class="source_keyword">else</font> 
<a name="4804"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="4805"></a>    }
<a name="4806"></a>    <font class="source_keyword">if</font> ( !bUpAndOut )
<a name="4807"></a>    {
<a name="4808"></a>        <font class="source_keyword">if</font> ( NextAnim == <font class="source_name">'Fighter'</font> )
<a name="4809"></a>            TweenToFighter(<font class="source_int">0.2</font>);
<a name="4810"></a>        <font class="source_keyword">else</font>
<a name="4811"></a>            TweenAnim(NextAnim, <font class="source_int">0.12</font>);
<a name="4812"></a>    } 
<a name="4813"></a>
<a name="4814"></a><font class="source_type"><a href="..\unrealshare\splash.html" class="source">Splash</a></font>:
<a name="4815"></a>    bUpAndOut = <font class="source_keyword">false</font>;
<a name="4816"></a>    <font class="source_keyword">if</font> ( NextState != <font class="source_name">''</font> )
<a name="4817"></a>        GotoState(NextState, NextLabel);
<a name="4818"></a>    <font class="source_keyword">else</font> 
<a name="4819"></a>        GotoState(<font class="source_name">'Attacking'</font>);
<a name="4820"></a>            
<a name="4821"></a>Begin:
<a name="4822"></a>    <font class="source_keyword">if</font> (Enemy == <font class="source_keyword">None</font>)
<a name="4823"></a>        Disable(<font class="source_name">'EnemyNotVisible'</font>);
<a name="4824"></a>    <font class="source_keyword">else</font>
<a name="4825"></a>    {
<a name="4826"></a>        Disable(<font class="source_name">'HearNoise'</font>);
<a name="4827"></a>        Disable(<font class="source_name">'SeePlayer'</font>);
<a name="4828"></a>    }
<a name="4829"></a>    <font class="source_keyword">if</font> ( !bUpAndOut ) <font class="source_comment">// not water jump
</font><a name="4830"></a>    {   
<a name="4831"></a>        <font class="source_keyword">if</font> (<font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.bWaterZone)
<a name="4832"></a>        {
<a name="4833"></a>            SetPhysics(PHYS_Swimming);
<a name="4834"></a>            GotoState(NextState, NextLabel);
<a name="4835"></a>        }   
<a name="4836"></a>        <font class="source_keyword">if</font> ( !bJumpOffPawn )
<a name="4837"></a>            AdjustJump();
<a name="4838"></a>        <font class="source_keyword">else</font>
<a name="4839"></a>            bJumpOffPawn = <font class="source_keyword">false</font>;
<a name="4840"></a>PlayFall:
<a name="4841"></a>        TweenToFalling();
<a name="4842"></a>        FinishAnim();
<a name="4843"></a>        PlayInAir();
<a name="4844"></a>    }
<a name="4845"></a>    
<a name="4846"></a>    <font class="source_keyword">if</font> (Physics != PHYS_Falling)
<a name="4847"></a>        Goto(<font class="source_name">'Done'</font>);
<a name="4848"></a>    Sleep(<font class="source_int">2.0</font>);
<a name="4849"></a>    Goto(<font class="source_name">'LongFall'</font>);
<a name="4850"></a>
<a name="4851"></a>Ducking:
<a name="4852"></a>        
<a name="4853"></a>}
<a name="4854"></a>
<a name="4855"></a><font class="source_keyword">state</font> RangedAttack
<a name="4856"></a>{
<a name="4857"></a><font class="source_keyword">ignores</font> SeePlayer, HearNoise, Bump;
<a name="4858"></a>
<a name="4859"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="4860"></a>                        <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="4861"></a>    {
<a name="4862"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="4863"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="4864"></a>            <font class="source_keyword">return</font>;
<a name="4865"></a>        <font class="source_keyword">if</font> (NextState == <font class="source_name">'TakeHit'</font>)
<a name="4866"></a>        {
<a name="4867"></a>            NextState = <font class="source_name">'RangedAttack'</font>;
<a name="4868"></a>            NextLabel = <font class="source_name">'Begin'</font>;
<a name="4869"></a>        }
<a name="4870"></a>    }
<a name="4871"></a>
<a name="4872"></a>    <font class="source_keyword">function</font> StopWaiting()
<a name="4873"></a>    {
<a name="4874"></a>        Timer();
<a name="4875"></a>    }
<a name="4876"></a>
<a name="4877"></a>    <font class="source_keyword">function</font> EnemyNotVisible()
<a name="4878"></a>    {
<a name="4879"></a>        <font class="source_comment">////log("enemy not visible");
</font><a name="4880"></a>        <font class="source_comment">//let attack animation completes
</font><a name="4881"></a>    }
<a name="4882"></a>
<a name="4883"></a>    <font class="source_keyword">function</font> KeepAttacking()
<a name="4884"></a>    {
<a name="4885"></a>        <font class="source_keyword">if</font> ( bFiringPaused )
<a name="4886"></a>            <font class="source_keyword">return</font>;
<a name="4887"></a>        <font class="source_keyword">if</font> ( (Enemy == <font class="source_keyword">None</font>) || (Enemy.<font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font>) || !LineOfSightTo(Enemy) )
<a name="4888"></a>        {
<a name="4889"></a>            bFire = <font class="source_int">0</font>;
<a name="4890"></a>            bAltFire = <font class="source_int">0</font>; 
<a name="4891"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="4892"></a>        }
<a name="4893"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> ( Skill &gt; <font class="source_int">3.5</font> * FRand() - <font class="source_int">0.5</font> )
<a name="4894"></a>        {
<a name="4895"></a>            bReadyToAttack = <font class="source_keyword">true</font>;
<a name="4896"></a>            GotoState(<font class="source_name">'TacticalMove'</font>);
<a name="4897"></a>        }   
<a name="4898"></a>    }
<a name="4899"></a>
<a name="4900"></a>    <font class="source_keyword">function</font> Timer()
<a name="4901"></a>    {
<a name="4902"></a>        <font class="source_keyword">if</font> ( bFiringPaused )
<a name="4903"></a>        {
<a name="4904"></a>            TweenToRunning(<font class="source_int">0.12</font>);
<a name="4905"></a>            GotoState(NextState, NextLabel);
<a name="4906"></a>        }
<a name="4907"></a>    }
<a name="4908"></a>
<a name="4909"></a>    <font class="source_keyword">function</font> AnimEnd()
<a name="4910"></a>    {
<a name="4911"></a>        <font class="source_keyword">local</font> <font class="source_keyword">float</font> decision;
<a name="4912"></a>
<a name="4913"></a>        decision = FRand() - <font class="source_int">0.27</font> * skill - <font class="source_int">0.1</font>;
<a name="4914"></a>        <font class="source_keyword">if</font> ( (bFire == <font class="source_int">0</font>) && (bAltFire == <font class="source_int">0</font>) )
<a name="4915"></a>            decision = decision - <font class="source_int">0.5</font>;
<a name="4916"></a>        <font class="source_keyword">if</font> ( decision &lt; <font class="source_int">0</font> )
<a name="4917"></a>            GotoState(<font class="source_name">'RangedAttack'</font>, <font class="source_name">'DoneFiring'</font>);
<a name="4918"></a>        <font class="source_keyword">else</font>
<a name="4919"></a>        {
<a name="4920"></a>            PlayWaiting();
<a name="4921"></a>            FireWeapon();
<a name="4922"></a>        }
<a name="4923"></a>    }
<a name="4924"></a>    
<a name="4925"></a>    <font class="source_keyword">function</font> SpecialFire()
<a name="4926"></a>    {
<a name="4927"></a>        bFiringPaused = <font class="source_keyword">true</font>;
<a name="4928"></a>        SetTimer(<font class="source_int">0.75</font> + VSize(Target.Location - Location)/Weapon.AltProjectileSpeed, <font class="source_keyword">false</font>);
<a name="4929"></a>        SpecialPause = <font class="source_int">0.0</font>;
<a name="4930"></a>        NextState = <font class="source_name">'Attacking'</font>;
<a name="4931"></a>        NextLabel = <font class="source_name">'Begin'</font>; 
<a name="4932"></a>    }
<a name="4933"></a>    
<a name="4934"></a>    <font class="source_keyword">function</font> BeginState()
<a name="4935"></a>    {
<a name="4936"></a>        Disable(<font class="source_name">'AnimEnd'</font>);
<a name="4937"></a>        <font class="source_keyword">if</font> ( bFiringPaused )
<a name="4938"></a>        {
<a name="4939"></a>            SetTimer(SpecialPause, <font class="source_keyword">false</font>);
<a name="4940"></a>            SpecialPause = <font class="source_int">0</font>;
<a name="4941"></a>        }
<a name="4942"></a>        <font class="source_keyword">else</font>
<a name="4943"></a>            Target = Enemy;
<a name="4944"></a>    }
<a name="4945"></a>    
<a name="4946"></a>    <font class="source_keyword">function</font> EndState()
<a name="4947"></a>    {
<a name="4948"></a>        bFiringPaused = <font class="source_keyword">false</font>;
<a name="4949"></a>    }
<a name="4950"></a>
<a name="4951"></a><font class="source_type"><a href="..\botpack\challenge.html" class="source">Challenge</a></font>:
<a name="4952"></a>    Disable(<font class="source_name">'AnimEnd'</font>);
<a name="4953"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>); <font class="source_comment">//stop
</font><a name="4954"></a>    DesiredRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(Enemy.Location - Location);
<a name="4955"></a>    PlayChallenge();
<a name="4956"></a>    FinishAnim();
<a name="4957"></a>    <font class="source_keyword">if</font> ( bCrouching && !<font class="source_type"><a href="..\uwindow\uwindowbase.html#Region" class="source">Region</a></font>.Zone.bWaterZone )
<a name="4958"></a>        Sleep(<font class="source_int">0.8</font> + FRand());
<a name="4959"></a>    bCrouching = <font class="source_keyword">false</font>;
<a name="4960"></a>    TweenToFighter(<font class="source_int">0.1</font>);
<a name="4961"></a>    Goto(<font class="source_name">'FaceTarget'</font>);
<a name="4962"></a>
<a name="4963"></a>Begin:
<a name="4964"></a>    <font class="source_keyword">if</font> ( Target == <font class="source_keyword">None</font> )
<a name="4965"></a>    {
<a name="4966"></a>        Target = Enemy;
<a name="4967"></a>        <font class="source_keyword">if</font> ( Target == <font class="source_keyword">None</font> )
<a name="4968"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="4969"></a>    }
<a name="4970"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>); <font class="source_comment">//stop
</font><a name="4971"></a>    DesiredRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(Target.Location - Location);
<a name="4972"></a>    TweenToFighter(<font class="source_int">0.15</font>);
<a name="4973"></a>    
<a name="4974"></a>FaceTarget:
<a name="4975"></a>    Disable(<font class="source_name">'AnimEnd'</font>);
<a name="4976"></a>    <font class="source_keyword">if</font> (NeedToTurn(Target.Location))
<a name="4977"></a>    {
<a name="4978"></a>        PlayTurning();
<a name="4979"></a>        TurnToward(Target);
<a name="4980"></a>        TweenToFighter(<font class="source_int">0.1</font>);
<a name="4981"></a>    }
<a name="4982"></a>    FinishAnim();
<a name="4983"></a>
<a name="4984"></a>ReadyToAttack:
<a name="4985"></a>    DesiredRotation = <font class="source_type"><a href="..\core\object.html#Rotator" class="source">Rotator</a></font>(Target.Location - Location);
<a name="4986"></a>    PlayRangedAttack();
<a name="4987"></a>    Enable(<font class="source_name">'AnimEnd'</font>);
<a name="4988"></a>Firing:
<a name="4989"></a>    <font class="source_keyword">if</font> ( Target == <font class="source_keyword">None</font> )
<a name="4990"></a>        GotoState(<font class="source_name">'Attacking'</font>);
<a name="4991"></a>    TurnToward(Target);
<a name="4992"></a>    Goto(<font class="source_name">'Firing'</font>);
<a name="4993"></a>DoneFiring:
<a name="4994"></a>    Disable(<font class="source_name">'AnimEnd'</font>);
<a name="4995"></a>    KeepAttacking();  
<a name="4996"></a>    Goto(<font class="source_name">'FaceTarget'</font>);
<a name="4997"></a>}
<a name="4998"></a>
<a name="4999"></a><font class="source_keyword">state</font> VictoryDance
<a name="5000"></a>{
<a name="5001"></a><font class="source_keyword">ignores</font> EnemyNotVisible; 
<a name="5002"></a>
<a name="5003"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="5004"></a>                            <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="5005"></a>    {
<a name="5006"></a>        Global.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="5007"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="5008"></a>            <font class="source_keyword">return</font>;
<a name="5009"></a>        Enemy = instigatedBy;
<a name="5010"></a>        <font class="source_keyword">if</font> ( NextState == <font class="source_name">'TakeHit'</font> )
<a name="5011"></a>        {
<a name="5012"></a>            NextState = <font class="source_name">'Attacking'</font>; <font class="source_comment">//default
</font><a name="5013"></a>            NextLabel = <font class="source_name">'Begin'</font>;
<a name="5014"></a>            GotoState(<font class="source_name">'TakeHit'</font>); 
<a name="5015"></a>        }
<a name="5016"></a>        <font class="source_keyword">else</font> <font class="source_keyword">if</font> (<font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &gt; <font class="source_int">0</font>)
<a name="5017"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="5018"></a>    }
<a name="5019"></a>
<a name="5020"></a>    <font class="source_keyword">function</font> EnemyAcquired()
<a name="5021"></a>    {
<a name="5022"></a>        GotoState(<font class="source_name">'Acquisition'</font>);
<a name="5023"></a>    }
<a name="5024"></a>    
<a name="5025"></a>    <font class="source_keyword">function</font> BeginState()
<a name="5026"></a>    {
<a name="5027"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt; <font class="source_int">0</font> )
<a name="5028"></a>            log(self$<font class="source_string">" victory dance while dead"</font>);
<a name="5029"></a>        SpecialGoal = <font class="source_keyword">None</font>;
<a name="5030"></a>        SpecialPause = <font class="source_int">0.0</font>;
<a name="5031"></a>        SetAlertness(-<font class="source_int">0.3</font>);
<a name="5032"></a>    }
<a name="5033"></a>
<a name="5034"></a>Begin:
<a name="5035"></a>    Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="5036"></a>    TweenToFighter(<font class="source_int">0.2</font>);
<a name="5037"></a>    FinishAnim();
<a name="5038"></a>    PlayTurning();
<a name="5039"></a>    TurnToward(Target);
<a name="5040"></a>    DesiredRotation = rot(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="5041"></a>    DesiredRotation.Yaw = Rotation.Yaw;
<a name="5042"></a>    setRotation(DesiredRotation);
<a name="5043"></a>    TweenToFighter(<font class="source_int">0.2</font>);
<a name="5044"></a>    FinishAnim();
<a name="5045"></a>    PlayVictoryDance();
<a name="5046"></a>    FinishAnim(); 
<a name="5047"></a>    WhatToDoNext(<font class="source_name">'Waiting'</font>,<font class="source_name">'TurnFromWall'</font>);
<a name="5048"></a>}
<a name="5049"></a>
<a name="5050"></a>
<a name="5051"></a><font class="source_keyword">state</font> GameEnded
<a name="5052"></a>{
<a name="5053"></a><font class="source_keyword">ignores</font> SeePlayer, EnemyNotVisible, HearNoise, TakeDamage, Died, Bump, <font class="source_type"><a href="..\engine\trigger.html" class="source">Trigger</a></font>, HitWall, HeadZoneChange, FootZoneChange, ZoneChange, Falling, WarnTarget, PainTimer;
<a name="5054"></a>
<a name="5055"></a>    <font class="source_keyword">function</font> BeginState()
<a name="5056"></a>    {
<a name="5057"></a>        bFire = <font class="source_int">0</font>;
<a name="5058"></a>        bAltFire = <font class="source_int">0</font>;
<a name="5059"></a>        <font class="source_keyword">Super</font>.BeginState();
<a name="5060"></a>    }
<a name="5061"></a>}
<a name="5062"></a>
<a name="5063"></a><font class="source_keyword">state</font> Dying
<a name="5064"></a>{
<a name="5065"></a><font class="source_keyword">ignores</font> SeePlayer, EnemyNotVisible, HearNoise, Died, Bump, <font class="source_type"><a href="..\engine\trigger.html" class="source">Trigger</a></font>, HitWall, HeadZoneChange, FootZoneChange, ZoneChange, Falling, WarnTarget, LongFall, SetFall, PainTimer;
<a name="5066"></a>
<a name="5067"></a>    <font class="source_keyword">function</font> ReStartPlayer()
<a name="5068"></a>    {
<a name="5069"></a>        <font class="source_keyword">if</font>( bHidden && <font class="source_type">Level</font>.Game.RestartPlayer(self) )
<a name="5070"></a>        {
<a name="5071"></a>            Velocity = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="5072"></a>            Acceleration = vect(<font class="source_int">0</font>,<font class="source_int">0</font>,<font class="source_int">0</font>);
<a name="5073"></a>            ViewRotation = Rotation;
<a name="5074"></a>            ReSetSkill();
<a name="5075"></a>            SetPhysics(PHYS_Falling);
<a name="5076"></a>            GotoState(<font class="source_name">'Roaming'</font>);
<a name="5077"></a>        }
<a name="5078"></a>        <font class="source_keyword">else</font>
<a name="5079"></a>            GotoState(<font class="source_name">'Dying'</font>, <font class="source_name">'TryAgain'</font>);
<a name="5080"></a>    }
<a name="5081"></a>    
<a name="5082"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="5083"></a>                            <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="5084"></a>    {
<a name="5085"></a>        <font class="source_keyword">if</font> ( !bHidden )
<a name="5086"></a>            <font class="source_keyword">Super</font>.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="5087"></a>    }
<a name="5088"></a>    
<a name="5089"></a>    <font class="source_keyword">function</font> BeginState()
<a name="5090"></a>    {
<a name="5091"></a>        SetTimer(<font class="source_int">0</font>, <font class="source_keyword">false</font>);
<a name="5092"></a>        Enemy = <font class="source_keyword">None</font>;
<a name="5093"></a>        AmbushSpot = <font class="source_keyword">None</font>;
<a name="5094"></a>        bFire = <font class="source_int">0</font>;
<a name="5095"></a>        bAltFire = <font class="source_int">0</font>;
<a name="5096"></a>    }
<a name="5097"></a>
<a name="5098"></a>    <font class="source_keyword">function</font> EndState()
<a name="5099"></a>    {
<a name="5100"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">Health</a></font> &lt;= <font class="source_int">0</font> )
<a name="5101"></a>            log(self$<font class="source_string">" health still &lt;0"</font>);
<a name="5102"></a>    }
<a name="5103"></a>
<a name="5104"></a>Begin:
<a name="5105"></a>    Sleep(<font class="source_int">0.2</font>);
<a name="5106"></a>    <font class="source_keyword">if</font> ( !bHidden )
<a name="5107"></a>    {
<a name="5108"></a>        SpawnCarcass();
<a name="5109"></a>        HidePlayer();
<a name="5110"></a>    }
<a name="5111"></a>TryAgain:
<a name="5112"></a>    Sleep(<font class="source_int">0.25</font> + <font class="source_type"><a href="..\unrealshare\deathmatchgame.html" class="source">DeathMatchGame</a></font>(<font class="source_type">Level</font>.Game).NumBots * FRand());
<a name="5113"></a>    ReStartPlayer();
<a name="5114"></a>    Goto(<font class="source_name">'TryAgain'</font>);
<a name="5115"></a>WaitingForStart:
<a name="5116"></a>    bHidden = <font class="source_keyword">true</font>;
<a name="5117"></a>}
<a name="5118"></a>
<a name="5119"></a><font class="source_comment">//FIXME - improve FindAir (use paths)
</font><a name="5120"></a><font class="source_keyword">state</font> FindAir
<a name="5121"></a>{
<a name="5122"></a><font class="source_keyword">ignores</font> SeePlayer, HearNoise, Bump;
<a name="5123"></a>
<a name="5124"></a>    <font class="source_keyword">function</font> HeadZoneChange(<font class="source_type"><a href="..\engine\zoneinfo.html" class="source">ZoneInfo</a></font> newHeadZone)
<a name="5125"></a>    {
<a name="5126"></a>        Global.HeadZoneChange(newHeadZone);
<a name="5127"></a>        <font class="source_keyword">if</font> (!newHeadZone.bWaterZone)
<a name="5128"></a>            GotoState(<font class="source_name">'Attacking'</font>);
<a name="5129"></a>    }
<a name="5130"></a>
<a name="5131"></a>    <font class="source_keyword">function</font> TakeDamage( <font class="source_keyword">int</font> Damage, <font class="source_type"><a href="..\engine\pawn.html" class="source">Pawn</a></font> instigatedBy, <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> hitlocation, 
<a name="5132"></a>                        <font class="source_type"><a href="..\core\object.html#Vector" class="source">Vector</a></font> momentum, <font class="source_keyword">name</font> <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>)
<a name="5133"></a>    {
<a name="5134"></a>        <font class="source_keyword">Super</font>.TakeDamage(Damage, instigatedBy, hitlocation, momentum, <font class="source_type"><a href="..\engine\damagetype.html" class="source">damageType</a></font>);
<a name="5135"></a>        <font class="source_keyword">if</font> ( <font class="source_type"><a href="..\unrealshare\health.html" class="source">health</a></font> &lt;= <font class="source_int">0</font> )
<a name="5136"></a>            <font class="source_keyword">return</font>;
<a name="5137"></a>        <font class="source_keyword">if</font> ( NextState == <font class="source_name">'TakeHit'</font> )
<a name="5138"></a>        {
<a name="5139"></a>            NextState = <font class="source_name">'FindAir'</font>; 
<a name="5140"></a>            NextLabel = <font class="source_name">'TakeHit'</font>;
<a name="5141"></a>            GotoState(<font class="source_name">'TakeHit'</font>); 
<a name="5142"></a>        }
<a name="5143"></a>    }
<a name="5144"></a>
<a name="5145"></a>    <font class="source_keyword">function</font> HitWall(<font class="source_type"><a href="..\core\object.html#Vector" class="source">vector</a></font> HitNormal, <font class="source_type"><a href="..\engine\actor.html" class="source">actor</a></font> Wall)
<a name="5146"></a>    {
<a name="5147"></a>        <font class="source_comment">//change directions
</font><a name="5148"></a>        Destination = <font class="source_int">200</font> * (Normal(Destination - Location) + HitNormal);
<a name="5149"></a>    }
<a name="5150"></a>
<a name="5151"></a>    <font class="source_keyword">function</font> AnimEnd() 
<a name="5152"></a>    {
<a name="5153"></a>        <font class="source_keyword">if</font> (Enemy != <font class="source_keyword">None</font>)
<a name="5154"></a>            PlayCombatMove();
<a name="5155"></a>        <font class="source_keyword">else</font>
<a name="5156"></a>            PlayRunning();
<a name="5157"></a>    }
<a name="5158"></a>
<a name="5159"></a>    <font class="source_keyword">function</font> Timer()
<a name="5160"></a>    {
<a name="5161"></a>        bReadyToAttack = <font class="source_keyword">True</font>;
<a name="5162"></a>        settimer(<font class="source_int">0.5</font>, <font class="source_keyword">false</font>);
<a name="5163"></a>    }
<a name="5164"></a>
<a name="5165"></a>    <font class="source_keyword">function</font> EnemyNotVisible()
<a name="5166"></a>    {
<a name="5167"></a>        <font class="source_comment">////log("enemy not visible");
</font><a name="5168"></a>        bReadyToAttack = <font class="source_keyword">false</font>;
<a name="5169"></a>    }
<a name="5170"></a>
<a name="5171"></a><font class="source_comment">/* PickDestination()
<a name="5172"></a>*/</font>
<a name="5173"></a>    <font class="source_keyword">function</font> PickDestination(<font class="source_keyword">bool</font> bNoCharge)
<a name="5174"></a>    {
<a name="5175"></a>        Destination = VRand();
<a name="5176"></a>        Destination.Z = <font class="source_int">1</font>;
<a name="5177"></a>        Destination = Location + <font class="source_int">200</font> * Destination;             
<a name="5178"></a>    }
<a name="5179"></a>
<a name="5180"></a>Begin:
<a name="5181"></a>    <font class="source_comment">//log("Find air");
</font><a name="5182"></a>    TweenToRunning(<font class="source_int">0.2</font>);
<a name="5183"></a>    Enable(<font class="source_name">'AnimEnd'</font>);
<a name="5184"></a>    PickDestination(<font class="source_keyword">false</font>);
<a name="5185"></a>
<a name="5186"></a>DoMove: 
<a name="5187"></a>    <font class="source_keyword">if</font> ( Enemy == <font class="source_keyword">None</font> )
<a name="5188"></a>        MoveTo(Destination);
<a name="5189"></a>    <font class="source_keyword">else</font>
<a name="5190"></a>    {
<a name="5191"></a>        bCanFire = <font class="source_keyword">true</font>;
<a name="5192"></a>        StrafeFacing(Destination, Enemy);   
<a name="5193"></a>    }
<a name="5194"></a>    GotoState(<font class="source_name">'Attacking'</font>);
<a name="5195"></a>
<a name="5196"></a>TakeHit:
<a name="5197"></a>    TweenToRunning(<font class="source_int">0.15</font>);
<a name="5198"></a>    Goto(<font class="source_name">'DoMove'</font>);
<a name="5199"></a>
<a name="5200"></a>}
<a name="5201"></a>
<a name="5202"></a><font class="source_keyword2">static</font> <font class="source_keyword">function</font> SetMultiSkin( <font class="source_type"><a href="..\engine\actor.html" class="source">Actor</a></font> SkinActor, <font class="source_keyword">string</font> SkinName, <font class="source_keyword">string</font> FaceName, <font class="source_keyword">byte</font> TeamNum )
<a name="5203"></a>{
<a name="5204"></a>    <font class="source_keyword">local</font> <font class="source_type"><a href="..\engine\texture.html" class="source">Texture</a></font> NewSkin;
<a name="5205"></a>    <font class="source_keyword">local</font> <font class="source_keyword">string</font> MeshName;
<a name="5206"></a>    <font class="source_keyword">local</font> <font class="source_keyword">int</font> i;
<a name="5207"></a>    <font class="source_keyword">local</font> <font class="source_keyword">string</font> TeamColor[<font class="source_int">4</font>];
<a name="5208"></a>
<a name="5209"></a>    TeamColor[<font class="source_int">0</font>]=<font class="source_string">"Red"</font>;
<a name="5210"></a>    TeamColor[<font class="source_int">1</font>]=<font class="source_string">"Blue"</font>;
<a name="5211"></a>    TeamColor[<font class="source_int">2</font>]=<font class="source_string">"Green"</font>;
<a name="5212"></a>    TeamColor[<font class="source_int">3</font>]=<font class="source_string">"Gold"</font>;
<a name="5213"></a>
<a name="5214"></a>    MeshName = SkinActor.GetItemName(<font class="source_keyword">string</font>(SkinActor.<font class="source_type">Mesh</font>));
<a name="5215"></a>
<a name="5216"></a>    <font class="source_keyword">if</font>(InStr(SkinName, <font class="source_string">"."</font>) == -<font class="source_int">1</font>)
<a name="5217"></a>        SkinName = MeshName$<font class="source_string">"Skins."</font>$SkinName;
<a name="5218"></a>
<a name="5219"></a>    <font class="source_keyword">if</font>(TeamNum &gt;=<font class="source_int">0</font> && TeamNum &lt;= <font class="source_int">3</font>)
<a name="5220"></a>        NewSkin = <font class="source_type"><a href="..\engine\texture.html" class="source">texture</a></font>(DynamicLoadObject(MeshName$<font class="source_string">"Skins.T_"</font>$TeamColor[TeamNum], <font class="source_keyword">class</font><font class="source_name">'Texture'</font>));
<a name="5221"></a>    <font class="source_keyword">else</font> <font class="source_keyword">if</font>( Left(SkinName, Len(MeshName)) ~= MeshName )
<a name="5222"></a>        NewSkin = <font class="source_type"><a href="..\engine\texture.html" class="source">texture</a></font>(DynamicLoadObject(SkinName, <font class="source_keyword">class</font><font class="source_name">'Texture'</font>));
<a name="5223"></a>
<a name="5224"></a>    <font class="source_comment">// Set skin
</font><a name="5225"></a>    <font class="source_keyword">if</font> ( NewSkin != <font class="source_keyword">None</font> )
<a name="5226"></a>        SkinActor.Skin = NewSkin;
<a name="5227"></a>}
<a name="5228"></a>
<a name="5229"></a><font class="source_keyword">defaultproperties</font>
<a name="5230"></a>{
<a name="5231"></a>     bIsPlayer=<font class="source_keyword">true</font>
<a name="5232"></a>     CarcassType=<font class="source_keyword">Class</font><font class="source_name">'UnrealShare.CreatureCarcass'</font>
<a name="5233"></a>     TimeBetweenAttacks=<font class="source_int">1.000000</font>
<a name="5234"></a>     WalkingSpeed=<font class="source_int">0.400000</font>
<a name="5235"></a>     bLeadTarget=<font class="source_keyword">True</font>
<a name="5236"></a>     bWarnTarget=<font class="source_keyword">True</font>
<a name="5237"></a>     HearingThreshold=<font class="source_int">0.300000</font>
<a name="5238"></a>     Land=<font class="source_type">Sound</font><font class="source_name">'UnrealShare.Generic.Land1'</font>
<a name="5239"></a>     WaterStep=<font class="source_type">Sound</font><font class="source_name">'UnrealShare.Generic.LSplash'</font>
<a name="5240"></a>     SightRadius=+<font class="source_int">03000.000000</font>
<a name="5241"></a>     Aggressiveness=+<font class="source_int">00000.200000</font>
<a name="5242"></a>     ReFireRate=+<font class="source_int">00000.900000</font>
<a name="5243"></a>     BaseEyeHeight=+<font class="source_int">00023.000000</font>
<a name="5244"></a>     UnderWaterTime=+<font class="source_int">00020.000000</font>
<a name="5245"></a>     bCanStrafe=<font class="source_keyword">True</font>
<a name="5246"></a>     bAutoActivate=<font class="source_keyword">True</font>
<a name="5247"></a>     MeleeRange=+<font class="source_int">00050.000000</font>
<a name="5248"></a>     Intelligence=BRAINS_HUMAN
<a name="5249"></a>     GroundSpeed=+<font class="source_int">00400.000000</font>
<a name="5250"></a>     AirSpeed=+<font class="source_int">00400.000000</font>
<a name="5251"></a>     AccelRate=+<font class="source_int">02048.000000</font>
<a name="5252"></a>     MaxStepHeight=+<font class="source_int">00025.000000</font>
<a name="5253"></a>     CombatStyle=+<font class="source_int">00000.00000</font>
<a name="5254"></a>     DrawType=DT_Mesh
<a name="5255"></a>     LightBrightness=<font class="source_int">70</font>
<a name="5256"></a>     LightHue=<font class="source_int">40</font>
<a name="5257"></a>     LightSaturation=<font class="source_int">128</font>
<a name="5258"></a>     LightRadius=<font class="source_int">6</font>
<a name="5259"></a>     bStasis=<font class="source_keyword">false</font>
<a name="5260"></a>     Buoyancy=+<font class="source_int">00100.000000</font>
<a name="5261"></a>     RotationRate=(Pitch=<font class="source_int">3072</font>,Yaw=<font class="source_int">30000</font>,Roll=<font class="source_int">2048</font>)
<a name="5262"></a>     NetPriority=+<font class="source_int">00003.000000</font>
<a name="5263"></a>}
<a name="5264"></a>
<a name="5265"></a>
<a name="5266"></a>
<a name="5267"></a></pre></td></tr></table></div>
<hr>
<table class="header">
<tr class="header">
	<td class="header"><a href="..\overview.html">Overview</a></td>
	<td class="header"><a href="..\unrealshare\unrealshare-overview.html">Package</a></td>
	<td class="header"><a href="..\unrealshare\bots.html">Class</a></td>
	<td class="header_hilight">Source</td>
	<td class="header"><a class="header" href="..\classtree.html#Bots">Class tree</a></td>
	<td class="header"><a class="header" href="..\glossary_A.html">Glossary</a></a>
	<td class="logo" rowspan="2">UnrealScript<br />Documentation</td>
</tr>
<tr>
	<td class="subheader" colspan="3"><a href="botinfo.html">previous class</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="boulder.html">next class</a></td>
	<td class="subheader" colspan="2"><a href="..\index.html" target="_top">frames</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="" target="_top">no frames</a></td>
</tr>
</table>

<div class="stats">Class file time: Mon 24/5/2004 11:25:58.000 - Creation time: Wed 26/5/2004 10:48:09.187 - Created with <a href="http://wiki.beyondunreal.com/wiki/UnCodeX" target="_blank">UnCodeX</a></div>

</body>
</html>